(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();function Jy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Rm={exports:{}},$p={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag;function lx(){if(ag)return $p;ag=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function n(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var c in o)c!=="key"&&(u[c]=o[c])}else u=o;return o=u.ref,{$$typeof:t,type:a,key:d,ref:o!==void 0?o:null,props:u}}return $p.Fragment=r,$p.jsx=n,$p.jsxs=n,$p}var ig;function ux(){return ig||(ig=1,Rm.exports=lx()),Rm.exports}var $e=ux(),Bm={exports:{}},ln={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var og;function cx(){if(og)return ln;og=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function h(q){return q===null||typeof q!="object"?null:(q=_&&q[_]||q["@@iterator"],typeof q=="function"?q:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,x={};function F(q,j,R){this.props=q,this.context=j,this.refs=x,this.updater=R||w}F.prototype.isReactComponent={},F.prototype.setState=function(q,j){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,j,"setState")},F.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function E(){}E.prototype=F.prototype;function T(q,j,R){this.props=q,this.context=j,this.refs=x,this.updater=R||w}var L=T.prototype=new E;L.constructor=T,M(L,F.prototype),L.isPureReactComponent=!0;var O=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function C(q,j,R,X,G,pe){return R=pe.ref,{$$typeof:t,type:q,key:j,ref:R!==void 0?R:null,props:pe}}function k(q,j){return C(q.type,j,void 0,void 0,void 0,q.props)}function U(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function V(q){var j={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(R){return j[R]})}var re=/\/+/g;function ne(q,j){return typeof q=="object"&&q!==null&&q.key!=null?V(""+q.key):j.toString(36)}function W(){}function ce(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(W,W):(q.status="pending",q.then(function(j){q.status==="pending"&&(q.status="fulfilled",q.value=j)},function(j){q.status==="pending"&&(q.status="rejected",q.reason=j)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function ae(q,j,R,X,G){var pe=typeof q;(pe==="undefined"||pe==="boolean")&&(q=null);var Te=!1;if(q===null)Te=!0;else switch(pe){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(q.$$typeof){case t:case r:Te=!0;break;case g:return Te=q._init,ae(Te(q._payload),j,R,X,G)}}if(Te)return G=G(q),Te=X===""?"."+ne(q,0):X,O(G)?(R="",Te!=null&&(R=Te.replace(re,"$&/")+"/"),ae(G,j,R,"",function(dt){return dt})):G!=null&&(U(G)&&(G=k(G,R+(G.key==null||q&&q.key===G.key?"":(""+G.key).replace(re,"$&/")+"/")+Te)),j.push(G)),1;Te=0;var Ie=X===""?".":X+":";if(O(q))for(var Ne=0;Ne<q.length;Ne++)X=q[Ne],pe=Ie+ne(X,Ne),Te+=ae(X,j,R,pe,G);else if(Ne=h(q),typeof Ne=="function")for(q=Ne.call(q),Ne=0;!(X=q.next()).done;)X=X.value,pe=Ie+ne(X,Ne++),Te+=ae(X,j,R,pe,G);else if(pe==="object"){if(typeof q.then=="function")return ae(ce(q),j,R,X,G);throw j=String(q),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return Te}function H(q,j,R){if(q==null)return q;var X=[],G=0;return ae(q,X,"","",function(pe){return j.call(R,pe,G++)}),X}function se(q){if(q._status===-1){var j=q._result;j=j(),j.then(function(R){(q._status===0||q._status===-1)&&(q._status=1,q._result=R)},function(R){(q._status===0||q._status===-1)&&(q._status=2,q._result=R)}),q._status===-1&&(q._status=0,q._result=j)}if(q._status===1)return q._result.default;throw q._result}var ie=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)};function ge(){}return ln.Children={map:H,forEach:function(q,j,R){H(q,function(){j.apply(this,arguments)},R)},count:function(q){var j=0;return H(q,function(){j++}),j},toArray:function(q){return H(q,function(j){return j})||[]},only:function(q){if(!U(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},ln.Component=F,ln.Fragment=n,ln.Profiler=o,ln.PureComponent=T,ln.StrictMode=a,ln.Suspense=f,ln.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,ln.__COMPILER_RUNTIME={__proto__:null,c:function(q){return S.H.useMemoCache(q)}},ln.cache=function(q){return function(){return q.apply(null,arguments)}},ln.cloneElement=function(q,j,R){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var X=M({},q.props),G=q.key,pe=void 0;if(j!=null)for(Te in j.ref!==void 0&&(pe=void 0),j.key!==void 0&&(G=""+j.key),j)!$.call(j,Te)||Te==="key"||Te==="__self"||Te==="__source"||Te==="ref"&&j.ref===void 0||(X[Te]=j[Te]);var Te=arguments.length-2;if(Te===1)X.children=R;else if(1<Te){for(var Ie=Array(Te),Ne=0;Ne<Te;Ne++)Ie[Ne]=arguments[Ne+2];X.children=Ie}return C(q.type,G,void 0,void 0,pe,X)},ln.createContext=function(q){return q={$$typeof:d,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:u,_context:q},q},ln.createElement=function(q,j,R){var X,G={},pe=null;if(j!=null)for(X in j.key!==void 0&&(pe=""+j.key),j)$.call(j,X)&&X!=="key"&&X!=="__self"&&X!=="__source"&&(G[X]=j[X]);var Te=arguments.length-2;if(Te===1)G.children=R;else if(1<Te){for(var Ie=Array(Te),Ne=0;Ne<Te;Ne++)Ie[Ne]=arguments[Ne+2];G.children=Ie}if(q&&q.defaultProps)for(X in Te=q.defaultProps,Te)G[X]===void 0&&(G[X]=Te[X]);return C(q,pe,void 0,void 0,null,G)},ln.createRef=function(){return{current:null}},ln.forwardRef=function(q){return{$$typeof:c,render:q}},ln.isValidElement=U,ln.lazy=function(q){return{$$typeof:g,_payload:{_status:-1,_result:q},_init:se}},ln.memo=function(q,j){return{$$typeof:p,type:q,compare:j===void 0?null:j}},ln.startTransition=function(q){var j=S.T,R={};S.T=R;try{var X=q(),G=S.S;G!==null&&G(R,X),typeof X=="object"&&X!==null&&typeof X.then=="function"&&X.then(ge,ie)}catch(pe){ie(pe)}finally{S.T=j}},ln.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},ln.use=function(q){return S.H.use(q)},ln.useActionState=function(q,j,R){return S.H.useActionState(q,j,R)},ln.useCallback=function(q,j){return S.H.useCallback(q,j)},ln.useContext=function(q){return S.H.useContext(q)},ln.useDebugValue=function(){},ln.useDeferredValue=function(q,j){return S.H.useDeferredValue(q,j)},ln.useEffect=function(q,j,R){var X=S.H;if(typeof R=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return X.useEffect(q,j)},ln.useId=function(){return S.H.useId()},ln.useImperativeHandle=function(q,j,R){return S.H.useImperativeHandle(q,j,R)},ln.useInsertionEffect=function(q,j){return S.H.useInsertionEffect(q,j)},ln.useLayoutEffect=function(q,j){return S.H.useLayoutEffect(q,j)},ln.useMemo=function(q,j){return S.H.useMemo(q,j)},ln.useOptimistic=function(q,j){return S.H.useOptimistic(q,j)},ln.useReducer=function(q,j,R){return S.H.useReducer(q,j,R)},ln.useRef=function(q){return S.H.useRef(q)},ln.useState=function(q){return S.H.useState(q)},ln.useSyncExternalStore=function(q,j,R){return S.H.useSyncExternalStore(q,j,R)},ln.useTransition=function(){return S.H.useTransition()},ln.version="19.1.1",ln}var lg;function c1(){return lg||(lg=1,Bm.exports=cx()),Bm.exports}var xt=c1();const dx=Jy(xt);var Nm={exports:{}},Dp={},jm={exports:{}},Um={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ug;function fx(){return ug||(ug=1,(function(t){function r(H,se){var ie=H.length;H.push(se);e:for(;0<ie;){var ge=ie-1>>>1,q=H[ge];if(0<o(q,se))H[ge]=se,H[ie]=q,ie=ge;else break e}}function n(H){return H.length===0?null:H[0]}function a(H){if(H.length===0)return null;var se=H[0],ie=H.pop();if(ie!==se){H[0]=ie;e:for(var ge=0,q=H.length,j=q>>>1;ge<j;){var R=2*(ge+1)-1,X=H[R],G=R+1,pe=H[G];if(0>o(X,ie))G<q&&0>o(pe,X)?(H[ge]=pe,H[G]=ie,ge=G):(H[ge]=X,H[R]=ie,ge=R);else if(G<q&&0>o(pe,ie))H[ge]=pe,H[G]=ie,ge=G;else break e}}return se}function o(H,se){var ie=H.sortIndex-se.sortIndex;return ie!==0?ie:H.id-se.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var d=Date,c=d.now();t.unstable_now=function(){return d.now()-c}}var f=[],p=[],g=1,_=null,h=3,w=!1,M=!1,x=!1,F=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function O(H){for(var se=n(p);se!==null;){if(se.callback===null)a(p);else if(se.startTime<=H)a(p),se.sortIndex=se.expirationTime,r(f,se);else break;se=n(p)}}function S(H){if(x=!1,O(H),!M)if(n(f)!==null)M=!0,$||($=!0,ne());else{var se=n(p);se!==null&&ae(S,se.startTime-H)}}var $=!1,C=-1,k=5,U=-1;function V(){return F?!0:!(t.unstable_now()-U<k)}function re(){if(F=!1,$){var H=t.unstable_now();U=H;var se=!0;try{e:{M=!1,x&&(x=!1,T(C),C=-1),w=!0;var ie=h;try{t:{for(O(H),_=n(f);_!==null&&!(_.expirationTime>H&&V());){var ge=_.callback;if(typeof ge=="function"){_.callback=null,h=_.priorityLevel;var q=ge(_.expirationTime<=H);if(H=t.unstable_now(),typeof q=="function"){_.callback=q,O(H),se=!0;break t}_===n(f)&&a(f),O(H)}else a(f);_=n(f)}if(_!==null)se=!0;else{var j=n(p);j!==null&&ae(S,j.startTime-H),se=!1}}break e}finally{_=null,h=ie,w=!1}se=void 0}}finally{se?ne():$=!1}}}var ne;if(typeof L=="function")ne=function(){L(re)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,ce=W.port2;W.port1.onmessage=re,ne=function(){ce.postMessage(null)}}else ne=function(){E(re,0)};function ae(H,se){C=E(function(){H(t.unstable_now())},se)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_next=function(H){switch(h){case 1:case 2:case 3:var se=3;break;default:se=h}var ie=h;h=se;try{return H()}finally{h=ie}},t.unstable_requestPaint=function(){F=!0},t.unstable_runWithPriority=function(H,se){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var ie=h;h=H;try{return se()}finally{h=ie}},t.unstable_scheduleCallback=function(H,se,ie){var ge=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?ge+ie:ge):ie=ge,H){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=ie+q,H={id:g++,callback:se,priorityLevel:H,startTime:ie,expirationTime:q,sortIndex:-1},ie>ge?(H.sortIndex=ie,r(p,H),n(f)===null&&H===n(p)&&(x?(T(C),C=-1):x=!0,ae(S,ie-ge))):(H.sortIndex=q,r(f,H),M||w||(M=!0,$||($=!0,ne()))),H},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(H){var se=h;return function(){var ie=h;h=se;try{return H.apply(this,arguments)}finally{h=ie}}}})(Um)),Um}var cg;function px(){return cg||(cg=1,jm.exports=fx()),jm.exports}var Vm={exports:{}},gr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dg;function hx(){if(dg)return gr;dg=1;var t=c1();function r(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var a={d:{f:n,r:function(){throw Error(r(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(f,p,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:_==null?null:""+_,children:f,containerInfo:p,implementation:g}}var d=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,p){if(f==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return gr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,gr.createPortal=function(f,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(r(299));return u(f,p,null,g)},gr.flushSync=function(f){var p=d.T,g=a.p;try{if(d.T=null,a.p=2,f)return f()}finally{d.T=p,a.p=g,a.d.f()}},gr.preconnect=function(f,p){typeof f=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(f,p))},gr.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},gr.preinit=function(f,p){if(typeof f=="string"&&p&&typeof p.as=="string"){var g=p.as,_=c(g,p.crossOrigin),h=typeof p.integrity=="string"?p.integrity:void 0,w=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?a.d.S(f,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:_,integrity:h,fetchPriority:w}):g==="script"&&a.d.X(f,{crossOrigin:_,integrity:h,fetchPriority:w,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},gr.preinitModule=function(f,p){if(typeof f=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=c(p.as,p.crossOrigin);a.d.M(f,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(f)},gr.preload=function(f,p){if(typeof f=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,_=c(g,p.crossOrigin);a.d.L(f,g,{crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},gr.preloadModule=function(f,p){if(typeof f=="string")if(p){var g=c(p.as,p.crossOrigin);a.d.m(f,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(f)},gr.requestFormReset=function(f){a.d.r(f)},gr.unstable_batchedUpdates=function(f,p){return f(p)},gr.useFormState=function(f,p,g){return d.H.useFormState(f,p,g)},gr.useFormStatus=function(){return d.H.useHostTransitionStatus()},gr.version="19.1.1",gr}var fg;function mx(){if(fg)return Vm.exports;fg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}return t(),Vm.exports=hx(),Vm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pg;function _x(){if(pg)return Dp;pg=1;var t=px(),r=c1(),n=mx();function a(e){var s="https://react.dev/errors/"+e;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)s+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var s=e,i=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,(s.flags&4098)!==0&&(i=s.return),e=s.return;while(e)}return s.tag===3?i:null}function d(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function c(e){if(u(e)!==e)throw Error(a(188))}function f(e){var s=e.alternate;if(!s){if(s=u(e),s===null)throw Error(a(188));return s!==e?null:e}for(var i=e,l=s;;){var m=i.return;if(m===null)break;var v=m.alternate;if(v===null){if(l=m.return,l!==null){i=l;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===i)return c(m),e;if(v===l)return c(m),s;v=v.sibling}throw Error(a(188))}if(i.return!==l.return)i=m,l=v;else{for(var B=!1,Z=m.child;Z;){if(Z===i){B=!0,i=m,l=v;break}if(Z===l){B=!0,l=m,i=v;break}Z=Z.sibling}if(!B){for(Z=v.child;Z;){if(Z===i){B=!0,i=v,l=m;break}if(Z===l){B=!0,l=v,i=m;break}Z=Z.sibling}if(!B)throw Error(a(189))}}if(i.alternate!==l)throw Error(a(190))}if(i.tag!==3)throw Error(a(188));return i.stateNode.current===i?e:s}function p(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e;for(e=e.child;e!==null;){if(s=p(e),s!==null)return s;e=e.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),h=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),T=Symbol.for("react.consumer"),L=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),re=Symbol.iterator;function ne(e){return e===null||typeof e!="object"?null:(e=re&&e[re]||e["@@iterator"],typeof e=="function"?e:null)}var W=Symbol.for("react.client.reference");function ce(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===W?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case M:return"Fragment";case F:return"Profiler";case x:return"StrictMode";case S:return"Suspense";case $:return"SuspenseList";case U:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case w:return"Portal";case L:return(e.displayName||"Context")+".Provider";case T:return(e._context.displayName||"Context")+".Consumer";case O:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case C:return s=e.displayName||null,s!==null?s:ce(e.type)||"Memo";case k:s=e._payload,e=e._init;try{return ce(e(s))}catch{}}return null}var ae=Array.isArray,H=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie={pending:!1,data:null,method:null,action:null},ge=[],q=-1;function j(e){return{current:e}}function R(e){0>q||(e.current=ge[q],ge[q]=null,q--)}function X(e,s){q++,ge[q]=e.current,e.current=s}var G=j(null),pe=j(null),Te=j(null),Ie=j(null);function Ne(e,s){switch(X(Te,s),X(pe,e),X(G,null),s.nodeType){case 9:case 11:e=(e=s.documentElement)&&(e=e.namespaceURI)?es(e):0;break;default:if(e=s.tagName,s=s.namespaceURI)s=es(s),e=As(s,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}R(G),X(G,e)}function dt(){R(G),R(pe),R(Te)}function je(e){e.memoizedState!==null&&X(Ie,e);var s=G.current,i=As(s,e.type);s!==i&&(X(pe,e),X(G,i))}function oe(e){pe.current===e&&(R(G),R(pe)),Ie.current===e&&(R(Ie),Cp._currentValue=ie)}var ve=Object.prototype.hasOwnProperty,te=t.unstable_scheduleCallback,De=t.unstable_cancelCallback,Xe=t.unstable_shouldYield,Be=t.unstable_requestPaint,Ee=t.unstable_now,Ve=t.unstable_getCurrentPriorityLevel,ke=t.unstable_ImmediatePriority,Ke=t.unstable_UserBlockingPriority,et=t.unstable_NormalPriority,ht=t.unstable_LowPriority,Re=t.unstable_IdlePriority,Tt=t.log,ut=t.unstable_setDisableYieldValue,st=null,mt=null;function ct(e){if(typeof Tt=="function"&&ut(e),mt&&typeof mt.setStrictMode=="function")try{mt.setStrictMode(st,e)}catch{}}var lt=Math.clz32?Math.clz32:un,bt=Math.log,nn=Math.LN2;function un(e){return e>>>=0,e===0?32:31-(bt(e)/nn|0)|0}var It=256,os=4194304;function Ts(e){var s=e&42;if(s!==0)return s;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Os(e,s,i){var l=e.pendingLanes;if(l===0)return 0;var m=0,v=e.suspendedLanes,B=e.pingedLanes;e=e.warmLanes;var Z=l&134217727;return Z!==0?(l=Z&~v,l!==0?m=Ts(l):(B&=Z,B!==0?m=Ts(B):i||(i=Z&~e,i!==0&&(m=Ts(i))))):(Z=l&~v,Z!==0?m=Ts(Z):B!==0?m=Ts(B):i||(i=l&~e,i!==0&&(m=Ts(i)))),m===0?0:s!==0&&s!==m&&(s&v)===0&&(v=m&-m,i=s&-s,v>=i||v===32&&(i&4194048)!==0)?s:m}function Zs(e,s){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&s)===0}function Rn(e,s){switch(e){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $s(){var e=It;return It<<=1,(It&4194048)===0&&(It=256),e}function xa(){var e=os;return os<<=1,(os&62914560)===0&&(os=4194304),e}function Zr(e){for(var s=[],i=0;31>i;i++)s.push(e);return s}function br(e,s){e.pendingLanes|=s,s!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ta(e,s,i,l,m,v){var B=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var Z=e.entanglements,fe=e.expirationTimes,Pe=e.hiddenUpdates;for(i=B&~i;0<i;){var Qe=31-lt(i),Je=1<<Qe;Z[Qe]=0,fe[Qe]=-1;var Le=Pe[Qe];if(Le!==null)for(Pe[Qe]=null,Qe=0;Qe<Le.length;Qe++){var ze=Le[Qe];ze!==null&&(ze.lane&=-536870913)}i&=~Je}l!==0&&Dt(e,l,0),v!==0&&m===0&&e.tag!==0&&(e.suspendedLanes|=v&~(B&~s))}function Dt(e,s,i){e.pendingLanes|=s,e.suspendedLanes&=~s;var l=31-lt(s);e.entangledLanes|=s,e.entanglements[l]=e.entanglements[l]|1073741824|i&4194090}function zr(e,s){var i=e.entangledLanes|=s;for(e=e.entanglements;i;){var l=31-lt(i),m=1<<l;m&s|e[l]&s&&(e[l]|=s),i&=~m}}function xn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function qt(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Fr(){var e=se.p;return e!==0?e:(e=window.event,e===void 0?32:J1(e.type))}function I(e,s){var i=se.p;try{return se.p=e,s()}finally{se.p=i}}var ue=Math.random().toString(36).slice(2),Y="__reactFiber$"+ue,le="__reactProps$"+ue,he="__reactContainer$"+ue,Se="__reactEvents$"+ue,He="__reactListeners$"+ue,Mt="__reactHandles$"+ue,Ct="__reactResources$"+ue,ft="__reactMarker$"+ue;function Xt(e){delete e[Y],delete e[le],delete e[Se],delete e[He],delete e[Mt]}function Kt(e){var s=e[Y];if(s)return s;for(var i=e.parentNode;i;){if(s=i[he]||i[Y]){if(i=s.alternate,s.child!==null||i!==null&&i.child!==null)for(e=Ih(e);e!==null;){if(i=e[Y])return i;e=Ih(e)}return s}e=i,i=e.parentNode}return null}function qn(e){if(e=e[Y]||e[he]){var s=e.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return e}return null}function dn(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e.stateNode;throw Error(a(33))}function Nn(e){var s=e[Ct];return s||(s=e[Ct]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Tn(e){e[ft]=!0}var Bn=new Set,cs={};function js(e,s){jn(e,s),jn(e+"Capture",s)}function jn(e,s){for(cs[e]=s,e=0;e<s.length;e++)Bn.add(s[e])}var Rr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pr={},Gs={};function Jr(e){return ve.call(Gs,e)?!0:ve.call(Pr,e)?!1:Rr.test(e)?Gs[e]=!0:(Pr[e]=!0,!1)}function lr(e,s,i){if(Jr(s))if(i===null)e.removeAttribute(s);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(s);return;case"boolean":var l=s.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(s);return}}e.setAttribute(s,""+i)}}function Un(e,s,i){if(i===null)e.removeAttribute(s);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttribute(s,""+i)}}function ds(e,s,i,l){if(l===null)e.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(s,i,""+l)}}var ns,gs;function Ws(e){if(ns===void 0)try{throw Error()}catch(i){var s=i.stack.trim().match(/\n( *(at )?)/);ns=s&&s[1]||"",gs=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ns+e+gs}var Ar=!1;function ar(e,s){if(!e||Ar)return"";Ar=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(s){var Je=function(){throw Error()};if(Object.defineProperty(Je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Je,[])}catch(ze){var Le=ze}Reflect.construct(e,[],Je)}else{try{Je.call()}catch(ze){Le=ze}e.call(Je.prototype)}}else{try{throw Error()}catch(ze){Le=ze}(Je=e())&&typeof Je.catch=="function"&&Je.catch(function(){})}}catch(ze){if(ze&&Le&&typeof ze.stack=="string")return[ze.stack,Le.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=l.DetermineComponentFrameRoot(),B=v[0],Z=v[1];if(B&&Z){var fe=B.split(`
`),Pe=Z.split(`
`);for(m=l=0;l<fe.length&&!fe[l].includes("DetermineComponentFrameRoot");)l++;for(;m<Pe.length&&!Pe[m].includes("DetermineComponentFrameRoot");)m++;if(l===fe.length||m===Pe.length)for(l=fe.length-1,m=Pe.length-1;1<=l&&0<=m&&fe[l]!==Pe[m];)m--;for(;1<=l&&0<=m;l--,m--)if(fe[l]!==Pe[m]){if(l!==1||m!==1)do if(l--,m--,0>m||fe[l]!==Pe[m]){var Qe=`
`+fe[l].replace(" at new "," at ");return e.displayName&&Qe.includes("<anonymous>")&&(Qe=Qe.replace("<anonymous>",e.displayName)),Qe}while(1<=l&&0<=m);break}}}finally{Ar=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?Ws(i):""}function Ea(e){switch(e.tag){case 26:case 27:case 5:return Ws(e.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 15:return ar(e.type,!1);case 11:return ar(e.type.render,!1);case 1:return ar(e.type,!0);case 31:return Ws("Activity");default:return""}}function Hs(e){try{var s="";do s+=Ea(e),e=e.return;while(e);return s}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function Ze(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function rt(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function vt(e){var s=rt(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,s),l=""+e[s];if(!e.hasOwnProperty(s)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var m=i.get,v=i.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return m.call(this)},set:function(B){l=""+B,v.call(this,B)}}),Object.defineProperty(e,s,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(B){l=""+B},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function Pn(e){e._valueTracker||(e._valueTracker=vt(e))}function ea(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var i=s.getValue(),l="";return e&&(l=rt(e)?e.checked?"true":"false":e.value),e=l,e!==i?(s.setValue(e),!0):!1}function Mr(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ca=/[\n"\\]/g;function fs(e){return e.replace(Ca,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Sa(e,s,i,l,m,v,B,Z){e.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?e.type=B:e.removeAttribute("type"),s!=null?B==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+Ze(s)):e.value!==""+Ze(s)&&(e.value=""+Ze(s)):B!=="submit"&&B!=="reset"||e.removeAttribute("value"),s!=null?oi(e,B,Ze(s)):i!=null?oi(e,B,Ze(i)):l!=null&&e.removeAttribute("value"),m==null&&v!=null&&(e.defaultChecked=!!v),m!=null&&(e.checked=m&&typeof m!="function"&&typeof m!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?e.name=""+Ze(Z):e.removeAttribute("name")}function ii(e,s,i,l,m,v,B,Z){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.type=v),s!=null||i!=null){if(!(v!=="submit"&&v!=="reset"||s!=null))return;i=i!=null?""+Ze(i):"",s=s!=null?""+Ze(s):i,Z||s===e.value||(e.value=s),e.defaultValue=s}l=l??m,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=Z?e.checked:!!l,e.defaultChecked=!!l,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(e.name=B)}function oi(e,s,i){s==="number"&&Mr(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function Me(e,s,i,l){if(e=e.options,s){s={};for(var m=0;m<i.length;m++)s["$"+i[m]]=!0;for(i=0;i<e.length;i++)m=s.hasOwnProperty("$"+e[i].value),e[i].selected!==m&&(e[i].selected=m),m&&l&&(e[i].defaultSelected=!0)}else{for(i=""+Ze(i),s=null,m=0;m<e.length;m++){if(e[m].value===i){e[m].selected=!0,l&&(e[m].defaultSelected=!0);return}s!==null||e[m].disabled||(s=e[m])}s!==null&&(s.selected=!0)}}function z(e,s,i){if(s!=null&&(s=""+Ze(s),s!==e.value&&(e.value=s),i==null)){e.defaultValue!==s&&(e.defaultValue=s);return}e.defaultValue=i!=null?""+Ze(i):""}function ee(e,s,i,l){if(s==null){if(l!=null){if(i!=null)throw Error(a(92));if(ae(l)){if(1<l.length)throw Error(a(93));l=l[0]}i=l}i==null&&(i=""),s=i}i=Ze(s),e.defaultValue=i,l=e.textContent,l===i&&l!==""&&l!==null&&(e.value=l)}function de(e,s){if(s){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=s;return}}e.textContent=s}var me=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Oe(e,s,i){var l=s.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?l?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="":l?e.setProperty(s,i):typeof i!="number"||i===0||me.has(s)?s==="float"?e.cssFloat=i:e[s]=(""+i).trim():e[s]=i+"px"}function Ge(e,s,i){if(s!=null&&typeof s!="object")throw Error(a(62));if(e=e.style,i!=null){for(var l in i)!i.hasOwnProperty(l)||s!=null&&s.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var m in s)l=s[m],s.hasOwnProperty(m)&&i[m]!==l&&Oe(e,m,l)}else for(var v in s)s.hasOwnProperty(v)&&Oe(e,v,s[v])}function pt(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),yt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ot(e){return yt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Yt=null;function jt(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var An=null,Yn=null;function In(e){var s=qn(e);if(s&&(e=s.stateNode)){var i=e[le]||null;e:switch(e=s.stateNode,s.type){case"input":if(Sa(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),s=i.name,i.type==="radio"&&s!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+fs(""+s)+'"][type="radio"]'),s=0;s<i.length;s++){var l=i[s];if(l!==e&&l.form===e.form){var m=l[le]||null;if(!m)throw Error(a(90));Sa(l,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(s=0;s<i.length;s++)l=i[s],l.form===e.form&&ea(l)}break e;case"textarea":z(e,i.value,i.defaultValue);break e;case"select":s=i.value,s!=null&&Me(e,!!i.multiple,s,!1)}}}var Vn=!1;function On(e,s,i){if(Vn)return e(s,i);Vn=!0;try{var l=e(s);return l}finally{if(Vn=!1,(An!==null||Yn!==null)&&(Ru(),An&&(s=An,e=Yn,Yn=An=null,In(s),e)))for(s=0;s<e.length;s++)In(e[s])}}function Ds(e,s){var i=e.stateNode;if(i===null)return null;var l=i[le]||null;if(l===null)return null;i=l[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(a(231,s,typeof i));return i}var Es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cs=!1;if(Es)try{var qs={};Object.defineProperty(qs,"passive",{get:function(){Cs=!0}}),window.addEventListener("test",qs,qs),window.removeEventListener("test",qs,qs)}catch{Cs=!1}var mn=null,ss=null,ks=null;function Ks(){if(ks)return ks;var e,s=ss,i=s.length,l,m="value"in mn?mn.value:mn.textContent,v=m.length;for(e=0;e<i&&s[e]===m[e];e++);var B=i-e;for(l=1;l<=B&&s[i-l]===m[v-l];l++);return ks=m.slice(e,1<l?1-l:void 0)}function ur(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function rs(){return!0}function vr(){return!1}function _n(e){function s(i,l,m,v,B){this._reactName=i,this._targetInst=m,this.type=l,this.nativeEvent=v,this.target=B,this.currentTarget=null;for(var Z in e)e.hasOwnProperty(Z)&&(i=e[Z],this[Z]=i?i(v):v[Z]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?rs:vr,this.isPropagationStopped=vr,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=rs)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=rs)},persist:function(){},isPersistent:rs}),s}var gn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zn=_n(gn),Gn=g({},gn,{view:0,detail:0}),Js=_n(Gn),ta,li,wr,ki=g({},Gn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wo,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==wr&&(wr&&e.type==="mousemove"?(ta=e.screenX-wr.screenX,li=e.screenY-wr.screenY):li=ta=0,wr=e),ta)},movementY:function(e){return"movementY"in e?e.movementY:li}}),wl=_n(ki),nc=g({},ki,{dataTransfer:0}),sc=_n(nc),rc=g({},Gn,{relatedTarget:0}),na=_n(rc),ac=g({},gn,{animationName:0,elapsedTime:0,pseudoElement:0}),ic=_n(ac),oc=g({},gn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),lc=_n(oc),uc=g({},gn,{data:0}),Pa=_n(uc),xl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},El={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cc(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=El[e])?!!s[e]:!1}function wo(){return cc}var xo=g({},Gn,{key:function(e){if(e.key){var s=xl[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=ur(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Tl[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wo,charCode:function(e){return e.type==="keypress"?ur(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ur(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Cl=_n(xo),ui=g({},ki,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),To=_n(ui),Sl=g({},Gn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wo}),Pl=_n(Sl),dc=g({},gn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Al=_n(dc),Ol=g({},ki,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$l=_n(Ol),Dl=g({},gn,{newState:0,oldState:0}),kl=_n(Dl),Eo=[9,13,27,32],Co=Es&&"CompositionEvent"in window,ci=null;Es&&"documentMode"in document&&(ci=document.documentMode);var fc=Es&&"TextEvent"in window&&!ci,Ll=Es&&(!Co||ci&&8<ci&&11>=ci),Il=" ",zl=!1;function di(e,s){switch(e){case"keyup":return Eo.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Aa(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Br=!1;function pc(e,s){switch(e){case"compositionend":return Aa(s);case"keypress":return s.which!==32?null:(zl=!0,Il);case"textInput":return e=s.data,e===Il&&zl?null:e;default:return null}}function So(e,s){if(Br)return e==="compositionend"||!Co&&di(e,s)?(e=Ks(),ks=ss=mn=null,Br=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ll&&s.locale!=="ko"?null:s.data;default:return null}}var Li={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ii(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!Li[e.type]:s==="textarea"}function zi(e,s,i,l){An?Yn?Yn.push(l):Yn=[l]:An=l,s=wt(s,"onChange"),0<s.length&&(i=new Zn("onChange","change",null,i,l),e.push({event:i,listeners:s}))}var cr=null,Oa=null;function hc(e){A(e,0)}function fi(e){var s=dn(e);if(ea(s))return e}function Fl(e,s){if(e==="change")return s}var Rl=!1;if(Es){var pi;if(Es){var Fi="oninput"in document;if(!Fi){var hi=document.createElement("div");hi.setAttribute("oninput","return;"),Fi=typeof hi.oninput=="function"}pi=Fi}else pi=!1;Rl=pi&&(!document.documentMode||9<document.documentMode)}function Ot(){cr&&(cr.detachEvent("onpropertychange",Bl),Oa=cr=null)}function Bl(e){if(e.propertyName==="value"&&fi(Oa)){var s=[];zi(s,Oa,e,jt(e)),On(hc,s)}}function Nl(e,s,i){e==="focusin"?(Ot(),cr=s,Oa=i,cr.attachEvent("onpropertychange",Bl)):e==="focusout"&&Ot()}function Ri(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return fi(Oa)}function Bi(e,s){if(e==="click")return fi(s)}function xr(e,s){if(e==="input"||e==="change")return fi(s)}function Ni(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var Ls=typeof Object.is=="function"?Object.is:Ni;function $a(e,s){if(Ls(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var i=Object.keys(e),l=Object.keys(s);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var m=i[l];if(!ve.call(s,m)||!Ls(e[m],s[m]))return!1}return!0}function Po(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ji(e,s){var i=Po(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=s&&l>=s)return{node:i,offset:s-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Po(i)}}function Ui(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?Ui(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function Ao(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var s=Mr(e.document);s instanceof e.HTMLIFrameElement;){try{var i=typeof s.contentWindow.location.href=="string"}catch{i=!1}if(i)e=s.contentWindow;else break;s=Mr(e.document)}return s}function mi(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}var jl=Es&&"documentMode"in document&&11>=document.documentMode,Or=null,Da=null,sa=null,Vi=!1;function Gi(e,s,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Vi||Or==null||Or!==Mr(l)||(l=Or,"selectionStart"in l&&mi(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),sa&&$a(sa,l)||(sa=l,l=wt(Da,"onSelect"),0<l.length&&(s=new Zn("onSelect","select",null,s,i),e.push({event:s,listeners:l}),s.target=Or)))}function Nr(e,s){var i={};return i[e.toLowerCase()]=s.toLowerCase(),i["Webkit"+e]="webkit"+s,i["Moz"+e]="moz"+s,i}var ra={animationend:Nr("Animation","AnimationEnd"),animationiteration:Nr("Animation","AnimationIteration"),animationstart:Nr("Animation","AnimationStart"),transitionrun:Nr("Transition","TransitionRun"),transitionstart:Nr("Transition","TransitionStart"),transitioncancel:Nr("Transition","TransitionCancel"),transitionend:Nr("Transition","TransitionEnd")},_i={},y={};Es&&(y=document.createElement("div").style,"AnimationEvent"in window||(delete ra.animationend.animation,delete ra.animationiteration.animation,delete ra.animationstart.animation),"TransitionEvent"in window||delete ra.transitionend.transition);function D(e){if(_i[e])return _i[e];if(!ra[e])return e;var s=ra[e],i;for(i in s)if(s.hasOwnProperty(i)&&i in y)return _i[e]=s[i];return e}var N=D("animationend"),K=D("animationiteration"),J=D("animationstart"),ye=D("transitionrun"),Ue=D("transitionstart"),nt=D("transitioncancel"),_t=D("transitionend"),Et=new Map,Ut="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ut.push("scrollEnd");function Wt(e,s){Et.set(e,s),js(s,[e])}var yn=new WeakMap;function En(e,s){if(typeof e=="object"&&e!==null){var i=yn.get(e);return i!==void 0?i:(s={value:e,source:s,stack:Hs(s)},yn.set(e,s),s)}return{value:e,source:s,stack:Hs(s)}}var ys=[],ka=0,mc=0;function Oo(){for(var e=ka,s=mc=ka=0;s<e;){var i=ys[s];ys[s++]=null;var l=ys[s];ys[s++]=null;var m=ys[s];ys[s++]=null;var v=ys[s];if(ys[s++]=null,l!==null&&m!==null){var B=l.pending;B===null?m.next=m:(m.next=B.next,B.next=m),l.pending=m}v!==0&&Fd(i,m,v)}}function Ul(e,s,i,l){ys[ka++]=e,ys[ka++]=s,ys[ka++]=i,ys[ka++]=l,mc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function _c(e,s,i,l){return Ul(e,s,i,l),Vl(e)}function gi(e,s){return Ul(e,null,null,s),Vl(e)}function Fd(e,s,i){e.lanes|=i;var l=e.alternate;l!==null&&(l.lanes|=i);for(var m=!1,v=e.return;v!==null;)v.childLanes|=i,l=v.alternate,l!==null&&(l.childLanes|=i),v.tag===22&&(e=v.stateNode,e===null||e._visibility&1||(m=!0)),e=v,v=v.return;return e.tag===3?(v=e.stateNode,m&&s!==null&&(m=31-lt(i),e=v.hiddenUpdates,l=e[m],l===null?e[m]=[s]:l.push(s),s.lane=i|536870912),v):null}function Vl(e){if(50<Fu)throw Fu=0,gd=null,Error(a(185));for(var s=e.return;s!==null;)e=s,s=e.return;return e.tag===3?e.stateNode:null}var yi={};function Yp(e,s,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dr(e,s,i,l){return new Yp(e,s,i,l)}function Gl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function aa(e,s){var i=e.alternate;return i===null?(i=dr(e.tag,s,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=s,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,s=e.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Rd(e,s){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=s,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,s=i.dependencies,e.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),e}function $o(e,s,i,l,m,v){var B=0;if(l=e,typeof e=="function")Gl(e)&&(B=1);else if(typeof e=="string")B=Qw(e,i,G.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case U:return e=dr(31,i,s,m),e.elementType=U,e.lanes=v,e;case M:return bi(i.children,m,v,s);case x:B=8,m|=24;break;case F:return e=dr(12,i,s,m|2),e.elementType=F,e.lanes=v,e;case S:return e=dr(13,i,s,m),e.elementType=S,e.lanes=v,e;case $:return e=dr(19,i,s,m),e.elementType=$,e.lanes=v,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:case L:B=10;break e;case T:B=9;break e;case O:B=11;break e;case C:B=14;break e;case k:B=16,l=null;break e}B=29,i=Error(a(130,e===null?"null":typeof e,"")),l=null}return s=dr(B,i,s,m),s.elementType=e,s.type=l,s.lanes=v,s}function bi(e,s,i,l){return e=dr(7,e,l,s),e.lanes=i,e}function gc(e,s,i){return e=dr(6,e,null,s),e.lanes=i,e}function Wl(e,s,i){return s=dr(4,e.children!==null?e.children:[],e.key,s),s.lanes=i,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}var Wi=[],Hi=0,Do=null,Hl=0,Tr=[],fr=0,Mi=null,ia=1,jr="";function vi(e,s){Wi[Hi++]=Hl,Wi[Hi++]=Do,Do=e,Hl=s}function Bd(e,s,i){Tr[fr++]=ia,Tr[fr++]=jr,Tr[fr++]=Mi,Mi=e;var l=ia;e=jr;var m=32-lt(l)-1;l&=~(1<<m),i+=1;var v=32-lt(s)+m;if(30<v){var B=m-m%5;v=(l&(1<<B)-1).toString(32),l>>=B,m-=B,ia=1<<32-lt(s)+m|i<<m|l,jr=v+e}else ia=1<<v|i<<m|l,jr=e}function ql(e){e.return!==null&&(vi(e,1),Bd(e,1,0))}function yc(e){for(;e===Do;)Do=Wi[--Hi],Wi[Hi]=null,Hl=Wi[--Hi],Wi[Hi]=null;for(;e===Mi;)Mi=Tr[--fr],Tr[fr]=null,jr=Tr[--fr],Tr[fr]=null,ia=Tr[--fr],Tr[fr]=null}var er=null,as=null,vn=!1,wi=null,$r=!1,bc=Error(a(519));function xi(e){var s=Error(a(418,""));throw Lo(En(s,e)),bc}function Mc(e){var s=e.stateNode,i=e.type,l=e.memoizedProps;switch(s[Y]=e,s[le]=l,i){case"dialog":Q("cancel",s),Q("close",s);break;case"iframe":case"object":case"embed":Q("load",s);break;case"video":case"audio":for(i=0;i<il.length;i++)Q(il[i],s);break;case"source":Q("error",s);break;case"img":case"image":case"link":Q("error",s),Q("load",s);break;case"details":Q("toggle",s);break;case"input":Q("invalid",s),ii(s,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Pn(s);break;case"select":Q("invalid",s);break;case"textarea":Q("invalid",s),ee(s,l.value,l.defaultValue,l.children),Pn(s)}i=l.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||s.textContent===""+i||l.suppressHydrationWarning===!0||Rt(s.textContent,i)?(l.popover!=null&&(Q("beforetoggle",s),Q("toggle",s)),l.onScroll!=null&&Q("scroll",s),l.onScrollEnd!=null&&Q("scrollend",s),l.onClick!=null&&(s.onclick=kt),s=!0):s=!1,s||xi(e)}function Nd(e){for(er=e.return;er;)switch(er.tag){case 5:case 13:$r=!1;return;case 27:case 3:$r=!0;return;default:er=er.return}}function ko(e){if(e!==er)return!1;if(!vn)return Nd(e),vn=!0,!1;var s=e.tag,i;if((i=s!==3&&s!==27)&&((i=s===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||Ka(e.type,e.memoizedProps)),i=!i),i&&as&&xi(e),Nd(e),s===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));e:{for(e=e.nextSibling,s=0;e;){if(e.nodeType===8)if(i=e.data,i==="/$"){if(s===0){as=Er(e.nextSibling);break e}s--}else i!=="$"&&i!=="$!"&&i!=="$?"||s++;e=e.nextSibling}as=null}}else s===27?(s=as,Mn(e.type)?(e=Uu,Uu=null,as=e):as=s):as=er?Er(e.stateNode.nextSibling):null;return!0}function qi(){as=er=null,vn=!1}function jd(){var e=wi;return e!==null&&(nr===null?nr=e:nr.push.apply(nr,e),wi=null),e}function Lo(e){wi===null?wi=[e]:wi.push(e)}var Kl=j(null),Ti=null,oa=null;function La(e,s,i){X(Kl,s._currentValue),s._currentValue=i}function la(e){e._currentValue=Kl.current,R(Kl)}function Ql(e,s,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,l!==null&&(l.childLanes|=s)):l!==null&&(l.childLanes&s)!==s&&(l.childLanes|=s),e===i)break;e=e.return}}function vc(e,s,i,l){var m=e.child;for(m!==null&&(m.return=e);m!==null;){var v=m.dependencies;if(v!==null){var B=m.child;v=v.firstContext;e:for(;v!==null;){var Z=v;v=m;for(var fe=0;fe<s.length;fe++)if(Z.context===s[fe]){v.lanes|=i,Z=v.alternate,Z!==null&&(Z.lanes|=i),Ql(v.return,i,e),l||(B=null);break e}v=Z.next}}else if(m.tag===18){if(B=m.return,B===null)throw Error(a(341));B.lanes|=i,v=B.alternate,v!==null&&(v.lanes|=i),Ql(B,i,e),B=null}else B=m.child;if(B!==null)B.return=m;else for(B=m;B!==null;){if(B===e){B=null;break}if(m=B.sibling,m!==null){m.return=B.return,B=m;break}B=B.return}m=B}}function Io(e,s,i,l){e=null;for(var m=s,v=!1;m!==null;){if(!v){if((m.flags&524288)!==0)v=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var B=m.alternate;if(B===null)throw Error(a(387));if(B=B.memoizedProps,B!==null){var Z=m.type;Ls(m.pendingProps.value,B.value)||(e!==null?e.push(Z):e=[Z])}}else if(m===Ie.current){if(B=m.alternate,B===null)throw Error(a(387));B.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(e!==null?e.push(Cp):e=[Cp])}m=m.return}e!==null&&vc(s,e,i,l),s.flags|=262144}function zo(e){for(e=e.firstContext;e!==null;){if(!Ls(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ei(e){Ti=e,oa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Qs(e){return Ud(Ti,e)}function Fo(e,s){return Ti===null&&Ei(e),Ud(e,s)}function Ud(e,s){var i=s._currentValue;if(s={context:s,memoizedValue:i,next:null},oa===null){if(e===null)throw Error(a(308));oa=s,e.dependencies={lanes:0,firstContext:s},e.flags|=524288}else oa=oa.next=s;return i}var Zp=typeof AbortController<"u"?AbortController:function(){var e=[],s=this.signal={aborted:!1,addEventListener:function(i,l){e.push(l)}};this.abort=function(){s.aborted=!0,e.forEach(function(i){return i()})}},Vd=t.unstable_scheduleCallback,Jp=t.unstable_NormalPriority,Ss={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xl(){return{controller:new Zp,data:new Map,refCount:0}}function Ro(e){e.refCount--,e.refCount===0&&Vd(Jp,function(){e.controller.abort()})}var Bo=null,Yl=0,Ki=0,Qi=null;function Gd(e,s){if(Bo===null){var i=Bo=[];Yl=0,Ki=Vt(),Qi={status:"pending",value:void 0,then:function(l){i.push(l)}}}return Yl++,s.then(Wd,Wd),s}function Wd(){if(--Yl===0&&Bo!==null){Qi!==null&&(Qi.status="fulfilled");var e=Bo;Bo=null,Ki=0,Qi=null;for(var s=0;s<e.length;s++)(0,e[s])()}}function eh(e,s){var i=[],l={status:"pending",value:null,reason:null,then:function(m){i.push(m)}};return e.then(function(){l.status="fulfilled",l.value=s;for(var m=0;m<i.length;m++)(0,i[m])(s)},function(m){for(l.status="rejected",l.reason=m,m=0;m<i.length;m++)(0,i[m])(void 0)}),l}var Hd=H.S;H.S=function(e,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Gd(e,s),Hd!==null&&Hd(e,s)};var Ci=j(null);function Zl(){var e=Ci.current;return e!==null?e:Wn.pooledCache}function Jl(e,s){s===null?X(Ci,Ci.current):X(Ci,s.pool)}function qd(){var e=Zl();return e===null?null:{parent:Ss._currentValue,pool:e}}var No=Error(a(460)),Kd=Error(a(474)),jo=Error(a(542)),wc={then:function(){}};function Qd(e){return e=e.status,e==="fulfilled"||e==="rejected"}function eu(){}function Xd(e,s,i){switch(i=e[i],i===void 0?e.push(s):i!==s&&(s.then(eu,eu),s=i),s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Zd(e),e;default:if(typeof s.status=="string")s.then(eu,eu);else{if(e=Wn,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=s,e.status="pending",e.then(function(l){if(s.status==="pending"){var m=s;m.status="fulfilled",m.value=l}},function(l){if(s.status==="pending"){var m=s;m.status="rejected",m.reason=l}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Zd(e),e}throw Xi=s,No}}var Xi=null;function Yd(){if(Xi===null)throw Error(a(459));var e=Xi;return Xi=null,e}function Zd(e){if(e===No||e===jo)throw Error(a(483))}var Ia=!1;function xc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tu(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function za(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Fa(e,s,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,($n&2)!==0){var m=l.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),l.pending=s,s=Vl(e),Fd(e,null,i),s}return Ul(e,l,s,i),Vl(e)}function Yi(e,s,i){if(s=s.updateQueue,s!==null&&(s=s.shared,(i&4194048)!==0)){var l=s.lanes;l&=e.pendingLanes,i|=l,s.lanes=i,zr(e,i)}}function Tc(e,s){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var m=null,v=null;if(i=i.firstBaseUpdate,i!==null){do{var B={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};v===null?m=v=B:v=v.next=B,i=i.next}while(i!==null);v===null?m=v=s:v=v.next=s}else m=v=s;i={baseState:l.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:l.shared,callbacks:l.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=s:e.next=s,i.lastBaseUpdate=s}var Ec=!1;function Zi(){if(Ec){var e=Qi;if(e!==null)throw e}}function Uo(e,s,i,l){Ec=!1;var m=e.updateQueue;Ia=!1;var v=m.firstBaseUpdate,B=m.lastBaseUpdate,Z=m.shared.pending;if(Z!==null){m.shared.pending=null;var fe=Z,Pe=fe.next;fe.next=null,B===null?v=Pe:B.next=Pe,B=fe;var Qe=e.alternate;Qe!==null&&(Qe=Qe.updateQueue,Z=Qe.lastBaseUpdate,Z!==B&&(Z===null?Qe.firstBaseUpdate=Pe:Z.next=Pe,Qe.lastBaseUpdate=fe))}if(v!==null){var Je=m.baseState;B=0,Qe=Pe=fe=null,Z=v;do{var Le=Z.lane&-536870913,ze=Le!==Z.lane;if(ze?(pn&Le)===Le:(l&Le)===Le){Le!==0&&Le===Ki&&(Ec=!0),Qe!==null&&(Qe=Qe.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var Zt=e,Gt=Z;Le=s;var Qn=i;switch(Gt.tag){case 1:if(Zt=Gt.payload,typeof Zt=="function"){Je=Zt.call(Qn,Je,Le);break e}Je=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=Gt.payload,Le=typeof Zt=="function"?Zt.call(Qn,Je,Le):Zt,Le==null)break e;Je=g({},Je,Le);break e;case 2:Ia=!0}}Le=Z.callback,Le!==null&&(e.flags|=64,ze&&(e.flags|=8192),ze=m.callbacks,ze===null?m.callbacks=[Le]:ze.push(Le))}else ze={lane:Le,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Qe===null?(Pe=Qe=ze,fe=Je):Qe=Qe.next=ze,B|=Le;if(Z=Z.next,Z===null){if(Z=m.shared.pending,Z===null)break;ze=Z,Z=ze.next,ze.next=null,m.lastBaseUpdate=ze,m.shared.pending=null}}while(!0);Qe===null&&(fe=Je),m.baseState=fe,m.firstBaseUpdate=Pe,m.lastBaseUpdate=Qe,v===null&&(m.shared.lanes=0),Wa|=B,e.lanes=B,e.memoizedState=Je}}function Jd(e,s){if(typeof e!="function")throw Error(a(191,e));e.call(s)}function Cc(e,s){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Jd(i[e],s)}var Ji=j(null),nu=j(0);function Sc(e,s){e=ma,X(nu,e),X(Ji,s),ma=e|s.baseLanes}function Pc(){X(nu,ma),X(Ji,Ji.current)}function Ac(){ma=nu.current,R(Ji),R(nu)}var Ur=0,rn=null,zn=null,ps=null,Vo=!1,eo=!1,Ra=!1,su=0,Go=0,ua=null,ef=0;function hs(){throw Error(a(321))}function Oc(e,s){if(s===null)return!1;for(var i=0;i<s.length&&i<e.length;i++)if(!Ls(e[i],s[i]))return!1;return!0}function $c(e,s,i,l,m,v){return Ur=v,rn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,H.H=e===null||e.memoizedState===null?$f:Df,Ra=!1,v=i(l,m),Ra=!1,eo&&(v=tf(s,i,l,m)),Dc(e),v}function Dc(e){H.H=Ko;var s=zn!==null&&zn.next!==null;if(Ur=0,ps=zn=rn=null,Vo=!1,Go=0,ua=null,s)throw Error(a(300));e===null||zs||(e=e.dependencies,e!==null&&zo(e)&&(zs=!0))}function tf(e,s,i,l){rn=e;var m=0;do{if(eo&&(ua=null),Go=0,eo=!1,25<=m)throw Error(a(301));if(m+=1,ps=zn=null,e.updateQueue!=null){var v=e.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}H.H=ah,v=s(i,l)}while(eo);return v}function th(){var e=H.H,s=e.useState()[0];return s=typeof s.then=="function"?Wo(s):s,e=e.useState()[0],(zn!==null?zn.memoizedState:null)!==e&&(rn.flags|=1024),s}function kc(){var e=su!==0;return su=0,e}function ru(e,s,i){s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~i}function Lc(e){if(Vo){for(e=e.memoizedState;e!==null;){var s=e.queue;s!==null&&(s.pending=null),e=e.next}Vo=!1}Ur=0,ps=zn=rn=null,eo=!1,Go=su=0,ua=null}function ir(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?rn.memoizedState=ps=e:ps=ps.next=e,ps}function ms(){if(zn===null){var e=rn.alternate;e=e!==null?e.memoizedState:null}else e=zn.next;var s=ps===null?rn.memoizedState:ps.next;if(s!==null)ps=s,zn=e;else{if(e===null)throw rn.alternate===null?Error(a(467)):Error(a(310));zn=e,e={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},ps===null?rn.memoizedState=ps=e:ps=ps.next=e}return ps}function Ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wo(e){var s=Go;return Go+=1,ua===null&&(ua=[]),e=Xd(ua,e,s),s=rn,(ps===null?s.memoizedState:ps.next)===null&&(s=s.alternate,H.H=s===null||s.memoizedState===null?$f:Df),e}function au(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Wo(e);if(e.$$typeof===L)return Qs(e)}throw Error(a(438,String(e)))}function iu(e){var s=null,i=rn.updateQueue;if(i!==null&&(s=i.memoCache),s==null){var l=rn.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(s={data:l.data.map(function(m){return m.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),i===null&&(i=Ic(),rn.updateQueue=i),i.memoCache=s,i=s.data[s.index],i===void 0)for(i=s.data[s.index]=Array(e),l=0;l<e;l++)i[l]=V;return s.index++,i}function ca(e,s){return typeof s=="function"?s(e):s}function ou(e){var s=ms();return lu(s,zn,e)}function lu(e,s,i){var l=e.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=i;var m=e.baseQueue,v=l.pending;if(v!==null){if(m!==null){var B=m.next;m.next=v.next,v.next=B}s.baseQueue=m=v,l.pending=null}if(v=e.baseState,m===null)e.memoizedState=v;else{s=m.next;var Z=B=null,fe=null,Pe=s,Qe=!1;do{var Je=Pe.lane&-536870913;if(Je!==Pe.lane?(pn&Je)===Je:(Ur&Je)===Je){var Le=Pe.revertLane;if(Le===0)fe!==null&&(fe=fe.next={lane:0,revertLane:0,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null}),Je===Ki&&(Qe=!0);else if((Ur&Le)===Le){Pe=Pe.next,Le===Ki&&(Qe=!0);continue}else Je={lane:0,revertLane:Pe.revertLane,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},fe===null?(Z=fe=Je,B=v):fe=fe.next=Je,rn.lanes|=Le,Wa|=Le;Je=Pe.action,Ra&&i(v,Je),v=Pe.hasEagerState?Pe.eagerState:i(v,Je)}else Le={lane:Je,revertLane:Pe.revertLane,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},fe===null?(Z=fe=Le,B=v):fe=fe.next=Le,rn.lanes|=Je,Wa|=Je;Pe=Pe.next}while(Pe!==null&&Pe!==s);if(fe===null?B=v:fe.next=Z,!Ls(v,e.memoizedState)&&(zs=!0,Qe&&(i=Qi,i!==null)))throw i;e.memoizedState=v,e.baseState=B,e.baseQueue=fe,l.lastRenderedState=v}return m===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function zc(e){var s=ms(),i=s.queue;if(i===null)throw Error(a(311));i.lastRenderedReducer=e;var l=i.dispatch,m=i.pending,v=s.memoizedState;if(m!==null){i.pending=null;var B=m=m.next;do v=e(v,B.action),B=B.next;while(B!==m);Ls(v,s.memoizedState)||(zs=!0),s.memoizedState=v,s.baseQueue===null&&(s.baseState=v),i.lastRenderedState=v}return[v,l]}function nf(e,s,i){var l=rn,m=ms(),v=vn;if(v){if(i===void 0)throw Error(a(407));i=i()}else i=s();var B=!Ls((zn||m).memoizedState,i);B&&(m.memoizedState=i,zs=!0),m=m.queue;var Z=rf.bind(null,l,m,e);if(Ho(2048,8,Z,[e]),m.getSnapshot!==s||B||ps!==null&&ps.memoizedState.tag&1){if(l.flags|=2048,to(9,du(),sf.bind(null,l,m,i,s),null),Wn===null)throw Error(a(349));v||(Ur&124)!==0||Fc(l,s,i)}return i}function Fc(e,s,i){e.flags|=16384,e={getSnapshot:s,value:i},s=rn.updateQueue,s===null?(s=Ic(),rn.updateQueue=s,s.stores=[e]):(i=s.stores,i===null?s.stores=[e]:i.push(e))}function sf(e,s,i,l){s.value=i,s.getSnapshot=l,uu(s)&&af(e)}function rf(e,s,i){return i(function(){uu(s)&&af(e)})}function uu(e){var s=e.getSnapshot;e=e.value;try{var i=s();return!Ls(e,i)}catch{return!0}}function af(e){var s=gi(e,2);s!==null&&Vs(s,e,2)}function Rc(e){var s=ir();if(typeof e=="function"){var i=e;if(e=i(),Ra){ct(!0);try{i()}finally{ct(!1)}}}return s.memoizedState=s.baseState=e,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ca,lastRenderedState:e},s}function of(e,s,i,l){return e.baseState=i,lu(e,zn,typeof l=="function"?l:ca)}function lf(e,s,i,l,m){if(hu(e))throw Error(a(485));if(e=s.action,e!==null){var v={payload:m,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){v.listeners.push(B)}};H.T!==null?i(!0):v.isTransition=!1,l(v),i=s.pending,i===null?(v.next=s.pending=v,uf(s,v)):(v.next=i.next,s.pending=i.next=v)}}function uf(e,s){var i=s.action,l=s.payload,m=e.state;if(s.isTransition){var v=H.T,B={};H.T=B;try{var Z=i(m,l),fe=H.S;fe!==null&&fe(B,Z),cf(e,s,Z)}catch(Pe){Nc(e,s,Pe)}finally{H.T=v}}else try{v=i(m,l),cf(e,s,v)}catch(Pe){Nc(e,s,Pe)}}function cf(e,s,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(l){Bc(e,s,l)},function(l){return Nc(e,s,l)}):Bc(e,s,i)}function Bc(e,s,i){s.status="fulfilled",s.value=i,df(s),e.state=i,s=e.pending,s!==null&&(i=s.next,i===s?e.pending=null:(i=i.next,s.next=i,uf(e,i)))}function Nc(e,s,i){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do s.status="rejected",s.reason=i,df(s),s=s.next;while(s!==l)}e.action=null}function df(e){e=e.listeners;for(var s=0;s<e.length;s++)(0,e[s])()}function ff(e,s){return s}function pf(e,s){if(vn){var i=Wn.formState;if(i!==null){e:{var l=rn;if(vn){if(as){t:{for(var m=as,v=$r;m.nodeType!==8;){if(!v){m=null;break t}if(m=Er(m.nextSibling),m===null){m=null;break t}}v=m.data,m=v==="F!"||v==="F"?m:null}if(m){as=Er(m.nextSibling),l=m.data==="F!";break e}}xi(l)}l=!1}l&&(s=i[0])}}return i=ir(),i.memoizedState=i.baseState=s,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ff,lastRenderedState:s},i.queue=l,i=Pf.bind(null,rn,l),l.dispatch=i,l=Rc(!1),v=Kc.bind(null,rn,!1,l.queue),l=ir(),m={state:s,dispatch:null,action:e,pending:null},l.queue=m,i=lf.bind(null,rn,m,v,i),m.dispatch=i,l.memoizedState=e,[s,i,!1]}function cu(e){var s=ms();return hf(s,zn,e)}function hf(e,s,i){if(s=lu(e,s,ff)[0],e=ou(ca)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var l=Wo(s)}catch(B){throw B===No?jo:B}else l=s;s=ms();var m=s.queue,v=m.dispatch;return i!==s.memoizedState&&(rn.flags|=2048,to(9,du(),nh.bind(null,m,i),null)),[l,v,e]}function nh(e,s){e.action=s}function mf(e){var s=ms(),i=zn;if(i!==null)return hf(s,i,e);ms(),s=s.memoizedState,i=ms();var l=i.queue.dispatch;return i.memoizedState=e,[s,l,!1]}function to(e,s,i,l){return e={tag:e,create:i,deps:l,inst:s,next:null},s=rn.updateQueue,s===null&&(s=Ic(),rn.updateQueue=s),i=s.lastEffect,i===null?s.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,s.lastEffect=e),e}function du(){return{destroy:void 0,resource:void 0}}function _f(){return ms().memoizedState}function fu(e,s,i,l){var m=ir();l=l===void 0?null:l,rn.flags|=e,m.memoizedState=to(1|s,du(),i,l)}function Ho(e,s,i,l){var m=ms();l=l===void 0?null:l;var v=m.memoizedState.inst;zn!==null&&l!==null&&Oc(l,zn.memoizedState.deps)?m.memoizedState=to(s,v,i,l):(rn.flags|=e,m.memoizedState=to(1|s,v,i,l))}function gf(e,s){fu(8390656,8,e,s)}function jc(e,s){Ho(2048,8,e,s)}function yf(e,s){return Ho(4,2,e,s)}function bf(e,s){return Ho(4,4,e,s)}function Uc(e,s){if(typeof s=="function"){e=e();var i=s(e);return function(){typeof i=="function"?i():s(null)}}if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function Mf(e,s,i){i=i!=null?i.concat([e]):null,Ho(4,4,Uc.bind(null,s,e),i)}function Vc(){}function vf(e,s){var i=ms();s=s===void 0?null:s;var l=i.memoizedState;return s!==null&&Oc(s,l[1])?l[0]:(i.memoizedState=[e,s],e)}function wf(e,s){var i=ms();s=s===void 0?null:s;var l=i.memoizedState;if(s!==null&&Oc(s,l[1]))return l[0];if(l=e(),Ra){ct(!0);try{e()}finally{ct(!1)}}return i.memoizedState=[l,s],l}function pu(e,s,i){return i===void 0||(Ur&1073741824)!==0?e.memoizedState=s:(e.memoizedState=i,e=dp(),rn.lanes|=e,Wa|=e,i)}function xf(e,s,i,l){return Ls(i,s)?i:Ji.current!==null?(e=pu(e,i,l),Ls(e,s)||(zs=!0),e):(Ur&42)===0?(zs=!0,e.memoizedState=i):(e=dp(),rn.lanes|=e,Wa|=e,s)}function Tf(e,s,i,l,m){var v=se.p;se.p=v!==0&&8>v?v:8;var B=H.T,Z={};H.T=Z,Kc(e,!1,s,i);try{var fe=m(),Pe=H.S;if(Pe!==null&&Pe(Z,fe),fe!==null&&typeof fe=="object"&&typeof fe.then=="function"){var Qe=eh(fe,l);qo(e,s,Qe,mr(e))}else qo(e,s,l,mr(e))}catch(Je){qo(e,s,{then:function(){},status:"rejected",reason:Je},mr())}finally{se.p=v,H.T=B}}function Ef(){}function Gc(e,s,i,l){if(e.tag!==5)throw Error(a(476));var m=Cf(e).queue;Tf(e,m,s,ie,i===null?Ef:function(){return Wc(e),i(l)})}function Cf(e){var s=e.memoizedState;if(s!==null)return s;s={memoizedState:ie,baseState:ie,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ca,lastRenderedState:ie},next:null};var i={};return s.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ca,lastRenderedState:i},next:null},e.memoizedState=s,e=e.alternate,e!==null&&(e.memoizedState=s),s}function Wc(e){var s=Cf(e).next.queue;qo(e,s,{},mr())}function Hc(){return Qs(Cp)}function Sf(){return ms().memoizedState}function qc(){return ms().memoizedState}function sh(e){for(var s=e.return;s!==null;){switch(s.tag){case 24:case 3:var i=mr();e=za(i);var l=Fa(s,e,i);l!==null&&(Vs(l,s,i),Yi(l,s,i)),s={cache:Xl()},e.payload=s;return}s=s.return}}function rh(e,s,i){var l=mr();i={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},hu(e)?Af(s,i):(i=_c(e,s,i,l),i!==null&&(Vs(i,e,l),Of(i,s,l)))}function Pf(e,s,i){var l=mr();qo(e,s,i,l)}function qo(e,s,i,l){var m={lane:l,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(hu(e))Af(s,m);else{var v=e.alternate;if(e.lanes===0&&(v===null||v.lanes===0)&&(v=s.lastRenderedReducer,v!==null))try{var B=s.lastRenderedState,Z=v(B,i);if(m.hasEagerState=!0,m.eagerState=Z,Ls(Z,B))return Ul(e,s,m,0),Wn===null&&Oo(),!1}catch{}finally{}if(i=_c(e,s,m,l),i!==null)return Vs(i,e,l),Of(i,s,l),!0}return!1}function Kc(e,s,i,l){if(l={lane:2,revertLane:Vt(),action:l,hasEagerState:!1,eagerState:null,next:null},hu(e)){if(s)throw Error(a(479))}else s=_c(e,i,l,2),s!==null&&Vs(s,e,2)}function hu(e){var s=e.alternate;return e===rn||s!==null&&s===rn}function Af(e,s){eo=Vo=!0;var i=e.pending;i===null?s.next=s:(s.next=i.next,i.next=s),e.pending=s}function Of(e,s,i){if((i&4194048)!==0){var l=s.lanes;l&=e.pendingLanes,i|=l,s.lanes=i,zr(e,i)}}var Ko={readContext:Qs,use:au,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useLayoutEffect:hs,useInsertionEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useSyncExternalStore:hs,useId:hs,useHostTransitionStatus:hs,useFormState:hs,useActionState:hs,useOptimistic:hs,useMemoCache:hs,useCacheRefresh:hs},$f={readContext:Qs,use:au,useCallback:function(e,s){return ir().memoizedState=[e,s===void 0?null:s],e},useContext:Qs,useEffect:gf,useImperativeHandle:function(e,s,i){i=i!=null?i.concat([e]):null,fu(4194308,4,Uc.bind(null,s,e),i)},useLayoutEffect:function(e,s){return fu(4194308,4,e,s)},useInsertionEffect:function(e,s){fu(4,2,e,s)},useMemo:function(e,s){var i=ir();s=s===void 0?null:s;var l=e();if(Ra){ct(!0);try{e()}finally{ct(!1)}}return i.memoizedState=[l,s],l},useReducer:function(e,s,i){var l=ir();if(i!==void 0){var m=i(s);if(Ra){ct(!0);try{i(s)}finally{ct(!1)}}}else m=s;return l.memoizedState=l.baseState=m,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:m},l.queue=e,e=e.dispatch=rh.bind(null,rn,e),[l.memoizedState,e]},useRef:function(e){var s=ir();return e={current:e},s.memoizedState=e},useState:function(e){e=Rc(e);var s=e.queue,i=Pf.bind(null,rn,s);return s.dispatch=i,[e.memoizedState,i]},useDebugValue:Vc,useDeferredValue:function(e,s){var i=ir();return pu(i,e,s)},useTransition:function(){var e=Rc(!1);return e=Tf.bind(null,rn,e.queue,!0,!1),ir().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,s,i){var l=rn,m=ir();if(vn){if(i===void 0)throw Error(a(407));i=i()}else{if(i=s(),Wn===null)throw Error(a(349));(pn&124)!==0||Fc(l,s,i)}m.memoizedState=i;var v={value:i,getSnapshot:s};return m.queue=v,gf(rf.bind(null,l,v,e),[e]),l.flags|=2048,to(9,du(),sf.bind(null,l,v,i,s),null),i},useId:function(){var e=ir(),s=Wn.identifierPrefix;if(vn){var i=jr,l=ia;i=(l&~(1<<32-lt(l)-1)).toString(32)+i,s="«"+s+"R"+i,i=su++,0<i&&(s+="H"+i.toString(32)),s+="»"}else i=ef++,s="«"+s+"r"+i.toString(32)+"»";return e.memoizedState=s},useHostTransitionStatus:Hc,useFormState:pf,useActionState:pf,useOptimistic:function(e){var s=ir();s.memoizedState=s.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=i,s=Kc.bind(null,rn,!0,i),i.dispatch=s,[e,s]},useMemoCache:iu,useCacheRefresh:function(){return ir().memoizedState=sh.bind(null,rn)}},Df={readContext:Qs,use:au,useCallback:vf,useContext:Qs,useEffect:jc,useImperativeHandle:Mf,useInsertionEffect:yf,useLayoutEffect:bf,useMemo:wf,useReducer:ou,useRef:_f,useState:function(){return ou(ca)},useDebugValue:Vc,useDeferredValue:function(e,s){var i=ms();return xf(i,zn.memoizedState,e,s)},useTransition:function(){var e=ou(ca)[0],s=ms().memoizedState;return[typeof e=="boolean"?e:Wo(e),s]},useSyncExternalStore:nf,useId:Sf,useHostTransitionStatus:Hc,useFormState:cu,useActionState:cu,useOptimistic:function(e,s){var i=ms();return of(i,zn,e,s)},useMemoCache:iu,useCacheRefresh:qc},ah={readContext:Qs,use:au,useCallback:vf,useContext:Qs,useEffect:jc,useImperativeHandle:Mf,useInsertionEffect:yf,useLayoutEffect:bf,useMemo:wf,useReducer:zc,useRef:_f,useState:function(){return zc(ca)},useDebugValue:Vc,useDeferredValue:function(e,s){var i=ms();return zn===null?pu(i,e,s):xf(i,zn.memoizedState,e,s)},useTransition:function(){var e=zc(ca)[0],s=ms().memoizedState;return[typeof e=="boolean"?e:Wo(e),s]},useSyncExternalStore:nf,useId:Sf,useHostTransitionStatus:Hc,useFormState:mf,useActionState:mf,useOptimistic:function(e,s){var i=ms();return zn!==null?of(i,zn,e,s):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:iu,useCacheRefresh:qc},no=null,Qo=0;function mu(e){var s=Qo;return Qo+=1,no===null&&(no=[]),Xd(no,e,s)}function so(e,s){s=s.props.ref,e.ref=s!==void 0?s:null}function _u(e,s){throw s.$$typeof===_?Error(a(525)):(e=Object.prototype.toString.call(s),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)))}function kf(e){var s=e._init;return s(e._payload)}function Qc(e){function s(we,be){if(e){var Ce=we.deletions;Ce===null?(we.deletions=[be],we.flags|=16):Ce.push(be)}}function i(we,be){if(!e)return null;for(;be!==null;)s(we,be),be=be.sibling;return null}function l(we){for(var be=new Map;we!==null;)we.key!==null?be.set(we.key,we):be.set(we.index,we),we=we.sibling;return be}function m(we,be){return we=aa(we,be),we.index=0,we.sibling=null,we}function v(we,be,Ce){return we.index=Ce,e?(Ce=we.alternate,Ce!==null?(Ce=Ce.index,Ce<be?(we.flags|=67108866,be):Ce):(we.flags|=67108866,be)):(we.flags|=1048576,be)}function B(we){return e&&we.alternate===null&&(we.flags|=67108866),we}function Z(we,be,Ce,Ye){return be===null||be.tag!==6?(be=gc(Ce,we.mode,Ye),be.return=we,be):(be=m(be,Ce),be.return=we,be)}function fe(we,be,Ce,Ye){var $t=Ce.type;return $t===M?Qe(we,be,Ce.props.children,Ye,Ce.key):be!==null&&(be.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===k&&kf($t)===be.type)?(be=m(be,Ce.props),so(be,Ce),be.return=we,be):(be=$o(Ce.type,Ce.key,Ce.props,null,we.mode,Ye),so(be,Ce),be.return=we,be)}function Pe(we,be,Ce,Ye){return be===null||be.tag!==4||be.stateNode.containerInfo!==Ce.containerInfo||be.stateNode.implementation!==Ce.implementation?(be=Wl(Ce,we.mode,Ye),be.return=we,be):(be=m(be,Ce.children||[]),be.return=we,be)}function Qe(we,be,Ce,Ye,$t){return be===null||be.tag!==7?(be=bi(Ce,we.mode,Ye,$t),be.return=we,be):(be=m(be,Ce),be.return=we,be)}function Je(we,be,Ce){if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return be=gc(""+be,we.mode,Ce),be.return=we,be;if(typeof be=="object"&&be!==null){switch(be.$$typeof){case h:return Ce=$o(be.type,be.key,be.props,null,we.mode,Ce),so(Ce,be),Ce.return=we,Ce;case w:return be=Wl(be,we.mode,Ce),be.return=we,be;case k:var Ye=be._init;return be=Ye(be._payload),Je(we,be,Ce)}if(ae(be)||ne(be))return be=bi(be,we.mode,Ce,null),be.return=we,be;if(typeof be.then=="function")return Je(we,mu(be),Ce);if(be.$$typeof===L)return Je(we,Fo(we,be),Ce);_u(we,be)}return null}function Le(we,be,Ce,Ye){var $t=be!==null?be.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return $t!==null?null:Z(we,be,""+Ce,Ye);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case h:return Ce.key===$t?fe(we,be,Ce,Ye):null;case w:return Ce.key===$t?Pe(we,be,Ce,Ye):null;case k:return $t=Ce._init,Ce=$t(Ce._payload),Le(we,be,Ce,Ye)}if(ae(Ce)||ne(Ce))return $t!==null?null:Qe(we,be,Ce,Ye,null);if(typeof Ce.then=="function")return Le(we,be,mu(Ce),Ye);if(Ce.$$typeof===L)return Le(we,be,Fo(we,Ce),Ye);_u(we,Ce)}return null}function ze(we,be,Ce,Ye,$t){if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint")return we=we.get(Ce)||null,Z(be,we,""+Ye,$t);if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case h:return we=we.get(Ye.key===null?Ce:Ye.key)||null,fe(be,we,Ye,$t);case w:return we=we.get(Ye.key===null?Ce:Ye.key)||null,Pe(be,we,Ye,$t);case k:var fn=Ye._init;return Ye=fn(Ye._payload),ze(we,be,Ce,Ye,$t)}if(ae(Ye)||ne(Ye))return we=we.get(Ce)||null,Qe(be,we,Ye,$t,null);if(typeof Ye.then=="function")return ze(we,be,Ce,mu(Ye),$t);if(Ye.$$typeof===L)return ze(we,be,Ce,Fo(be,Ye),$t);_u(be,Ye)}return null}function Zt(we,be,Ce,Ye){for(var $t=null,fn=null,Ft=be,Ht=be=0,sr=null;Ft!==null&&Ht<Ce.length;Ht++){Ft.index>Ht?(sr=Ft,Ft=null):sr=Ft.sibling;var Ln=Le(we,Ft,Ce[Ht],Ye);if(Ln===null){Ft===null&&(Ft=sr);break}e&&Ft&&Ln.alternate===null&&s(we,Ft),be=v(Ln,be,Ht),fn===null?$t=Ln:fn.sibling=Ln,fn=Ln,Ft=sr}if(Ht===Ce.length)return i(we,Ft),vn&&vi(we,Ht),$t;if(Ft===null){for(;Ht<Ce.length;Ht++)Ft=Je(we,Ce[Ht],Ye),Ft!==null&&(be=v(Ft,be,Ht),fn===null?$t=Ft:fn.sibling=Ft,fn=Ft);return vn&&vi(we,Ht),$t}for(Ft=l(Ft);Ht<Ce.length;Ht++)sr=ze(Ft,we,Ht,Ce[Ht],Ye),sr!==null&&(e&&sr.alternate!==null&&Ft.delete(sr.key===null?Ht:sr.key),be=v(sr,be,Ht),fn===null?$t=sr:fn.sibling=sr,fn=sr);return e&&Ft.forEach(function(_l){return s(we,_l)}),vn&&vi(we,Ht),$t}function Gt(we,be,Ce,Ye){if(Ce==null)throw Error(a(151));for(var $t=null,fn=null,Ft=be,Ht=be=0,sr=null,Ln=Ce.next();Ft!==null&&!Ln.done;Ht++,Ln=Ce.next()){Ft.index>Ht?(sr=Ft,Ft=null):sr=Ft.sibling;var _l=Le(we,Ft,Ln.value,Ye);if(_l===null){Ft===null&&(Ft=sr);break}e&&Ft&&_l.alternate===null&&s(we,Ft),be=v(_l,be,Ht),fn===null?$t=_l:fn.sibling=_l,fn=_l,Ft=sr}if(Ln.done)return i(we,Ft),vn&&vi(we,Ht),$t;if(Ft===null){for(;!Ln.done;Ht++,Ln=Ce.next())Ln=Je(we,Ln.value,Ye),Ln!==null&&(be=v(Ln,be,Ht),fn===null?$t=Ln:fn.sibling=Ln,fn=Ln);return vn&&vi(we,Ht),$t}for(Ft=l(Ft);!Ln.done;Ht++,Ln=Ce.next())Ln=ze(Ft,we,Ht,Ln.value,Ye),Ln!==null&&(e&&Ln.alternate!==null&&Ft.delete(Ln.key===null?Ht:Ln.key),be=v(Ln,be,Ht),fn===null?$t=Ln:fn.sibling=Ln,fn=Ln);return e&&Ft.forEach(function(ox){return s(we,ox)}),vn&&vi(we,Ht),$t}function Qn(we,be,Ce,Ye){if(typeof Ce=="object"&&Ce!==null&&Ce.type===M&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case h:e:{for(var $t=Ce.key;be!==null;){if(be.key===$t){if($t=Ce.type,$t===M){if(be.tag===7){i(we,be.sibling),Ye=m(be,Ce.props.children),Ye.return=we,we=Ye;break e}}else if(be.elementType===$t||typeof $t=="object"&&$t!==null&&$t.$$typeof===k&&kf($t)===be.type){i(we,be.sibling),Ye=m(be,Ce.props),so(Ye,Ce),Ye.return=we,we=Ye;break e}i(we,be);break}else s(we,be);be=be.sibling}Ce.type===M?(Ye=bi(Ce.props.children,we.mode,Ye,Ce.key),Ye.return=we,we=Ye):(Ye=$o(Ce.type,Ce.key,Ce.props,null,we.mode,Ye),so(Ye,Ce),Ye.return=we,we=Ye)}return B(we);case w:e:{for($t=Ce.key;be!==null;){if(be.key===$t)if(be.tag===4&&be.stateNode.containerInfo===Ce.containerInfo&&be.stateNode.implementation===Ce.implementation){i(we,be.sibling),Ye=m(be,Ce.children||[]),Ye.return=we,we=Ye;break e}else{i(we,be);break}else s(we,be);be=be.sibling}Ye=Wl(Ce,we.mode,Ye),Ye.return=we,we=Ye}return B(we);case k:return $t=Ce._init,Ce=$t(Ce._payload),Qn(we,be,Ce,Ye)}if(ae(Ce))return Zt(we,be,Ce,Ye);if(ne(Ce)){if($t=ne(Ce),typeof $t!="function")throw Error(a(150));return Ce=$t.call(Ce),Gt(we,be,Ce,Ye)}if(typeof Ce.then=="function")return Qn(we,be,mu(Ce),Ye);if(Ce.$$typeof===L)return Qn(we,be,Fo(we,Ce),Ye);_u(we,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,be!==null&&be.tag===6?(i(we,be.sibling),Ye=m(be,Ce),Ye.return=we,we=Ye):(i(we,be),Ye=gc(Ce,we.mode,Ye),Ye.return=we,we=Ye),B(we)):i(we,be)}return function(we,be,Ce,Ye){try{Qo=0;var $t=Qn(we,be,Ce,Ye);return no=null,$t}catch(Ft){if(Ft===No||Ft===jo)throw Ft;var fn=dr(29,Ft,null,we.mode);return fn.lanes=Ye,fn.return=we,fn}finally{}}}var ro=Qc(!0),Lf=Qc(!1),Is=j(null),Vr=null;function Ba(e){var s=e.alternate;X(Ps,Ps.current&1),X(Is,e),Vr===null&&(s===null||Ji.current!==null||s.memoizedState!==null)&&(Vr=e)}function If(e){if(e.tag===22){if(X(Ps,Ps.current),X(Is,e),Vr===null){var s=e.alternate;s!==null&&s.memoizedState!==null&&(Vr=e)}}else Na()}function Na(){X(Ps,Ps.current),X(Is,Is.current)}function Gr(e){R(Is),Vr===e&&(Vr=null),R(Ps)}var Ps=j(0);function gu(e){for(var s=e;s!==null;){if(s.tag===13){var i=s.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||ul(i)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Xc(e,s,i,l){s=e.memoizedState,i=i(l,s),i=i==null?s:g({},s,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Yc={enqueueSetState:function(e,s,i){e=e._reactInternals;var l=mr(),m=za(l);m.payload=s,i!=null&&(m.callback=i),s=Fa(e,m,l),s!==null&&(Vs(s,e,l),Yi(s,e,l))},enqueueReplaceState:function(e,s,i){e=e._reactInternals;var l=mr(),m=za(l);m.tag=1,m.payload=s,i!=null&&(m.callback=i),s=Fa(e,m,l),s!==null&&(Vs(s,e,l),Yi(s,e,l))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var i=mr(),l=za(i);l.tag=2,s!=null&&(l.callback=s),s=Fa(e,l,i),s!==null&&(Vs(s,e,i),Yi(s,e,i))}};function yu(e,s,i,l,m,v,B){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,v,B):s.prototype&&s.prototype.isPureReactComponent?!$a(i,l)||!$a(m,v):!0}function zf(e,s,i,l){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(i,l),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(i,l),s.state!==e&&Yc.enqueueReplaceState(s,s.state,null)}function Si(e,s){var i=s;if("ref"in s){i={};for(var l in s)l!=="ref"&&(i[l]=s[l])}if(e=e.defaultProps){i===s&&(i=g({},i));for(var m in e)i[m]===void 0&&(i[m]=e[m])}return i}var bu=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Xo(e){bu(e)}function Ff(e){console.error(e)}function Rf(e){bu(e)}function Mu(e,s){try{var i=e.onUncaughtError;i(s.value,{componentStack:s.stack})}catch(l){setTimeout(function(){throw l})}}function Bf(e,s,i){try{var l=e.onCaughtError;l(i.value,{componentStack:i.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Yo(e,s,i){return i=za(i),i.tag=3,i.payload={element:null},i.callback=function(){Mu(e,s)},i}function Nf(e){return e=za(e),e.tag=3,e}function jf(e,s,i,l){var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var v=l.value;e.payload=function(){return m(v)},e.callback=function(){Bf(s,i,l)}}var B=i.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(e.callback=function(){Bf(s,i,l),typeof m!="function"&&(_a===null?_a=new Set([this]):_a.add(this));var Z=l.stack;this.componentDidCatch(l.value,{componentStack:Z!==null?Z:""})})}function ih(e,s,i,l,m){if(i.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(s=i.alternate,s!==null&&Io(s,i,m,!0),i=Is.current,i!==null){switch(i.tag){case 13:return Vr===null?bd():i.alternate===null&&ls===0&&(ls=3),i.flags&=-257,i.flags|=65536,i.lanes=m,l===wc?i.flags|=16384:(s=i.updateQueue,s===null?i.updateQueue=new Set([l]):s.add(l),gp(e,l,m)),!1;case 22:return i.flags|=65536,l===wc?i.flags|=16384:(s=i.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([l])},i.updateQueue=s):(i=s.retryQueue,i===null?s.retryQueue=new Set([l]):i.add(l)),gp(e,l,m)),!1}throw Error(a(435,i.tag))}return gp(e,l,m),bd(),!1}if(vn)return s=Is.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=m,l!==bc&&(e=Error(a(422),{cause:l}),Lo(En(e,i)))):(l!==bc&&(s=Error(a(423),{cause:l}),Lo(En(s,i))),e=e.current.alternate,e.flags|=65536,m&=-m,e.lanes|=m,l=En(l,i),m=Yo(e.stateNode,l,m),Tc(e,m),ls!==4&&(ls=2)),!1;var v=Error(a(520),{cause:l});if(v=En(v,i),ku===null?ku=[v]:ku.push(v),ls!==4&&(ls=2),s===null)return!0;l=En(l,i),i=s;do{switch(i.tag){case 3:return i.flags|=65536,e=m&-m,i.lanes|=e,e=Yo(i.stateNode,l,e),Tc(i,e),!1;case 1:if(s=i.type,v=i.stateNode,(i.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(_a===null||!_a.has(v))))return i.flags|=65536,m&=-m,i.lanes|=m,m=Nf(m),jf(m,e,i,l),Tc(i,m),!1}i=i.return}while(i!==null);return!1}var oh=Error(a(461)),zs=!1;function Us(e,s,i,l){s.child=e===null?Lf(s,null,i,l):ro(s,e.child,i,l)}function Uf(e,s,i,l,m){i=i.render;var v=s.ref;if("ref"in l){var B={};for(var Z in l)Z!=="ref"&&(B[Z]=l[Z])}else B=l;return Ei(s),l=$c(e,s,i,B,v,m),Z=kc(),e!==null&&!zs?(ru(e,s,m),da(e,s,m)):(vn&&Z&&ql(s),s.flags|=1,Us(e,s,l,m),s.child)}function ao(e,s,i,l,m){if(e===null){var v=i.type;return typeof v=="function"&&!Gl(v)&&v.defaultProps===void 0&&i.compare===null?(s.tag=15,s.type=v,Vf(e,s,v,l,m)):(e=$o(i.type,null,l,s,s.mode,m),e.ref=s.ref,e.return=s,s.child=e)}if(v=e.child,!rd(e,m)){var B=v.memoizedProps;if(i=i.compare,i=i!==null?i:$a,i(B,l)&&e.ref===s.ref)return da(e,s,m)}return s.flags|=1,e=aa(v,l),e.ref=s.ref,e.return=s,s.child=e}function Vf(e,s,i,l,m){if(e!==null){var v=e.memoizedProps;if($a(v,l)&&e.ref===s.ref)if(zs=!1,s.pendingProps=l=v,rd(e,m))(e.flags&131072)!==0&&(zs=!0);else return s.lanes=e.lanes,da(e,s,m)}return Zc(e,s,i,l,m)}function Gf(e,s,i){var l=s.pendingProps,m=l.children,v=e!==null?e.memoizedState:null;if(l.mode==="hidden"){if((s.flags&128)!==0){if(l=v!==null?v.baseLanes|i:i,e!==null){for(m=s.child=e.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;s.childLanes=v&~l}else s.childLanes=0,s.child=null;return Wf(e,s,l,i)}if((i&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},e!==null&&Jl(s,v!==null?v.cachePool:null),v!==null?Sc(s,v):Pc(),If(s);else return s.lanes=s.childLanes=536870912,Wf(e,s,v!==null?v.baseLanes|i:i,i)}else v!==null?(Jl(s,v.cachePool),Sc(s,v),Na(),s.memoizedState=null):(e!==null&&Jl(s,null),Pc(),Na());return Us(e,s,m,i),s.child}function Wf(e,s,i,l){var m=Zl();return m=m===null?null:{parent:Ss._currentValue,pool:m},s.memoizedState={baseLanes:i,cachePool:m},e!==null&&Jl(s,null),Pc(),If(s),e!==null&&Io(e,s,l,!0),null}function vu(e,s){var i=s.ref;if(i===null)e!==null&&e.ref!==null&&(s.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(a(284));(e===null||e.ref!==i)&&(s.flags|=4194816)}}function Zc(e,s,i,l,m){return Ei(s),i=$c(e,s,i,l,void 0,m),l=kc(),e!==null&&!zs?(ru(e,s,m),da(e,s,m)):(vn&&l&&ql(s),s.flags|=1,Us(e,s,i,m),s.child)}function Hf(e,s,i,l,m,v){return Ei(s),s.updateQueue=null,i=tf(s,l,i,m),Dc(e),l=kc(),e!==null&&!zs?(ru(e,s,v),da(e,s,v)):(vn&&l&&ql(s),s.flags|=1,Us(e,s,i,v),s.child)}function qf(e,s,i,l,m){if(Ei(s),s.stateNode===null){var v=yi,B=i.contextType;typeof B=="object"&&B!==null&&(v=Qs(B)),v=new i(l,v),s.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Yc,s.stateNode=v,v._reactInternals=s,v=s.stateNode,v.props=l,v.state=s.memoizedState,v.refs={},xc(s),B=i.contextType,v.context=typeof B=="object"&&B!==null?Qs(B):yi,v.state=s.memoizedState,B=i.getDerivedStateFromProps,typeof B=="function"&&(Xc(s,i,B,l),v.state=s.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(B=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),B!==v.state&&Yc.enqueueReplaceState(v,v.state,null),Uo(s,l,v,m),Zi(),v.state=s.memoizedState),typeof v.componentDidMount=="function"&&(s.flags|=4194308),l=!0}else if(e===null){v=s.stateNode;var Z=s.memoizedProps,fe=Si(i,Z);v.props=fe;var Pe=v.context,Qe=i.contextType;B=yi,typeof Qe=="object"&&Qe!==null&&(B=Qs(Qe));var Je=i.getDerivedStateFromProps;Qe=typeof Je=="function"||typeof v.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Qe||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(Z||Pe!==B)&&zf(s,v,l,B),Ia=!1;var Le=s.memoizedState;v.state=Le,Uo(s,l,v,m),Zi(),Pe=s.memoizedState,Z||Le!==Pe||Ia?(typeof Je=="function"&&(Xc(s,i,Je,l),Pe=s.memoizedState),(fe=Ia||yu(s,i,fe,l,Le,Pe,B))?(Qe||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(s.flags|=4194308)):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=l,s.memoizedState=Pe),v.props=l,v.state=Pe,v.context=B,l=fe):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),l=!1)}else{v=s.stateNode,tu(e,s),B=s.memoizedProps,Qe=Si(i,B),v.props=Qe,Je=s.pendingProps,Le=v.context,Pe=i.contextType,fe=yi,typeof Pe=="object"&&Pe!==null&&(fe=Qs(Pe)),Z=i.getDerivedStateFromProps,(Pe=typeof Z=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(B!==Je||Le!==fe)&&zf(s,v,l,fe),Ia=!1,Le=s.memoizedState,v.state=Le,Uo(s,l,v,m),Zi();var ze=s.memoizedState;B!==Je||Le!==ze||Ia||e!==null&&e.dependencies!==null&&zo(e.dependencies)?(typeof Z=="function"&&(Xc(s,i,Z,l),ze=s.memoizedState),(Qe=Ia||yu(s,i,Qe,l,Le,ze,fe)||e!==null&&e.dependencies!==null&&zo(e.dependencies))?(Pe||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(l,ze,fe),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(l,ze,fe)),typeof v.componentDidUpdate=="function"&&(s.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof v.componentDidUpdate!="function"||B===e.memoizedProps&&Le===e.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||B===e.memoizedProps&&Le===e.memoizedState||(s.flags|=1024),s.memoizedProps=l,s.memoizedState=ze),v.props=l,v.state=ze,v.context=fe,l=Qe):(typeof v.componentDidUpdate!="function"||B===e.memoizedProps&&Le===e.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||B===e.memoizedProps&&Le===e.memoizedState||(s.flags|=1024),l=!1)}return v=l,vu(e,s),l=(s.flags&128)!==0,v||l?(v=s.stateNode,i=l&&typeof i.getDerivedStateFromError!="function"?null:v.render(),s.flags|=1,e!==null&&l?(s.child=ro(s,e.child,null,m),s.child=ro(s,null,i,m)):Us(e,s,i,m),s.memoizedState=v.state,e=s.child):e=da(e,s,m),e}function wu(e,s,i,l){return qi(),s.flags|=256,Us(e,s,i,l),s.child}var Kf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Jc(e){return{baseLanes:e,cachePool:qd()}}function ed(e,s,i){return e=e!==null?e.childLanes&~i:0,s&&(e|=kr),e}function Qf(e,s,i){var l=s.pendingProps,m=!1,v=(s.flags&128)!==0,B;if((B=v)||(B=e!==null&&e.memoizedState===null?!1:(Ps.current&2)!==0),B&&(m=!0,s.flags&=-129),B=(s.flags&32)!==0,s.flags&=-33,e===null){if(vn){if(m?Ba(s):Na(),vn){var Z=as,fe;if(fe=Z){e:{for(fe=Z,Z=$r;fe.nodeType!==8;){if(!Z){Z=null;break e}if(fe=Er(fe.nextSibling),fe===null){Z=null;break e}}Z=fe}Z!==null?(s.memoizedState={dehydrated:Z,treeContext:Mi!==null?{id:ia,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},fe=dr(18,null,null,0),fe.stateNode=Z,fe.return=s,s.child=fe,er=s,as=null,fe=!0):fe=!1}fe||xi(s)}if(Z=s.memoizedState,Z!==null&&(Z=Z.dehydrated,Z!==null))return ul(Z)?s.lanes=32:s.lanes=536870912,null;Gr(s)}return Z=l.children,l=l.fallback,m?(Na(),m=s.mode,Z=xu({mode:"hidden",children:Z},m),l=bi(l,m,i,null),Z.return=s,l.return=s,Z.sibling=l,s.child=Z,m=s.child,m.memoizedState=Jc(i),m.childLanes=ed(e,B,i),s.memoizedState=Kf,l):(Ba(s),td(s,Z))}if(fe=e.memoizedState,fe!==null&&(Z=fe.dehydrated,Z!==null)){if(v)s.flags&256?(Ba(s),s.flags&=-257,s=Tu(e,s,i)):s.memoizedState!==null?(Na(),s.child=e.child,s.flags|=128,s=null):(Na(),m=l.fallback,Z=s.mode,l=xu({mode:"visible",children:l.children},Z),m=bi(m,Z,i,null),m.flags|=2,l.return=s,m.return=s,l.sibling=m,s.child=l,ro(s,e.child,null,i),l=s.child,l.memoizedState=Jc(i),l.childLanes=ed(e,B,i),s.memoizedState=Kf,s=m);else if(Ba(s),ul(Z)){if(B=Z.nextSibling&&Z.nextSibling.dataset,B)var Pe=B.dgst;B=Pe,l=Error(a(419)),l.stack="",l.digest=B,Lo({value:l,source:null,stack:null}),s=Tu(e,s,i)}else if(zs||Io(e,s,i,!1),B=(i&e.childLanes)!==0,zs||B){if(B=Wn,B!==null&&(l=i&-i,l=(l&42)!==0?1:xn(l),l=(l&(B.suspendedLanes|i))!==0?0:l,l!==0&&l!==fe.retryLane))throw fe.retryLane=l,gi(e,l),Vs(B,e,l),oh;Z.data==="$?"||bd(),s=Tu(e,s,i)}else Z.data==="$?"?(s.flags|=192,s.child=e.child,s=null):(e=fe.treeContext,as=Er(Z.nextSibling),er=s,vn=!0,wi=null,$r=!1,e!==null&&(Tr[fr++]=ia,Tr[fr++]=jr,Tr[fr++]=Mi,ia=e.id,jr=e.overflow,Mi=s),s=td(s,l.children),s.flags|=4096);return s}return m?(Na(),m=l.fallback,Z=s.mode,fe=e.child,Pe=fe.sibling,l=aa(fe,{mode:"hidden",children:l.children}),l.subtreeFlags=fe.subtreeFlags&65011712,Pe!==null?m=aa(Pe,m):(m=bi(m,Z,i,null),m.flags|=2),m.return=s,l.return=s,l.sibling=m,s.child=l,l=m,m=s.child,Z=e.child.memoizedState,Z===null?Z=Jc(i):(fe=Z.cachePool,fe!==null?(Pe=Ss._currentValue,fe=fe.parent!==Pe?{parent:Pe,pool:Pe}:fe):fe=qd(),Z={baseLanes:Z.baseLanes|i,cachePool:fe}),m.memoizedState=Z,m.childLanes=ed(e,B,i),s.memoizedState=Kf,l):(Ba(s),i=e.child,e=i.sibling,i=aa(i,{mode:"visible",children:l.children}),i.return=s,i.sibling=null,e!==null&&(B=s.deletions,B===null?(s.deletions=[e],s.flags|=16):B.push(e)),s.child=i,s.memoizedState=null,i)}function td(e,s){return s=xu({mode:"visible",children:s},e.mode),s.return=e,e.child=s}function xu(e,s){return e=dr(22,e,null,s),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Tu(e,s,i){return ro(s,e.child,null,i),e=td(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function Xf(e,s,i){e.lanes|=s;var l=e.alternate;l!==null&&(l.lanes|=s),Ql(e.return,s,i)}function nd(e,s,i,l,m){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:m}:(v.isBackwards=s,v.rendering=null,v.renderingStartTime=0,v.last=l,v.tail=i,v.tailMode=m)}function sd(e,s,i){var l=s.pendingProps,m=l.revealOrder,v=l.tail;if(Us(e,s,l.children,i),l=Ps.current,(l&2)!==0)l=l&1|2,s.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Xf(e,i,s);else if(e.tag===19)Xf(e,i,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}switch(X(Ps,l),m){case"forwards":for(i=s.child,m=null;i!==null;)e=i.alternate,e!==null&&gu(e)===null&&(m=i),i=i.sibling;i=m,i===null?(m=s.child,s.child=null):(m=i.sibling,i.sibling=null),nd(s,!1,m,i,v);break;case"backwards":for(i=null,m=s.child,s.child=null;m!==null;){if(e=m.alternate,e!==null&&gu(e)===null){s.child=m;break}e=m.sibling,m.sibling=i,i=m,m=e}nd(s,!0,i,null,v);break;case"together":nd(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function da(e,s,i){if(e!==null&&(s.dependencies=e.dependencies),Wa|=s.lanes,(i&s.childLanes)===0)if(e!==null){if(Io(e,s,i,!1),(i&s.childLanes)===0)return null}else return null;if(e!==null&&s.child!==e.child)throw Error(a(153));if(s.child!==null){for(e=s.child,i=aa(e,e.pendingProps),s.child=i,i.return=s;e.sibling!==null;)e=e.sibling,i=i.sibling=aa(e,e.pendingProps),i.return=s;i.sibling=null}return s.child}function rd(e,s){return(e.lanes&s)!==0?!0:(e=e.dependencies,!!(e!==null&&zo(e)))}function Yf(e,s,i){switch(s.tag){case 3:Ne(s,s.stateNode.containerInfo),La(s,Ss,e.memoizedState.cache),qi();break;case 27:case 5:je(s);break;case 4:Ne(s,s.stateNode.containerInfo);break;case 10:La(s,s.type,s.memoizedProps.value);break;case 13:var l=s.memoizedState;if(l!==null)return l.dehydrated!==null?(Ba(s),s.flags|=128,null):(i&s.child.childLanes)!==0?Qf(e,s,i):(Ba(s),e=da(e,s,i),e!==null?e.sibling:null);Ba(s);break;case 19:var m=(e.flags&128)!==0;if(l=(i&s.childLanes)!==0,l||(Io(e,s,i,!1),l=(i&s.childLanes)!==0),m){if(l)return sd(e,s,i);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),X(Ps,Ps.current),l)break;return null;case 22:case 23:return s.lanes=0,Gf(e,s,i);case 24:La(s,Ss,e.memoizedState.cache)}return da(e,s,i)}function Zf(e,s,i){if(e!==null)if(e.memoizedProps!==s.pendingProps)zs=!0;else{if(!rd(e,i)&&(s.flags&128)===0)return zs=!1,Yf(e,s,i);zs=(e.flags&131072)!==0}else zs=!1,vn&&(s.flags&1048576)!==0&&Bd(s,Hl,s.index);switch(s.lanes=0,s.tag){case 16:e:{e=s.pendingProps;var l=s.elementType,m=l._init;if(l=m(l._payload),s.type=l,typeof l=="function")Gl(l)?(e=Si(l,e),s.tag=1,s=qf(null,s,l,e,i)):(s.tag=0,s=Zc(null,s,l,e,i));else{if(l!=null){if(m=l.$$typeof,m===O){s.tag=11,s=Uf(null,s,l,e,i);break e}else if(m===C){s.tag=14,s=ao(null,s,l,e,i);break e}}throw s=ce(l)||l,Error(a(306,s,""))}}return s;case 0:return Zc(e,s,s.type,s.pendingProps,i);case 1:return l=s.type,m=Si(l,s.pendingProps),qf(e,s,l,m,i);case 3:e:{if(Ne(s,s.stateNode.containerInfo),e===null)throw Error(a(387));l=s.pendingProps;var v=s.memoizedState;m=v.element,tu(e,s),Uo(s,l,null,i);var B=s.memoizedState;if(l=B.cache,La(s,Ss,l),l!==v.cache&&vc(s,[Ss],i,!0),Zi(),l=B.element,v.isDehydrated)if(v={element:l,isDehydrated:!1,cache:B.cache},s.updateQueue.baseState=v,s.memoizedState=v,s.flags&256){s=wu(e,s,l,i);break e}else if(l!==m){m=En(Error(a(424)),s),Lo(m),s=wu(e,s,l,i);break e}else{switch(e=s.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(as=Er(e.firstChild),er=s,vn=!0,wi=null,$r=!0,i=Lf(s,null,l,i),s.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(qi(),l===m){s=da(e,s,i);break e}Us(e,s,l,i)}s=s.child}return s;case 26:return vu(e,s),e===null?(i=U1(s.type,null,s.pendingProps,null))?s.memoizedState=i:vn||(i=s.type,e=s.pendingProps,l=en(Te.current).createElement(i),l[Y]=s,l[le]=e,on(l,i,e),Tn(l),s.stateNode=l):s.memoizedState=U1(s.type,e.memoizedProps,s.pendingProps,e.memoizedState),null;case 27:return je(s),e===null&&vn&&(l=s.stateNode=Ed(s.type,s.pendingProps,Te.current),er=s,$r=!0,m=as,Mn(s.type)?(Uu=m,as=Er(l.firstChild)):as=m),Us(e,s,s.pendingProps.children,i),vu(e,s),e===null&&(s.flags|=4194304),s.child;case 5:return e===null&&vn&&((m=l=as)&&(l=yo(l,s.type,s.pendingProps,$r),l!==null?(s.stateNode=l,er=s,as=Er(l.firstChild),$r=!1,m=!0):m=!1),m||xi(s)),je(s),m=s.type,v=s.pendingProps,B=e!==null?e.memoizedProps:null,l=v.children,Ka(m,v)?l=null:B!==null&&Ka(m,B)&&(s.flags|=32),s.memoizedState!==null&&(m=$c(e,s,th,null,null,i),Cp._currentValue=m),vu(e,s),Us(e,s,l,i),s.child;case 6:return e===null&&vn&&((e=i=as)&&(i=ll(i,s.pendingProps,$r),i!==null?(s.stateNode=i,er=s,as=null,e=!0):e=!1),e||xi(s)),null;case 13:return Qf(e,s,i);case 4:return Ne(s,s.stateNode.containerInfo),l=s.pendingProps,e===null?s.child=ro(s,null,l,i):Us(e,s,l,i),s.child;case 11:return Uf(e,s,s.type,s.pendingProps,i);case 7:return Us(e,s,s.pendingProps,i),s.child;case 8:return Us(e,s,s.pendingProps.children,i),s.child;case 12:return Us(e,s,s.pendingProps.children,i),s.child;case 10:return l=s.pendingProps,La(s,s.type,l.value),Us(e,s,l.children,i),s.child;case 9:return m=s.type._context,l=s.pendingProps.children,Ei(s),m=Qs(m),l=l(m),s.flags|=1,Us(e,s,l,i),s.child;case 14:return ao(e,s,s.type,s.pendingProps,i);case 15:return Vf(e,s,s.type,s.pendingProps,i);case 19:return sd(e,s,i);case 31:return l=s.pendingProps,i=s.mode,l={mode:l.mode,children:l.children},e===null?(i=xu(l,i),i.ref=s.ref,s.child=i,i.return=s,s=i):(i=aa(e.child,l),i.ref=s.ref,s.child=i,i.return=s,s=i),s;case 22:return Gf(e,s,i);case 24:return Ei(s),l=Qs(Ss),e===null?(m=Zl(),m===null&&(m=Wn,v=Xl(),m.pooledCache=v,v.refCount++,v!==null&&(m.pooledCacheLanes|=i),m=v),s.memoizedState={parent:l,cache:m},xc(s),La(s,Ss,m)):((e.lanes&i)!==0&&(tu(e,s),Uo(s,null,null,i),Zi()),m=e.memoizedState,v=s.memoizedState,m.parent!==l?(m={parent:l,cache:l},s.memoizedState=m,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=m),La(s,Ss,l)):(l=v.cache,La(s,Ss,l),l!==m.cache&&vc(s,[Ss],i,!0))),Us(e,s,s.pendingProps.children,i),s.child;case 29:throw s.pendingProps}throw Error(a(156,s.tag))}function fa(e){e.flags|=4}function ad(e,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!q1(s)){if(s=Is.current,s!==null&&((pn&4194048)===pn?Vr!==null:(pn&62914560)!==pn&&(pn&536870912)===0||s!==Vr))throw Xi=wc,Kd;e.flags|=8192}}function Eu(e,s){s!==null&&(e.flags|=4),e.flags&16384&&(s=e.tag!==22?xa():536870912,e.lanes|=s,sl|=s)}function Zo(e,s){if(!vn)switch(e.tailMode){case"hidden":s=e.tail;for(var i=null;s!==null;)s.alternate!==null&&(i=s),s=s.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Kn(e){var s=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(s)for(var m=e.child;m!==null;)i|=m.lanes|m.childLanes,l|=m.subtreeFlags&65011712,l|=m.flags&65011712,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)i|=m.lanes|m.childLanes,l|=m.subtreeFlags,l|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=l,e.childLanes=i,s}function lh(e,s,i){var l=s.pendingProps;switch(yc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kn(s),null;case 1:return Kn(s),null;case 3:return i=s.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),la(Ss),dt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(ko(s)?fa(s):e===null||e.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,jd())),Kn(s),null;case 26:return i=s.memoizedState,e===null?(fa(s),i!==null?(Kn(s),ad(s,i)):(Kn(s),s.flags&=-16777217)):i?i!==e.memoizedState?(fa(s),Kn(s),ad(s,i)):(Kn(s),s.flags&=-16777217):(e.memoizedProps!==l&&fa(s),Kn(s),s.flags&=-16777217),null;case 27:oe(s),i=Te.current;var m=s.type;if(e!==null&&s.stateNode!=null)e.memoizedProps!==l&&fa(s);else{if(!l){if(s.stateNode===null)throw Error(a(166));return Kn(s),null}e=G.current,ko(s)?Mc(s):(e=Ed(m,l,i),s.stateNode=e,fa(s))}return Kn(s),null;case 5:if(oe(s),i=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==l&&fa(s);else{if(!l){if(s.stateNode===null)throw Error(a(166));return Kn(s),null}if(e=G.current,ko(s))Mc(s);else{switch(m=en(Te.current),e){case 1:e=m.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=m.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=m.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=m.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":e=m.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof l.is=="string"?m.createElement("select",{is:l.is}):m.createElement("select"),l.multiple?e.multiple=!0:l.size&&(e.size=l.size);break;default:e=typeof l.is=="string"?m.createElement(i,{is:l.is}):m.createElement(i)}}e[Y]=s,e[le]=l;e:for(m=s.child;m!==null;){if(m.tag===5||m.tag===6)e.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===s)break e;for(;m.sibling===null;){if(m.return===null||m.return===s)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}s.stateNode=e;e:switch(on(e,i,l),i){case"button":case"input":case"select":case"textarea":e=!!l.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&fa(s)}}return Kn(s),s.flags&=-16777217,null;case 6:if(e&&s.stateNode!=null)e.memoizedProps!==l&&fa(s);else{if(typeof l!="string"&&s.stateNode===null)throw Error(a(166));if(e=Te.current,ko(s)){if(e=s.stateNode,i=s.memoizedProps,l=null,m=er,m!==null)switch(m.tag){case 27:case 5:l=m.memoizedProps}e[Y]=s,e=!!(e.nodeValue===i||l!==null&&l.suppressHydrationWarning===!0||Rt(e.nodeValue,i)),e||xi(s)}else e=en(e).createTextNode(l),e[Y]=s,s.stateNode=e}return Kn(s),null;case 13:if(l=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(m=ko(s),l!==null&&l.dehydrated!==null){if(e===null){if(!m)throw Error(a(318));if(m=s.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(a(317));m[Y]=s}else qi(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Kn(s),m=!1}else m=jd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=m),m=!0;if(!m)return s.flags&256?(Gr(s),s):(Gr(s),null)}if(Gr(s),(s.flags&128)!==0)return s.lanes=i,s;if(i=l!==null,e=e!==null&&e.memoizedState!==null,i){l=s.child,m=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(m=l.alternate.memoizedState.cachePool.pool);var v=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(v=l.memoizedState.cachePool.pool),v!==m&&(l.flags|=2048)}return i!==e&&i&&(s.child.flags|=8192),Eu(s,s.updateQueue),Kn(s),null;case 4:return dt(),e===null&&Ae(s.stateNode.containerInfo),Kn(s),null;case 10:return la(s.type),Kn(s),null;case 19:if(R(Ps),m=s.memoizedState,m===null)return Kn(s),null;if(l=(s.flags&128)!==0,v=m.rendering,v===null)if(l)Zo(m,!1);else{if(ls!==0||e!==null&&(e.flags&128)!==0)for(e=s.child;e!==null;){if(v=gu(e),v!==null){for(s.flags|=128,Zo(m,!1),e=v.updateQueue,s.updateQueue=e,Eu(s,e),s.subtreeFlags=0,e=i,i=s.child;i!==null;)Rd(i,e),i=i.sibling;return X(Ps,Ps.current&1|2),s.child}e=e.sibling}m.tail!==null&&Ee()>Lu&&(s.flags|=128,l=!0,Zo(m,!1),s.lanes=4194304)}else{if(!l)if(e=gu(v),e!==null){if(s.flags|=128,l=!0,e=e.updateQueue,s.updateQueue=e,Eu(s,e),Zo(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!vn)return Kn(s),null}else 2*Ee()-m.renderingStartTime>Lu&&i!==536870912&&(s.flags|=128,l=!0,Zo(m,!1),s.lanes=4194304);m.isBackwards?(v.sibling=s.child,s.child=v):(e=m.last,e!==null?e.sibling=v:s.child=v,m.last=v)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Ee(),s.sibling=null,e=Ps.current,X(Ps,l?e&1|2:e&1),s):(Kn(s),null);case 22:case 23:return Gr(s),Ac(),l=s.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(s.flags|=8192):l&&(s.flags|=8192),l?(i&536870912)!==0&&(s.flags&128)===0&&(Kn(s),s.subtreeFlags&6&&(s.flags|=8192)):Kn(s),i=s.updateQueue,i!==null&&Eu(s,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),l=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),l!==i&&(s.flags|=2048),e!==null&&R(Ci),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),s.memoizedState.cache!==i&&(s.flags|=2048),la(Ss),Kn(s),null;case 25:return null;case 30:return null}throw Error(a(156,s.tag))}function uh(e,s){switch(yc(s),s.tag){case 1:return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return la(Ss),dt(),e=s.flags,(e&65536)!==0&&(e&128)===0?(s.flags=e&-65537|128,s):null;case 26:case 27:case 5:return oe(s),null;case 13:if(Gr(s),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(a(340));qi()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return R(Ps),null;case 4:return dt(),null;case 10:return la(s.type),null;case 22:case 23:return Gr(s),Ac(),e!==null&&R(Ci),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 24:return la(Ss),null;case 25:return null;default:return null}}function Jf(e,s){switch(yc(s),s.tag){case 3:la(Ss),dt();break;case 26:case 27:case 5:oe(s);break;case 4:dt();break;case 13:Gr(s);break;case 19:R(Ps);break;case 10:la(s.type);break;case 22:case 23:Gr(s),Ac(),e!==null&&R(Ci);break;case 24:la(Ss)}}function Jo(e,s){try{var i=s.updateQueue,l=i!==null?i.lastEffect:null;if(l!==null){var m=l.next;i=m;do{if((i.tag&e)===e){l=void 0;var v=i.create,B=i.inst;l=v(),B.destroy=l}i=i.next}while(i!==m)}}catch(Z){Hn(s,s.return,Z)}}function pa(e,s,i){try{var l=s.updateQueue,m=l!==null?l.lastEffect:null;if(m!==null){var v=m.next;l=v;do{if((l.tag&e)===e){var B=l.inst,Z=B.destroy;if(Z!==void 0){B.destroy=void 0,m=s;var fe=i,Pe=Z;try{Pe()}catch(Qe){Hn(m,fe,Qe)}}}l=l.next}while(l!==v)}}catch(Qe){Hn(s,s.return,Qe)}}function Cu(e){var s=e.updateQueue;if(s!==null){var i=e.stateNode;try{Cc(s,i)}catch(l){Hn(e,e.return,l)}}}function ch(e,s,i){i.props=Si(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(l){Hn(e,s,l)}}function el(e,s){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof i=="function"?e.refCleanup=i(l):i.current=l}}catch(m){Hn(e,s,m)}}function Wr(e,s){var i=e.ref,l=e.refCleanup;if(i!==null)if(typeof l=="function")try{l()}catch(m){Hn(e,s,m)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(m){Hn(e,s,m)}else i.current=null}function id(e){var s=e.type,i=e.memoizedProps,l=e.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":i.autoFocus&&l.focus();break e;case"img":i.src?l.src=i.src:i.srcSet&&(l.srcset=i.srcSet)}}catch(m){Hn(e,e.return,m)}}function od(e,s,i){try{var l=e.stateNode;vs(l,e.type,i,s),l[le]=s}catch(m){Hn(e,e.return,m)}}function ep(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Mn(e.type)||e.tag===4}function Su(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ep(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Mn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ld(e,s,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,s?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,s):(s=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,s.appendChild(e),i=i._reactRootContainer,i!=null||s.onclick!==null||(s.onclick=kt));else if(l!==4&&(l===27&&Mn(e.type)&&(i=e.stateNode,s=null),e=e.child,e!==null))for(ld(e,s,i),e=e.sibling;e!==null;)ld(e,s,i),e=e.sibling}function Pu(e,s,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,s?i.insertBefore(e,s):i.appendChild(e);else if(l!==4&&(l===27&&Mn(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(Pu(e,s,i),e=e.sibling;e!==null;)Pu(e,s,i),e=e.sibling}function ud(e){var s=e.stateNode,i=e.memoizedProps;try{for(var l=e.type,m=s.attributes;m.length;)s.removeAttributeNode(m[0]);on(s,l,i),s[Y]=e,s[le]=i}catch(v){Hn(e,e.return,v)}}var ja=!1,bs=!1,Au=!1,Ou=typeof WeakSet=="function"?WeakSet:Set,Fs=null;function dh(e,s){if(e=e.containerInfo,us=Nh,e=Ao(e),mi(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var m=l.anchorOffset,v=l.focusNode;l=l.focusOffset;try{i.nodeType,v.nodeType}catch{i=null;break e}var B=0,Z=-1,fe=-1,Pe=0,Qe=0,Je=e,Le=null;t:for(;;){for(var ze;Je!==i||m!==0&&Je.nodeType!==3||(Z=B+m),Je!==v||l!==0&&Je.nodeType!==3||(fe=B+l),Je.nodeType===3&&(B+=Je.nodeValue.length),(ze=Je.firstChild)!==null;)Le=Je,Je=ze;for(;;){if(Je===e)break t;if(Le===i&&++Pe===m&&(Z=B),Le===v&&++Qe===l&&(fe=B),(ze=Je.nextSibling)!==null)break;Je=Le,Le=Je.parentNode}Je=ze}i=Z===-1||fe===-1?null:{start:Z,end:fe}}else i=null}i=i||{start:0,end:0}}else i=null;for(is={focusedElem:e,selectionRange:i},Nh=!1,Fs=s;Fs!==null;)if(s=Fs,e=s.child,(s.subtreeFlags&1024)!==0&&e!==null)e.return=s,Fs=e;else for(;Fs!==null;){switch(s=Fs,v=s.alternate,e=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&v!==null){e=void 0,i=s,m=v.memoizedProps,v=v.memoizedState,l=i.stateNode;try{var Zt=Si(i.type,m,i.elementType===i.type);e=l.getSnapshotBeforeUpdate(Zt,v),l.__reactInternalSnapshotBeforeUpdate=e}catch(Gt){Hn(i,i.return,Gt)}}break;case 3:if((e&1024)!==0){if(e=s.stateNode.containerInfo,i=e.nodeType,i===9)ya(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ya(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=s.sibling,e!==null){e.return=s.return,Fs=e;break}Fs=s.return}}function tp(e,s,i){var l=i.flags;switch(i.tag){case 0:case 11:case 15:Ua(e,i),l&4&&Jo(5,i);break;case 1:if(Ua(e,i),l&4)if(e=i.stateNode,s===null)try{e.componentDidMount()}catch(B){Hn(i,i.return,B)}else{var m=Si(i.type,s.memoizedProps);s=s.memoizedState;try{e.componentDidUpdate(m,s,e.__reactInternalSnapshotBeforeUpdate)}catch(B){Hn(i,i.return,B)}}l&64&&Cu(i),l&512&&el(i,i.return);break;case 3:if(Ua(e,i),l&64&&(e=i.updateQueue,e!==null)){if(s=null,i.child!==null)switch(i.child.tag){case 27:case 5:s=i.child.stateNode;break;case 1:s=i.child.stateNode}try{Cc(e,s)}catch(B){Hn(i,i.return,B)}}break;case 27:s===null&&l&4&&ud(i);case 26:case 5:Ua(e,i),s===null&&l&4&&id(i),l&512&&el(i,i.return);break;case 12:Ua(e,i);break;case 13:Ua(e,i),l&4&&np(e,i),l&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=Mm.bind(null,i),vp(e,i))));break;case 22:if(l=i.memoizedState!==null||ja,!l){s=s!==null&&s.memoizedState!==null||bs,m=ja;var v=bs;ja=l,(bs=s)&&!v?Va(e,i,(i.subtreeFlags&8772)!==0):Ua(e,i),ja=m,bs=v}break;case 30:break;default:Ua(e,i)}}function $u(e){var s=e.alternate;s!==null&&(e.alternate=null,$u(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&Xt(s)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Jn=null,or=!1;function ha(e,s,i){for(i=i.child;i!==null;)Du(e,s,i),i=i.sibling}function Du(e,s,i){if(mt&&typeof mt.onCommitFiberUnmount=="function")try{mt.onCommitFiberUnmount(st,i)}catch{}switch(i.tag){case 26:bs||Wr(i,s),ha(e,s,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:bs||Wr(i,s);var l=Jn,m=or;Mn(i.type)&&(Jn=i.stateNode,or=!1),ha(e,s,i),Oi(i.stateNode),Jn=l,or=m;break;case 5:bs||Wr(i,s);case 6:if(l=Jn,m=or,Jn=null,ha(e,s,i),Jn=l,or=m,Jn!==null)if(or)try{(Jn.nodeType===9?Jn.body:Jn.nodeName==="HTML"?Jn.ownerDocument.body:Jn).removeChild(i.stateNode)}catch(v){Hn(i,s,v)}else try{Jn.removeChild(i.stateNode)}catch(v){Hn(i,s,v)}break;case 18:Jn!==null&&(or?(e=Jn,ws(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),Op(e)):ws(Jn,i.stateNode));break;case 4:l=Jn,m=or,Jn=i.stateNode.containerInfo,or=!0,ha(e,s,i),Jn=l,or=m;break;case 0:case 11:case 14:case 15:bs||pa(2,i,s),bs||pa(4,i,s),ha(e,s,i);break;case 1:bs||(Wr(i,s),l=i.stateNode,typeof l.componentWillUnmount=="function"&&ch(i,s,l)),ha(e,s,i);break;case 21:ha(e,s,i);break;case 22:bs=(l=bs)||i.memoizedState!==null,ha(e,s,i),bs=l;break;default:ha(e,s,i)}}function np(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Op(e)}catch(i){Hn(s,s.return,i)}}function fh(e){switch(e.tag){case 13:case 19:var s=e.stateNode;return s===null&&(s=e.stateNode=new Ou),s;case 22:return e=e.stateNode,s=e._retryCache,s===null&&(s=e._retryCache=new Ou),s;default:throw Error(a(435,e.tag))}}function cd(e,s){var i=fh(e);s.forEach(function(l){var m=vm.bind(null,e,l);i.has(l)||(i.add(l),l.then(m,m))})}function tr(e,s){var i=s.deletions;if(i!==null)for(var l=0;l<i.length;l++){var m=i[l],v=e,B=s,Z=B;e:for(;Z!==null;){switch(Z.tag){case 27:if(Mn(Z.type)){Jn=Z.stateNode,or=!1;break e}break;case 5:Jn=Z.stateNode,or=!1;break e;case 3:case 4:Jn=Z.stateNode.containerInfo,or=!0;break e}Z=Z.return}if(Jn===null)throw Error(a(160));Du(v,B,m),Jn=null,or=!1,v=m.alternate,v!==null&&(v.return=null),m.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)sp(s,e),s=s.sibling}var Dr=null;function sp(e,s){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:tr(s,e),pr(e),l&4&&(pa(3,e,e.return),Jo(3,e),pa(5,e,e.return));break;case 1:tr(s,e),pr(e),l&512&&(bs||i===null||Wr(i,i.return)),l&64&&ja&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?l:i.concat(l))));break;case 26:var m=Dr;if(tr(s,e),pr(e),l&512&&(bs||i===null||Wr(i,i.return)),l&4){var v=i!==null?i.memoizedState:null;if(l=e.memoizedState,i===null)if(l===null)if(e.stateNode===null){e:{l=e.type,i=e.memoizedProps,m=m.ownerDocument||m;t:switch(l){case"title":v=m.getElementsByTagName("title")[0],(!v||v[ft]||v[Y]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=m.createElement(l),m.head.insertBefore(v,m.querySelector("head > title"))),on(v,l,i),v[Y]=e,Tn(v),l=v;break e;case"link":var B=W1("link","href",m).get(l+(i.href||""));if(B){for(var Z=0;Z<B.length;Z++)if(v=B[Z],v.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&v.getAttribute("rel")===(i.rel==null?null:i.rel)&&v.getAttribute("title")===(i.title==null?null:i.title)&&v.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){B.splice(Z,1);break t}}v=m.createElement(l),on(v,l,i),m.head.appendChild(v);break;case"meta":if(B=W1("meta","content",m).get(l+(i.content||""))){for(Z=0;Z<B.length;Z++)if(v=B[Z],v.getAttribute("content")===(i.content==null?null:""+i.content)&&v.getAttribute("name")===(i.name==null?null:i.name)&&v.getAttribute("property")===(i.property==null?null:i.property)&&v.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&v.getAttribute("charset")===(i.charSet==null?null:i.charSet)){B.splice(Z,1);break t}}v=m.createElement(l),on(v,l,i),m.head.appendChild(v);break;default:throw Error(a(468,l))}v[Y]=e,Tn(v),l=v}e.stateNode=l}else H1(m,e.type,e.stateNode);else e.stateNode=G1(m,l,e.memoizedProps);else v!==l?(v===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):v.count--,l===null?H1(m,e.type,e.stateNode):G1(m,l,e.memoizedProps)):l===null&&e.stateNode!==null&&od(e,e.memoizedProps,i.memoizedProps)}break;case 27:tr(s,e),pr(e),l&512&&(bs||i===null||Wr(i,i.return)),i!==null&&l&4&&od(e,e.memoizedProps,i.memoizedProps);break;case 5:if(tr(s,e),pr(e),l&512&&(bs||i===null||Wr(i,i.return)),e.flags&32){m=e.stateNode;try{de(m,"")}catch(ze){Hn(e,e.return,ze)}}l&4&&e.stateNode!=null&&(m=e.memoizedProps,od(e,m,i!==null?i.memoizedProps:m)),l&1024&&(Au=!0);break;case 6:if(tr(s,e),pr(e),l&4){if(e.stateNode===null)throw Error(a(162));l=e.memoizedProps,i=e.stateNode;try{i.nodeValue=l}catch(ze){Hn(e,e.return,ze)}}break;case 3:if(Fh=null,m=Dr,Dr=cl(s.containerInfo),tr(s,e),Dr=m,pr(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{Op(s.containerInfo)}catch(ze){Hn(e,e.return,ze)}Au&&(Au=!1,rp(e));break;case 4:l=Dr,Dr=cl(e.stateNode.containerInfo),tr(s,e),pr(e),Dr=l;break;case 12:tr(s,e),pr(e);break;case 13:tr(s,e),pr(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(md=Ee()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,cd(e,l)));break;case 22:m=e.memoizedState!==null;var fe=i!==null&&i.memoizedState!==null,Pe=ja,Qe=bs;if(ja=Pe||m,bs=Qe||fe,tr(s,e),bs=Qe,ja=Pe,pr(e),l&8192)e:for(s=e.stateNode,s._visibility=m?s._visibility&-2:s._visibility|1,m&&(i===null||fe||ja||bs||Pi(e)),i=null,s=e;;){if(s.tag===5||s.tag===26){if(i===null){fe=i=s;try{if(v=fe.stateNode,m)B=v.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{Z=fe.stateNode;var Je=fe.memoizedProps.style,Le=Je!=null&&Je.hasOwnProperty("display")?Je.display:null;Z.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(ze){Hn(fe,fe.return,ze)}}}else if(s.tag===6){if(i===null){fe=s;try{fe.stateNode.nodeValue=m?"":fe.memoizedProps}catch(ze){Hn(fe,fe.return,ze)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===e)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;i===s&&(i=null),s=s.return}i===s&&(i=null),s.sibling.return=s.return,s=s.sibling}l&4&&(l=e.updateQueue,l!==null&&(i=l.retryQueue,i!==null&&(l.retryQueue=null,cd(e,i))));break;case 19:tr(s,e),pr(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,cd(e,l)));break;case 30:break;case 21:break;default:tr(s,e),pr(e)}}function pr(e){var s=e.flags;if(s&2){try{for(var i,l=e.return;l!==null;){if(ep(l)){i=l;break}l=l.return}if(i==null)throw Error(a(160));switch(i.tag){case 27:var m=i.stateNode,v=Su(e);Pu(e,v,m);break;case 5:var B=i.stateNode;i.flags&32&&(de(B,""),i.flags&=-33);var Z=Su(e);Pu(e,Z,B);break;case 3:case 4:var fe=i.stateNode.containerInfo,Pe=Su(e);ld(e,Pe,fe);break;default:throw Error(a(161))}}catch(Qe){Hn(e,e.return,Qe)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function rp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var s=e;rp(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),e=e.sibling}}function Ua(e,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)tp(e,s.alternate,s),s=s.sibling}function Pi(e){for(e=e.child;e!==null;){var s=e;switch(s.tag){case 0:case 11:case 14:case 15:pa(4,s,s.return),Pi(s);break;case 1:Wr(s,s.return);var i=s.stateNode;typeof i.componentWillUnmount=="function"&&ch(s,s.return,i),Pi(s);break;case 27:Oi(s.stateNode);case 26:case 5:Wr(s,s.return),Pi(s);break;case 22:s.memoizedState===null&&Pi(s);break;case 30:Pi(s);break;default:Pi(s)}e=e.sibling}}function Va(e,s,i){for(i=i&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var l=s.alternate,m=e,v=s,B=v.flags;switch(v.tag){case 0:case 11:case 15:Va(m,v,i),Jo(4,v);break;case 1:if(Va(m,v,i),l=v,m=l.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(Pe){Hn(l,l.return,Pe)}if(l=v,m=l.updateQueue,m!==null){var Z=l.stateNode;try{var fe=m.shared.hiddenCallbacks;if(fe!==null)for(m.shared.hiddenCallbacks=null,m=0;m<fe.length;m++)Jd(fe[m],Z)}catch(Pe){Hn(l,l.return,Pe)}}i&&B&64&&Cu(v),el(v,v.return);break;case 27:ud(v);case 26:case 5:Va(m,v,i),i&&l===null&&B&4&&id(v),el(v,v.return);break;case 12:Va(m,v,i);break;case 13:Va(m,v,i),i&&B&4&&np(m,v);break;case 22:v.memoizedState===null&&Va(m,v,i),el(v,v.return);break;case 30:break;default:Va(m,v,i)}s=s.sibling}}function dd(e,s){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(e=s.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Ro(i))}function fd(e,s){e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Ro(e))}function Hr(e,s,i,l){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)pd(e,s,i,l),s=s.sibling}function pd(e,s,i,l){var m=s.flags;switch(s.tag){case 0:case 11:case 15:Hr(e,s,i,l),m&2048&&Jo(9,s);break;case 1:Hr(e,s,i,l);break;case 3:Hr(e,s,i,l),m&2048&&(e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Ro(e)));break;case 12:if(m&2048){Hr(e,s,i,l),e=s.stateNode;try{var v=s.memoizedProps,B=v.id,Z=v.onPostCommit;typeof Z=="function"&&Z(B,s.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(fe){Hn(s,s.return,fe)}}else Hr(e,s,i,l);break;case 13:Hr(e,s,i,l);break;case 23:break;case 22:v=s.stateNode,B=s.alternate,s.memoizedState!==null?v._visibility&2?Hr(e,s,i,l):tl(e,s):v._visibility&2?Hr(e,s,i,l):(v._visibility|=2,io(e,s,i,l,(s.subtreeFlags&10256)!==0)),m&2048&&dd(B,s);break;case 24:Hr(e,s,i,l),m&2048&&fd(s.alternate,s);break;default:Hr(e,s,i,l)}}function io(e,s,i,l,m){for(m=m&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var v=e,B=s,Z=i,fe=l,Pe=B.flags;switch(B.tag){case 0:case 11:case 15:io(v,B,Z,fe,m),Jo(8,B);break;case 23:break;case 22:var Qe=B.stateNode;B.memoizedState!==null?Qe._visibility&2?io(v,B,Z,fe,m):tl(v,B):(Qe._visibility|=2,io(v,B,Z,fe,m)),m&&Pe&2048&&dd(B.alternate,B);break;case 24:io(v,B,Z,fe,m),m&&Pe&2048&&fd(B.alternate,B);break;default:io(v,B,Z,fe,m)}s=s.sibling}}function tl(e,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var i=e,l=s,m=l.flags;switch(l.tag){case 22:tl(i,l),m&2048&&dd(l.alternate,l);break;case 24:tl(i,l),m&2048&&fd(l.alternate,l);break;default:tl(i,l)}s=s.sibling}}var oo=8192;function lo(e){if(e.subtreeFlags&oo)for(e=e.child;e!==null;)ap(e),e=e.sibling}function ap(e){switch(e.tag){case 26:lo(e),e.flags&oo&&e.memoizedState!==null&&Yw(Dr,e.memoizedState,e.memoizedProps);break;case 5:lo(e);break;case 3:case 4:var s=Dr;Dr=cl(e.stateNode.containerInfo),lo(e),Dr=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=oo,oo=16777216,lo(e),oo=s):lo(e));break;default:lo(e)}}function ip(e){var s=e.alternate;if(s!==null&&(e=s.child,e!==null)){s.child=null;do s=e.sibling,e.sibling=null,e=s;while(e!==null)}}function uo(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var i=0;i<s.length;i++){var l=s[i];Fs=l,lp(l,e)}ip(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)op(e),e=e.sibling}function op(e){switch(e.tag){case 0:case 11:case 15:uo(e),e.flags&2048&&pa(9,e,e.return);break;case 3:uo(e);break;case 12:uo(e);break;case 22:var s=e.stateNode;e.memoizedState!==null&&s._visibility&2&&(e.return===null||e.return.tag!==13)?(s._visibility&=-3,co(e)):uo(e);break;default:uo(e)}}function co(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var i=0;i<s.length;i++){var l=s[i];Fs=l,lp(l,e)}ip(e)}for(e=e.child;e!==null;){switch(s=e,s.tag){case 0:case 11:case 15:pa(8,s,s.return),co(s);break;case 22:i=s.stateNode,i._visibility&2&&(i._visibility&=-3,co(s));break;default:co(s)}e=e.sibling}}function lp(e,s){for(;Fs!==null;){var i=Fs;switch(i.tag){case 0:case 11:case 15:pa(8,i,s);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var l=i.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Ro(i.memoizedState.cache)}if(l=i.child,l!==null)l.return=i,Fs=l;else e:for(i=e;Fs!==null;){l=Fs;var m=l.sibling,v=l.return;if($u(l),l===i){Fs=null;break e}if(m!==null){m.return=v,Fs=m;break e}Fs=v}}}var ph={getCacheForType:function(e){var s=Qs(Ss),i=s.data.get(e);return i===void 0&&(i=e(),s.data.set(e,i)),i}},hh=typeof WeakMap=="function"?WeakMap:Map,$n=0,Wn=null,an=null,pn=0,Dn=0,hr=null,Ga=!1,fo=!1,nl=!1,ma=0,ls=0,Wa=0,cn=0,up=0,kr=0,sl=0,ku=null,nr=null,hd=!1,md=0,Lu=1/0,Iu=null,_a=null,Rs=0,Ai=null,po=null,ho=0,zu=0,_d=null,cp=null,Fu=0,gd=null;function mr(){if(($n&2)!==0&&pn!==0)return pn&-pn;if(H.T!==null){var e=Ki;return e!==0?e:Vt()}return Fr()}function dp(){kr===0&&(kr=(pn&536870912)===0||vn?$s():536870912);var e=Is.current;return e!==null&&(e.flags|=32),kr}function Vs(e,s,i){(e===Wn&&(Dn===2||Dn===9)||e.cancelPendingCommit!==null)&&(mo(e,0),Ha(e,pn,kr,!1)),br(e,i),(($n&2)===0||e!==Wn)&&(e===Wn&&(($n&2)===0&&(cn|=i),ls===4&&Ha(e,pn,kr,!1)),ga(e))}function fp(e,s,i){if(($n&6)!==0)throw Error(a(327));var l=!i&&(s&124)===0&&(s&e.expiredLanes)===0||Zs(e,s),m=l?yh(e,s):Md(e,s,!0),v=l;do{if(m===0){fo&&!l&&Ha(e,s,0,!1);break}else{if(i=e.current.alternate,v&&!mh(i)){m=Md(e,s,!1),v=!1;continue}if(m===2){if(v=s,e.errorRecoveryDisabledLanes&v)var B=0;else B=e.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){s=B;e:{var Z=e;m=ku;var fe=Z.current.memoizedState.isDehydrated;if(fe&&(mo(Z,B).flags|=256),B=Md(Z,B,!1),B!==2){if(nl&&!fe){Z.errorRecoveryDisabledLanes|=v,cn|=v,m=4;break e}v=nr,nr=m,v!==null&&(nr===null?nr=v:nr.push.apply(nr,v))}m=B}if(v=!1,m!==2)continue}}if(m===1){mo(e,0),Ha(e,s,0,!0);break}e:{switch(l=e,v=m,v){case 0:case 1:throw Error(a(345));case 4:if((s&4194048)!==s)break;case 6:Ha(l,s,kr,!Ga);break e;case 2:nr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((s&62914560)===s&&(m=md+300-Ee(),10<m)){if(Ha(l,s,kr,!Ga),Os(l,0,!0)!==0)break e;l.timeoutHandle=go(pp.bind(null,l,i,nr,Iu,hd,s,kr,cn,sl,Ga,v,2,-0,0),m);break e}pp(l,i,nr,Iu,hd,s,kr,cn,sl,Ga,v,0,-0,0)}}break}while(!0);ga(e)}function pp(e,s,i,l,m,v,B,Z,fe,Pe,Qe,Je,Le,ze){if(e.timeoutHandle=-1,Je=s.subtreeFlags,(Je&8192||(Je&16785408)===16785408)&&(Ep={stylesheets:null,count:0,unsuspend:Xw},ap(s),Je=Zw(),Je!==null)){e.cancelPendingCommit=Je(wh.bind(null,e,s,v,i,l,m,B,Z,fe,Qe,1,Le,ze)),Ha(e,v,B,!Pe);return}wh(e,s,v,i,l,m,B,Z,fe)}function mh(e){for(var s=e;;){var i=s.tag;if((i===0||i===11||i===15)&&s.flags&16384&&(i=s.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var l=0;l<i.length;l++){var m=i[l],v=m.getSnapshot;m=m.value;try{if(!Ls(v(),m))return!1}catch{return!1}}if(i=s.child,s.subtreeFlags&16384&&i!==null)i.return=s,s=i;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ha(e,s,i,l){s&=~up,s&=~cn,e.suspendedLanes|=s,e.pingedLanes&=~s,l&&(e.warmLanes|=s),l=e.expirationTimes;for(var m=s;0<m;){var v=31-lt(m),B=1<<v;l[v]=-1,m&=~B}i!==0&&Dt(e,i,s)}function Ru(){return($n&6)===0?(Bu(0),!1):!0}function yd(){if(an!==null){if(Dn===0)var e=an.return;else e=an,oa=Ti=null,Lc(e),no=null,Qo=0,e=an;for(;e!==null;)Jf(e.alternate,e),e=e.return;an=null}}function mo(e,s){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,ol(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),yd(),Wn=e,an=i=aa(e.current,null),pn=s,Dn=0,hr=null,Ga=!1,fo=Zs(e,s),nl=!1,sl=kr=up=cn=Wa=ls=0,nr=ku=null,hd=!1,(s&8)!==0&&(s|=s&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=s;0<l;){var m=31-lt(l),v=1<<m;s|=e[m],l&=~v}return ma=s,Oo(),i}function hp(e,s){rn=null,H.H=Ko,s===No||s===jo?(s=Yd(),Dn=3):s===Kd?(s=Yd(),Dn=4):Dn=s===oh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,hr=s,an===null&&(ls=1,Mu(e,En(s,e.current)))}function _h(){var e=H.H;return H.H=Ko,e===null?Ko:e}function mp(){var e=H.A;return H.A=ph,e}function bd(){ls=4,Ga||(pn&4194048)!==pn&&Is.current!==null||(fo=!0),(Wa&134217727)===0&&(cn&134217727)===0||Wn===null||Ha(Wn,pn,kr,!1)}function Md(e,s,i){var l=$n;$n|=2;var m=_h(),v=mp();(Wn!==e||pn!==s)&&(Iu=null,mo(e,s)),s=!1;var B=ls;e:do try{if(Dn!==0&&an!==null){var Z=an,fe=hr;switch(Dn){case 8:yd(),B=6;break e;case 3:case 2:case 9:case 6:Is.current===null&&(s=!0);var Pe=Dn;if(Dn=0,hr=null,rl(e,Z,fe,Pe),i&&fo){B=0;break e}break;default:Pe=Dn,Dn=0,hr=null,rl(e,Z,fe,Pe)}}gh(),B=ls;break}catch(Qe){hp(e,Qe)}while(!0);return s&&e.shellSuspendCounter++,oa=Ti=null,$n=l,H.H=m,H.A=v,an===null&&(Wn=null,pn=0,Oo()),B}function gh(){for(;an!==null;)Mh(an)}function yh(e,s){var i=$n;$n|=2;var l=_h(),m=mp();Wn!==e||pn!==s?(Iu=null,Lu=Ee()+500,mo(e,s)):fo=Zs(e,s);e:do try{if(Dn!==0&&an!==null){s=an;var v=hr;t:switch(Dn){case 1:Dn=0,hr=null,rl(e,s,v,1);break;case 2:case 9:if(Qd(v)){Dn=0,hr=null,_p(s);break}s=function(){Dn!==2&&Dn!==9||Wn!==e||(Dn=7),ga(e)},v.then(s,s);break e;case 3:Dn=7;break e;case 4:Dn=5;break e;case 7:Qd(v)?(Dn=0,hr=null,_p(s)):(Dn=0,hr=null,rl(e,s,v,7));break;case 5:var B=null;switch(an.tag){case 26:B=an.memoizedState;case 5:case 27:var Z=an;if(!B||q1(B)){Dn=0,hr=null;var fe=Z.sibling;if(fe!==null)an=fe;else{var Pe=Z.return;Pe!==null?(an=Pe,vd(Pe)):an=null}break t}}Dn=0,hr=null,rl(e,s,v,5);break;case 6:Dn=0,hr=null,rl(e,s,v,6);break;case 8:yd(),ls=6;break e;default:throw Error(a(462))}}bh();break}catch(Qe){hp(e,Qe)}while(!0);return oa=Ti=null,H.H=l,H.A=m,$n=i,an!==null?0:(Wn=null,pn=0,Oo(),ls)}function bh(){for(;an!==null&&!Xe();)Mh(an)}function Mh(e){var s=Zf(e.alternate,e,ma);e.memoizedProps=e.pendingProps,s===null?vd(e):an=s}function _p(e){var s=e,i=s.alternate;switch(s.tag){case 15:case 0:s=Hf(i,s,s.pendingProps,s.type,void 0,pn);break;case 11:s=Hf(i,s,s.pendingProps,s.type.render,s.ref,pn);break;case 5:Lc(s);default:Jf(i,s),s=an=Rd(s,ma),s=Zf(i,s,ma)}e.memoizedProps=e.pendingProps,s===null?vd(e):an=s}function rl(e,s,i,l){oa=Ti=null,Lc(s),no=null,Qo=0;var m=s.return;try{if(ih(e,m,s,i,pn)){ls=1,Mu(e,En(i,e.current)),an=null;return}}catch(v){if(m!==null)throw an=m,v;ls=1,Mu(e,En(i,e.current)),an=null;return}s.flags&32768?(vn||l===1?e=!0:fo||(pn&536870912)!==0?e=!1:(Ga=e=!0,(l===2||l===9||l===3||l===6)&&(l=Is.current,l!==null&&l.tag===13&&(l.flags|=16384))),vh(s,e)):vd(s)}function vd(e){var s=e;do{if((s.flags&32768)!==0){vh(s,Ga);return}e=s.return;var i=lh(s.alternate,s,ma);if(i!==null){an=i;return}if(s=s.sibling,s!==null){an=s;return}an=s=e}while(s!==null);ls===0&&(ls=5)}function vh(e,s){do{var i=uh(e.alternate,e);if(i!==null){i.flags&=32767,an=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!s&&(e=e.sibling,e!==null)){an=e;return}an=e=i}while(e!==null);ls=6,an=null}function wh(e,s,i,l,m,v,B,Z,fe){e.cancelPendingCommit=null;do wd();while(Rs!==0);if(($n&6)!==0)throw Error(a(327));if(s!==null){if(s===e.current)throw Error(a(177));if(v=s.lanes|s.childLanes,v|=mc,Ta(e,i,v,B,Z,fe),e===Wn&&(an=Wn=null,pn=0),po=s,Ai=e,ho=i,zu=v,_d=m,cp=l,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,wm(et,function(){return Sh(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||l){l=H.T,H.T=null,m=se.p,se.p=2,B=$n,$n|=4;try{dh(e,s,i)}finally{$n=B,se.p=m,H.T=l}}Rs=1,xh(),Th(),Eh()}}function xh(){if(Rs===1){Rs=0;var e=Ai,s=po,i=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||i){i=H.T,H.T=null;var l=se.p;se.p=2;var m=$n;$n|=4;try{sp(s,e);var v=is,B=Ao(e.containerInfo),Z=v.focusedElem,fe=v.selectionRange;if(B!==Z&&Z&&Z.ownerDocument&&Ui(Z.ownerDocument.documentElement,Z)){if(fe!==null&&mi(Z)){var Pe=fe.start,Qe=fe.end;if(Qe===void 0&&(Qe=Pe),"selectionStart"in Z)Z.selectionStart=Pe,Z.selectionEnd=Math.min(Qe,Z.value.length);else{var Je=Z.ownerDocument||document,Le=Je&&Je.defaultView||window;if(Le.getSelection){var ze=Le.getSelection(),Zt=Z.textContent.length,Gt=Math.min(fe.start,Zt),Qn=fe.end===void 0?Gt:Math.min(fe.end,Zt);!ze.extend&&Gt>Qn&&(B=Qn,Qn=Gt,Gt=B);var we=ji(Z,Gt),be=ji(Z,Qn);if(we&&be&&(ze.rangeCount!==1||ze.anchorNode!==we.node||ze.anchorOffset!==we.offset||ze.focusNode!==be.node||ze.focusOffset!==be.offset)){var Ce=Je.createRange();Ce.setStart(we.node,we.offset),ze.removeAllRanges(),Gt>Qn?(ze.addRange(Ce),ze.extend(be.node,be.offset)):(Ce.setEnd(be.node,be.offset),ze.addRange(Ce))}}}}for(Je=[],ze=Z;ze=ze.parentNode;)ze.nodeType===1&&Je.push({element:ze,left:ze.scrollLeft,top:ze.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<Je.length;Z++){var Ye=Je[Z];Ye.element.scrollLeft=Ye.left,Ye.element.scrollTop=Ye.top}}Nh=!!us,is=us=null}finally{$n=m,se.p=l,H.T=i}}e.current=s,Rs=2}}function Th(){if(Rs===2){Rs=0;var e=Ai,s=po,i=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||i){i=H.T,H.T=null;var l=se.p;se.p=2;var m=$n;$n|=4;try{tp(e,s.alternate,s)}finally{$n=m,se.p=l,H.T=i}}Rs=3}}function Eh(){if(Rs===4||Rs===3){Rs=0,Be();var e=Ai,s=po,i=ho,l=cp;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Rs=5:(Rs=0,po=Ai=null,Ch(e,e.pendingLanes));var m=e.pendingLanes;if(m===0&&(_a=null),qt(i),s=s.stateNode,mt&&typeof mt.onCommitFiberRoot=="function")try{mt.onCommitFiberRoot(st,s,void 0,(s.current.flags&128)===128)}catch{}if(l!==null){s=H.T,m=se.p,se.p=2,H.T=null;try{for(var v=e.onRecoverableError,B=0;B<l.length;B++){var Z=l[B];v(Z.value,{componentStack:Z.stack})}}finally{H.T=s,se.p=m}}(ho&3)!==0&&wd(),ga(e),m=e.pendingLanes,(i&4194090)!==0&&(m&42)!==0?e===gd?Fu++:(Fu=0,gd=e):Fu=0,Bu(0)}}function Ch(e,s){(e.pooledCacheLanes&=s)===0&&(s=e.pooledCache,s!=null&&(e.pooledCache=null,Ro(s)))}function wd(e){return xh(),Th(),Eh(),Sh()}function Sh(){if(Rs!==5)return!1;var e=Ai,s=zu;zu=0;var i=qt(ho),l=H.T,m=se.p;try{se.p=32>i?32:i,H.T=null,i=_d,_d=null;var v=Ai,B=ho;if(Rs=0,po=Ai=null,ho=0,($n&6)!==0)throw Error(a(331));var Z=$n;if($n|=4,op(v.current),pd(v,v.current,B,i),$n=Z,Bu(0,!1),mt&&typeof mt.onPostCommitFiberRoot=="function")try{mt.onPostCommitFiberRoot(st,v)}catch{}return!0}finally{se.p=m,H.T=l,Ch(e,s)}}function Ph(e,s,i){s=En(i,s),s=Yo(e.stateNode,s,2),e=Fa(e,s,2),e!==null&&(br(e,2),ga(e))}function Hn(e,s,i){if(e.tag===3)Ph(e,e,i);else for(;s!==null;){if(s.tag===3){Ph(s,e,i);break}else if(s.tag===1){var l=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(_a===null||!_a.has(l))){e=En(i,e),i=Nf(2),l=Fa(s,i,2),l!==null&&(jf(i,l,s,e),br(l,2),ga(l));break}}s=s.return}}function gp(e,s,i){var l=e.pingCache;if(l===null){l=e.pingCache=new hh;var m=new Set;l.set(s,m)}else m=l.get(s),m===void 0&&(m=new Set,l.set(s,m));m.has(i)||(nl=!0,m.add(i),e=bm.bind(null,e,s,i),s.then(e,e))}function bm(e,s,i){var l=e.pingCache;l!==null&&l.delete(s),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Wn===e&&(pn&i)===i&&(ls===4||ls===3&&(pn&62914560)===pn&&300>Ee()-md?($n&2)===0&&mo(e,0):up|=i,sl===pn&&(sl=0)),ga(e)}function Ah(e,s){s===0&&(s=xa()),e=gi(e,s),e!==null&&(br(e,s),ga(e))}function Mm(e){var s=e.memoizedState,i=0;s!==null&&(i=s.retryLane),Ah(e,i)}function vm(e,s){var i=0;switch(e.tag){case 13:var l=e.stateNode,m=e.memoizedState;m!==null&&(i=m.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(a(314))}l!==null&&l.delete(s),Ah(e,i)}function wm(e,s){return te(e,s)}var xd=null,al=null,yp=!1,Td=!1,bp=!1,_o=0;function ga(e){e!==al&&e.next===null&&(al===null?xd=al=e:al=al.next=e),Td=!0,yp||(yp=!0,Tm())}function Bu(e,s){if(!bp&&Td){bp=!0;do for(var i=!1,l=xd;l!==null;){if(e!==0){var m=l.pendingLanes;if(m===0)var v=0;else{var B=l.suspendedLanes,Z=l.pingedLanes;v=(1<<31-lt(42|e)+1)-1,v&=m&~(B&~Z),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(i=!0,kh(l,v))}else v=pn,v=Os(l,l===Wn?v:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(v&3)===0||Zs(l,v)||(i=!0,kh(l,v));l=l.next}while(i);bp=!1}}function xm(){Oh()}function Oh(){Td=yp=!1;var e=0;_o!==0&&(qr()&&(e=_o),_o=0);for(var s=Ee(),i=null,l=xd;l!==null;){var m=l.next,v=$h(l,s);v===0?(l.next=null,i===null?xd=m:i.next=m,m===null&&(al=i)):(i=l,(e!==0||(v&3)!==0)&&(Td=!0)),l=m}Bu(e)}function $h(e,s){for(var i=e.suspendedLanes,l=e.pingedLanes,m=e.expirationTimes,v=e.pendingLanes&-62914561;0<v;){var B=31-lt(v),Z=1<<B,fe=m[B];fe===-1?((Z&i)===0||(Z&l)!==0)&&(m[B]=Rn(Z,s)):fe<=s&&(e.expiredLanes|=Z),v&=~Z}if(s=Wn,i=pn,i=Os(e,e===s?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,i===0||e===s&&(Dn===2||Dn===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&De(l),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||Zs(e,i)){if(s=i&-i,s===e.callbackPriority)return s;switch(l!==null&&De(l),qt(i)){case 2:case 8:i=Ke;break;case 32:i=et;break;case 268435456:i=Re;break;default:i=et}return l=Dh.bind(null,e),i=te(i,l),e.callbackPriority=s,e.callbackNode=i,s}return l!==null&&l!==null&&De(l),e.callbackPriority=2,e.callbackNode=null,2}function Dh(e,s){if(Rs!==0&&Rs!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(wd()&&e.callbackNode!==i)return null;var l=pn;return l=Os(e,e===Wn?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(fp(e,l,s),$h(e,Ee()),e.callbackNode!=null&&e.callbackNode===i?Dh.bind(null,e):null)}function kh(e,s){if(wd())return null;fp(e,s,!0)}function Tm(){ju(function(){($n&6)!==0?te(ke,xm):Oh()})}function Vt(){return _o===0&&(_o=$s()),_o}function Mp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ot(""+e)}function Ms(e,s){var i=s.ownerDocument.createElement("input");return i.name=s.name,i.value=s.value,e.id&&i.setAttribute("form",e.id),s.parentNode.insertBefore(i,s),e=new FormData(e),i.parentNode.removeChild(i),e}function Bs(e,s,i,l,m){if(s==="submit"&&i&&i.stateNode===m){var v=Mp((m[le]||null).action),B=l.submitter;B&&(s=(s=B[le]||null)?Mp(s.formAction):B.getAttribute("formAction"),s!==null&&(v=s,B=null));var Z=new Zn("action","action",null,l,m);e.push({event:Z,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(_o!==0){var fe=B?Ms(m,B):new FormData(m);Gc(i,{pending:!0,data:fe,method:m.method,action:v},null,fe)}}else typeof v=="function"&&(Z.preventDefault(),fe=B?Ms(m,B):new FormData(m),Gc(i,{pending:!0,data:fe,method:m.method,action:v},v,fe))},currentTarget:m}]})}}for(var Ns=0;Ns<Ut.length;Ns++){var qa=Ut[Ns],Em=qa.toLowerCase(),Lh=qa[0].toUpperCase()+qa.slice(1);Wt(Em,"on"+Lh)}Wt(N,"onAnimationEnd"),Wt(K,"onAnimationIteration"),Wt(J,"onAnimationStart"),Wt("dblclick","onDoubleClick"),Wt("focusin","onFocus"),Wt("focusout","onBlur"),Wt(ye,"onTransitionRun"),Wt(Ue,"onTransitionStart"),Wt(nt,"onTransitionCancel"),Wt(_t,"onTransitionEnd"),jn("onMouseEnter",["mouseout","mouseover"]),jn("onMouseLeave",["mouseout","mouseover"]),jn("onPointerEnter",["pointerout","pointerover"]),jn("onPointerLeave",["pointerout","pointerover"]),js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),js("onBeforeInput",["compositionend","keypress","textInput","paste"]),js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var il="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(il));function A(e,s){s=(s&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],m=l.event;l=l.listeners;e:{var v=void 0;if(s)for(var B=l.length-1;0<=B;B--){var Z=l[B],fe=Z.instance,Pe=Z.currentTarget;if(Z=Z.listener,fe!==v&&m.isPropagationStopped())break e;v=Z,m.currentTarget=Pe;try{v(m)}catch(Qe){bu(Qe)}m.currentTarget=null,v=fe}else for(B=0;B<l.length;B++){if(Z=l[B],fe=Z.instance,Pe=Z.currentTarget,Z=Z.listener,fe!==v&&m.isPropagationStopped())break e;v=Z,m.currentTarget=Pe;try{v(m)}catch(Qe){bu(Qe)}m.currentTarget=null,v=fe}}}}function Q(e,s){var i=s[Se];i===void 0&&(i=s[Se]=new Set);var l=e+"__bubble";i.has(l)||(qe(s,e,2,!1),i.add(l))}function _e(e,s,i){var l=0;s&&(l|=4),qe(i,e,l,s)}var xe="_reactListening"+Math.random().toString(36).slice(2);function Ae(e){if(!e[xe]){e[xe]=!0,Bn.forEach(function(i){i!=="selectionchange"&&(P.has(i)||_e(i,!1,e),_e(i,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[xe]||(s[xe]=!0,_e("selectionchange",!1,s))}}function qe(e,s,i,l){switch(J1(s)){case 2:var m=tx;break;case 8:m=nx;break;default:m=km}i=m.bind(null,s,i,e),m=void 0,!Cs||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),l?m!==void 0?e.addEventListener(s,i,{capture:!0,passive:m}):e.addEventListener(s,i,!0):m!==void 0?e.addEventListener(s,i,{passive:m}):e.addEventListener(s,i,!1)}function tt(e,s,i,l,m){var v=l;if((s&1)===0&&(s&2)===0&&l!==null)e:for(;;){if(l===null)return;var B=l.tag;if(B===3||B===4){var Z=l.stateNode.containerInfo;if(Z===m)break;if(B===4)for(B=l.return;B!==null;){var fe=B.tag;if((fe===3||fe===4)&&B.stateNode.containerInfo===m)return;B=B.return}for(;Z!==null;){if(B=Kt(Z),B===null)return;if(fe=B.tag,fe===5||fe===6||fe===26||fe===27){l=v=B;continue e}Z=Z.parentNode}}l=l.return}On(function(){var Pe=v,Qe=jt(i),Je=[];e:{var Le=Et.get(e);if(Le!==void 0){var ze=Zn,Zt=e;switch(e){case"keypress":if(ur(i)===0)break e;case"keydown":case"keyup":ze=Cl;break;case"focusin":Zt="focus",ze=na;break;case"focusout":Zt="blur",ze=na;break;case"beforeblur":case"afterblur":ze=na;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=wl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=sc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=Pl;break;case N:case K:case J:ze=ic;break;case _t:ze=Al;break;case"scroll":case"scrollend":ze=Js;break;case"wheel":ze=$l;break;case"copy":case"cut":case"paste":ze=lc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=To;break;case"toggle":case"beforetoggle":ze=kl}var Gt=(s&4)!==0,Qn=!Gt&&(e==="scroll"||e==="scrollend"),we=Gt?Le!==null?Le+"Capture":null:Le;Gt=[];for(var be=Pe,Ce;be!==null;){var Ye=be;if(Ce=Ye.stateNode,Ye=Ye.tag,Ye!==5&&Ye!==26&&Ye!==27||Ce===null||we===null||(Ye=Ds(be,we),Ye!=null&&Gt.push(it(be,Ye,Ce))),Qn)break;be=be.return}0<Gt.length&&(Le=new ze(Le,Zt,null,i,Qe),Je.push({event:Le,listeners:Gt}))}}if((s&7)===0){e:{if(Le=e==="mouseover"||e==="pointerover",ze=e==="mouseout"||e==="pointerout",Le&&i!==Yt&&(Zt=i.relatedTarget||i.fromElement)&&(Kt(Zt)||Zt[he]))break e;if((ze||Le)&&(Le=Qe.window===Qe?Qe:(Le=Qe.ownerDocument)?Le.defaultView||Le.parentWindow:window,ze?(Zt=i.relatedTarget||i.toElement,ze=Pe,Zt=Zt?Kt(Zt):null,Zt!==null&&(Qn=u(Zt),Gt=Zt.tag,Zt!==Qn||Gt!==5&&Gt!==27&&Gt!==6)&&(Zt=null)):(ze=null,Zt=Pe),ze!==Zt)){if(Gt=wl,Ye="onMouseLeave",we="onMouseEnter",be="mouse",(e==="pointerout"||e==="pointerover")&&(Gt=To,Ye="onPointerLeave",we="onPointerEnter",be="pointer"),Qn=ze==null?Le:dn(ze),Ce=Zt==null?Le:dn(Zt),Le=new Gt(Ye,be+"leave",ze,i,Qe),Le.target=Qn,Le.relatedTarget=Ce,Ye=null,Kt(Qe)===Pe&&(Gt=new Gt(we,be+"enter",Zt,i,Qe),Gt.target=Ce,Gt.relatedTarget=Qn,Ye=Gt),Qn=Ye,ze&&Zt)t:{for(Gt=ze,we=Zt,be=0,Ce=Gt;Ce;Ce=Bt(Ce))be++;for(Ce=0,Ye=we;Ye;Ye=Bt(Ye))Ce++;for(;0<be-Ce;)Gt=Bt(Gt),be--;for(;0<Ce-be;)we=Bt(we),Ce--;for(;be--;){if(Gt===we||we!==null&&Gt===we.alternate)break t;Gt=Bt(Gt),we=Bt(we)}Gt=null}else Gt=null;ze!==null&&Qt(Je,Le,ze,Gt,!1),Zt!==null&&Qn!==null&&Qt(Je,Qn,Zt,Gt,!0)}}e:{if(Le=Pe?dn(Pe):window,ze=Le.nodeName&&Le.nodeName.toLowerCase(),ze==="select"||ze==="input"&&Le.type==="file")var $t=Fl;else if(Ii(Le))if(Rl)$t=xr;else{$t=Ri;var fn=Nl}else ze=Le.nodeName,!ze||ze.toLowerCase()!=="input"||Le.type!=="checkbox"&&Le.type!=="radio"?Pe&&pt(Pe.elementType)&&($t=Fl):$t=Bi;if($t&&($t=$t(e,Pe))){zi(Je,$t,i,Qe);break e}fn&&fn(e,Le,Pe),e==="focusout"&&Pe&&Le.type==="number"&&Pe.memoizedProps.value!=null&&oi(Le,"number",Le.value)}switch(fn=Pe?dn(Pe):window,e){case"focusin":(Ii(fn)||fn.contentEditable==="true")&&(Or=fn,Da=Pe,sa=null);break;case"focusout":sa=Da=Or=null;break;case"mousedown":Vi=!0;break;case"contextmenu":case"mouseup":case"dragend":Vi=!1,Gi(Je,i,Qe);break;case"selectionchange":if(jl)break;case"keydown":case"keyup":Gi(Je,i,Qe)}var Ft;if(Co)e:{switch(e){case"compositionstart":var Ht="onCompositionStart";break e;case"compositionend":Ht="onCompositionEnd";break e;case"compositionupdate":Ht="onCompositionUpdate";break e}Ht=void 0}else Br?di(e,i)&&(Ht="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ht="onCompositionStart");Ht&&(Ll&&i.locale!=="ko"&&(Br||Ht!=="onCompositionStart"?Ht==="onCompositionEnd"&&Br&&(Ft=Ks()):(mn=Qe,ss="value"in mn?mn.value:mn.textContent,Br=!0)),fn=wt(Pe,Ht),0<fn.length&&(Ht=new Pa(Ht,e,null,i,Qe),Je.push({event:Ht,listeners:fn}),Ft?Ht.data=Ft:(Ft=Aa(i),Ft!==null&&(Ht.data=Ft)))),(Ft=fc?pc(e,i):So(e,i))&&(Ht=wt(Pe,"onBeforeInput"),0<Ht.length&&(fn=new Pa("onBeforeInput","beforeinput",null,i,Qe),Je.push({event:fn,listeners:Ht}),fn.data=Ft)),Bs(Je,e,Pe,i,Qe)}A(Je,s)})}function it(e,s,i){return{instance:e,listener:s,currentTarget:i}}function wt(e,s){for(var i=s+"Capture",l=[];e!==null;){var m=e,v=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||v===null||(m=Ds(e,i),m!=null&&l.unshift(it(e,m,v)),m=Ds(e,s),m!=null&&l.push(it(e,m,v))),e.tag===3)return l;e=e.return}return[]}function Bt(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Qt(e,s,i,l,m){for(var v=s._reactName,B=[];i!==null&&i!==l;){var Z=i,fe=Z.alternate,Pe=Z.stateNode;if(Z=Z.tag,fe!==null&&fe===l)break;Z!==5&&Z!==26&&Z!==27||Pe===null||(fe=Pe,m?(Pe=Ds(i,v),Pe!=null&&B.unshift(it(i,Pe,fe))):m||(Pe=Ds(i,v),Pe!=null&&B.push(it(i,Pe,fe)))),i=i.return}B.length!==0&&e.push({event:s,listeners:B})}var Jt=/\r\n?/g,zt=/\u0000|\uFFFD/g;function bn(e){return(typeof e=="string"?e:""+e).replace(Jt,`
`).replace(zt,"")}function Rt(e,s){return s=bn(s),bn(e)===s}function kt(){}function Pt(e,s,i,l,m,v){switch(i){case"children":typeof l=="string"?s==="body"||s==="textarea"&&l===""||de(e,l):(typeof l=="number"||typeof l=="bigint")&&s!=="body"&&de(e,""+l);break;case"className":Un(e,"class",l);break;case"tabIndex":Un(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Un(e,i,l);break;case"style":Ge(e,l,v);break;case"data":if(s!=="object"){Un(e,"data",l);break}case"src":case"href":if(l===""&&(s!=="a"||i!=="href")){e.removeAttribute(i);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=ot(""+l),e.setAttribute(i,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(i==="formAction"?(s!=="input"&&Pt(e,s,"name",m.name,m,null),Pt(e,s,"formEncType",m.formEncType,m,null),Pt(e,s,"formMethod",m.formMethod,m,null),Pt(e,s,"formTarget",m.formTarget,m,null)):(Pt(e,s,"encType",m.encType,m,null),Pt(e,s,"method",m.method,m,null),Pt(e,s,"target",m.target,m,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=ot(""+l),e.setAttribute(i,l);break;case"onClick":l!=null&&(e.onclick=kt);break;case"onScroll":l!=null&&Q("scroll",e);break;case"onScrollEnd":l!=null&&Q("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(a(61));if(i=l.__html,i!=null){if(m.children!=null)throw Error(a(60));e.innerHTML=i}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}i=ot(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""+l):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":l===!0?e.setAttribute(i,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,l):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(i,l):e.removeAttribute(i);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(i):e.setAttribute(i,l);break;case"popover":Q("beforetoggle",e),Q("toggle",e),lr(e,"popover",l);break;case"xlinkActuate":ds(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":ds(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":ds(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":ds(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":ds(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":ds(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":ds(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":ds(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":ds(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":lr(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=gt.get(i)||i,lr(e,i,l))}}function kn(e,s,i,l,m,v){switch(i){case"style":Ge(e,l,v);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(a(61));if(i=l.__html,i!=null){if(m.children!=null)throw Error(a(60));e.innerHTML=i}}break;case"children":typeof l=="string"?de(e,l):(typeof l=="number"||typeof l=="bigint")&&de(e,""+l);break;case"onScroll":l!=null&&Q("scroll",e);break;case"onScrollEnd":l!=null&&Q("scrollend",e);break;case"onClick":l!=null&&(e.onclick=kt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!cs.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(m=i.endsWith("Capture"),s=i.slice(2,m?i.length-7:void 0),v=e[le]||null,v=v!=null?v[i]:null,typeof v=="function"&&e.removeEventListener(s,v,m),typeof l=="function")){typeof v!="function"&&v!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(s,l,m);break e}i in e?e[i]=l:l===!0?e.setAttribute(i,""):lr(e,i,l)}}}function on(e,s,i){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Q("error",e),Q("load",e);var l=!1,m=!1,v;for(v in i)if(i.hasOwnProperty(v)){var B=i[v];if(B!=null)switch(v){case"src":l=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:Pt(e,s,v,B,i,null)}}m&&Pt(e,s,"srcSet",i.srcSet,i,null),l&&Pt(e,s,"src",i.src,i,null);return;case"input":Q("invalid",e);var Z=v=B=m=null,fe=null,Pe=null;for(l in i)if(i.hasOwnProperty(l)){var Qe=i[l];if(Qe!=null)switch(l){case"name":m=Qe;break;case"type":B=Qe;break;case"checked":fe=Qe;break;case"defaultChecked":Pe=Qe;break;case"value":v=Qe;break;case"defaultValue":Z=Qe;break;case"children":case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(a(137,s));break;default:Pt(e,s,l,Qe,i,null)}}ii(e,v,Z,fe,Pe,B,m,!1),Pn(e);return;case"select":Q("invalid",e),l=B=v=null;for(m in i)if(i.hasOwnProperty(m)&&(Z=i[m],Z!=null))switch(m){case"value":v=Z;break;case"defaultValue":B=Z;break;case"multiple":l=Z;default:Pt(e,s,m,Z,i,null)}s=v,i=B,e.multiple=!!l,s!=null?Me(e,!!l,s,!1):i!=null&&Me(e,!!l,i,!0);return;case"textarea":Q("invalid",e),v=m=l=null;for(B in i)if(i.hasOwnProperty(B)&&(Z=i[B],Z!=null))switch(B){case"value":l=Z;break;case"defaultValue":m=Z;break;case"children":v=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(a(91));break;default:Pt(e,s,B,Z,i,null)}ee(e,l,m,v),Pn(e);return;case"option":for(fe in i)if(i.hasOwnProperty(fe)&&(l=i[fe],l!=null))switch(fe){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Pt(e,s,fe,l,i,null)}return;case"dialog":Q("beforetoggle",e),Q("toggle",e),Q("cancel",e),Q("close",e);break;case"iframe":case"object":Q("load",e);break;case"video":case"audio":for(l=0;l<il.length;l++)Q(il[l],e);break;case"image":Q("error",e),Q("load",e);break;case"details":Q("toggle",e);break;case"embed":case"source":case"link":Q("error",e),Q("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Pe in i)if(i.hasOwnProperty(Pe)&&(l=i[Pe],l!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:Pt(e,s,Pe,l,i,null)}return;default:if(pt(s)){for(Qe in i)i.hasOwnProperty(Qe)&&(l=i[Qe],l!==void 0&&kn(e,s,Qe,l,i,void 0));return}}for(Z in i)i.hasOwnProperty(Z)&&(l=i[Z],l!=null&&Pt(e,s,Z,l,i,null))}function vs(e,s,i,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,v=null,B=null,Z=null,fe=null,Pe=null,Qe=null;for(ze in i){var Je=i[ze];if(i.hasOwnProperty(ze)&&Je!=null)switch(ze){case"checked":break;case"value":break;case"defaultValue":fe=Je;default:l.hasOwnProperty(ze)||Pt(e,s,ze,null,l,Je)}}for(var Le in l){var ze=l[Le];if(Je=i[Le],l.hasOwnProperty(Le)&&(ze!=null||Je!=null))switch(Le){case"type":v=ze;break;case"name":m=ze;break;case"checked":Pe=ze;break;case"defaultChecked":Qe=ze;break;case"value":B=ze;break;case"defaultValue":Z=ze;break;case"children":case"dangerouslySetInnerHTML":if(ze!=null)throw Error(a(137,s));break;default:ze!==Je&&Pt(e,s,Le,ze,l,Je)}}Sa(e,B,Z,fe,Pe,Qe,v,m);return;case"select":ze=B=Z=Le=null;for(v in i)if(fe=i[v],i.hasOwnProperty(v)&&fe!=null)switch(v){case"value":break;case"multiple":ze=fe;default:l.hasOwnProperty(v)||Pt(e,s,v,null,l,fe)}for(m in l)if(v=l[m],fe=i[m],l.hasOwnProperty(m)&&(v!=null||fe!=null))switch(m){case"value":Le=v;break;case"defaultValue":Z=v;break;case"multiple":B=v;default:v!==fe&&Pt(e,s,m,v,l,fe)}s=Z,i=B,l=ze,Le!=null?Me(e,!!i,Le,!1):!!l!=!!i&&(s!=null?Me(e,!!i,s,!0):Me(e,!!i,i?[]:"",!1));return;case"textarea":ze=Le=null;for(Z in i)if(m=i[Z],i.hasOwnProperty(Z)&&m!=null&&!l.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:Pt(e,s,Z,null,l,m)}for(B in l)if(m=l[B],v=i[B],l.hasOwnProperty(B)&&(m!=null||v!=null))switch(B){case"value":Le=m;break;case"defaultValue":ze=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(a(91));break;default:m!==v&&Pt(e,s,B,m,l,v)}z(e,Le,ze);return;case"option":for(var Zt in i)if(Le=i[Zt],i.hasOwnProperty(Zt)&&Le!=null&&!l.hasOwnProperty(Zt))switch(Zt){case"selected":e.selected=!1;break;default:Pt(e,s,Zt,null,l,Le)}for(fe in l)if(Le=l[fe],ze=i[fe],l.hasOwnProperty(fe)&&Le!==ze&&(Le!=null||ze!=null))switch(fe){case"selected":e.selected=Le&&typeof Le!="function"&&typeof Le!="symbol";break;default:Pt(e,s,fe,Le,l,ze)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Gt in i)Le=i[Gt],i.hasOwnProperty(Gt)&&Le!=null&&!l.hasOwnProperty(Gt)&&Pt(e,s,Gt,null,l,Le);for(Pe in l)if(Le=l[Pe],ze=i[Pe],l.hasOwnProperty(Pe)&&Le!==ze&&(Le!=null||ze!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(a(137,s));break;default:Pt(e,s,Pe,Le,l,ze)}return;default:if(pt(s)){for(var Qn in i)Le=i[Qn],i.hasOwnProperty(Qn)&&Le!==void 0&&!l.hasOwnProperty(Qn)&&kn(e,s,Qn,void 0,l,Le);for(Qe in l)Le=l[Qe],ze=i[Qe],!l.hasOwnProperty(Qe)||Le===ze||Le===void 0&&ze===void 0||kn(e,s,Qe,Le,l,ze);return}}for(var we in i)Le=i[we],i.hasOwnProperty(we)&&Le!=null&&!l.hasOwnProperty(we)&&Pt(e,s,we,null,l,Le);for(Je in l)Le=l[Je],ze=i[Je],!l.hasOwnProperty(Je)||Le===ze||Le==null&&ze==null||Pt(e,s,Je,Le,l,ze)}var us=null,is=null;function en(e){return e.nodeType===9?e:e.ownerDocument}function es(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function As(e,s){if(e===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&s==="foreignObject"?0:e}function Ka(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Xs=null;function qr(){var e=window.event;return e&&e.type==="popstate"?e===Xs?!1:(Xs=e,!0):(Xs=null,!1)}var go=typeof setTimeout=="function"?setTimeout:void 0,ol=typeof clearTimeout=="function"?clearTimeout:void 0,Nu=typeof Promise=="function"?Promise:void 0,ju=typeof queueMicrotask=="function"?queueMicrotask:typeof Nu<"u"?function(e){return Nu.resolve(null).then(e).catch(Cm)}:go;function Cm(e){setTimeout(function(){throw e})}function Mn(e){return e==="head"}function ws(e,s){var i=s,l=0,m=0;do{var v=i.nextSibling;if(e.removeChild(i),v&&v.nodeType===8)if(i=v.data,i==="/$"){if(0<l&&8>l){i=l;var B=e.ownerDocument;if(i&1&&Oi(B.documentElement),i&2&&Oi(B.body),i&4)for(i=B.head,Oi(i),B=i.firstChild;B;){var Z=B.nextSibling,fe=B.nodeName;B[ft]||fe==="SCRIPT"||fe==="STYLE"||fe==="LINK"&&B.rel.toLowerCase()==="stylesheet"||i.removeChild(B),B=Z}}if(m===0){e.removeChild(v),Op(s);return}m--}else i==="$"||i==="$?"||i==="$!"?m++:l=i.charCodeAt(0)-48;else l=0;i=v}while(i);Op(s)}function ya(e){var s=e.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var i=s;switch(s=s.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":ya(i),Xt(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function yo(e,s,i,l){for(;e.nodeType===1;){var m=i;if(e.nodeName.toLowerCase()!==s.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[ft])switch(s){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(v=e.getAttribute("rel"),v==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(v!==m.rel||e.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||e.getAttribute("title")!==(m.title==null?null:m.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(v=e.getAttribute("src"),(v!==(m.src==null?null:m.src)||e.getAttribute("type")!==(m.type==null?null:m.type)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&v&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(s==="input"&&e.type==="hidden"){var v=m.name==null?null:""+m.name;if(m.type==="hidden"&&e.getAttribute("name")===v)return e}else return e;if(e=Er(e.nextSibling),e===null)break}return null}function ll(e,s,i){if(s==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Er(e.nextSibling),e===null))return null;return e}function ul(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function vp(e,s){var i=e.ownerDocument;if(e.data!=="$?"||i.readyState==="complete")s();else{var l=function(){s(),i.removeEventListener("DOMContentLoaded",l)};i.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Er(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return e}var Uu=null;function Ih(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(s===0)return e;s--}else i==="/$"&&s++}e=e.previousSibling}return null}function Ed(e,s,i){switch(s=en(i),e){case"html":if(e=s.documentElement,!e)throw Error(a(452));return e;case"head":if(e=s.head,!e)throw Error(a(453));return e;case"body":if(e=s.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function Oi(e){for(var s=e.attributes;s.length;)e.removeAttributeNode(s[0]);Xt(e)}var _r=new Map,wp=new Set;function cl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Lr=se.d;se.d={f:Sm,r:Pm,D:Kr,C:Uw,L:Vw,m:Gw,X:Hw,S:Ww,M:qw};function Sm(){var e=Lr.f(),s=Ru();return e||s}function Pm(e){var s=qn(e);s!==null&&s.tag===5&&s.type==="form"?Wc(s):Lr.r(e)}var dl=typeof document>"u"?null:document;function $i(e,s,i){var l=dl;if(l&&typeof s=="string"&&s){var m=fs(s);m='link[rel="'+e+'"][href="'+m+'"]',typeof i=="string"&&(m+='[crossorigin="'+i+'"]'),wp.has(m)||(wp.add(m),e={rel:e,crossOrigin:i,href:s},l.querySelector(m)===null&&(s=l.createElement("link"),on(s,"link",e),Tn(s),l.head.appendChild(s)))}}function Kr(e){Lr.D(e),$i("dns-prefetch",e,null)}function Uw(e,s){Lr.C(e,s),$i("preconnect",e,s)}function Vw(e,s,i){Lr.L(e,s,i);var l=dl;if(l&&e&&s){var m='link[rel="preload"][as="'+fs(s)+'"]';s==="image"&&i&&i.imageSrcSet?(m+='[imagesrcset="'+fs(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(m+='[imagesizes="'+fs(i.imageSizes)+'"]')):m+='[href="'+fs(e)+'"]';var v=m;switch(s){case"style":v=Cd(e);break;case"script":v=Sd(e)}_r.has(v)||(e=g({rel:"preload",href:s==="image"&&i&&i.imageSrcSet?void 0:e,as:s},i),_r.set(v,e),l.querySelector(m)!==null||s==="style"&&l.querySelector(xp(v))||s==="script"&&l.querySelector(Tp(v))||(s=l.createElement("link"),on(s,"link",e),Tn(s),l.head.appendChild(s)))}}function Gw(e,s){Lr.m(e,s);var i=dl;if(i&&e){var l=s&&typeof s.as=="string"?s.as:"script",m='link[rel="modulepreload"][as="'+fs(l)+'"][href="'+fs(e)+'"]',v=m;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Sd(e)}if(!_r.has(v)&&(e=g({rel:"modulepreload",href:e},s),_r.set(v,e),i.querySelector(m)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Tp(v)))return}l=i.createElement("link"),on(l,"link",e),Tn(l),i.head.appendChild(l)}}}function Ww(e,s,i){Lr.S(e,s,i);var l=dl;if(l&&e){var m=Nn(l).hoistableStyles,v=Cd(e);s=s||"default";var B=m.get(v);if(!B){var Z={loading:0,preload:null};if(B=l.querySelector(xp(v)))Z.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":s},i),(i=_r.get(v))&&Am(e,i);var fe=B=l.createElement("link");Tn(fe),on(fe,"link",e),fe._p=new Promise(function(Pe,Qe){fe.onload=Pe,fe.onerror=Qe}),fe.addEventListener("load",function(){Z.loading|=1}),fe.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,zh(B,s,l)}B={type:"stylesheet",instance:B,count:1,state:Z},m.set(v,B)}}}function Hw(e,s){Lr.X(e,s);var i=dl;if(i&&e){var l=Nn(i).hoistableScripts,m=Sd(e),v=l.get(m);v||(v=i.querySelector(Tp(m)),v||(e=g({src:e,async:!0},s),(s=_r.get(m))&&Om(e,s),v=i.createElement("script"),Tn(v),on(v,"link",e),i.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},l.set(m,v))}}function qw(e,s){Lr.M(e,s);var i=dl;if(i&&e){var l=Nn(i).hoistableScripts,m=Sd(e),v=l.get(m);v||(v=i.querySelector(Tp(m)),v||(e=g({src:e,async:!0,type:"module"},s),(s=_r.get(m))&&Om(e,s),v=i.createElement("script"),Tn(v),on(v,"link",e),i.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},l.set(m,v))}}function U1(e,s,i,l){var m=(m=Te.current)?cl(m):null;if(!m)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(s=Cd(i.href),i=Nn(m).hoistableStyles,l=i.get(s),l||(l={type:"style",instance:null,count:0,state:null},i.set(s,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=Cd(i.href);var v=Nn(m).hoistableStyles,B=v.get(e);if(B||(m=m.ownerDocument||m,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(e,B),(v=m.querySelector(xp(e)))&&!v._p&&(B.instance=v,B.state.loading=5),_r.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},_r.set(e,i),v||Kw(m,e,i,B.state))),s&&l===null)throw Error(a(528,""));return B}if(s&&l!==null)throw Error(a(529,""));return null;case"script":return s=i.async,i=i.src,typeof i=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Sd(i),i=Nn(m).hoistableScripts,l=i.get(s),l||(l={type:"script",instance:null,count:0,state:null},i.set(s,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Cd(e){return'href="'+fs(e)+'"'}function xp(e){return'link[rel="stylesheet"]['+e+"]"}function V1(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function Kw(e,s,i,l){e.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=e.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),on(s,"link",i),Tn(s),e.head.appendChild(s))}function Sd(e){return'[src="'+fs(e)+'"]'}function Tp(e){return"script[async]"+e}function G1(e,s,i){if(s.count++,s.instance===null)switch(s.type){case"style":var l=e.querySelector('style[data-href~="'+fs(i.href)+'"]');if(l)return s.instance=l,Tn(l),l;var m=g({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),Tn(l),on(l,"style",m),zh(l,i.precedence,e),s.instance=l;case"stylesheet":m=Cd(i.href);var v=e.querySelector(xp(m));if(v)return s.state.loading|=4,s.instance=v,Tn(v),v;l=V1(i),(m=_r.get(m))&&Am(l,m),v=(e.ownerDocument||e).createElement("link"),Tn(v);var B=v;return B._p=new Promise(function(Z,fe){B.onload=Z,B.onerror=fe}),on(v,"link",l),s.state.loading|=4,zh(v,i.precedence,e),s.instance=v;case"script":return v=Sd(i.src),(m=e.querySelector(Tp(v)))?(s.instance=m,Tn(m),m):(l=i,(m=_r.get(v))&&(l=g({},i),Om(l,m)),e=e.ownerDocument||e,m=e.createElement("script"),Tn(m),on(m,"link",l),e.head.appendChild(m),s.instance=m);case"void":return null;default:throw Error(a(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(l=s.instance,s.state.loading|=4,zh(l,i.precedence,e));return s.instance}function zh(e,s,i){for(var l=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=l.length?l[l.length-1]:null,v=m,B=0;B<l.length;B++){var Z=l[B];if(Z.dataset.precedence===s)v=Z;else if(v!==m)break}v?v.parentNode.insertBefore(e,v.nextSibling):(s=i.nodeType===9?i.head:i,s.insertBefore(e,s.firstChild))}function Am(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.title==null&&(e.title=s.title)}function Om(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.integrity==null&&(e.integrity=s.integrity)}var Fh=null;function W1(e,s,i){if(Fh===null){var l=new Map,m=Fh=new Map;m.set(i,l)}else m=Fh,l=m.get(i),l||(l=new Map,m.set(i,l));if(l.has(e))return l;for(l.set(e,null),i=i.getElementsByTagName(e),m=0;m<i.length;m++){var v=i[m];if(!(v[ft]||v[Y]||e==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var B=v.getAttribute(s)||"";B=e+B;var Z=l.get(B);Z?Z.push(v):l.set(B,[v])}}return l}function H1(e,s,i){e=e.ownerDocument||e,e.head.insertBefore(i,s==="title"?e.querySelector("head > title"):null)}function Qw(e,s,i){if(i===1||s.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return e=s.disabled,typeof s.precedence=="string"&&e==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function q1(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Ep=null;function Xw(){}function Yw(e,s,i){if(Ep===null)throw Error(a(475));var l=Ep;if(s.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var m=Cd(i.href),v=e.querySelector(xp(m));if(v){e=v._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(l.count++,l=Rh.bind(l),e.then(l,l)),s.state.loading|=4,s.instance=v,Tn(v);return}v=e.ownerDocument||e,i=V1(i),(m=_r.get(m))&&Am(i,m),v=v.createElement("link"),Tn(v);var B=v;B._p=new Promise(function(Z,fe){B.onload=Z,B.onerror=fe}),on(v,"link",i),s.instance=v}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(s,e),(e=s.state.preload)&&(s.state.loading&3)===0&&(l.count++,s=Rh.bind(l),e.addEventListener("load",s),e.addEventListener("error",s))}}function Zw(){if(Ep===null)throw Error(a(475));var e=Ep;return e.stylesheets&&e.count===0&&$m(e,e.stylesheets),0<e.count?function(s){var i=setTimeout(function(){if(e.stylesheets&&$m(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(i)}}:null}function Rh(){if(this.count--,this.count===0){if(this.stylesheets)$m(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Bh=null;function $m(e,s){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Bh=new Map,s.forEach(Jw,e),Bh=null,Rh.call(e))}function Jw(e,s){if(!(s.state.loading&4)){var i=Bh.get(e);if(i)var l=i.get(null);else{i=new Map,Bh.set(e,i);for(var m=e.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<m.length;v++){var B=m[v];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(i.set(B.dataset.precedence,B),l=B)}l&&i.set(null,l)}m=s.instance,B=m.getAttribute("data-precedence"),v=i.get(B)||l,v===l&&i.set(null,m),i.set(B,m),this.count++,l=Rh.bind(this),m.addEventListener("load",l),m.addEventListener("error",l),v?v.parentNode.insertBefore(m,v.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(m,e.firstChild)),s.state.loading|=4}}var Cp={$$typeof:L,Provider:null,Consumer:null,_currentValue:ie,_currentValue2:ie,_threadCount:0};function ex(e,s,i,l,m,v,B,Z){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Zr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zr(0),this.hiddenUpdates=Zr(null),this.identifierPrefix=l,this.onUncaughtError=m,this.onCaughtError=v,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function K1(e,s,i,l,m,v,B,Z,fe,Pe,Qe,Je){return e=new ex(e,s,i,B,Z,fe,Pe,Je),s=1,v===!0&&(s|=24),v=dr(3,null,null,s),e.current=v,v.stateNode=e,s=Xl(),s.refCount++,e.pooledCache=s,s.refCount++,v.memoizedState={element:l,isDehydrated:i,cache:s},xc(v),e}function Q1(e){return e?(e=yi,e):yi}function X1(e,s,i,l,m,v){m=Q1(m),l.context===null?l.context=m:l.pendingContext=m,l=za(s),l.payload={element:i},v=v===void 0?null:v,v!==null&&(l.callback=v),i=Fa(e,l,s),i!==null&&(Vs(i,e,s),Yi(i,e,s))}function Y1(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<s?i:s}}function Dm(e,s){Y1(e,s),(e=e.alternate)&&Y1(e,s)}function Z1(e){if(e.tag===13){var s=gi(e,67108864);s!==null&&Vs(s,e,67108864),Dm(e,67108864)}}var Nh=!0;function tx(e,s,i,l){var m=H.T;H.T=null;var v=se.p;try{se.p=2,km(e,s,i,l)}finally{se.p=v,H.T=m}}function nx(e,s,i,l){var m=H.T;H.T=null;var v=se.p;try{se.p=8,km(e,s,i,l)}finally{se.p=v,H.T=m}}function km(e,s,i,l){if(Nh){var m=Lm(l);if(m===null)tt(e,s,l,jh,i),eg(e,l);else if(rx(m,e,s,i,l))l.stopPropagation();else if(eg(e,l),s&4&&-1<sx.indexOf(e)){for(;m!==null;){var v=qn(m);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var B=Ts(v.pendingLanes);if(B!==0){var Z=v;for(Z.pendingLanes|=2,Z.entangledLanes|=2;B;){var fe=1<<31-lt(B);Z.entanglements[1]|=fe,B&=~fe}ga(v),($n&6)===0&&(Lu=Ee()+500,Bu(0))}}break;case 13:Z=gi(v,2),Z!==null&&Vs(Z,v,2),Ru(),Dm(v,2)}if(v=Lm(l),v===null&&tt(e,s,l,jh,i),v===m)break;m=v}m!==null&&l.stopPropagation()}else tt(e,s,l,null,i)}}function Lm(e){return e=jt(e),Im(e)}var jh=null;function Im(e){if(jh=null,e=Kt(e),e!==null){var s=u(e);if(s===null)e=null;else{var i=s.tag;if(i===13){if(e=d(s),e!==null)return e;e=null}else if(i===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null)}}return jh=e,null}function J1(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ve()){case ke:return 2;case Ke:return 8;case et:case ht:return 32;case Re:return 268435456;default:return 32}default:return 32}}var zm=!1,fl=null,pl=null,hl=null,Sp=new Map,Pp=new Map,ml=[],sx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function eg(e,s){switch(e){case"focusin":case"focusout":fl=null;break;case"dragenter":case"dragleave":pl=null;break;case"mouseover":case"mouseout":hl=null;break;case"pointerover":case"pointerout":Sp.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pp.delete(s.pointerId)}}function Ap(e,s,i,l,m,v){return e===null||e.nativeEvent!==v?(e={blockedOn:s,domEventName:i,eventSystemFlags:l,nativeEvent:v,targetContainers:[m]},s!==null&&(s=qn(s),s!==null&&Z1(s)),e):(e.eventSystemFlags|=l,s=e.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),e)}function rx(e,s,i,l,m){switch(s){case"focusin":return fl=Ap(fl,e,s,i,l,m),!0;case"dragenter":return pl=Ap(pl,e,s,i,l,m),!0;case"mouseover":return hl=Ap(hl,e,s,i,l,m),!0;case"pointerover":var v=m.pointerId;return Sp.set(v,Ap(Sp.get(v)||null,e,s,i,l,m)),!0;case"gotpointercapture":return v=m.pointerId,Pp.set(v,Ap(Pp.get(v)||null,e,s,i,l,m)),!0}return!1}function tg(e){var s=Kt(e.target);if(s!==null){var i=u(s);if(i!==null){if(s=i.tag,s===13){if(s=d(i),s!==null){e.blockedOn=s,I(e.priority,function(){if(i.tag===13){var l=mr();l=xn(l);var m=gi(i,l);m!==null&&Vs(m,i,l),Dm(i,l)}});return}}else if(s===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Uh(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var i=Lm(e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);Yt=l,i.target.dispatchEvent(l),Yt=null}else return s=qn(i),s!==null&&Z1(s),e.blockedOn=i,!1;s.shift()}return!0}function ng(e,s,i){Uh(e)&&i.delete(s)}function ax(){zm=!1,fl!==null&&Uh(fl)&&(fl=null),pl!==null&&Uh(pl)&&(pl=null),hl!==null&&Uh(hl)&&(hl=null),Sp.forEach(ng),Pp.forEach(ng)}function Vh(e,s){e.blockedOn===s&&(e.blockedOn=null,zm||(zm=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,ax)))}var Gh=null;function sg(e){Gh!==e&&(Gh=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Gh===e&&(Gh=null);for(var s=0;s<e.length;s+=3){var i=e[s],l=e[s+1],m=e[s+2];if(typeof l!="function"){if(Im(l||i)===null)continue;break}var v=qn(i);v!==null&&(e.splice(s,3),s-=3,Gc(v,{pending:!0,data:m,method:i.method,action:l},l,m))}}))}function Op(e){function s(fe){return Vh(fe,e)}fl!==null&&Vh(fl,e),pl!==null&&Vh(pl,e),hl!==null&&Vh(hl,e),Sp.forEach(s),Pp.forEach(s);for(var i=0;i<ml.length;i++){var l=ml[i];l.blockedOn===e&&(l.blockedOn=null)}for(;0<ml.length&&(i=ml[0],i.blockedOn===null);)tg(i),i.blockedOn===null&&ml.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(l=0;l<i.length;l+=3){var m=i[l],v=i[l+1],B=m[le]||null;if(typeof v=="function")B||sg(i);else if(B){var Z=null;if(v&&v.hasAttribute("formAction")){if(m=v,B=v[le]||null)Z=B.formAction;else if(Im(m)!==null)continue}else Z=B.action;typeof Z=="function"?i[l+1]=Z:(i.splice(l,3),l-=3),sg(i)}}}function Fm(e){this._internalRoot=e}Wh.prototype.render=Fm.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(a(409));var i=s.current,l=mr();X1(i,l,e,s,null,null)},Wh.prototype.unmount=Fm.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;X1(e.current,2,null,e,null,null),Ru(),s[he]=null}};function Wh(e){this._internalRoot=e}Wh.prototype.unstable_scheduleHydration=function(e){if(e){var s=Fr();e={blockedOn:null,target:e,priority:s};for(var i=0;i<ml.length&&s!==0&&s<ml[i].priority;i++);ml.splice(i,0,e),i===0&&tg(e)}};var rg=r.version;if(rg!=="19.1.1")throw Error(a(527,rg,"19.1.1"));se.findDOMNode=function(e){var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=f(s),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var ix={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hh.isDisabled&&Hh.supportsFiber)try{st=Hh.inject(ix),mt=Hh}catch{}}return Dp.createRoot=function(e,s){if(!o(e))throw Error(a(299));var i=!1,l="",m=Xo,v=Ff,B=Rf,Z=null;return s!=null&&(s.unstable_strictMode===!0&&(i=!0),s.identifierPrefix!==void 0&&(l=s.identifierPrefix),s.onUncaughtError!==void 0&&(m=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(B=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(Z=s.unstable_transitionCallbacks)),s=K1(e,1,!1,null,null,i,l,m,v,B,Z,null),e[he]=s.current,Ae(e),new Fm(s)},Dp.hydrateRoot=function(e,s,i){if(!o(e))throw Error(a(299));var l=!1,m="",v=Xo,B=Ff,Z=Rf,fe=null,Pe=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(m=i.identifierPrefix),i.onUncaughtError!==void 0&&(v=i.onUncaughtError),i.onCaughtError!==void 0&&(B=i.onCaughtError),i.onRecoverableError!==void 0&&(Z=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(fe=i.unstable_transitionCallbacks),i.formState!==void 0&&(Pe=i.formState)),s=K1(e,1,!0,s,i??null,l,m,v,B,Z,fe,Pe),s.context=Q1(null),i=s.current,l=mr(),l=xn(l),m=za(l),m.callback=null,Fa(i,m,l),i=l,s.current.lanes=i,br(s,i),ga(s),e[he]=s.current,Ae(e),new Wh(s)},Dp.version="19.1.1",Dp}var hg;function gx(){if(hg)return Nm.exports;hg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}return t(),Nm.exports=_x(),Nm.exports}var yx=gx();const bx=Jy(yx),lm=new Map,qu=[],Mx=(t,r,n)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){const a=lm.get(t);if(a===void 0)lm.set(t,{backend:r,priority:n});else{if(a.priority>n)return;if(a.priority===n&&a.backend!==r)throw new Error(`cannot register backend "${t}" using priority ${n}`)}if(n>=0){const o=qu.indexOf(t);o!==-1&&qu.splice(o,1);for(let u=0;u<qu.length;u++)if(lm.get(qu[u]).priority<=n){qu.splice(u,0,t);return}qu.push(t)}return}throw new TypeError("not a valid backend")},vx=async t=>{const r=lm.get(t);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{const n=!!r.initPromise;try{return n||(r.initPromise=r.backend.init(t)),await r.initPromise,r.initialized=!0,r.backend}catch(a){return n||(r.error=`${a}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},wx=async t=>{const r=t.executionProviders||[],n=r.map(f=>typeof f=="string"?f:f.name),a=n.length===0?qu:n;let o;const u=[],d=new Set;for(const f of a){const p=await vx(f);typeof p=="string"?u.push({name:f,err:p}):(o||(o=p),o===p&&d.add(f))}if(!o)throw new Error(`no available backend found. ERR: ${u.map(f=>`[${f.name}] ${f.err}`).join(", ")}`);for(const{name:f,err:p}of u)n.includes(f)&&console.warn(`removing requested execution provider "${f}" from session options because it is not available: ${p}`);const c=r.filter(f=>d.has(typeof f=="string"?f:f.name));return[o,new Proxy(t,{get:(f,p)=>p==="executionProviders"?c:Reflect.get(f,p)})]},xx="1.21.0";let mg="warning";const ni={wasm:{},webgl:{},webgpu:{},versions:{common:xx},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);mg=t}},get logLevel(){return mg}};Object.defineProperty(ni,"logLevel",{enumerable:!0});const Tx=ni,Ex=(t,r)=>{const n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=t.dims[3],n.height=t.dims[2];const a=n.getContext("2d");if(a!=null){let o,u;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(o=t.dims[2],u=t.dims[3]):(o=t.dims[3],u=t.dims[2]);const d=r?.format!==void 0?r.format:"RGB",c=r?.norm;let f,p;c===void 0||c.mean===void 0?f=[255,255,255,255]:typeof c.mean=="number"?f=[c.mean,c.mean,c.mean,c.mean]:(f=[c.mean[0],c.mean[1],c.mean[2],0],c.mean[3]!==void 0&&(f[3]=c.mean[3])),c===void 0||c.bias===void 0?p=[0,0,0,0]:typeof c.bias=="number"?p=[c.bias,c.bias,c.bias,c.bias]:(p=[c.bias[0],c.bias[1],c.bias[2],0],c.bias[3]!==void 0&&(p[3]=c.bias[3]));const g=u*o;let _=0,h=g,w=g*2,M=-1;d==="RGBA"?(_=0,h=g,w=g*2,M=g*3):d==="RGB"?(_=0,h=g,w=g*2):d==="RBG"&&(_=0,w=g,h=g*2);for(let x=0;x<u;x++)for(let F=0;F<o;F++){const E=(t.data[_++]-p[0])*f[0],T=(t.data[h++]-p[1])*f[1],L=(t.data[w++]-p[2])*f[2],O=M===-1?255:(t.data[M++]-p[3])*f[3];a.fillStyle="rgba("+E+","+T+","+L+","+O+")",a.fillRect(F,x,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Cx=(t,r)=>{const n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let a;if(n!=null){let o,u,d;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(o=t.dims[2],u=t.dims[1],d=t.dims[3]):(o=t.dims[3],u=t.dims[2],d=t.dims[1]);const c=r!==void 0&&r.format!==void 0?r.format:"RGB",f=r?.norm;let p,g;f===void 0||f.mean===void 0?p=[255,255,255,255]:typeof f.mean=="number"?p=[f.mean,f.mean,f.mean,f.mean]:(p=[f.mean[0],f.mean[1],f.mean[2],255],f.mean[3]!==void 0&&(p[3]=f.mean[3])),f===void 0||f.bias===void 0?g=[0,0,0,0]:typeof f.bias=="number"?g=[f.bias,f.bias,f.bias,f.bias]:(g=[f.bias[0],f.bias[1],f.bias[2],0],f.bias[3]!==void 0&&(g[3]=f.bias[3]));const _=u*o;if(r!==void 0&&(r.format!==void 0&&d===4&&r.format!=="RGBA"||d===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const h=4;let w=0,M=1,x=2,F=3,E=0,T=_,L=_*2,O=-1;c==="RGBA"?(E=0,T=_,L=_*2,O=_*3):c==="RGB"?(E=0,T=_,L=_*2):c==="RBG"&&(E=0,L=_,T=_*2),a=n.createImageData(o,u);for(let S=0;S<u*o;w+=h,M+=h,x+=h,F+=h,S++)a.data[w]=(t.data[E++]-g[0])*p[0],a.data[M]=(t.data[T++]-g[1])*p[1],a.data[x]=(t.data[L++]-g[2])*p[2],a.data[F]=O===-1?255:(t.data[O++]-g[3])*p[3]}else throw new Error("Can not access image data");return a},Gm=(t,r)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:n,width:a}=r,o=r.norm??{mean:255,bias:0};let u,d;typeof o.mean=="number"?u=[o.mean,o.mean,o.mean,o.mean]:u=[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],typeof o.bias=="number"?d=[o.bias,o.bias,o.bias,o.bias]:d=[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];const c=r.format!==void 0?r.format:"RGBA",f=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",p=n*a,g=f==="RGBA"?new Float32Array(p*4):new Float32Array(p*3);let _=4,h=0,w=1,M=2,x=3,F=0,E=p,T=p*2,L=-1;c==="RGB"&&(_=3,h=0,w=1,M=2,x=-1),f==="RGBA"?L=p*3:f==="RBG"?(F=0,T=p,E=p*2):f==="BGR"&&(T=0,E=p,F=p*2);for(let S=0;S<p;S++,h+=_,M+=_,w+=_,x+=_)g[F++]=(t[h]+d[0])/u[0],g[E++]=(t[w]+d[1])/u[1],g[T++]=(t[M]+d[2])/u[2],L!==-1&&x!==-1&&(g[L++]=(t[x]+d[3])/u[3]);return f==="RGBA"?new va("float32",g,[1,4,n,a]):new va("float32",g,[1,3,n,a])},Sx=async(t,r)=>{const n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,a=typeof ImageData<"u"&&t instanceof ImageData,o=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,u=typeof t=="string";let d,c=r??{};const f=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},p=g=>typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||g instanceof OffscreenCanvas?g.getContext("2d"):null;if(n){const g=f();g.width=t.width,g.height=t.height;const _=p(g);if(_!=null){let h=t.height,w=t.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(h=r.resizedHeight,w=r.resizedWidth),r!==void 0){if(c=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");c.tensorFormat="RGBA",c.height=h,c.width=w}else c.tensorFormat="RGBA",c.height=h,c.width=w;_.drawImage(t,0,0),d=_.getImageData(0,0,w,h).data}else throw new Error("Can not access image data")}else if(a){let g,_;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(g=r.resizedHeight,_=r.resizedWidth):(g=t.height,_=t.width),r!==void 0&&(c=r),c.format="RGBA",c.height=g,c.width=_,r!==void 0){const h=f();h.width=_,h.height=g;const w=p(h);if(w!=null)w.putImageData(t,0,0),d=w.getImageData(0,0,_,g).data;else throw new Error("Can not access image data")}else d=t.data}else if(o){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");const g=f();g.width=t.width,g.height=t.height;const _=p(g);if(_!=null){const h=t.height,w=t.width;return _.drawImage(t,0,0,w,h),d=_.getImageData(0,0,w,h).data,c.height=h,c.width=w,Gm(d,c)}else throw new Error("Can not access image data")}else{if(u)return new Promise((g,_)=>{const h=f(),w=p(h);if(!t||!w)return _();const M=new Image;M.crossOrigin="Anonymous",M.src=t,M.onload=()=>{h.width=M.width,h.height=M.height,w.drawImage(M,0,0,h.width,h.height);const x=w.getImageData(0,0,h.width,h.height);c.height=h.height,c.width=h.width,g(Gm(x.data,c))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(d!==void 0)return Gm(d,c);throw new Error("Input data provided is not supported - aborted tensor creation")},Px=(t,r)=>{const{width:n,height:a,download:o,dispose:u}=r,d=[1,a,n,4];return new va({location:"texture",type:"float32",texture:t,dims:d,download:o,dispose:u})},Ax=(t,r)=>{const{dataType:n,dims:a,download:o,dispose:u}=r;return new va({location:"gpu-buffer",type:n??"float32",gpuBuffer:t,dims:a,download:o,dispose:u})},Ox=(t,r)=>{const{dataType:n,dims:a,download:o,dispose:u}=r;return new va({location:"ml-tensor",type:n??"float32",mlTensor:t,dims:a,download:o,dispose:u})},$x=(t,r,n)=>new va({location:"cpu-pinned",type:t,data:r,dims:n??[r.length]}),$d=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),um=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let _g=!1;const Dx=()=>{if(!_g){_g=!0;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,a=typeof n<"u"&&n.from;t&&($d.set("int64",BigInt64Array),um.set(BigInt64Array,"int64")),r&&($d.set("uint64",BigUint64Array),um.set(BigUint64Array,"uint64")),a?($d.set("float16",n),um.set(n,"float16")):$d.set("float16",Uint16Array)}},kx=t=>{let r=1;for(let n=0;n<t.length;n++){const a=t[n];if(typeof a!="number"||!Number.isSafeInteger(a))throw new TypeError(`dims[${n}] must be an integer, got: ${a}`);if(a<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${a}`);r*=a}return r},Lx=(t,r)=>{switch(t.location){case"cpu":return new va(t.type,t.data,r);case"cpu-pinned":return new va({location:"cpu-pinned",data:t.data,type:t.type,dims:r});case"texture":return new va({location:"texture",texture:t.texture,type:t.type,dims:r});case"gpu-buffer":return new va({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:r});case"ml-tensor":return new va({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};let va=class{constructor(r,n,a){Dx();let o,u;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,o=r.type,u=r.dims,r.location){case"cpu-pinned":{const c=$d.get(o);if(!c)throw new TypeError(`unsupported type "${o}" to create tensor from pinned buffer`);if(!(r.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=r.data;break}case"texture":{if(o!=="float32")throw new TypeError(`unsupported type "${o}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint64"&&o!=="int8"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,f;if(typeof r=="string")if(o=r,f=a,r==="string"){if(!Array.isArray(n))throw new TypeError("A string tensor's data must be a string array.");c=n}else{const p=$d.get(r);if(p===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(n)){if(r==="float16"&&p===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${p.name} as data.`);r==="uint64"||r==="int64"?c=p.from(n,BigInt):c=p.from(n)}else if(n instanceof p)c=n;else if(n instanceof Uint8ClampedArray)if(r==="uint8")c=Uint8Array.from(n);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&n instanceof Uint16Array&&p!==Uint16Array)c=new globalThis.Float16Array(n.buffer,n.byteOffset,n.length);else throw new TypeError(`A ${o} tensor's data must be type of ${p}`)}else if(f=n,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const p=typeof r[0];if(p==="string")o="string",c=r;else if(p==="boolean")o="bool",c=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${p}.`)}else if(r instanceof Uint8ClampedArray)o="uint8",c=Uint8Array.from(r);else{const p=um.get(r.constructor);if(p===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);o=p,c=r}if(f===void 0)f=[c.length];else if(!Array.isArray(f))throw new TypeError("A tensor's dims must be a number array");u=f,this.cpuData=c,this.dataLocation="cpu"}const d=kx(u);if(this.cpuData&&d!==this.cpuData.length&&!((o==="uint4"||o==="int4")&&Math.ceil(d/2)===this.cpuData.length))throw new Error(`Tensor's size(${d}) does not match data length(${this.cpuData.length}).`);this.type=o,this.dims=u,this.size=d}static async fromImage(r,n){return Sx(r,n)}static fromTexture(r,n){return Px(r,n)}static fromGpuBuffer(r,n){return Ax(r,n)}static fromMLTensor(r,n){return Ox(r,n)}static fromPinnedBuffer(r,n,a){return $x(r,n,a)}toDataURL(r){return Ex(this,r)}toImageData(r){return Cx(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const n=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=n,r&&this.disposer&&(this.disposer(),this.disposer=void 0),n}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Lx(this,r)}};const Ad=va,eb=(t,r)=>{(typeof ni.trace>"u"?!ni.wasm.trace:!ni.trace)||console.timeStamp(`${t}::ORT::${r}`)},tb=(t,r)=>{const n=new Error().stack?.split(/\r\n|\r|\n/g)||[];let a=!1;for(let o=0;o<n.length;o++){if(a&&!n[o].includes("TRACE_FUNC")){let u=`FUNC_${t}::${n[o].trim().split(" ")[1]}`;r&&(u+=`::${r}`),eb("CPU",u);return}n[o].includes("TRACE_FUNC")&&(a=!0)}},H_=t=>{(typeof ni.trace>"u"?!ni.wasm.trace:!ni.trace)||tb("BEGIN",t)},q_=t=>{(typeof ni.trace>"u"?!ni.wasm.trace:!ni.trace)||tb("END",t)};let Ix=class nb{constructor(r){this.handler=r}async run(r,n,a){H_();const o={};let u={};if(typeof r!="object"||r===null||r instanceof Ad||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let d=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof Ad)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");d=!1;for(const p of n){if(typeof p!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(p)===-1)throw new RangeError(`'fetches' contains invalid output name: ${p}.`);o[p]=null}if(typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else{let p=!1;const g=Object.getOwnPropertyNames(n);for(const _ of this.outputNames)if(g.indexOf(_)!==-1){const h=n[_];(h===null||h instanceof Ad)&&(p=!0,d=!1,o[_]=h)}if(p){if(typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else u=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const p of this.inputNames)if(typeof r[p]>"u")throw new Error(`input '${p}' is missing in 'feeds'.`);if(d)for(const p of this.outputNames)o[p]=null;const c=await this.handler.run(r,o,u),f={};for(const p in c)if(Object.hasOwnProperty.call(c,p)){const g=c[p];g instanceof Ad?f[p]=g:f[p]=new Ad(g.type,g.data,g.dims)}return q_(),f}async release(){return this.handler.dispose()}static async create(r,n,a,o){H_();let u,d={};if(typeof r=="string"){if(u=r,typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(u=r,typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){const g=r;let _=0,h=r.byteLength;if(typeof n=="object"&&n!==null)d=n;else if(typeof n=="number"){if(_=n,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=g.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${g.byteLength}).`);if(h=r.byteLength-_,typeof a=="number"){if(h=a,!Number.isSafeInteger(h))throw new RangeError("'byteLength' must be an integer.");if(h<=0||_+h>g.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${g.byteLength-_}].`);if(typeof o=="object"&&o!==null)d=o;else if(typeof o<"u")throw new TypeError("'options' must be an object.")}else if(typeof a<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");u=new Uint8Array(g,_,h)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[c,f]=await wx(d),p=await c.createInferenceSessionHandler(u,f);return q_(),new nb(p)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const zx=Ix,Fx=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:zx,TRACE:eb,TRACE_FUNC_BEGIN:H_,TRACE_FUNC_END:q_,Tensor:Ad,env:Tx,registerBackend:Mx},Symbol.toStringTag,{value:"Module"}));/*!
 * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var d1=Object.defineProperty,Rx=Object.getOwnPropertyDescriptor,Bx=Object.getOwnPropertyNames,Nx=Object.prototype.hasOwnProperty,jx=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,n)=>(typeof require<"u"?require:r)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),at=(t,r)=>()=>(t&&(r=t(t=0)),r),zd=(t,r)=>{for(var n in r)d1(t,n,{get:r[n],enumerable:!0})},Ux=(t,r,n,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Bx(r))!Nx.call(t,o)&&o!==n&&d1(t,o,{get:()=>r[o],enumerable:!(a=Rx(r,o))||a.enumerable});return t},Kp=t=>Ux(d1({},"__esModule",{value:!0}),t),kp,gl,Xu,gg,sb,rb=at(()=>{kp=new Map,gl=[],Xu=(t,r,n)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let a=kp.get(t);if(a===void 0)kp.set(t,{backend:r,priority:n});else{if(a.priority>n)return;if(a.priority===n&&a.backend!==r)throw new Error(`cannot register backend "${t}" using priority ${n}`)}if(n>=0){let o=gl.indexOf(t);o!==-1&&gl.splice(o,1);for(let u=0;u<gl.length;u++)if(kp.get(gl[u]).priority<=n){gl.splice(u,0,t);return}gl.push(t)}return}throw new TypeError("not a valid backend")},gg=async t=>{let r=kp.get(t);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let n=!!r.initPromise;try{return n||(r.initPromise=r.backend.init(t)),await r.initPromise,r.initialized=!0,r.backend}catch(a){return n||(r.error=`${a}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},sb=async t=>{let r=t.executionProviders||[],n=r.map(f=>typeof f=="string"?f:f.name),a=n.length===0?gl:n,o,u=[],d=new Set;for(let f of a){let p=await gg(f);typeof p=="string"?u.push({name:f,err:p}):(o||(o=p),o===p&&d.add(f))}if(!o)throw new Error(`no available backend found. ERR: ${u.map(f=>`[${f.name}] ${f.err}`).join(", ")}`);for(let{name:f,err:p}of u)n.includes(f)&&console.warn(`removing requested execution provider "${f}" from session options because it is not available: ${p}`);let c=r.filter(f=>d.has(typeof f=="string"?f:f.name));return[o,new Proxy(t,{get:(f,p)=>p==="executionProviders"?c:Reflect.get(f,p)})]}}),Vx=at(()=>{rb()}),ab,Gx=at(()=>{ab="1.22.0-dev.20250409-89f8206ba4"}),Wm,Ma,ib=at(()=>{Gx(),Wm="warning",Ma={wasm:{},webgl:{},webgpu:{},versions:{common:ab},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);Wm=t}},get logLevel(){return Wm}},Object.defineProperty(Ma,"logLevel",{enumerable:!0})}),ts,Wx=at(()=>{ib(),ts=Ma}),ob,lb,Hx=at(()=>{ob=(t,r)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=t.dims[3],n.height=t.dims[2];let a=n.getContext("2d");if(a!=null){let o,u;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(o=t.dims[2],u=t.dims[3]):(o=t.dims[3],u=t.dims[2]);let d=r?.format!==void 0?r.format:"RGB",c=r?.norm,f,p;c===void 0||c.mean===void 0?f=[255,255,255,255]:typeof c.mean=="number"?f=[c.mean,c.mean,c.mean,c.mean]:(f=[c.mean[0],c.mean[1],c.mean[2],0],c.mean[3]!==void 0&&(f[3]=c.mean[3])),c===void 0||c.bias===void 0?p=[0,0,0,0]:typeof c.bias=="number"?p=[c.bias,c.bias,c.bias,c.bias]:(p=[c.bias[0],c.bias[1],c.bias[2],0],c.bias[3]!==void 0&&(p[3]=c.bias[3]));let g=u*o,_=0,h=g,w=g*2,M=-1;d==="RGBA"?(_=0,h=g,w=g*2,M=g*3):d==="RGB"?(_=0,h=g,w=g*2):d==="RBG"&&(_=0,w=g,h=g*2);for(let x=0;x<u;x++)for(let F=0;F<o;F++){let E=(t.data[_++]-p[0])*f[0],T=(t.data[h++]-p[1])*f[1],L=(t.data[w++]-p[2])*f[2],O=M===-1?255:(t.data[M++]-p[3])*f[3];a.fillStyle="rgba("+E+","+T+","+L+","+O+")",a.fillRect(F,x,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},lb=(t,r)=>{let n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),a;if(n!=null){let o,u,d;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(o=t.dims[2],u=t.dims[1],d=t.dims[3]):(o=t.dims[3],u=t.dims[2],d=t.dims[1]);let c=r!==void 0&&r.format!==void 0?r.format:"RGB",f=r?.norm,p,g;f===void 0||f.mean===void 0?p=[255,255,255,255]:typeof f.mean=="number"?p=[f.mean,f.mean,f.mean,f.mean]:(p=[f.mean[0],f.mean[1],f.mean[2],255],f.mean[3]!==void 0&&(p[3]=f.mean[3])),f===void 0||f.bias===void 0?g=[0,0,0,0]:typeof f.bias=="number"?g=[f.bias,f.bias,f.bias,f.bias]:(g=[f.bias[0],f.bias[1],f.bias[2],0],f.bias[3]!==void 0&&(g[3]=f.bias[3]));let _=u*o;if(r!==void 0&&(r.format!==void 0&&d===4&&r.format!=="RGBA"||d===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let h=4,w=0,M=1,x=2,F=3,E=0,T=_,L=_*2,O=-1;c==="RGBA"?(E=0,T=_,L=_*2,O=_*3):c==="RGB"?(E=0,T=_,L=_*2):c==="RBG"&&(E=0,L=_,T=_*2),a=n.createImageData(o,u);for(let S=0;S<u*o;w+=h,M+=h,x+=h,F+=h,S++)a.data[w]=(t.data[E++]-g[0])*p[0],a.data[M]=(t.data[T++]-g[1])*p[1],a.data[x]=(t.data[L++]-g[2])*p[2],a.data[F]=O===-1?255:(t.data[O++]-g[3])*p[3]}else throw new Error("Can not access image data");return a}}),qh,ub,cb,db,fb,pb,qx=at(()=>{f1(),qh=(t,r)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:a}=r,o=r.norm??{mean:255,bias:0},u,d;typeof o.mean=="number"?u=[o.mean,o.mean,o.mean,o.mean]:u=[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],typeof o.bias=="number"?d=[o.bias,o.bias,o.bias,o.bias]:d=[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let c=r.format!==void 0?r.format:"RGBA",f=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",p=n*a,g=f==="RGBA"?new Float32Array(p*4):new Float32Array(p*3),_=4,h=0,w=1,M=2,x=3,F=0,E=p,T=p*2,L=-1;c==="RGB"&&(_=3,h=0,w=1,M=2,x=-1),f==="RGBA"?L=p*3:f==="RBG"?(F=0,T=p,E=p*2):f==="BGR"&&(T=0,E=p,F=p*2);for(let O=0;O<p;O++,h+=_,M+=_,w+=_,x+=_)g[F++]=(t[h]+d[0])/u[0],g[E++]=(t[w]+d[1])/u[1],g[T++]=(t[M]+d[2])/u[2],L!==-1&&x!==-1&&(g[L++]=(t[x]+d[3])/u[3]);return f==="RGBA"?new Xr("float32",g,[1,4,n,a]):new Xr("float32",g,[1,3,n,a])},ub=async(t,r)=>{let n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,a=typeof ImageData<"u"&&t instanceof ImageData,o=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,u=typeof t=="string",d,c=r??{},f=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},p=g=>typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||g instanceof OffscreenCanvas?g.getContext("2d"):null;if(n){let g=f();g.width=t.width,g.height=t.height;let _=p(g);if(_!=null){let h=t.height,w=t.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(h=r.resizedHeight,w=r.resizedWidth),r!==void 0){if(c=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");c.tensorFormat="RGBA",c.height=h,c.width=w}else c.tensorFormat="RGBA",c.height=h,c.width=w;_.drawImage(t,0,0),d=_.getImageData(0,0,w,h).data}else throw new Error("Can not access image data")}else if(a){let g,_;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(g=r.resizedHeight,_=r.resizedWidth):(g=t.height,_=t.width),r!==void 0&&(c=r),c.format="RGBA",c.height=g,c.width=_,r!==void 0){let h=f();h.width=_,h.height=g;let w=p(h);if(w!=null)w.putImageData(t,0,0),d=w.getImageData(0,0,_,g).data;else throw new Error("Can not access image data")}else d=t.data}else if(o){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let g=f();g.width=t.width,g.height=t.height;let _=p(g);if(_!=null){let h=t.height,w=t.width;return _.drawImage(t,0,0,w,h),d=_.getImageData(0,0,w,h).data,c.height=h,c.width=w,qh(d,c)}else throw new Error("Can not access image data")}else{if(u)return new Promise((g,_)=>{let h=f(),w=p(h);if(!t||!w)return _();let M=new Image;M.crossOrigin="Anonymous",M.src=t,M.onload=()=>{h.width=M.width,h.height=M.height,w.drawImage(M,0,0,h.width,h.height);let x=w.getImageData(0,0,h.width,h.height);c.height=h.height,c.width=h.width,g(qh(x.data,c))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(d!==void 0)return qh(d,c);throw new Error("Input data provided is not supported - aborted tensor creation")},cb=(t,r)=>{let{width:n,height:a,download:o,dispose:u}=r,d=[1,a,n,4];return new Xr({location:"texture",type:"float32",texture:t,dims:d,download:o,dispose:u})},db=(t,r)=>{let{dataType:n,dims:a,download:o,dispose:u}=r;return new Xr({location:"gpu-buffer",type:n??"float32",gpuBuffer:t,dims:a,download:o,dispose:u})},fb=(t,r)=>{let{dataType:n,dims:a,download:o,dispose:u}=r;return new Xr({location:"ml-tensor",type:n??"float32",mlTensor:t,dims:a,download:o,dispose:u})},pb=(t,r,n)=>new Xr({location:"cpu-pinned",type:t,data:r,dims:n??[r.length]})}),Ku,Vp,Hm,hb,Kx=at(()=>{Ku=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Vp=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Hm=!1,hb=()=>{if(!Hm){Hm=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,a=typeof n<"u"&&n.from;t&&(Ku.set("int64",BigInt64Array),Vp.set(BigInt64Array,"int64")),r&&(Ku.set("uint64",BigUint64Array),Vp.set(BigUint64Array,"uint64")),a?(Ku.set("float16",n),Vp.set(n,"float16")):Ku.set("float16",Uint16Array)}}}),mb,_b,Qx=at(()=>{f1(),mb=t=>{let r=1;for(let n=0;n<t.length;n++){let a=t[n];if(typeof a!="number"||!Number.isSafeInteger(a))throw new TypeError(`dims[${n}] must be an integer, got: ${a}`);if(a<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${a}`);r*=a}return r},_b=(t,r)=>{switch(t.location){case"cpu":return new Xr(t.type,t.data,r);case"cpu-pinned":return new Xr({location:"cpu-pinned",data:t.data,type:t.type,dims:r});case"texture":return new Xr({location:"texture",texture:t.texture,type:t.type,dims:r});case"gpu-buffer":return new Xr({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:r});case"ml-tensor":return new Xr({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),Xr,f1=at(()=>{Hx(),qx(),Kx(),Qx(),Xr=class{constructor(t,r,n){hb();let a,o;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,a=t.type,o=t.dims,t.location){case"cpu-pinned":{let d=Ku.get(a);if(!d)throw new TypeError(`unsupported type "${a}" to create tensor from pinned buffer`);if(!(t.data instanceof d))throw new TypeError(`buffer should be of type ${d.name}`);this.cpuData=t.data;break}case"texture":{if(a!=="float32")throw new TypeError(`unsupported type "${a}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint64"&&a!=="int8"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let d,c;if(typeof t=="string")if(a=t,c=n,t==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");d=r}else{let f=Ku.get(t);if(f===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(r)){if(t==="float16"&&f===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${f.name} as data.`);t==="uint64"||t==="int64"?d=f.from(r,BigInt):d=f.from(r)}else if(r instanceof f)d=r;else if(r instanceof Uint8ClampedArray)if(t==="uint8")d=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&r instanceof Uint16Array&&f!==Uint16Array)d=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${a} tensor's data must be type of ${f}`)}else if(c=r,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let f=typeof t[0];if(f==="string")a="string",d=t;else if(f==="boolean")a="bool",d=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${f}.`)}else if(t instanceof Uint8ClampedArray)a="uint8",d=Uint8Array.from(t);else{let f=Vp.get(t.constructor);if(f===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);a=f,d=t}if(c===void 0)c=[d.length];else if(!Array.isArray(c))throw new TypeError("A tensor's dims must be a number array");o=c,this.cpuData=d,this.dataLocation="cpu"}let u=mb(o);if(this.cpuData&&u!==this.cpuData.length&&!((a==="uint4"||a==="int4")&&Math.ceil(u/2)===this.cpuData.length))throw new Error(`Tensor's size(${u}) does not match data length(${this.cpuData.length}).`);this.type=a,this.dims=o,this.size=u}static async fromImage(t,r){return ub(t,r)}static fromTexture(t,r){return cb(t,r)}static fromGpuBuffer(t,r){return db(t,r)}static fromMLTensor(t,r){return fb(t,r)}static fromPinnedBuffer(t,r,n){return pb(t,r,n)}toDataURL(t){return ob(this,t)}toImageData(t){return lb(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,t&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return _b(this,t)}}}),ti,gb=at(()=>{f1(),ti=Xr}),Qp,qm,ri,wa,yb=at(()=>{ib(),Qp=(t,r)=>{(typeof Ma.trace>"u"?!Ma.wasm.trace:!Ma.trace)||console.timeStamp(`${t}::ORT::${r}`)},qm=(t,r)=>{let n=new Error().stack?.split(/\r\n|\r|\n/g)||[],a=!1;for(let o=0;o<n.length;o++){if(a&&!n[o].includes("TRACE_FUNC")){let u=`FUNC_${t}::${n[o].trim().split(" ")[1]}`;r&&(u+=`::${r}`),Qp("CPU",u);return}n[o].includes("TRACE_FUNC")&&(a=!0)}},ri=t=>{(typeof Ma.trace>"u"?!Ma.wasm.trace:!Ma.trace)||qm("BEGIN",t)},wa=t=>{(typeof Ma.trace>"u"?!Ma.wasm.trace:!Ma.trace)||qm("END",t)}}),bb,Xx=at(()=>{rb(),gb(),yb(),bb=class Mb{constructor(r){this.handler=r}async run(r,n,a){ri();let o={},u={};if(typeof r!="object"||r===null||r instanceof ti||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let d=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof ti)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");d=!1;for(let p of n){if(typeof p!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(p)===-1)throw new RangeError(`'fetches' contains invalid output name: ${p}.`);o[p]=null}if(typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else{let p=!1,g=Object.getOwnPropertyNames(n);for(let _ of this.outputNames)if(g.indexOf(_)!==-1){let h=n[_];(h===null||h instanceof ti)&&(p=!0,d=!1,o[_]=h)}if(p){if(typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else u=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let p of this.inputNames)if(typeof r[p]>"u")throw new Error(`input '${p}' is missing in 'feeds'.`);if(d)for(let p of this.outputNames)o[p]=null;let c=await this.handler.run(r,o,u),f={};for(let p in c)if(Object.hasOwnProperty.call(c,p)){let g=c[p];g instanceof ti?f[p]=g:f[p]=new ti(g.type,g.data,g.dims)}return wa(),f}async release(){return this.handler.dispose()}static async create(r,n,a,o){ri();let u,d={};if(typeof r=="string"){if(u=r,typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(u=r,typeof n=="object"&&n!==null)d=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let g=r,_=0,h=r.byteLength;if(typeof n=="object"&&n!==null)d=n;else if(typeof n=="number"){if(_=n,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=g.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${g.byteLength}).`);if(h=r.byteLength-_,typeof a=="number"){if(h=a,!Number.isSafeInteger(h))throw new RangeError("'byteLength' must be an integer.");if(h<=0||_+h>g.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${g.byteLength-_}].`);if(typeof o=="object"&&o!==null)d=o;else if(typeof o<"u")throw new TypeError("'options' must be an object.")}else if(typeof a<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");u=new Uint8Array(g,_,h)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[c,f]=await sb(d),p=await c.createInferenceSessionHandler(u,f);return wa(),new Mb(p)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),p1,Yx=at(()=>{Xx(),p1=bb}),Zx=at(()=>{}),Jx=at(()=>{}),e3=at(()=>{}),t3=at(()=>{}),vb={};zd(vb,{InferenceSession:()=>p1,TRACE:()=>Qp,TRACE_FUNC_BEGIN:()=>ri,TRACE_FUNC_END:()=>wa,Tensor:()=>ti,env:()=>ts,registerBackend:()=>Xu});var ai=at(()=>{Vx(),Wx(),Yx(),gb(),Zx(),Jx(),yb(),e3(),t3()}),h1=at(()=>{}),wb={};zd(wb,{default:()=>xb});var Km,Qm,xb,n3=at(()=>{Pw(),ec(),m1(),Km="ort-wasm-proxy-worker",Qm=globalThis.self?.name===Km,Qm&&(self.onmessage=t=>{let{type:r,in:n}=t.data;try{switch(r){case"init-wasm":_1(n.wasm).then(()=>{L1(n).then(()=>{postMessage({type:r})},a=>{postMessage({type:r,err:a})})},a=>{postMessage({type:r,err:a})});break;case"init-ep":{let{epName:a,env:o}=n;I1(o,a).then(()=>{postMessage({type:r})},u=>{postMessage({type:r,err:u})});break}case"copy-from":{let{buffer:a}=n,o=ym(a);postMessage({type:r,out:o});break}case"create":{let{model:a,options:o}=n;z1(a,o).then(u=>{postMessage({type:r,out:u})},u=>{postMessage({type:r,err:u})});break}case"release":F1(n),postMessage({type:r});break;case"run":{let{sessionId:a,inputIndices:o,inputs:u,outputIndices:d,options:c}=n;R1(a,o,u,d,new Array(d.length).fill(null),c).then(f=>{f.some(p=>p[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:f},N1([...u,...f]))},f=>{postMessage({type:r,err:f})});break}case"end-profiling":B1(n),postMessage({type:r});break;default:}}catch(a){postMessage({type:r,err:a})}}),xb=Qm?null:t=>new Worker(t??Qr,{type:"module",name:Km})}),Tb={};zd(Tb,{default:()=>Eb});var Xm,Ym,Eb,yg,s3=at(()=>{Ym=(Xm=import.meta.url,async function(t={}){var r,n,a=t,o=new Promise((y,D)=>{r=y,n=D}),u=typeof window=="object",d=typeof WorkerGlobalScope<"u",c=d&&self.name?.startsWith("em-pthread");a.mountExternalData=(y,D)=>{y.startsWith("./")&&(y=y.substring(2)),(a.Eb||(a.Eb=new Map)).set(y,D)},a.unmountExternalData=()=>{delete a.Eb};var f=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let p=y=>async(...D)=>{try{if(a.Fb)throw Error("Session already started");let N=a.Fb={dc:D[0],errors:[]},K=await y(...D);if(a.Fb!==N)throw Error("Session mismatch");a.Jb?.flush();let J=N.errors;if(0<J.length){let ye=await Promise.all(J);if(ye=ye.filter(Ue=>Ue),0<ye.length)throw Error(ye.join(`
`))}return K}finally{a.Fb=null}};a.jsepInit=(y,D)=>{if(y==="webgpu"){[a.Jb,a.Ub,a.Yb,a.Kb,a.Xb,a.jb,a.Zb,a.ac,a.Vb,a.Wb,a.$b]=D;let N=a.Jb;a.jsepRegisterBuffer=(K,J,ye,Ue)=>N.registerBuffer(K,J,ye,Ue),a.jsepGetBuffer=K=>N.getBuffer(K),a.jsepCreateDownloader=(K,J,ye)=>N.createDownloader(K,J,ye),a.jsepOnCreateSession=K=>{N.onCreateSession(K)},a.jsepOnReleaseSession=K=>{N.onReleaseSession(K)},a.jsepOnRunStart=K=>N.onRunStart(K),a.bc=(K,J)=>{N.upload(K,J)}}else if(y==="webnn"){let N=D[0];[a.nc,a.Nb,a.webnnEnsureTensor,a.Ob,a.webnnDownloadTensor]=D.slice(1),a.webnnReleaseTensorId=a.Nb,a.webnnUploadTensor=a.Ob,a.webnnOnRunStart=K=>N.onRunStart(K),a.webnnOnRunEnd=N.onRunEnd.bind(N),a.webnnRegisterMLContext=(K,J)=>{N.registerMLContext(K,J)},a.webnnOnReleaseSession=K=>{N.onReleaseSession(K)},a.webnnCreateMLTensorDownloader=(K,J)=>N.createMLTensorDownloader(K,J),a.webnnRegisterMLTensor=(K,J,ye,Ue)=>N.registerMLTensor(K,J,ye,Ue),a.webnnCreateMLContext=K=>N.createMLContext(K),a.webnnRegisterMLConstant=(K,J,ye,Ue,nt,_t)=>N.registerMLConstant(K,J,ye,Ue,nt,a.Eb,_t),a.webnnRegisterGraphInput=N.registerGraphInput.bind(N),a.webnnIsGraphInput=N.isGraphInput.bind(N),a.webnnCreateTemporaryTensor=N.createTemporaryTensor.bind(N),a.webnnIsInt64Supported=N.isInt64Supported.bind(N)}};let g=()=>{let y=(D,N,K)=>(...J)=>{let ye=On,Ue=N?.();J=D(...J);let nt=N?.();return Ue!==nt&&(D=nt,K(Ue),N=K=null),On!=ye?new Promise((_t,Et)=>{ss={resolve:_t,reject:Et}}):J};(()=>{for(let D of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])a[D]=y(a[D],()=>a[D],N=>a[D]=N)})(),p!==void 0&&(a._OrtRun=p(a._OrtRun),a._OrtRunWithBinding=p(a._OrtRunWithBinding)),g=void 0};a.asyncInit=()=>{g?.()};var _,h,w=Object.assign({},a),M=(y,D)=>{throw D},x="";(u||d)&&(d?x=self.location.href:typeof document<"u"&&document.currentScript&&(x=document.currentScript.src),Xm&&(x=Xm),x=x.startsWith("blob:")?"":x.slice(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1),d&&(h=y=>{var D=new XMLHttpRequest;return D.open("GET",y,!1),D.responseType="arraybuffer",D.send(null),new Uint8Array(D.response)}),_=async y=>{if(ge(y))return new Promise((N,K)=>{var J=new XMLHttpRequest;J.open("GET",y,!0),J.responseType="arraybuffer",J.onload=()=>{J.status==200||J.status==0&&J.response?N(J.response):K(J.status)},J.onerror=K,J.send(null)});var D=await fetch(y,{credentials:"same-origin"});if(D.ok)return D.arrayBuffer();throw Error(D.status+" : "+D.url)});var F=console.log.bind(console),E=console.error.bind(console),T=F,L=E;Object.assign(a,w),w=null;var O,S,$,C,k,U,V,re,ne,W,ce,ae,H,se=a.wasmBinary,ie=!1,ge=y=>y.startsWith("file://");function q(){return O.buffer!=C.buffer&&je(),C}function j(){return O.buffer!=C.buffer&&je(),k}function R(){return O.buffer!=C.buffer&&je(),U}function X(){return O.buffer!=C.buffer&&je(),V}function G(){return O.buffer!=C.buffer&&je(),re}function pe(){return O.buffer!=C.buffer&&je(),ne}function Te(){return O.buffer!=C.buffer&&je(),W}function Ie(){return O.buffer!=C.buffer&&je(),H}if(c){let y=function(D){try{var N=D.data,K=N.Bb;if(K==="load"){let J=[];self.onmessage=ye=>J.push(ye),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let ye of J)y(ye);self.onmessage=y};for(let ye of N.Rb)a[ye]&&!a[ye].proxy||(a[ye]=(...Ue)=>{postMessage({Bb:"callHandler",Qb:ye,args:Ue})},ye=="print"&&(T=a[ye]),ye=="printErr"&&(L=a[ye]));O=N.kc,je(),Ne(N.lc)}else if(K==="run"){Rn(N.Ab),Ls(N.Ab,0,0,1,0,0),Ts(),de(N.Ab),dt||(Ri(),dt=!0);try{$s(N.fc,N.Hb)}catch(J){if(J!="unwind")throw J}}else N.target!=="setimmediate"&&(K==="checkMailbox"?dt&&me():K&&(L(`worker: received unknown command ${K}`),L(N)))}catch(J){throw $a(),J}};var Ne,dt=!1;L=function(...D){D=D.join(" "),console.error(D)},self.alert=function(...D){postMessage({Bb:"alert",text:D.join(" "),ic:Bi()})},self.onunhandledrejection=D=>{throw D.reason||D},self.onmessage=y}function je(){var y=O.buffer;a.HEAP8=C=new Int8Array(y),a.HEAP16=U=new Int16Array(y),a.HEAPU8=k=new Uint8Array(y),a.HEAPU16=V=new Uint16Array(y),a.HEAP32=re=new Int32Array(y),a.HEAPU32=ne=new Uint32Array(y),a.HEAPF32=W=new Float32Array(y),a.HEAPF64=H=new Float64Array(y),a.HEAP64=ce=new BigInt64Array(y),a.HEAPU64=ae=new BigUint64Array(y)}function oe(){c?startWorker(a):Ot.Ca()}c||(O=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),je());var ve,te=0,De=null;function Xe(){if(--te==0&&De){var y=De;De=null,y()}}function Be(y){throw L(y="Aborted("+y+")"),ie=!0,y=new WebAssembly.RuntimeError(y+". Build with -sASSERTIONS for more info."),n(y),y}function Ee(){return{a:{L:Ke,Aa:ke,b:Zr,$:Ta,A:qt,pa:Fr,X:Y,Z:le,qa:he,na:Se,ga:He,ma:Mt,J:Ct,Y:ft,V:Xt,oa:Kt,W:qn,va:Tn,E:Pr,Q:Jr,O:ar,D:Hs,u:Ze,r:rt,P:vt,z:oi,R:Me,ja:z,T:Oe,aa:pt,M:gt,F:yt,ia:de,sa:ot,t:An,Ba:Yn,w:ur,o:vr,l:Zn,c:ds,n:Js,j:ki,v:wl,p:nc,f:sc,s:rc,m:na,e:ac,k:ic,i:oc,g:lc,d:uc,da:Pa,ea:cc,fa:wo,ba:xo,ca:Cl,N:Sl,xa:Pl,ua:Al,h:Dl,C:kl,G:Eo,ta:dc,x:Co,ra:ci,U:fc,q:To,y:Ll,K:Il,S:zl,za:pc,ya:So,ka:cr,la:Oa,_:lt,B:hc,I:fi,ha:Fl,H:pi,a:O,wa:mt}}}var Ve={829644:(y,D,N,K,J)=>{if(a===void 0||!a.Eb)return 1;if((y=xn(Number(y>>>0))).startsWith("./")&&(y=y.substring(2)),!(y=a.Eb.get(y)))return 2;if(D=Number(D>>>0),N=Number(N>>>0),K=Number(K>>>0),D+N>y.byteLength)return 3;try{let ye=y.subarray(D,D+N);switch(J){case 0:j().set(ye,K>>>0);break;case 1:a.mc?a.mc(K,ye):a.bc(K,ye);break;default:return 4}return 0}catch{return 4}},830468:(y,D,N)=>{a.Ob(y,j().subarray(D>>>0,D+N>>>0))},830532:()=>a.nc(),830574:y=>{a.Nb(y)},830611:()=>{a.Vb()},830642:()=>{a.Wb()},830671:()=>{a.$b()},830696:y=>a.Ub(y),830729:y=>a.Yb(y),830761:(y,D,N)=>{a.Kb(Number(y),Number(D),Number(N),!0)},830824:(y,D,N)=>{a.Kb(Number(y),Number(D),Number(N))},830881:()=>typeof wasmOffsetConverter<"u",830938:y=>{a.jb("Abs",y,void 0)},830989:y=>{a.jb("Neg",y,void 0)},831040:y=>{a.jb("Floor",y,void 0)},831093:y=>{a.jb("Ceil",y,void 0)},831145:y=>{a.jb("Reciprocal",y,void 0)},831203:y=>{a.jb("Sqrt",y,void 0)},831255:y=>{a.jb("Exp",y,void 0)},831306:y=>{a.jb("Erf",y,void 0)},831357:y=>{a.jb("Sigmoid",y,void 0)},831412:(y,D,N)=>{a.jb("HardSigmoid",y,{alpha:D,beta:N})},831491:y=>{a.jb("Log",y,void 0)},831542:y=>{a.jb("Sin",y,void 0)},831593:y=>{a.jb("Cos",y,void 0)},831644:y=>{a.jb("Tan",y,void 0)},831695:y=>{a.jb("Asin",y,void 0)},831747:y=>{a.jb("Acos",y,void 0)},831799:y=>{a.jb("Atan",y,void 0)},831851:y=>{a.jb("Sinh",y,void 0)},831903:y=>{a.jb("Cosh",y,void 0)},831955:y=>{a.jb("Asinh",y,void 0)},832008:y=>{a.jb("Acosh",y,void 0)},832061:y=>{a.jb("Atanh",y,void 0)},832114:y=>{a.jb("Tanh",y,void 0)},832166:y=>{a.jb("Not",y,void 0)},832217:(y,D,N)=>{a.jb("Clip",y,{min:D,max:N})},832286:y=>{a.jb("Clip",y,void 0)},832338:(y,D)=>{a.jb("Elu",y,{alpha:D})},832396:y=>{a.jb("Gelu",y,void 0)},832448:y=>{a.jb("Relu",y,void 0)},832500:(y,D)=>{a.jb("LeakyRelu",y,{alpha:D})},832564:(y,D)=>{a.jb("ThresholdedRelu",y,{alpha:D})},832634:(y,D)=>{a.jb("Cast",y,{to:D})},832692:y=>{a.jb("Add",y,void 0)},832743:y=>{a.jb("Sub",y,void 0)},832794:y=>{a.jb("Mul",y,void 0)},832845:y=>{a.jb("Div",y,void 0)},832896:y=>{a.jb("Pow",y,void 0)},832947:y=>{a.jb("Equal",y,void 0)},833e3:y=>{a.jb("Greater",y,void 0)},833055:y=>{a.jb("GreaterOrEqual",y,void 0)},833117:y=>{a.jb("Less",y,void 0)},833169:y=>{a.jb("LessOrEqual",y,void 0)},833228:(y,D,N,K,J)=>{a.jb("ReduceMean",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},833403:(y,D,N,K,J)=>{a.jb("ReduceMax",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},833577:(y,D,N,K,J)=>{a.jb("ReduceMin",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},833751:(y,D,N,K,J)=>{a.jb("ReduceProd",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},833926:(y,D,N,K,J)=>{a.jb("ReduceSum",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834100:(y,D,N,K,J)=>{a.jb("ReduceL1",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834273:(y,D,N,K,J)=>{a.jb("ReduceL2",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834446:(y,D,N,K,J)=>{a.jb("ReduceLogSum",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834623:(y,D,N,K,J)=>{a.jb("ReduceSumSquare",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834803:(y,D,N,K,J)=>{a.jb("ReduceLogSumExp",y,{keepDims:!!D,noopWithEmptyAxes:!!N,axes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},834983:y=>{a.jb("Where",y,void 0)},835036:(y,D,N)=>{a.jb("Transpose",y,{perm:D?Array.from(G().subarray(Number(D)>>>0,Number(N)>>>0)):[]})},835160:(y,D,N,K)=>{a.jb("DepthToSpace",y,{blocksize:D,mode:xn(N),format:K?"NHWC":"NCHW"})},835293:(y,D,N,K)=>{a.jb("DepthToSpace",y,{blocksize:D,mode:xn(N),format:K?"NHWC":"NCHW"})},835426:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En,ys)=>{a.jb("ConvTranspose",y,{format:_t?"NHWC":"NCHW",autoPad:D,dilations:[N],group:K,kernelShape:[J],pads:[ye,Ue],strides:[nt],wIsConst:()=>!!q()[Et>>>0],outputPadding:Ut?Array.from(G().subarray(Number(Ut)>>>0,Number(Wt)>>>0)):[],outputShape:yn?Array.from(G().subarray(Number(yn)>>>0,Number(En)>>>0)):[],activation:xn(ys)})},835859:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("ConvTranspose",y,{format:nt?"NHWC":"NCHW",autoPad:D,dilations:Array.from(G().subarray(Number(N)>>>0,2+(Number(N)>>>0)>>>0)),group:K,kernelShape:Array.from(G().subarray(Number(J)>>>0,2+(Number(J)>>>0)>>>0)),pads:Array.from(G().subarray(Number(ye)>>>0,4+(Number(ye)>>>0)>>>0)),strides:Array.from(G().subarray(Number(Ue)>>>0,2+(Number(Ue)>>>0)>>>0)),wIsConst:()=>!!q()[_t>>>0],outputPadding:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],outputShape:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[],activation:xn(En)})},836520:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En,ys)=>{a.jb("ConvTranspose",y,{format:_t?"NHWC":"NCHW",autoPad:D,dilations:[N],group:K,kernelShape:[J],pads:[ye,Ue],strides:[nt],wIsConst:()=>!!q()[Et>>>0],outputPadding:Ut?Array.from(G().subarray(Number(Ut)>>>0,Number(Wt)>>>0)):[],outputShape:yn?Array.from(G().subarray(Number(yn)>>>0,Number(En)>>>0)):[],activation:xn(ys)})},836953:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("ConvTranspose",y,{format:nt?"NHWC":"NCHW",autoPad:D,dilations:Array.from(G().subarray(Number(N)>>>0,2+(Number(N)>>>0)>>>0)),group:K,kernelShape:Array.from(G().subarray(Number(J)>>>0,2+(Number(J)>>>0)>>>0)),pads:Array.from(G().subarray(Number(ye)>>>0,4+(Number(ye)>>>0)>>>0)),strides:Array.from(G().subarray(Number(Ue)>>>0,2+(Number(Ue)>>>0)>>>0)),wIsConst:()=>!!q()[_t>>>0],outputPadding:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],outputShape:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[],activation:xn(En)})},837614:(y,D)=>{a.jb("GlobalAveragePool",y,{format:D?"NHWC":"NCHW"})},837705:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("AveragePool",y,{format:En?"NHWC":"NCHW",auto_pad:D,ceil_mode:N,count_include_pad:K,storage_order:J,dilations:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[],kernel_shape:nt?Array.from(G().subarray(Number(nt)>>>0,Number(_t)>>>0)):[],pads:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],strides:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[]})},838184:(y,D)=>{a.jb("GlobalAveragePool",y,{format:D?"NHWC":"NCHW"})},838275:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("AveragePool",y,{format:En?"NHWC":"NCHW",auto_pad:D,ceil_mode:N,count_include_pad:K,storage_order:J,dilations:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[],kernel_shape:nt?Array.from(G().subarray(Number(nt)>>>0,Number(_t)>>>0)):[],pads:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],strides:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[]})},838754:(y,D)=>{a.jb("GlobalMaxPool",y,{format:D?"NHWC":"NCHW"})},838841:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("MaxPool",y,{format:En?"NHWC":"NCHW",auto_pad:D,ceil_mode:N,count_include_pad:K,storage_order:J,dilations:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[],kernel_shape:nt?Array.from(G().subarray(Number(nt)>>>0,Number(_t)>>>0)):[],pads:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],strides:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[]})},839316:(y,D)=>{a.jb("GlobalMaxPool",y,{format:D?"NHWC":"NCHW"})},839403:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En)=>{a.jb("MaxPool",y,{format:En?"NHWC":"NCHW",auto_pad:D,ceil_mode:N,count_include_pad:K,storage_order:J,dilations:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[],kernel_shape:nt?Array.from(G().subarray(Number(nt)>>>0,Number(_t)>>>0)):[],pads:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],strides:Wt?Array.from(G().subarray(Number(Wt)>>>0,Number(yn)>>>0)):[]})},839878:(y,D,N,K,J)=>{a.jb("Gemm",y,{alpha:D,beta:N,transA:K,transB:J})},839982:y=>{a.jb("MatMul",y,void 0)},840036:(y,D,N,K)=>{a.jb("ArgMax",y,{keepDims:!!D,selectLastIndex:!!N,axis:K})},840144:(y,D,N,K)=>{a.jb("ArgMin",y,{keepDims:!!D,selectLastIndex:!!N,axis:K})},840252:(y,D)=>{a.jb("Softmax",y,{axis:D})},840315:(y,D)=>{a.jb("Concat",y,{axis:D})},840375:(y,D,N,K,J)=>{a.jb("Split",y,{axis:D,numOutputs:N,splitSizes:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},840531:y=>{a.jb("Expand",y,void 0)},840585:(y,D)=>{a.jb("Gather",y,{axis:Number(D)})},840656:(y,D)=>{a.jb("GatherElements",y,{axis:Number(D)})},840735:(y,D)=>{a.jb("GatherND",y,{batch_dims:Number(D)})},840814:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut)=>{a.jb("Resize",y,{antialias:D,axes:N?Array.from(G().subarray(Number(N)>>>0,Number(K)>>>0)):[],coordinateTransformMode:xn(J),cubicCoeffA:ye,excludeOutside:Ue,extrapolationValue:nt,keepAspectRatioPolicy:xn(_t),mode:xn(Et),nearestMode:xn(Ut)})},841176:(y,D,N,K,J,ye,Ue)=>{a.jb("Slice",y,{starts:D?Array.from(G().subarray(Number(D)>>>0,Number(N)>>>0)):[],ends:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[],axes:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[]})},841440:y=>{a.jb("Tile",y,void 0)},841492:(y,D,N)=>{a.jb("InstanceNormalization",y,{epsilon:D,format:N?"NHWC":"NCHW"})},841606:(y,D,N)=>{a.jb("InstanceNormalization",y,{epsilon:D,format:N?"NHWC":"NCHW"})},841720:y=>{a.jb("Range",y,void 0)},841773:(y,D)=>{a.jb("Einsum",y,{equation:xn(D)})},841854:(y,D,N,K,J)=>{a.jb("Pad",y,{mode:D,value:N,pads:K?Array.from(G().subarray(Number(K)>>>0,Number(J)>>>0)):[]})},841997:(y,D,N,K,J,ye)=>{a.jb("BatchNormalization",y,{epsilon:D,momentum:N,spatial:!!J,trainingMode:!!K,format:ye?"NHWC":"NCHW"})},842166:(y,D,N,K,J,ye)=>{a.jb("BatchNormalization",y,{epsilon:D,momentum:N,spatial:!!J,trainingMode:!!K,format:ye?"NHWC":"NCHW"})},842335:(y,D,N)=>{a.jb("CumSum",y,{exclusive:Number(D),reverse:Number(N)})},842432:(y,D,N)=>{a.jb("DequantizeLinear",y,{axis:D,blockSize:N})},842522:(y,D,N,K,J)=>{a.jb("GridSample",y,{align_corners:D,mode:xn(N),padding_mode:xn(K),format:J?"NHWC":"NCHW"})},842692:(y,D,N,K,J)=>{a.jb("GridSample",y,{align_corners:D,mode:xn(N),padding_mode:xn(K),format:J?"NHWC":"NCHW"})},842862:(y,D)=>{a.jb("ScatterND",y,{reduction:xn(D)})},842947:(y,D,N,K,J,ye,Ue,nt,_t)=>{a.jb("Attention",y,{numHeads:D,isUnidirectional:N,maskFilterValue:K,scale:J,doRotary:ye,qkvHiddenSizes:Ue?Array.from(G().subarray(Number(nt)>>>0,Number(nt)+Ue>>>0)):[],pastPresentShareBuffer:!!_t})},843219:y=>{a.jb("BiasAdd",y,void 0)},843274:y=>{a.jb("BiasSplitGelu",y,void 0)},843335:y=>{a.jb("FastGelu",y,void 0)},843391:(y,D,N,K,J,ye,Ue,nt,_t,Et,Ut,Wt,yn,En,ys,ka)=>{a.jb("Conv",y,{format:Wt?"NHWC":"NCHW",auto_pad:D,dilations:N?Array.from(G().subarray(Number(N)>>>0,Number(K)>>>0)):[],group:J,kernel_shape:ye?Array.from(G().subarray(Number(ye)>>>0,Number(Ue)>>>0)):[],pads:nt?Array.from(G().subarray(Number(nt)>>>0,Number(_t)>>>0)):[],strides:Et?Array.from(G().subarray(Number(Et)>>>0,Number(Ut)>>>0)):[],w_is_const:()=>!!q()[Number(yn)>>>0],activation:xn(En),activation_params:ys?Array.from(Te().subarray(Number(ys)>>>0,Number(ka)>>>0)):[]})},843975:y=>{a.jb("Gelu",y,void 0)},844027:(y,D,N,K,J,ye,Ue,nt,_t)=>{a.jb("GroupQueryAttention",y,{numHeads:D,kvNumHeads:N,scale:K,softcap:J,doRotary:ye,rotaryInterleaved:Ue,smoothSoftmax:nt,localWindowSize:_t})},844244:(y,D,N,K)=>{a.jb("LayerNormalization",y,{axis:D,epsilon:N,simplified:!!K})},844355:(y,D,N,K)=>{a.jb("LayerNormalization",y,{axis:D,epsilon:N,simplified:!!K})},844466:(y,D,N,K,J,ye)=>{a.jb("MatMulNBits",y,{k:D,n:N,accuracyLevel:K,bits:J,blockSize:ye})},844593:(y,D,N,K,J,ye)=>{a.jb("MultiHeadAttention",y,{numHeads:D,isUnidirectional:N,maskFilterValue:K,scale:J,doRotary:ye})},844752:(y,D)=>{a.jb("QuickGelu",y,{alpha:D})},844816:(y,D,N,K,J)=>{a.jb("RotaryEmbedding",y,{interleaved:!!D,numHeads:N,rotaryEmbeddingDim:K,scale:J})},844955:(y,D,N)=>{a.jb("SkipLayerNormalization",y,{epsilon:D,simplified:!!N})},845057:(y,D,N)=>{a.jb("SkipLayerNormalization",y,{epsilon:D,simplified:!!N})},845159:(y,D,N,K)=>{a.jb("GatherBlockQuantized",y,{gatherAxis:D,quantizeAxis:N,blockSize:K})},845280:y=>{a.Zb(y)},845314:(y,D)=>a.ac(Number(y),Number(D),a.Fb.dc,a.Fb.errors)};function ke(y,D,N){return Ks(async()=>{await a.Xb(Number(y),Number(D),Number(N))})}function Ke(){return typeof wasmOffsetConverter<"u"}class et{name="ExitStatus";constructor(D){this.message=`Program terminated with exit(${D})`,this.status=D}}var ht=y=>{y.terminate(),y.onmessage=()=>{}},Re=[],Tt=y=>{bt.length==0&&(Zs(),Os(bt[0]));var D=bt.pop();if(!D)return 6;nn.push(D),It[y.Ab]=D,D.Ab=y.Ab;var N={Bb:"run",fc:y.ec,Hb:y.Hb,Ab:y.Ab};return D.postMessage(N,y.Mb),0},ut=0,st=(y,D,...N)=>{for(var K=2*N.length,J=sa(),ye=Da(8*K),Ue=ye>>>3,nt=0;nt<N.length;nt++){var _t=N[nt];typeof _t=="bigint"?(ce[Ue+2*nt]=1n,ce[Ue+2*nt+1]=_t):(ce[Ue+2*nt]=0n,Ie()[Ue+2*nt+1>>>0]=_t)}return y=Po(y,0,K,ye,D),Or(J),y};function mt(y){if(c)return st(0,1,y);if($=y,!(0<ut)){for(var D of nn)ht(D);for(D of bt)ht(D);bt=[],nn=[],It={},ie=!0}M(0,new et(y))}function ct(y){if(c)return st(1,0,y);lt(y)}var lt=y=>{if($=y,c)throw ct(y),"unwind";mt(y)},bt=[],nn=[],un=[],It={},os=y=>{var D=y.Ab;delete It[D],bt.push(y),nn.splice(nn.indexOf(y),1),y.Ab=0,ji(D)};function Ts(){un.forEach(y=>y())}var Os=y=>new Promise(D=>{y.onmessage=J=>{var ye=(J=J.data).Bb;if(J.Gb&&J.Gb!=Bi()){var Ue=It[J.Gb];Ue?Ue.postMessage(J,J.Mb):L(`Internal error! Worker sent a message "${ye}" to target pthread ${J.Gb}, but that thread no longer exists!`)}else ye==="checkMailbox"?me():ye==="spawnThread"?Tt(J):ye==="cleanupThread"?os(It[J.hc]):ye==="loaded"?(y.loaded=!0,D(y)):ye==="alert"?alert(`Thread ${J.ic}: ${J.text}`):J.target==="setimmediate"?y.postMessage(J):ye==="callHandler"?a[J.Qb](...J.args):ye&&L(`worker sent an unknown command ${ye}`)},y.onerror=J=>{throw L(`worker sent an error! ${J.filename}:${J.lineno}: ${J.message}`),J};var N,K=[];for(N of[])a.propertyIsEnumerable(N)&&K.push(N);y.postMessage({Bb:"load",Rb:K,kc:O,lc:S})});function Zs(){var y=new Worker((()=>{let D=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new D("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});bt.push(y)}var Rn=y=>{je();var D=pe()[y+52>>>2>>>0];y=pe()[y+56>>>2>>>0],jl(D,D-y),Or(D)},$s=(y,D)=>{ut=0,y=Vi(y,D),0<ut?$=y:Ui(y)};class xa{constructor(D){this.Ib=D-24}}function Zr(y,D,N){var K=new xa(y>>>=0);throw D>>>=0,N>>>=0,pe()[K.Ib+16>>>2>>>0]=0,pe()[K.Ib+4>>>2>>>0]=D,pe()[K.Ib+8>>>2>>>0]=N,y}function br(y,D,N,K){return c?st(2,1,y,D,N,K):Ta(y,D,N,K)}function Ta(y,D,N,K){if(y>>>=0,N>>>=0,K>>>=0,f===void 0)return 6;var J=[];return c&&J.length===0?br(y,D>>>=0,N,K):(y={ec:N,Ab:y,Hb:K,Mb:J},c?(y.Bb="spawnThread",postMessage(y,J),0):Tt(y))}var Dt=typeof TextDecoder<"u"?new TextDecoder:void 0,zr=(y,D=0,N=NaN)=>{var K=(D>>>=0)+N;for(N=D;y[N]&&!(N>=K);)++N;if(16<N-D&&y.buffer&&Dt)return Dt.decode(y.buffer instanceof ArrayBuffer?y.subarray(D,N):y.slice(D,N));for(K="";D<N;){var J=y[D++];if(128&J){var ye=63&y[D++];if((224&J)==192)K+=String.fromCharCode((31&J)<<6|ye);else{var Ue=63&y[D++];65536>(J=(240&J)==224?(15&J)<<12|ye<<6|Ue:(7&J)<<18|ye<<12|Ue<<6|63&y[D++])?K+=String.fromCharCode(J):(J-=65536,K+=String.fromCharCode(55296|J>>10,56320|1023&J))}}else K+=String.fromCharCode(J)}return K},xn=(y,D)=>(y>>>=0)?zr(j(),y,D):"";function qt(y,D,N){return c?st(3,1,y,D,N):0}function Fr(y,D){if(c)return st(4,1,y,D)}var I=y=>{for(var D=0,N=0;N<y.length;++N){var K=y.charCodeAt(N);127>=K?D++:2047>=K?D+=2:55296<=K&&57343>=K?(D+=4,++N):D+=3}return D},ue=(y,D,N)=>{var K=j();if(D>>>=0,0<N){var J=D;N=D+N-1;for(var ye=0;ye<y.length;++ye){var Ue=y.charCodeAt(ye);if(55296<=Ue&&57343>=Ue&&(Ue=65536+((1023&Ue)<<10)|1023&y.charCodeAt(++ye)),127>=Ue){if(D>=N)break;K[D++>>>0]=Ue}else{if(2047>=Ue){if(D+1>=N)break;K[D++>>>0]=192|Ue>>6}else{if(65535>=Ue){if(D+2>=N)break;K[D++>>>0]=224|Ue>>12}else{if(D+3>=N)break;K[D++>>>0]=240|Ue>>18,K[D++>>>0]=128|Ue>>12&63}K[D++>>>0]=128|Ue>>6&63}K[D++>>>0]=128|63&Ue}}K[D>>>0]=0,y=D-J}else y=0;return y};function Y(y,D){if(c)return st(5,1,y,D)}function le(y,D,N){if(c)return st(6,1,y,D,N)}function he(y,D,N){return c?st(7,1,y,D,N):0}function Se(y,D){if(c)return st(8,1,y,D)}function He(y,D,N){if(c)return st(9,1,y,D,N)}function Mt(y,D,N,K){if(c)return st(10,1,y,D,N,K)}function Ct(y,D,N,K){if(c)return st(11,1,y,D,N,K)}function ft(y,D,N,K){if(c)return st(12,1,y,D,N,K)}function Xt(y){if(c)return st(13,1,y)}function Kt(y,D){if(c)return st(14,1,y,D)}function qn(y,D,N){if(c)return st(15,1,y,D,N)}var dn,Nn,Tn=()=>Be(""),Bn=y=>{for(var D="";j()[y>>>0];)D+=dn[j()[y++>>>0]];return D},cs={},js={};function jn(y,D,N={}){return(function(K,J,ye={}){var Ue=J.name;if(!K)throw new Nn(`type "${Ue}" must have a positive integer typeid pointer`);if(js.hasOwnProperty(K)){if(ye.Sb)return;throw new Nn(`Cannot register type '${Ue}' twice`)}js[K]=J,cs.hasOwnProperty(K)&&(J=cs[K],delete cs[K],J.forEach(nt=>nt()))})(y,D,N)}var Rr=(y,D,N)=>{switch(D){case 1:return N?K=>q()[K>>>0]:K=>j()[K>>>0];case 2:return N?K=>R()[K>>>1>>>0]:K=>X()[K>>>1>>>0];case 4:return N?K=>G()[K>>>2>>>0]:K=>pe()[K>>>2>>>0];case 8:return N?K=>ce[K>>>3]:K=>ae[K>>>3];default:throw new TypeError(`invalid integer width (${D}): ${y}`)}};function Pr(y,D,N){N>>>=0,jn(y>>>=0,{name:D=Bn(D>>>0),fromWireType:K=>K,toWireType:function(K,J){if(typeof J!="bigint"&&typeof J!="number")throw J=J===null?"null":(K=typeof J)=="object"||K==="array"||K==="function"?J.toString():""+J,new TypeError(`Cannot convert "${J}" to ${this.name}`);return typeof J=="number"&&(J=BigInt(J)),J},Cb:Gs,readValueFromPointer:Rr(D,N,D.indexOf("u")==-1),Db:null})}var Gs=8;function Jr(y,D,N,K){jn(y>>>=0,{name:D=Bn(D>>>0),fromWireType:function(J){return!!J},toWireType:function(J,ye){return ye?N:K},Cb:Gs,readValueFromPointer:function(J){return this.fromWireType(j()[J>>>0])},Db:null})}var lr=[],Un=[];function ds(y){9<(y>>>=0)&&--Un[y+1]==0&&(Un[y]=void 0,lr.push(y))}var ns=y=>{if(!y)throw new Nn("Cannot use deleted val. handle = "+y);return Un[y]},gs=y=>{switch(y){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let D=lr.pop()||Un.length;return Un[D]=y,Un[D+1]=1,D}};function Ws(y){return this.fromWireType(pe()[y>>>2>>>0])}var Ar={name:"emscripten::val",fromWireType:y=>{var D=ns(y);return ds(y),D},toWireType:(y,D)=>gs(D),Cb:Gs,readValueFromPointer:Ws,Db:null};function ar(y){return jn(y>>>0,Ar)}var Ea=(y,D)=>{switch(D){case 4:return function(N){return this.fromWireType(Te()[N>>>2>>>0])};case 8:return function(N){return this.fromWireType(Ie()[N>>>3>>>0])};default:throw new TypeError(`invalid float width (${D}): ${y}`)}};function Hs(y,D,N){N>>>=0,jn(y>>>=0,{name:D=Bn(D>>>0),fromWireType:K=>K,toWireType:(K,J)=>J,Cb:Gs,readValueFromPointer:Ea(D,N),Db:null})}function Ze(y,D,N,K,J){if(y>>>=0,N>>>=0,D=Bn(D>>>0),J===-1&&(J=4294967295),J=nt=>nt,K===0){var ye=32-8*N;J=nt=>nt<<ye>>>ye}var Ue=D.includes("unsigned")?function(nt,_t){return _t>>>0}:function(nt,_t){return _t};jn(y,{name:D,fromWireType:J,toWireType:Ue,Cb:Gs,readValueFromPointer:Rr(D,N,K!==0),Db:null})}function rt(y,D,N){function K(ye){var Ue=pe()[ye>>>2>>>0];return ye=pe()[ye+4>>>2>>>0],new J(q().buffer,ye,Ue)}var J=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][D];jn(y>>>=0,{name:N=Bn(N>>>0),fromWireType:K,Cb:Gs,readValueFromPointer:K},{Sb:!0})}function vt(y,D){jn(y>>>=0,{name:D=Bn(D>>>0),fromWireType:function(N){for(var K,J=pe()[N>>>2>>>0],ye=N+4,Ue=ye,nt=0;nt<=J;++nt){var _t=ye+nt;nt!=J&&j()[_t>>>0]!=0||(Ue=xn(Ue,_t-Ue),K===void 0?K=Ue:(K+="\0",K+=Ue),Ue=_t+1)}return xr(N),K},toWireType:function(N,K){K instanceof ArrayBuffer&&(K=new Uint8Array(K));var J=typeof K=="string";if(!(J||K instanceof Uint8Array||K instanceof Uint8ClampedArray||K instanceof Int8Array))throw new Nn("Cannot pass non-string to std::string");var ye=J?I(K):K.length,Ue=Ni(4+ye+1),nt=Ue+4;if(pe()[Ue>>>2>>>0]=ye,J)ue(K,nt,ye+1);else if(J)for(J=0;J<ye;++J){var _t=K.charCodeAt(J);if(255<_t)throw xr(Ue),new Nn("String has UTF-16 code units that do not fit in 8 bits");j()[nt+J>>>0]=_t}else for(J=0;J<ye;++J)j()[nt+J>>>0]=K[J];return N!==null&&N.push(xr,Ue),Ue},Cb:Gs,readValueFromPointer:Ws,Db(N){xr(N)}})}var Pn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ea=(y,D)=>{for(var N=y>>1,K=N+D/2;!(N>=K)&&X()[N>>>0];)++N;if(32<(N<<=1)-y&&Pn)return Pn.decode(j().slice(y,N));for(N="",K=0;!(K>=D/2);++K){var J=R()[y+2*K>>>1>>>0];if(J==0)break;N+=String.fromCharCode(J)}return N},Mr=(y,D,N)=>{if(N??=2147483647,2>N)return 0;var K=D;N=(N-=2)<2*y.length?N/2:y.length;for(var J=0;J<N;++J){var ye=y.charCodeAt(J);R()[D>>>1>>>0]=ye,D+=2}return R()[D>>>1>>>0]=0,D-K},Ca=y=>2*y.length,fs=(y,D)=>{for(var N=0,K="";!(N>=D/4);){var J=G()[y+4*N>>>2>>>0];if(J==0)break;++N,65536<=J?(J-=65536,K+=String.fromCharCode(55296|J>>10,56320|1023&J)):K+=String.fromCharCode(J)}return K},Sa=(y,D,N)=>{if(D>>>=0,N??=2147483647,4>N)return 0;var K=D;N=K+N-4;for(var J=0;J<y.length;++J){var ye=y.charCodeAt(J);if(55296<=ye&&57343>=ye&&(ye=65536+((1023&ye)<<10)|1023&y.charCodeAt(++J)),G()[D>>>2>>>0]=ye,(D+=4)+4>N)break}return G()[D>>>2>>>0]=0,D-K},ii=y=>{for(var D=0,N=0;N<y.length;++N){var K=y.charCodeAt(N);55296<=K&&57343>=K&&++N,D+=4}return D};function oi(y,D,N){if(y>>>=0,D>>>=0,N=Bn(N>>>=0),D===2)var K=ea,J=Mr,ye=Ca,Ue=nt=>X()[nt>>>1>>>0];else D===4&&(K=fs,J=Sa,ye=ii,Ue=nt=>pe()[nt>>>2>>>0]);jn(y,{name:N,fromWireType:nt=>{for(var _t,Et=pe()[nt>>>2>>>0],Ut=nt+4,Wt=0;Wt<=Et;++Wt){var yn=nt+4+Wt*D;Wt!=Et&&Ue(yn)!=0||(Ut=K(Ut,yn-Ut),_t===void 0?_t=Ut:(_t+="\0",_t+=Ut),Ut=yn+D)}return xr(nt),_t},toWireType:(nt,_t)=>{if(typeof _t!="string")throw new Nn(`Cannot pass non-string to C++ string type ${N}`);var Et=ye(_t),Ut=Ni(4+Et+D);return pe()[Ut>>>2>>>0]=Et/D,J(_t,Ut+4,Et+D),nt!==null&&nt.push(xr,Ut),Ut},Cb:Gs,readValueFromPointer:Ws,Db(nt){xr(nt)}})}function Me(y,D){jn(y>>>=0,{Tb:!0,name:D=Bn(D>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function z(y){Ls(y>>>0,!d,1,!u,131072,!1),Ts()}var ee=y=>{if(!ie)try{if(y(),!(0<ut))try{c?Ui($):lt($)}catch(D){D instanceof et||D=="unwind"||M(0,D)}}catch(D){D instanceof et||D=="unwind"||M(0,D)}};function de(y){y>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(G(),y>>>2,y).value.then(me),y+=128,Atomics.store(G(),y>>>2,1))}var me=()=>{var y=Bi();y&&(de(y),ee(mi))};function Oe(y,D){(y>>>=0)==D>>>0?setTimeout(me):c?postMessage({Gb:y,Bb:"checkMailbox"}):(y=It[y])&&y.postMessage({Bb:"checkMailbox"})}var Ge=[];function pt(y,D,N,K,J){for(D>>>=0,K/=2,Ge.length=K,N=J>>>0>>>3,J=0;J<K;J++)Ge[J]=ce[N+2*J]?ce[N+2*J+1]:Ie()[N+2*J+1>>>0];return(D?Ve[D]:Bl[y])(...Ge)}var gt=()=>{ut=0};function yt(y){y>>>=0,c?postMessage({Bb:"cleanupThread",hc:y}):os(It[y])}function ot(y){}var Yt=(y,D)=>{var N=js[y];if(N===void 0)throw y=Nl(y),N=Bn(y),xr(y),new Nn(`${D} has unknown type ${N}`);return N},jt=(y,D,N)=>{var K=[];return y=y.toWireType(K,N),K.length&&(pe()[D>>>2>>>0]=gs(K)),y};function An(y,D,N){return D>>>=0,N>>>=0,y=ns(y>>>0),D=Yt(D,"emval::as"),jt(D,N,y)}function Yn(y,D){return D>>>=0,y=ns(y>>>0),(D=Yt(D,"emval::as")).toWireType(null,y)}var In=y=>{try{y()}catch(D){Be(D)}},Vn=0,On=null,Ds=0,Es=[],Cs={},qs={},mn=0,ss=null,ks=[];function Ks(y){return(function(D){if(!ie){if(Vn===0){var N=!1,K=!1;D((J=0)=>{if(!ie&&(Ds=J,N=!0,K)){Vn=2,In(()=>ra(On)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),J=!1;try{var ye=(function(){var _t=G()[On+8>>>2>>>0];return _t=Ot[qs[_t]],--ut,_t()})()}catch(_t){ye=_t,J=!0}var Ue=!1;if(!On){var nt=ss;nt&&(ss=null,(J?nt.reject:nt.resolve)(ye),Ue=!0)}if(J&&!Ue)throw ye}}),K=!0,N||(Vn=1,On=(function(){var J=Ni(65548),ye=J+12;pe()[J>>>2>>>0]=ye,pe()[J+4>>>2>>>0]=ye+65536,ye=Es[0];var Ue=Cs[ye];return Ue===void 0&&(Ue=mn++,Cs[ye]=Ue,qs[Ue]=ye),ye=Ue,G()[J+8>>>2>>>0]=ye,J})(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),In(()=>Gi(On)))}else Vn===2?(Vn=0,In(_i),xr(On),On=null,ks.forEach(ee)):Be(`invalid state: ${Vn}`);return Ds}})(D=>{y().then(D)})}function ur(y){return y>>>=0,Ks(async()=>{var D=await ns(y);return gs(D)})}var rs=[];function vr(y,D,N,K){return N>>>=0,K>>>=0,(y=rs[y>>>0])(null,D=ns(D>>>0),N,K)}var _n={},gn=y=>{var D=_n[y];return D===void 0?Bn(y):D};function Zn(y,D,N,K,J){return N>>>=0,K>>>=0,J>>>=0,(y=rs[y>>>0])(D=ns(D>>>0),D[N=gn(N)],K,J)}var Gn=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Js(y){return(y>>>=0)==0?gs(Gn()):(y=gn(y),gs(Gn()[y]))}var ta=y=>{var D=rs.length;return rs.push(y),D},li=(y,D)=>{for(var N=Array(y),K=0;K<y;++K)N[K]=Yt(pe()[D+4*K>>>2>>>0],"parameter "+K);return N},wr=(y,D)=>Object.defineProperty(D,"name",{value:y});function ki(y,D,N){var K=(D=li(y,D>>>0)).shift();y--;var J=`return function (obj, func, destructorsRef, args) {
`,ye=0,Ue=[];N===0&&Ue.push("obj");for(var nt=["retType"],_t=[K],Et=0;Et<y;++Et)Ue.push("arg"+Et),nt.push("argType"+Et),_t.push(D[Et]),J+=`  var arg${Et} = argType${Et}.readValueFromPointer(args${ye?"+"+ye:""});
`,ye+=D[Et].Cb;return J+=`  var rv = ${N===1?"new func":"func.call"}(${Ue.join(", ")});
`,K.Tb||(nt.push("emval_returnValue"),_t.push(jt),J+=`  return emval_returnValue(retType, destructorsRef, rv);
`),nt.push(J+`};
`),y=(function(Ut){var Wt=Function;if(!(Wt instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Wt} which is not a function`);var yn=wr(Wt.name||"unknownFunctionName",function(){});return yn.prototype=Wt.prototype,yn=new yn,(Ut=Wt.apply(yn,Ut))instanceof Object?Ut:yn})(nt)(..._t),N=`methodCaller<(${D.map(Ut=>Ut.name).join(", ")}) => ${K.name}>`,ta(wr(N,y))}function wl(y){return y=gn(y>>>0),gs(a[y])}function nc(y,D){return D>>>=0,y=ns(y>>>0),D=ns(D),gs(y[D])}function sc(y){9<(y>>>=0)&&(Un[y+1]+=1)}function rc(){return gs([])}function na(y){y=ns(y>>>0);for(var D=Array(y.length),N=0;N<y.length;N++)D[N]=y[N];return gs(D)}function ac(y){return gs(gn(y>>>0))}function ic(){return gs({})}function oc(y){for(var D=ns(y>>>=0);D.length;){var N=D.pop();D.pop()(N)}ds(y)}function lc(y,D,N){D>>>=0,N>>>=0,y=ns(y>>>0),D=ns(D),N=ns(N),y[D]=N}function uc(y,D){return D>>>=0,y=(y=Yt(y>>>0,"_emval_take_value")).readValueFromPointer(D),gs(y)}function Pa(y,D){y=-9007199254740992>y||9007199254740992<y?NaN:Number(y),D>>>=0,y=new Date(1e3*y),G()[D>>>2>>>0]=y.getUTCSeconds(),G()[D+4>>>2>>>0]=y.getUTCMinutes(),G()[D+8>>>2>>>0]=y.getUTCHours(),G()[D+12>>>2>>>0]=y.getUTCDate(),G()[D+16>>>2>>>0]=y.getUTCMonth(),G()[D+20>>>2>>>0]=y.getUTCFullYear()-1900,G()[D+24>>>2>>>0]=y.getUTCDay(),y=(y.getTime()-Date.UTC(y.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,G()[D+28>>>2>>>0]=y}var xl=y=>y%4==0&&(y%100!=0||y%400==0),Tl=[0,31,60,91,121,152,182,213,244,274,305,335],El=[0,31,59,90,120,151,181,212,243,273,304,334];function cc(y,D){y=-9007199254740992>y||9007199254740992<y?NaN:Number(y),D>>>=0,y=new Date(1e3*y),G()[D>>>2>>>0]=y.getSeconds(),G()[D+4>>>2>>>0]=y.getMinutes(),G()[D+8>>>2>>>0]=y.getHours(),G()[D+12>>>2>>>0]=y.getDate(),G()[D+16>>>2>>>0]=y.getMonth(),G()[D+20>>>2>>>0]=y.getFullYear()-1900,G()[D+24>>>2>>>0]=y.getDay();var N=(xl(y.getFullYear())?Tl:El)[y.getMonth()]+y.getDate()-1|0;G()[D+28>>>2>>>0]=N,G()[D+36>>>2>>>0]=-60*y.getTimezoneOffset(),N=new Date(y.getFullYear(),6,1).getTimezoneOffset();var K=new Date(y.getFullYear(),0,1).getTimezoneOffset();y=0|(N!=K&&y.getTimezoneOffset()==Math.min(K,N)),G()[D+32>>>2>>>0]=y}function wo(y){y>>>=0;var D=new Date(G()[y+20>>>2>>>0]+1900,G()[y+16>>>2>>>0],G()[y+12>>>2>>>0],G()[y+8>>>2>>>0],G()[y+4>>>2>>>0],G()[y>>>2>>>0],0),N=G()[y+32>>>2>>>0],K=D.getTimezoneOffset(),J=new Date(D.getFullYear(),6,1).getTimezoneOffset(),ye=new Date(D.getFullYear(),0,1).getTimezoneOffset(),Ue=Math.min(ye,J);return 0>N?G()[y+32>>>2>>>0]=+(J!=ye&&Ue==K):0<N!=(Ue==K)&&(J=Math.max(ye,J),D.setTime(D.getTime()+6e4*((0<N?Ue:J)-K))),G()[y+24>>>2>>>0]=D.getDay(),N=(xl(D.getFullYear())?Tl:El)[D.getMonth()]+D.getDate()-1|0,G()[y+28>>>2>>>0]=N,G()[y>>>2>>>0]=D.getSeconds(),G()[y+4>>>2>>>0]=D.getMinutes(),G()[y+8>>>2>>>0]=D.getHours(),G()[y+12>>>2>>>0]=D.getDate(),G()[y+16>>>2>>>0]=D.getMonth(),G()[y+20>>>2>>>0]=D.getYear(),y=D.getTime(),BigInt(isNaN(y)?-1:y/1e3)}function xo(y,D,N,K,J,ye,Ue){return c?st(16,1,y,D,N,K,J,ye,Ue):-52}function Cl(y,D,N,K,J,ye){if(c)return st(17,1,y,D,N,K,J,ye)}var ui={},To=()=>performance.timeOrigin+performance.now();function Sl(y,D){if(c)return st(18,1,y,D);if(ui[y]&&(clearTimeout(ui[y].id),delete ui[y]),!D)return 0;var N=setTimeout(()=>{delete ui[y],ee(()=>Ao(y,performance.timeOrigin+performance.now()))},D);return ui[y]={id:N,qc:D},0}function Pl(y,D,N,K){y>>>=0,D>>>=0,N>>>=0,K>>>=0;var J=new Date().getFullYear(),ye=new Date(J,0,1).getTimezoneOffset();J=new Date(J,6,1).getTimezoneOffset();var Ue=Math.max(ye,J);pe()[y>>>2>>>0]=60*Ue,G()[D>>>2>>>0]=+(ye!=J),y=(D=nt=>{var _t=Math.abs(nt);return`UTC${0<=nt?"-":"+"}${String(Math.floor(_t/60)).padStart(2,"0")}${String(_t%60).padStart(2,"0")}`})(ye),D=D(J),J<ye?(ue(y,N,17),ue(D,K,17)):(ue(y,K,17),ue(D,N,17))}var dc=()=>Date.now();function Al(y,D,N){return 0<=y&&3>=y?(y===0?y=Date.now():y=performance.timeOrigin+performance.now(),ce[N>>>0>>>3]=BigInt(Math.round(1e6*y)),0):28}var Ol=[],$l=(y,D)=>{Ol.length=0;for(var N;N=j()[y++>>>0];){var K=N!=105;D+=(K&=N!=112)&&D%8?4:0,Ol.push(N==112?pe()[D>>>2>>>0]:N==106?ce[D>>>3]:N==105?G()[D>>>2>>>0]:Ie()[D>>>3>>>0]),D+=K?8:4}return Ol};function Dl(y,D,N){return y>>>=0,D=$l(D>>>0,N>>>0),Ve[y](...D)}function kl(y,D,N){return y>>>=0,D=$l(D>>>0,N>>>0),Ve[y](...D)}var Eo=()=>{};function Co(y,D){return L(xn(y>>>0,D>>>0))}var ci=()=>{throw ut+=1,"unwind"};function fc(){return 4294901760}var Ll=()=>navigator.hardwareConcurrency;function Il(){return Be("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function zl(y){y>>>=0;var D=j().length;if(y<=D||4294901760<y)return!1;for(var N=1;4>=N;N*=2){var K=D*(1+.2/N);K=Math.min(K,y+100663296);e:{K=(Math.min(4294901760,65536*Math.ceil(Math.max(y,K)/65536))-O.buffer.byteLength+65535)/65536|0;try{O.grow(K),je();var J=1;break e}catch{}J=void 0}if(J)return!0}return!1}var di=()=>(Be("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Aa={},Br=y=>{y.forEach(D=>{di()})};function pc(){var y=Error().stack.toString().split(`
`);return y[0]=="Error"&&y.shift(),Br(y),Aa.Lb=di(),Aa.cc=y,Aa.Lb}function So(y,D,N){if(y>>>=0,D>>>=0,Aa.Lb==y)var K=Aa.cc;else(K=Error().stack.toString().split(`
`))[0]=="Error"&&K.shift(),Br(K);for(var J=3;K[J]&&di()!=y;)++J;for(y=0;y<N&&K[y+J];++y)G()[D+4*y>>>2>>>0]=di();return y}var Li,Ii={},zi=()=>{if(!Li){var y,D={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(y in Ii)Ii[y]===void 0?delete D[y]:D[y]=Ii[y];var N=[];for(y in D)N.push(`${y}=${D[y]}`);Li=N}return Li};function cr(y,D){if(c)return st(19,1,y,D);y>>>=0,D>>>=0;var N=0;return zi().forEach((K,J)=>{var ye=D+N;for(J=pe()[y+4*J>>>2>>>0]=ye,ye=0;ye<K.length;++ye)q()[J++>>>0]=K.charCodeAt(ye);q()[J>>>0]=0,N+=K.length+1}),0}function Oa(y,D){if(c)return st(20,1,y,D);y>>>=0,D>>>=0;var N=zi();pe()[y>>>2>>>0]=N.length;var K=0;return N.forEach(J=>K+=J.length+1),pe()[D>>>2>>>0]=K,0}function hc(y){return c?st(21,1,y):52}function fi(y,D,N,K){return c?st(22,1,y,D,N,K):52}function Fl(y,D,N,K){return c?st(23,1,y,D,N,K):70}var Rl=[null,[],[]];function pi(y,D,N,K){if(c)return st(24,1,y,D,N,K);D>>>=0,N>>>=0,K>>>=0;for(var J=0,ye=0;ye<N;ye++){var Ue=pe()[D>>>2>>>0],nt=pe()[D+4>>>2>>>0];D+=8;for(var _t=0;_t<nt;_t++){var Et=j()[Ue+_t>>>0],Ut=Rl[y];Et===0||Et===10?((y===1?T:L)(zr(Ut)),Ut.length=0):Ut.push(Et)}J+=nt}return pe()[K>>>2>>>0]=J,0}c||(function(){for(var y=a.numThreads-1;y--;)Zs();Re.unshift(()=>{te++,(function(D){c?D():Promise.all(bt.map(Os)).then(D)})(()=>Xe())})})();for(var Fi=Array(256),hi=0;256>hi;++hi)Fi[hi]=String.fromCharCode(hi);dn=Fi,Nn=a.BindingError=class extends Error{constructor(y){super(y),this.name="BindingError"}},a.InternalError=class extends Error{constructor(y){super(y),this.name="InternalError"}},Un.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=()=>Un.length/2-5-lr.length;var Ot,Bl=[mt,ct,br,qt,Fr,Y,le,he,Se,He,Mt,Ct,ft,Xt,Kt,qn,xo,Cl,Sl,cr,Oa,hc,fi,Fl,pi];(async function(){function y(K,J){return Ot=K.exports,Ot=(function(){var ye=Ot,Ue={};for(let[nt,_t]of Object.entries(ye))Ue[nt]=typeof _t=="function"?(...Et)=>{Es.push(nt);try{return _t(...Et)}finally{ie||(Es.pop(),On&&Vn===1&&Es.length===0&&(Vn=0,ut+=1,In(Nr),typeof Fibers<"u"&&Fibers.rc()))}}:_t;return Ue})(),Ot=(function(){var ye=Ot,Ue=_t=>Et=>_t(Et)>>>0,nt=_t=>()=>_t()>>>0;return(ye=Object.assign({},ye)).Da=Ue(ye.Da),ye.fb=nt(ye.fb),ye.hb=Ue(ye.hb),ye.tb=Ue(ye.tb),ye.ub=nt(ye.ub),ye.__cxa_get_exception_ptr=Ue(ye.__cxa_get_exception_ptr),ye})(),un.push(Ot.ib),S=J,Xe(),Ot}te++;var D=Ee();if(a.instantiateWasm)return new Promise(K=>{a.instantiateWasm(D,(J,ye)=>{y(J,ye),K(J.exports)})});if(c)return new Promise(K=>{Ne=J=>{var ye=new WebAssembly.Instance(J,Ee());K(y(ye,J))}});ve??=a.locateFile?a.locateFile?a.locateFile("ort-wasm-simd-threaded.jsep.wasm",x):x+"ort-wasm-simd-threaded.jsep.wasm":new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href;try{var N=await(async function(K){var J=ve;if(!se&&typeof WebAssembly.instantiateStreaming=="function"&&!ge(J))try{var ye=fetch(J,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(ye,K)}catch(Ue){L(`wasm streaming compile failed: ${Ue}`),L("falling back to ArrayBuffer instantiation")}return(async function(Ue,nt){try{var _t=await(async function(Et){if(!se)try{var Ut=await _(Et);return new Uint8Array(Ut)}catch{}if(Et==ve&&se)Et=new Uint8Array(se);else{if(!h)throw"both async and sync fetching of the wasm failed";Et=h(Et)}return Et})(Ue);return await WebAssembly.instantiate(_t,nt)}catch(Et){L(`failed to asynchronously prepare wasm: ${Et}`),Be(Et)}})(J,K)})(D);return y(N.instance,N.module)}catch(K){return n(K),Promise.reject(K)}})();var Nl=y=>(Nl=Ot.Da)(y),Ri=()=>(Ri=Ot.Ea)();a._OrtInit=(y,D)=>(a._OrtInit=Ot.Fa)(y,D),a._OrtGetLastError=(y,D)=>(a._OrtGetLastError=Ot.Ga)(y,D),a._OrtCreateSessionOptions=(y,D,N,K,J,ye,Ue,nt,_t,Et)=>(a._OrtCreateSessionOptions=Ot.Ha)(y,D,N,K,J,ye,Ue,nt,_t,Et),a._OrtAppendExecutionProvider=(y,D,N,K,J)=>(a._OrtAppendExecutionProvider=Ot.Ia)(y,D,N,K,J),a._OrtAddFreeDimensionOverride=(y,D,N)=>(a._OrtAddFreeDimensionOverride=Ot.Ja)(y,D,N),a._OrtAddSessionConfigEntry=(y,D,N)=>(a._OrtAddSessionConfigEntry=Ot.Ka)(y,D,N),a._OrtReleaseSessionOptions=y=>(a._OrtReleaseSessionOptions=Ot.La)(y),a._OrtCreateSession=(y,D,N)=>(a._OrtCreateSession=Ot.Ma)(y,D,N),a._OrtReleaseSession=y=>(a._OrtReleaseSession=Ot.Na)(y),a._OrtGetInputOutputCount=(y,D,N)=>(a._OrtGetInputOutputCount=Ot.Oa)(y,D,N),a._OrtGetInputOutputMetadata=(y,D,N,K)=>(a._OrtGetInputOutputMetadata=Ot.Pa)(y,D,N,K),a._OrtFree=y=>(a._OrtFree=Ot.Qa)(y),a._OrtCreateTensor=(y,D,N,K,J,ye)=>(a._OrtCreateTensor=Ot.Ra)(y,D,N,K,J,ye),a._OrtGetTensorData=(y,D,N,K,J)=>(a._OrtGetTensorData=Ot.Sa)(y,D,N,K,J),a._OrtReleaseTensor=y=>(a._OrtReleaseTensor=Ot.Ta)(y),a._OrtCreateRunOptions=(y,D,N,K)=>(a._OrtCreateRunOptions=Ot.Ua)(y,D,N,K),a._OrtAddRunConfigEntry=(y,D,N)=>(a._OrtAddRunConfigEntry=Ot.Va)(y,D,N),a._OrtReleaseRunOptions=y=>(a._OrtReleaseRunOptions=Ot.Wa)(y),a._OrtCreateBinding=y=>(a._OrtCreateBinding=Ot.Xa)(y),a._OrtBindInput=(y,D,N)=>(a._OrtBindInput=Ot.Ya)(y,D,N),a._OrtBindOutput=(y,D,N,K)=>(a._OrtBindOutput=Ot.Za)(y,D,N,K),a._OrtClearBoundOutputs=y=>(a._OrtClearBoundOutputs=Ot._a)(y),a._OrtReleaseBinding=y=>(a._OrtReleaseBinding=Ot.$a)(y),a._OrtRunWithBinding=(y,D,N,K,J)=>(a._OrtRunWithBinding=Ot.ab)(y,D,N,K,J),a._OrtRun=(y,D,N,K,J,ye,Ue,nt)=>(a._OrtRun=Ot.bb)(y,D,N,K,J,ye,Ue,nt),a._OrtEndProfiling=y=>(a._OrtEndProfiling=Ot.cb)(y),a._JsepOutput=(y,D,N)=>(a._JsepOutput=Ot.db)(y,D,N),a._JsepGetNodeName=y=>(a._JsepGetNodeName=Ot.eb)(y);var Bi=()=>(Bi=Ot.fb)(),xr=a._free=y=>(xr=a._free=Ot.gb)(y),Ni=a._malloc=y=>(Ni=a._malloc=Ot.hb)(y),Ls=(y,D,N,K,J,ye)=>(Ls=Ot.kb)(y,D,N,K,J,ye),$a=()=>($a=Ot.lb)(),Po=(y,D,N,K,J)=>(Po=Ot.mb)(y,D,N,K,J),ji=y=>(ji=Ot.nb)(y),Ui=y=>(Ui=Ot.ob)(y),Ao=(y,D)=>(Ao=Ot.pb)(y,D),mi=()=>(mi=Ot.qb)(),jl=(y,D)=>(jl=Ot.rb)(y,D),Or=y=>(Or=Ot.sb)(y),Da=y=>(Da=Ot.tb)(y),sa=()=>(sa=Ot.ub)(),Vi=a.dynCall_ii=(y,D)=>(Vi=a.dynCall_ii=Ot.vb)(y,D),Gi=y=>(Gi=Ot.wb)(y),Nr=()=>(Nr=Ot.xb)(),ra=y=>(ra=Ot.yb)(y),_i=()=>(_i=Ot.zb)();return a.stackSave=()=>sa(),a.stackRestore=y=>Or(y),a.stackAlloc=y=>Da(y),a.setValue=function(y,D,N="i8"){switch(N.endsWith("*")&&(N="*"),N){case"i1":case"i8":q()[y>>>0]=D;break;case"i16":R()[y>>>1>>>0]=D;break;case"i32":G()[y>>>2>>>0]=D;break;case"i64":ce[y>>>3]=BigInt(D);break;case"float":Te()[y>>>2>>>0]=D;break;case"double":Ie()[y>>>3>>>0]=D;break;case"*":pe()[y>>>2>>>0]=D;break;default:Be(`invalid type for setValue: ${N}`)}},a.getValue=function(y,D="i8"){switch(D.endsWith("*")&&(D="*"),D){case"i1":case"i8":return q()[y>>>0];case"i16":return R()[y>>>1>>>0];case"i32":return G()[y>>>2>>>0];case"i64":return ce[y>>>3];case"float":return Te()[y>>>2>>>0];case"double":return Ie()[y>>>3>>>0];case"*":return pe()[y>>>2>>>0];default:Be(`invalid type for getValue: ${D}`)}},a.UTF8ToString=xn,a.stringToUTF8=ue,a.lengthBytesUTF8=I,(function y(){if(0<te)De=y;else if(c)r(a),oe();else{for(;0<Re.length;)Re.shift()(a);0<te?De=y:(a.calledRun=!0,ie||(oe(),r(a)))}})(),a.PTR_SIZE=4,o}),Eb=Ym,yg=globalThis.self?.name?.startsWith("em-pthread"),yg&&Ym()}),Zm,K_,bg,Qr,Cb,Kh,Mg,vg,Jm,wg,e_,Sb,t_,Pb,m1=at(()=>{h1(),Zm=typeof location>"u"?void 0:location.origin,K_=import.meta.url>"file:"&&import.meta.url<"file;",bg=()=>{{if(K_){let t=URL;return new URL(new t("ort.bundle.min.mjs",import.meta.url).href,Zm).href}return import.meta.url}},Qr=bg(),Cb=()=>{if(Qr&&!Qr.startsWith("blob:"))return Qr.substring(0,Qr.lastIndexOf("/")+1)},Kh=(t,r)=>{try{let n=r??Qr;return(n?new URL(t,n):new URL(t)).origin===Zm}catch{return!1}},Mg=(t,r)=>{let n=r??Qr;try{return(n?new URL(t,n):new URL(t)).href}catch{return}},vg=(t,r)=>`${r??"./"}${t}`,Jm=async t=>{let r=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(r)},wg=async t=>(await import(t)).default,e_=(n3(),Kp(wb)).default,Sb=async()=>{if(!Qr)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Kh(Qr))return[void 0,e_()];let t=await Jm(Qr);return[t,e_(t)]},t_=(s3(),Kp(Tb)).default,Pb=async(t,r,n)=>{if(!t&&!r&&t_&&Qr&&Kh(Qr))return[void 0,t_];{let a="ort-wasm-simd-threaded.jsep.mjs",o=t??Mg(a,r),u=n&&o&&!Kh(o,r),d=u?await Jm(o):o??vg(a,r);return[u?d:void 0,await wg(d)]}}}),n_,Qh,Lp,s_,xg,Tg,Eg,_1,Xn,ec=at(()=>{m1(),Qh=!1,Lp=!1,s_=!1,xg=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Tg=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Eg=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},_1=async t=>{if(Qh)return Promise.resolve();if(Lp)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(s_)throw new Error("previous call to 'initializeWebAssembly()' failed.");Lp=!0;let r=t.initTimeout,n=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!Eg())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Tg())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let a=xg();n>1&&!a&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=n=1);let o=t.wasmPaths,u=typeof o=="string"?o:void 0,d=o?.mjs,c=d?.href??d,f=o?.wasm,p=f?.href??f,g=t.wasmBinary,[_,h]=await Pb(c,u,n>1),w=!1,M=[];if(r>0&&M.push(new Promise(x=>{setTimeout(()=>{w=!0,x()},r)})),M.push(new Promise((x,F)=>{let E={numThreads:n};if(g)E.wasmBinary=g;else if(p||u)E.locateFile=T=>p??u+T;else if(c&&c.indexOf("blob:")!==0)E.locateFile=T=>new URL(T,c).href;else if(_){let T=Cb();T&&(E.locateFile=L=>T+L)}h(E).then(T=>{Lp=!1,Qh=!0,n_=T,x(),_&&URL.revokeObjectURL(_)},T=>{Lp=!1,s_=!0,F(T)})})),await Promise.race(M),w)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},Xn=()=>{if(Qh&&n_)return n_;throw new Error("WebAssembly is not initialized yet.")}}),ei,fm,Fn,g1=at(()=>{ec(),ei=(t,r)=>{let n=Xn(),a=n.lengthBytesUTF8(t)+1,o=n._malloc(a);return n.stringToUTF8(t,o,a),r.push(o),o},fm=(t,r,n,a)=>{if(typeof t=="object"&&t!==null){if(n.has(t))throw new Error("Circular reference in options");n.add(t)}Object.entries(t).forEach(([o,u])=>{let d=r?r+o:o;if(typeof u=="object")fm(u,d+".",n,a);else if(typeof u=="string"||typeof u=="number")a(d,u.toString());else if(typeof u=="boolean")a(d,u?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof u}`)})},Fn=t=>{let r=Xn(),n=r.stackSave();try{let a=r.PTR_SIZE,o=r.stackAlloc(2*a);r._OrtGetLastError(o,o+a);let u=Number(r.getValue(o,a===4?"i32":"i64")),d=r.getValue(o+a,"*"),c=d?r.UTF8ToString(d):"";throw new Error(`${t} ERROR_CODE: ${u}, ERROR_MESSAGE: ${c}`)}finally{r.stackRestore(n)}}}),Ab,r3=at(()=>{ec(),g1(),Ab=t=>{let r=Xn(),n=0,a=[],o=t||{};try{if(t?.logSeverityLevel===void 0)o.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(t?.logVerbosityLevel===void 0)o.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);t?.terminate===void 0&&(o.terminate=!1);let u=0;return t?.tag!==void 0&&(u=ei(t.tag,a)),n=r._OrtCreateRunOptions(o.logSeverityLevel,o.logVerbosityLevel,!!o.terminate,u),n===0&&Fn("Can't create run options."),t?.extra!==void 0&&fm(t.extra,"",new WeakSet,(d,c)=>{let f=ei(d,a),p=ei(c,a);r._OrtAddRunConfigEntry(n,f,p)!==0&&Fn(`Can't set a run config entry: ${d} - ${c}.`)}),[n,a]}catch(u){throw n!==0&&r._OrtReleaseRunOptions(n),a.forEach(d=>r._free(d)),u}}}),Cg,Sg,Pg,Ip,Ag,Ob,a3=at(()=>{ec(),g1(),Cg=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},Sg=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},Pg=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let r=t.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(t.enableMemPattern=!1)},Ip=(t,r,n,a)=>{let o=ei(r,a),u=ei(n,a);Xn()._OrtAddSessionConfigEntry(t,o,u)!==0&&Fn(`Can't set a session config entry: ${r} - ${n}.`)},Ag=async(t,r,n)=>{for(let a of r){let o=typeof a=="string"?a:a.name,u=[];switch(o){case"webnn":if(o="WEBNN",typeof a!="string"){let g=a?.deviceType;g&&Ip(t,"deviceType",g,n)}break;case"webgpu":if(o="JS",typeof a!="string"){let g=a;if(g?.preferredLayout){if(g.preferredLayout!=="NCHW"&&g.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${g.preferredLayout}`);Ip(t,"preferredLayout",g.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${o}`)}let d=ei(o,n),c=u.length,f=0,p=0;if(c>0){f=Xn()._malloc(c*Xn().PTR_SIZE),n.push(f),p=Xn()._malloc(c*Xn().PTR_SIZE),n.push(p);for(let g=0;g<c;g++)Xn().setValue(f+g*Xn().PTR_SIZE,u[g][0],"*"),Xn().setValue(p+g*Xn().PTR_SIZE,u[g][1],"*")}await Xn()._OrtAppendExecutionProvider(t,d,f,p,c)!==0&&Fn(`Can't append execution provider: ${o}.`)}},Ob=async t=>{let r=Xn(),n=0,a=[],o=t||{};Pg(o);try{let u=Cg(o.graphOptimizationLevel??"all"),d=Sg(o.executionMode??"sequential"),c=typeof o.logId=="string"?ei(o.logId,a):0,f=o.logSeverityLevel??2;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log serverity level is not valid: ${f}`);let p=o.logVerbosityLevel??0;if(!Number.isInteger(p)||p<0||p>4)throw new Error(`log verbosity level is not valid: ${p}`);let g=typeof o.optimizedModelFilePath=="string"?ei(o.optimizedModelFilePath,a):0;if(n=r._OrtCreateSessionOptions(u,!!o.enableCpuMemArena,!!o.enableMemPattern,d,!!o.enableProfiling,0,c,f,p,g),n===0&&Fn("Can't create session options."),o.executionProviders&&await Ag(n,o.executionProviders,a),o.enableGraphCapture!==void 0){if(typeof o.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${o.enableGraphCapture}`);Ip(n,"enableGraphCapture",o.enableGraphCapture.toString(),a)}if(o.freeDimensionOverrides)for(let[_,h]of Object.entries(o.freeDimensionOverrides)){if(typeof _!="string")throw new Error(`free dimension override name must be a string: ${_}`);if(typeof h!="number"||!Number.isInteger(h)||h<0)throw new Error(`free dimension override value must be a non-negative integer: ${h}`);let w=ei(_,a);r._OrtAddFreeDimensionOverride(n,w,h)!==0&&Fn(`Can't set a free dimension override: ${_} - ${h}.`)}return o.extra!==void 0&&fm(o.extra,"",new WeakSet,(_,h)=>{Ip(n,_,h,a)}),[n,a]}catch(u){throw n!==0&&r._OrtReleaseSessionOptions(n)!==0&&Fn("Can't release session options."),a.forEach(d=>r._free(d)),u}}}),Od,Mo,Qu,y1,pm,b1,M1,Q_,Nt=at(()=>{Od=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},Mo=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},Qu=(t,r)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],a=typeof r=="number"?r:r.reduce((o,u)=>o*u,1);return n>0?Math.ceil(a*n):void 0},y1=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},pm=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},b1=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",M1=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Q_=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),v1,$b=at(()=>{h1(),v1=async t=>{if(typeof t=="string"){let r=await fetch(t);if(!r.ok)throw new Error(`failed to load external data file: ${t}`);let n=r.headers.get("Content-Length"),a=n?parseInt(n,10):0;if(a<1073741824)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let o=r.body.getReader(),u;try{u=new ArrayBuffer(a)}catch(c){if(c instanceof RangeError){let f=Math.ceil(a/65536);u=new WebAssembly.Memory({initial:f,maximum:f}).buffer}else throw c}let d=0;for(;;){let{done:c,value:f}=await o.read();if(c)break;let p=f.byteLength;new Uint8Array(u,d,p).set(f),d+=p}return new Uint8Array(u,0,a)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),Og,$g,Dg,kg,w1,Lg,hn,vo=at(()=>{Nt(),Og=["V","I","W","E","F"],$g=(t,r)=>{console.log(`[${Og[t]},${new Date().toISOString()}]${r}`)},w1=(t,r)=>{Dg=t,kg=r},Lg=(t,r)=>{let n=pm(t),a=pm(Dg);n>=a&&$g(n,typeof r=="function"?r():r)},hn=(...t)=>{kg&&Lg(...t)}}),Ig,Ld,Fe,hm,Db,kb,Lb,tn=at(()=>{Ig=class{static calcMatMulShape(t,r){return t[1]!==r[0]?void 0:[t[0],r[1]]}},Ld=class{static calcShape(t,r,n=!1){let a=t.length,o=r.length;if(a===0)return r;if(o===0)return t;let u=Math.max(t.length,r.length),d=new Array(u);if(n){if(a<2||o<2)return;let c=Ig.calcMatMulShape([t[a-2],t[a-1]],[r[o-2],r[o-1]]);if(c===void 0)return;[d[u-2],d[u-1]]=c}for(let c=n?3:1;c<=u;c++){let f=a-c<0?1:t[a-c],p=o-c<0?1:r[o-c];if(f!==p&&f>1&&p>1)return;let g=Math.max(f,p);if(f&&p)d[u-c]=Math.max(f,p);else{if(g>1)return;d[u-c]=0}}return d}static isValidBroadcast(t,r){let n=t.length,a=r.length;if(n>a)return!1;for(let o=1;o<=n;o++)if(t[n-o]!==1&&t[n-o]!==r[a-o])return!1;return!0}},Fe=class cm{static size(r){return cm.getSizeFromDimensionRange(r,0,r.length)}static convertShape(r,n=4){let a=r.length;if(a===0)return[];let o=new Array(a),u=a-1;for(;u>=0;){if(r[u]%n===0){o[u]=r[u]/n;break}if(n%r[u]!==0)throw new Error("cannot convert shape");o[u]=1,n/=r[u],u--}for(u--;u>=0;u--)o[u]=r[u];return o}static sizeFromDimension(r,n){if(n<0||n>r.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${r.length} dimensions.`);return cm.getSizeFromDimensionRange(r,n,r.length)}static sizeToDimension(r,n){if(n<0||n>r.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${r.length} dimensions.`);return cm.getSizeFromDimensionRange(r,0,n)}static getSizeFromDimensionRange(r,n,a){let o=1;for(let u=n;u<a;u++){if(r[u]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");o*=Number(r[u])}return o}static computeStrides(r){let n=r.length;if(n===0)return[];if(n===1)return[1];let a=new Array(n);a[n-1]=1,a[n-2]=r[n-1];for(let o=n-3;o>=0;--o)a[o]=a[o+1]*r[o+1];return a}static normalizeAxis(r,n){if(r<-n&&r>=n)throw new Error("unsupported axis for this operation.");return r<0?r+n:r}static normalizeAxes(r,n){return r.map(a=>this.normalizeAxis(a,n??r.length))}static sortBasedOnPerm(r,n){return n?n.map(a=>r[a]):r.slice().reverse()}static padShape(r,n){let a=r.length;return r.map((o,u)=>o+n[u]+n[u+a])}static areEqual(r,n){return r.length!==n.length?!1:r.every((a,o)=>a===n[o])}},hm=class Gp{static adjustPoolAttributes(r,n,a,o,u,d){if(!r&&a.length!==n.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(r)for(let c=0;c<n.length-2;c++)c>=a.length?a.push(n[c+2]):a[c]=n[c+2];for(let c=0;c<a.length;c++)if(c<o.length){if(o[c]<0)throw new Error("strides should be greater than or equal to 1")}else o.push(1);for(let c=0;c<a.length;c++)if(c<u.length){if(u[c]<0)throw new Error("dilations should be greater than or equal to 1")}else u.push(1);for(let c=0;c<a.length*2;c++)if(c<d.length){if(d[c]<0)throw new Error("pad should be greater than or equal to 1")}else d.push(0);for(let c=0;c<a.length;c++){if(a[c]<=0)throw new Error("kernel shapes need to be greater than 0");if(d[c]>=a[c]||d[c+a.length]>=a[c])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(r,n,a,o,u,d,c){if(c){if(u.length!==2*(r.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==r.length-2)throw new Error("length of strides should be the length of data dimensions");if(o.length!==r.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let f=0;f<r.length-2;f++)Gp.adjustPadAndReturnShape(r[f+(d?1:2)],n[f],a[f],o[f],u,f,f+r.length-2,c)}}static computePoolOutputShape(r,n,a,o,u,d,c){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let f=[n[0],n[1]];return Gp.computeShapeHelper(r,n,f,a,o,u,d,c),f}static computeConvOutputShape(r,n,a,o,u,d,c){if(r.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let f=[r[0],n[0]];return Gp.computeShapeHelper(!1,r,f,a,o,u,d,c),f}static computeShapeHelper(r,n,a,o,u,d,c,f){if(r)for(let p=0;p<n.length-2;p++)a.push(1);else for(let p=0;p<n.length-2;p++)a.push(Gp.adjustPadAndReturnShape(n[p+2],o[p],u[p],d[p],c,p,p+n.length-2,f))}static adjustPadAndReturnShape(r,n,a,o,u,d,c,f){let p=a*(o-1)+1;if(f&&f!=="NOTSET")switch(f){case"VALID":return u[d]=0,u[c]=0,Math.floor((r-p)/n+1);case"SAME_LOWER":case"SAME_UPPER":if(a!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let g=((r+n-1)/n-1)*n+o-r;return u[d]=Math.floor(f==="SAME_LOWER"?(g+1)/2:g/2),u[c]=g-u[d],Math.floor((r+g-o)/n+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((r+u[d]+u[c]-p)/n+1)}},Db=class{static getShapeOfGemmResult(t,r,n,a,o){if(t.length!==2||n.length!==2)throw new Error("shape need to be of size 2");let u,d,c;r?(u=t[1],d=t[0]):(u=t[0],d=t[1]);let f=-1;if(a?(c=n[0],f=1):(c=n[1],f=0),n[f]!==d)throw new Error("dimension mismatch");if(u<=0||c<=0||d<=0)throw new Error("invalid shape specified");if(o&&!Ld.isValidBroadcast(o,[u,c]))throw new Error("gemm: invalid bias shape for broadcast");return[u,c,d]}},kb=-34028234663852886e22,Lb=34028234663852886e22}),x1,Ib=at(()=>{Nt(),x1=(t,r)=>new(y1(r))(t)}),X_,r_,zg,a_,Fg,i_,o_,l_,Rg,zb,i3=at(()=>{vo(),X_=(t,r=!0)=>{if(t.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let n=t.byteLength/8,a=new BigInt64Array(t.buffer,t.byteOffset,n),o=new Int32Array(n);for(let u=0;u<n;u++){let d=a[u];if(d>2147483647n||d<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${u}: ${d}`);o[u]=Number(d)}return r?new Uint8Array(o.buffer):o},r_=(t,r=!0)=>{if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let n=t.byteLength/4,a=new Int32Array(t.buffer,t.byteOffset,n),o=BigInt64Array.from(a,BigInt);return r?new Uint8Array(o.buffer):o},zg=1,a_=()=>zg++,Fg=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),i_=(t,r)=>{let n=Fg.get(t);if(!n)throw new Error("Unsupported data type.");return r.length>0?Math.ceil(r.reduce((a,o)=>a*o)*n/8):0},o_=class{constructor(t){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:r,context:n,tensor:a,dataType:o,shape:u,shouldConvertInt64toInt32:d=!1}=t;this.sessionId=r,this.mlContext=n,this.mlTensor=a,this.dataType=o,this.tensorShape=u,this.shouldConvertInt64toInt32=d}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return i_(this.dataType,this.tensorShape)}destroy(){hn("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t,r){if(t){let n=await this.mlContext.readTensor(this.mlTensor),a=r_(new Uint8Array(n));if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(a);return}else return a.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,r,n){return this.mlContext===t&&this.dataType===r&&this.tensorShape.length===n.length&&this.tensorShape.every((a,o)=>a===n[o])}setIsInt64ToInt32Converted(t){this.isInt64ToInt32Converted=t}},l_=class{constructor(t,r){this.tensorManager=t,this.wrapper=r}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,r,n,a){let o=r,u=this.tensorManager.getMLContext(t),d=o==="int64"&&!u.opSupportLimits().input.dataTypes.includes("int64");if(d&&(o="int32",hn("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(u,o,n))return this.wrapper.tensor;if(a){if(this.wrapper.byteLength!==i_(o,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let c=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,o,n,c,!0,!0,d),a&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let r=t;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(r=X_(t,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),r.byteLength===this.wrapper.byteLength){this.wrapper.write(r);return}else hn("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(r):this.activeUpload=new Uint8Array(r)}async download(t){if(this.activeUpload){let r=this.wrapper?.isInt64ToInt32Converted?r_(this.activeUpload):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(r):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(r);return}else return r.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(this.wrapper?.shouldConvertInt64toInt32,t):this.wrapper.read(this.wrapper?.shouldConvertInt64toInt32)}},Rg=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let r=this.backend.getMLContext(t);if(!r)throw new Error("MLContext not found for session.");return r}reserveTensorId(){let t=a_();return this.tensorTrackersById.set(t,new l_(this)),t}releaseTensorId(t){let r=this.tensorTrackersById.get(t);r&&(this.tensorTrackersById.delete(t),r.tensorWrapper&&this.releaseTensor(r.tensorWrapper))}async ensureTensor(t,r,n,a,o){hn("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${r}, dataType: ${n}, shape: ${a}, copyOld: ${o}}`);let u=this.tensorTrackersById.get(r);if(!u)throw new Error("Tensor not found.");return u.ensureTensor(t,n,a,o)}upload(t,r){let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");n.upload(r)}async download(t,r){hn("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${r?.byteLength}}`);let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");return n.download(r)}releaseTensorsForSession(t){for(let r of this.freeTensors)r.sessionId===t&&r.destroy();this.freeTensors=this.freeTensors.filter(r=>r.sessionId!==t)}registerTensor(t,r,n,a){let o=this.getMLContext(t),u=a_(),d=new o_({sessionId:t,context:o,tensor:r,dataType:n,shape:a});return this.tensorTrackersById.set(u,new l_(this,d)),this.externalTensors.add(d),u}async getCachedTensor(t,r,n,a,o,u,d=!1){let c=this.getMLContext(t);for(let[p,g]of this.freeTensors.entries())if(g.canReuseTensor(c,r,n)){hn("verbose",()=>`[WebNN] Reusing tensor {dataType: ${r}, shape: ${n}}`);let _=this.freeTensors.splice(p,1)[0];return _.sessionId=t,_}hn("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${r}, shape: ${n}}`);let f=await c.createTensor({dataType:r,shape:n,dimensions:n,usage:a,writable:o,readable:u});return new o_({sessionId:t,context:c,tensor:f,dataType:r,shape:n,shouldConvertInt64toInt32:d})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},zb=(...t)=>new Rg(...t)}),Xh,Bg,Fb,o3=at(()=>{Nt(),ec(),Ib(),i3(),vo(),Xh=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Bg=(t,r)=>{if(t===r)return!0;if(t===void 0||r===void 0)return!1;let n=Object.keys(t).sort(),a=Object.keys(r).sort();return n.length===a.length&&n.every((o,u)=>o===a[u]&&t[o]===r[o])},Fb=class{constructor(t){this.tensorManager=zb(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,w1(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){hn("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){hn("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let r=this.temporarySessionTensorIds.get(t);if(r){for(let n of r)hn("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let n=this.mlContextCache.findIndex(a=>a.gpuDevice===t);if(n!==-1)return this.mlContextCache[n].mlContext;{let a=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:a}),a}}else if(t===void 0){let n=this.mlContextCache.findIndex(a=>a.options===void 0&&a.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let a=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:a}),a}}let r=this.mlContextCache.findIndex(n=>Bg(n.options,t));if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:n}),n}}registerMLContext(t,r){this.mlContextBySessionId.set(t,r);let n=this.sessionIdsByMLContext.get(r);n||(n=new Set,this.sessionIdsByMLContext.set(r,n)),n.add(t),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t);let r=this.mlContextBySessionId.get(t);if(!r)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t);let n=this.sessionIdsByMLContext.get(r);if(n.delete(t),n.size===0){this.sessionIdsByMLContext.delete(r);let a=this.mlContextCache.findIndex(o=>o.mlContext===r);a!==-1&&this.mlContextCache.splice(a,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){hn("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,r,n,a,o){let u=Xh.get(n);if(!u)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,r,u,a,o)}async createTemporaryTensor(t,r,n){hn("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${r}, shape: ${n}}`);let a=Xh.get(r);if(!a)throw new Error(`Unsupported ONNX data type: ${r}`);let o=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,o,a,n,!1);let u=this.temporarySessionTensorIds.get(t);return u?u.push(o):this.temporarySessionTensorIds.set(t,[o]),o}uploadTensor(t,r){if(!Xn().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");hn("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${r.byteLength}}`),this.tensorManager.upload(t,r)}async downloadTensor(t,r){return this.tensorManager.download(t,r)}createMLTensorDownloader(t,r){return async()=>{let n=await this.tensorManager.download(t);return x1(n,r)}}registerMLTensor(t,r,n,a){let o=Xh.get(n);if(!o)throw new Error(`Unsupported ONNX data type: ${n}`);let u=this.tensorManager.registerTensor(t,r,o,a);return hn("verbose",()=>`[WebNN] registerMLTensor {tensor: ${r}, dataType: ${o}, dimensions: ${a}} -> {tensorId: ${u}}`),u}registerMLConstant(t,r,n,a,o,u,d=!1){if(!u)throw new Error("External mounted files are not available.");let c=t;t.startsWith("./")&&(c=t.substring(2));let f=u.get(c);if(!f)throw new Error(`File with name ${c} not found in preloaded files.`);if(r+n>f.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let p=f.slice(r,r+n).buffer,g;switch(o.dataType){case"float32":g=new Float32Array(p);break;case"float16":g=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(p):new Uint16Array(p);break;case"int32":g=new Int32Array(p);break;case"uint32":g=new Uint32Array(p);break;case"int64":d?(g=X_(new Uint8Array(p),!1),o.dataType="int32"):g=new BigInt64Array(p);break;case"uint64":g=new BigUint64Array(p);break;case"int8":g=new Int8Array(p);break;case"int4":case"uint4":case"uint8":g=new Uint8Array(p);break;default:throw new Error(`Unsupported data type: ${o.dataType} in creating WebNN Constant from external data.`)}return hn("verbose",()=>`[WebNN] registerMLConstant {dataType: ${o.dataType}, shape: ${o.shape}}} ${d?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),a.constant(o,g)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}isGraphInput(t,r){let n=this.sessionGraphInputs.get(t);return n?n.includes(r):!1}isInt64Supported(t){return!!this.mlContextBySessionId.get(t)?.opSupportLimits().input.dataTypes.includes("int64")}flush(){}}}),T1=at(()=>{}),u_,Yh,Zh,Ng,jg,c_,Y_,Ug,Rb,l3=at(()=>{vo(),T1(),u_=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Yh=[],Zh=t=>Math.ceil(Number(t)/16)*16,Ng=t=>{for(let r=0;r<Yh.length;r++){let n=Yh[r];if(t<=n)return n}return Math.ceil(t/16)*16},jg=1,c_=()=>jg++,Y_=async(t,r,n,a)=>{let o=Zh(n),u=t.device.createBuffer({size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let d=t.getCommandEncoder();t.endComputePass(),d.copyBufferToBuffer(r,0,u,0,o),t.flush(),await u.mapAsync(GPUMapMode.READ);let c=u.getMappedRange();if(a){let f=a();return f.set(new Uint8Array(c,0,n)),f}else return new Uint8Array(c.slice(0,n))}finally{u.destroy()}},Ug=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[r]of u_)Yh.push(r),this.freeBuffers.set(r,[]),this.freeUniformBuffers.set(r,[]);this.sessionCount=0}upload(t,r){let n=r.buffer,a=r.byteOffset,o=r.byteLength,u=Zh(o),d=this.storageCache.get(t);if(!d)throw new Error("gpu data for uploading does not exist");if(Number(d.originalSize)!==o)throw new Error(`inconsistent data size. gpu data size=${d.originalSize}, data size=${o}`);let c=this.backend.device.createBuffer({mappedAtCreation:!0,size:u,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),f=c.getMappedRange();new Uint8Array(f).set(new Uint8Array(n,a,o)),c.unmap();let p=this.backend.device.createCommandEncoder();p.copyBufferToBuffer(c,0,d.gpuData.buffer,0,u),this.backend.device.queue.submit([p.finish()]),c.destroy(),hn("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,r){let n=this.storageCache.get(t);if(!n)throw new Error("source gpu data for memcpy does not exist");let a=this.storageCache.get(r);if(!a)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==a.originalSize)throw new Error("inconsistent source and destination gpu data size");let o=Zh(n.originalSize),u=this.backend.getCommandEncoder();this.backend.endComputePass(),u.copyBufferToBuffer(n.gpuData.buffer,0,a.gpuData.buffer,0,o)}registerExternalBuffer(t,r,n){let a;if(n){if(a=n[0],t===n[1])return hn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${a}, buffer is the same, skip.`),a;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else a=c_();return this.storageCache.set(a,{gpuData:{id:a,type:0,buffer:t},originalSize:r}),hn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${a}, registered.`),a}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),hn("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n=Ng(t),a,o=(r&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,u=(r&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(o||u){let c=(o?this.freeBuffers:this.freeUniformBuffers).get(n);c?c.length>0?a=c.pop():a=this.backend.device.createBuffer({size:n,usage:r}):a=this.backend.device.createBuffer({size:n,usage:r})}else a=this.backend.device.createBuffer({size:n,usage:r});let d={id:c_(),type:0,buffer:a};return this.storageCache.set(d.id,{gpuData:d,originalSize:Number(t)}),hn("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${d.id}`),d}get(t){return this.storageCache.get(t)?.gpuData}release(t){let r=typeof t=="bigint"?Number(t):t,n=this.storageCache.get(r);if(!n){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return hn("verbose",()=>`[WebGPU] GpuDataManager.release(id=${r}), gpuDataId=${n.gpuData.id}`),this.storageCache.delete(r),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(t,r){let n=this.storageCache.get(Number(t));if(!n)throw new Error("data does not exist");await Y_(this.backend,n.gpuData.buffer,n.originalSize,r)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let r=u_.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(t.size)||[];r===void 0||n.length>=r?t.destroy():n.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(t.size)||[];r===void 0||n.length>=r?t.destroy():n.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let r of this.buffersPending)t.push(r);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(r=>{r.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(r=>{r.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(r=>{r.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let r=this.capturedPendingBuffers.get(t);r&&(r.forEach(n=>{n.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(hn("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.storageCache=new Map)}},Rb=(...t)=>new Ug(...t)}),Vg,Sn,xs=at(()=>{Vg=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},Sn=t=>new Vg(t)}),Id,Jh,Ys,yr,Lt,_s,Z_,Dd,Ml,At,zp,We,St,Bb,E1,Gg,Nb,sn=at(()=>{Nt(),tn(),Id=64,Jh=(t,r)=>{if(r===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return r>1?`vec${r}<f16>`:"f16";case 1:return r>1?`vec${r}<f32>`:"f32";case 6:return r>1?`vec${r}<i32>`:"i32";case 12:return r>1?`vec${r}<u32>`:"u32";case 7:if(r>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(r>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(r!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},Ys=(t,r=1)=>{let n=Jh(t,r);return typeof n=="string"?n:n[0]},yr=(t,r=1)=>{let n=Jh(t,r);return typeof n=="string"?n:n[1]},Lt=(...t)=>{let r=[];return t.forEach(n=>{n.length!==0&&r.push({type:12,data:n},{type:12,data:Fe.computeStrides(n)})}),r},_s=t=>t%4===0?4:t%2===0?2:1,Z_=(t="f32",r,n="0")=>!r||r===1?`${t}(${n})`:`vec${r}<${t}>(${n})`,Dd=(t,r,n)=>t==="f32"?n:r===1?`f32(${n})`:`vec${r}<f32>(${n})`,Ml=(t,r)=>r===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:r===2?`(${t}.x + ${t}.y)`:r===3?`(${t}.x + ${t}.y + ${t}.z)`:t,At=(t,r,n,a)=>t.startsWith("uniforms.")&&n>4?typeof r=="string"?a==="f16"?`${t}[(${r}) / 8][(${r}) % 8 / 4][(${r}) % 8 % 4]`:`${t}[(${r}) / 4][(${r}) % 4]`:a==="f16"?`${t}[${Math.floor(r/8)}][${Math.floor(r%8/4)}][${r%8%4}]`:`${t}[${Math.floor(r/4)}][${r%4}]`:n>1?`${t}[${r}]`:t,zp=(t,r,n,a,o)=>{let u=typeof n=="number",d=u?n:n.length,c=[...new Array(d).keys()],f=d<2?"u32":d<=4?`vec${d}<u32>`:`array<u32, ${d}>`,p=Jh(r,o),g=typeof p=="string"?p:p[1],_=typeof p=="string"?p:p[0],h={indices:f,value:g,storage:_,tensor:r},w=j=>typeof j=="string"?j:`${j}u`,M={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},x=u?"uniforms.":"",F=`${x}${t}_shape`,E=`${x}${t}_strides`,T="";for(let j=0;j<d-1;j++)T+=`
    let dim${j} = current / ${At(E,j,d)};
    let rest${j} = current % ${At(E,j,d)};
    indices[${j}] = dim${j};
    current = rest${j};
    `;T+=`indices[${d-1}] = current;`;let L=d<2?"":`
  fn o2i_${t}(offset: u32) -> ${h.indices} {
    var indices: ${h.indices};
    var current = offset;
    ${T}
    return indices;
  }`,O=j=>(M.offsetToIndices=!0,d<2?j:`o2i_${t}(${j})`),S=[];if(d>=2)for(let j=d-1;j>=0;j--)S.push(`${At(E,j,d)} * (indices[${j}])`);let $=d<2?"":`
  fn i2o_${t}(indices: ${h.indices}) -> u32 {
    return ${S.join("+")};
  }`,C=j=>(M.indicesToOffset=!0,d<2?j:`i2o_${t}(${j})`),k=(...j)=>d===0?"0u":`${h.indices}(${j.map(w).join(",")})`,U=(j,R)=>d<2?`${j}`:`${At(j,R,d)}`,V=(j,R,X)=>d<2?`${j}=${X};`:`${At(j,R,d)}=${X};`,re={},ne=(j,R)=>{M.broadcastedIndicesToOffset=!0;let X=`${R.name}broadcastedIndicesTo${t}Offset`;if(X in re)return`${X}(${j})`;let G=[];for(let pe=d-1;pe>=0;pe--){let Te=R.indicesGet("outputIndices",pe+R.rank-d);G.push(`${U(E,pe)} * (${Te} % ${U(F,pe)})`)}return re[X]=`fn ${X}(outputIndices: ${R.type.indices}) -> u32 {
             return ${G.length>0?G.join("+"):"0u"};
           }`,`${X}(${j})`},W=(j,R)=>(()=>{if(h.storage===h.value)return`${t}[${j}]=${R};`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`${t}[${j}]=vec2<u32>(u32(${R}), select(0u, 0xFFFFFFFFu, ${R} < 0));`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`${t}[${j}]=vec2<u32>(u32(${R}), 0u);`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`${t}[${j}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${R}));`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),ce=j=>(()=>{if(h.storage===h.value)return`${t}[${j}]`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`i32(${t}[${j}].x)`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`u32(${t}[${j}].x)`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${j}] & 0xFFu), bool(${t}[${j}] & 0xFF00u), bool(${t}[${j}] & 0xFF0000u), bool(${t}[${j}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),ae=d<2?"":`
  fn get_${t}ByIndices(indices: ${h.indices}) -> ${g} {
    return ${ce(`i2o_${t}(indices)`)};
  }`,H=d<2?"":(()=>{let j=c.map(X=>`d${X}: u32`).join(", "),R=c.map(X=>`d${X}`).join(", ");return`
  fn get_${t}(${j}) -> ${g} {
    return get_${t}ByIndices(${k(R)});
  }`})(),se=(...j)=>{if(j.length!==d)throw new Error(`indices length must be ${d}`);let R=j.map(w).join(",");return d===0?ce("0u"):d===1?ce(R[0]):(M.get=!0,M.getByIndices=!0,M.indicesToOffset=!0,`get_${t}(${R})`)},ie=j=>d<2?ce(j):(M.getByIndices=!0,M.indicesToOffset=!0,`get_${t}ByIndices(${j})`),ge=d<2?"":`
  fn set_${t}ByIndices(indices: ${h.indices}, value: ${g}) {
    ${W(`i2o_${t}(indices)`,"value")}
  }`,q=d<2?"":(()=>{let j=c.map(X=>`d${X}: u32`).join(", "),R=c.map(X=>`d${X}`).join(", ");return`
  fn set_${t}(${j}, value: ${g}) {
    set_${t}ByIndices(${k(R)}, value);
  }`})();return{impl:()=>{let j=[],R=!1;return M.offsetToIndices&&(j.push(L),R=!0),M.indicesToOffset&&(j.push($),R=!0),M.broadcastedIndicesToOffset&&(Object.values(re).forEach(X=>j.push(X)),R=!0),M.set&&(j.push(q),R=!0),M.setByIndices&&(j.push(ge),R=!0),M.get&&(j.push(H),R=!0),M.getByIndices&&(j.push(ae),R=!0),!u&&R&&j.unshift(`const ${F} = ${h.indices}(${n.join(",")});`,`const ${E} = ${h.indices}(${Fe.computeStrides(n).join(",")});`),j.join(`
`)},type:h,offsetToIndices:O,indicesToOffset:C,broadcastedIndicesToOffset:ne,indices:k,indicesGet:U,indicesSet:V,set:(...j)=>{if(j.length!==d+1)throw new Error(`indices length must be ${d}`);let R=j[d];if(typeof R!="string")throw new Error("value must be string");let X=j.slice(0,d).map(w).join(",");return d===0?W("0u",R):d===1?W(X[0],R):(M.set=!0,M.setByIndices=!0,M.indicesToOffset=!0,`set_${t}(${X}, ${R})`)},setByOffset:W,setByIndices:(j,R)=>d<2?W(j,R):(M.setByIndices=!0,M.indicesToOffset=!0,`set_${t}ByIndices(${j}, ${R});`),get:se,getByOffset:ce,getByIndices:ie,usage:a,name:t,strides:E,shape:F,rank:d}},We=(t,r,n,a=1)=>zp(t,r,n,"input",a),St=(t,r,n,a=1)=>zp(t,r,n,"output",a),Bb=(t,r,n)=>zp(t,r,n,"atomicOutput",1),E1=(t,r,n,a=1)=>zp(t,r,n,"internal",a),Gg=class{constructor(t,r){this.normalizedDispatchGroup=t,this.limits=r,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=Id){let r=typeof t=="number"?t:t[0],n=typeof t=="number"?1:t[1],a=typeof t=="number"?1:t[2];if(r>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||a>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${r}, ${n}, ${a}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(r*n*a>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${r}, ${n}, ${a}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let o=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,u=o?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,d=o?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${r*n*a}u + local_idx;`;return`@compute @workgroup_size(${r}, ${n}, ${a})
  fn main(${u}) {
    ${d}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,r){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let n=t.usage==="input"?"read":"read_write",a=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${r}) var<storage, ${n}> ${t.name}: array<${a}>;`}declareVariables(...t){return t.map(r=>this.declareVariable(r,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(r=>this.registerInternalVariable(r)),this}registerUniform(t,r,n=1){return this.uniforms.push({name:t,type:r,length:n}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:r,type:n,length:a}of this.uniforms)if(a&&a>4)n==="f16"?t.push(`@align(16) ${r}:array<mat2x4<${n}>, ${Math.ceil(a/8)}>`):t.push(`${r}:array<vec4<${n}>, ${Math.ceil(a/4)}>`);else{let o=a==null||a===1?n:`vec${a}<${n}>`;t.push(`${r}:${o}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=r=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(r)];return this.uniforms.map(r=>[t(r.type),r.length??1])}},Nb=(t,r)=>new Gg(t,r)}),Wg,d_,Hg,qg,Kg,Qg,Yr,jb,Ub,vl=at(()=>{Nt(),tn(),xs(),sn(),Wg=(t,r)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(r.length!==0&&r.length!==t[0].dims.length)throw new Error(`perm size ${r.length} does not match input rank ${t[0].dims.length}`)},d_=(t,r)=>r.length!==0?r:[...new Array(t).keys()].reverse(),Hg=(t,r)=>Fe.sortBasedOnPerm(t,d_(t.length,r)),qg=(t,r,n,a)=>{let o=`fn perm(i: ${a.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`;for(let u=0;u<r;++u)o+=`a[${t[u]}]=i[${u}];`;return o+="return a;}"},Kg=(t,r)=>{let n=[],a=[];for(let o=0;o<t.length;++o)t[o]!==1&&n.push(t[o]),t[r[o]]!==1&&a.push(r[o]);return{newShape:n,newPerm:a}},Qg=(t,r)=>{let n=0;for(let a=0;a<t.length;++a)if(r[t[a]]!==1){if(t[a]<n)return!1;n=t[a]}return!0},Yr=(t,r)=>{let n=t.dataType,a=t.dims.length,o=d_(a,r),u=Hg(t.dims,o),d=t.dims,c=u,f=a<2||Qg(o,t.dims),p;if(f)return p=M=>{let x=We("input",n,d,4),F=St("output",n,c,4);return`
  ${M.registerUniform("output_size","u32").declareVariables(x,F)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let M=Fe.size(u);return{outputs:[{dims:u,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(M/64/4)},programUniforms:[{type:12,data:Math.ceil(M/4)}]}},getShaderSource:p};let{newShape:g,newPerm:_}=Kg(t.dims,o),h=Fe.areEqual(_,[2,3,1]),w=Fe.areEqual(_,[3,1,2]);if(g.length===2||h||w){d=h?[g[0],g[1]*g[2]]:w?[g[0]*g[1],g[2]]:g,c=[d[1],d[0]];let M=16;return p=x=>{let F=We("a",n,d.length),E=St("output",n,c.length);return`
  ${x.registerUniform("output_size","u32").declareVariables(F,E)}
  var<workgroup> tile : array<array<${E.type.value}, ${M+1}>, ${M}>;
  ${x.mainStart([M,M,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${M} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${M}u + local_id.x;
    let input_row = workgroup_id_x * ${M}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${F.getByIndices(`${F.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${M}u + local_id.x;
    let output_row = workgroup_id_y * ${M}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${E.setByIndices(`${E.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let x=Fe.size(u);return{outputs:[{dims:u,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(c[1]/M),y:Math.ceil(c[0]/M)},programUniforms:[{type:12,data:x},...Lt(d,c)]}},getShaderSource:p}}return p=M=>{let x=We("a",n,d.length),F=St("output",n,c.length);return`
  ${M.registerUniform("output_size","u32").declareVariables(x,F)}

  ${qg(o,a,x,F)}

  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${F.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${F.setByOffset("global_idx",x.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>{let M=Fe.size(u);return{outputs:[{dims:u,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(M/64)},programUniforms:[{type:12,data:M},...Lt(d,c)]}},getShaderSource:p}},jb=(t,r)=>{Wg(t.inputs,r.perm),t.compute(Yr(t.inputs[0],r.perm))},Ub=t=>Sn({perm:t.perm})}),Xg,Yg,Zg,Jg,e0,t0,n0,s0,r0,a0,Qa,Vb,Gb,Wb,Hb,qb,Kb,Qb,Xb,Yb,Zb,u3=at(()=>{Nt(),tn(),sn(),C1(),vl(),Xg={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Yg={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Zg={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Jg={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},e0=(t,r)=>{let n=[];for(let a=r-t;a<r;++a)n.push(a);return n},t0=(t,r)=>{let n=[],a=t.length;for(let u=0;u<a;u++)r.indexOf(u)===-1&&n.push(t[u]);let o=r.map(u=>t[u]);return[n,o]},n0=(t,r)=>{let n=t.length+r.length,a=[],o=0;for(let u=0;u<n;u++)r.indexOf(u)===-1?a.push(t[o++]):a.push(1);return a},s0=(t,r)=>{for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==r-1-n)return!1;return!0},r0=(t,r)=>{let n=[];if(!s0(t,r)){for(let a=0;a<r;++a)t.indexOf(a)===-1&&n.push(a);t.forEach(a=>n.push(a))}return n},a0=(t,r,n,a,o,u,d)=>{let c=n[0].dims,f=Fe.size(u),p=Fe.size(d),g=We("_A",n[0].dataType,c),_=St("output",o,u),h=64;f===1&&(h=256);let w=`
          var<workgroup> aBestValues : array<f32, ${h}>;
       `,M=x=>`
        ${x.registerUniform("reduceSize","u32").declareVariables(g,_)}
        ${w}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${x.mainStart(h)}

          let outputIndex = global_idx / ${h};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Zg[a]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${h}) {
           let candidate = f32(${g.getByOffset("offset + k")});
           bestValue = ${Xg[a]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${h}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Yg[a]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${_.setByOffset("outputIndex",`${a==="mean"?`${_.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${_.type.storage}(${Jg[a]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${r};${h}`,inputDependencies:["type"]},getShaderSource:M,getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:f},programUniforms:[{type:12,data:p}]})}},Qa=(t,r,n,a)=>{let o=t.inputs.length===1?n:J_(t.inputs,n),u=o.axes;u.length===0&&!o.noopWithEmptyAxes&&(u=t.inputs[0].dims.map((w,M)=>M));let d=Fe.normalizeAxes(u,t.inputs[0].dims.length),c=d,f=t.inputs[0],p=r0(c,t.inputs[0].dims.length);p.length>0&&(f=t.compute(Yr(t.inputs[0],p),{inputs:[0],outputs:[-1]})[0],c=e0(c.length,f.dims.length));let[g,_]=t0(f.dims,c),h=g;o.keepDims&&(h=n0(g,d)),t.compute(a0(r,o.cacheKey,[f],a,t.inputs[0].dataType,h,_),{inputs:[f]})},Vb=(t,r)=>{Qa(t,"ReduceMeanShared",r,"mean")},Gb=(t,r)=>{Qa(t,"ReduceL1Shared",r,"l1")},Wb=(t,r)=>{Qa(t,"ReduceL2Shared",r,"l2")},Hb=(t,r)=>{Qa(t,"ReduceLogSumExpShared",r,"logSumExp")},qb=(t,r)=>{Qa(t,"ReduceMaxShared",r,"max")},Kb=(t,r)=>{Qa(t,"ReduceMinShared",r,"min")},Qb=(t,r)=>{Qa(t,"ReduceProdShared",r,"prod")},Xb=(t,r)=>{Qa(t,"ReduceSumShared",r,"sum")},Yb=(t,r)=>{Qa(t,"ReduceSumSquareShared",r,"sumSquare")},Zb=(t,r)=>{Qa(t,"ReduceLogSumShared",r,"logSum")}}),Xa,i0,mm,J_,Ya,o0,l0,u0,c0,d0,f0,p0,h0,m0,_0,Za,Jb,eM,tM,nM,sM,rM,aM,iM,oM,lM,C1=at(()=>{Nt(),tn(),xs(),sn(),u3(),Xa=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},i0=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],mm=(t,r,n,a,o,u,d=!1,c=!1)=>{let f=[],p=n[0].dims,g=p.length,_=Fe.normalizeAxes(o,g),h=!c&&_.length===0;p.forEach((x,F)=>{h||_.indexOf(F)>=0?d&&f.push(1):f.push(x)});let w=f.length,M=Fe.size(f);return{name:t,shaderCache:r,getShaderSource:x=>{let F=[],E=We("_A",n[0].dataType,g),T=St("output",u,w),L=a(E,T,_),O=L[2];for(let S=0,$=0;S<g;S++)h||_.indexOf(S)>=0?(d&&$++,O=`for(var j${S}: u32 = 0; j${S} < ${p[S]}; j${S}++) {
                  ${L[2].includes("last_index")?`let last_index = j${S};`:""}
                  ${E.indicesSet("input_indices",S,`j${S}`)}
                  ${O}
                }`):(F.push(`${E.indicesSet("input_indices",S,T.indicesGet("output_indices",$))};`),$++);return`

        ${x.registerUniform("output_size","u32").declareVariables(E,T)}

        ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${E.type.indices};
          let output_indices = ${T.offsetToIndices("global_idx")};

          ${F.join(`
`)}
          ${L[0]}       // init ops for reduce max/min
          ${L[1]}
          ${O}
          ${L[3]}
          ${L.length===4?T.setByOffset("global_idx","value"):L.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:f,dataType:u}],dispatchGroup:{x:Math.ceil(M/64)},programUniforms:[{type:12,data:M},...Lt(p,f)]})}},J_=(t,r)=>{let n=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(a=>n.push(Number(a))),Sn({axes:n,keepDims:r.keepDims,noopWithEmptyAxes:r.noopWithEmptyAxes})},Ya=(t,r,n,a)=>{let o=t.inputs,u=o.length===1?n:J_(o,n);t.compute(mm(r,{hint:u.cacheKey,inputDependencies:["rank"]},[o[0]],u.noopWithEmptyAxes&&u.axes.length===0?i0:a,u.axes,o[0].dataType,u.keepDims,u.noopWithEmptyAxes),{inputs:[0]})},o0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceLogSum",r,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,"value = log(value);"])},l0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceL1",r,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += abs(${n.getByIndices("input_indices")});`,""])},u0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceL2",r,(n,a)=>[`var t = ${a.type.value}(0); var value = ${a.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},c0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceLogSumExp",r,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += exp(${n.getByIndices("input_indices")});`,"value = log(value);"])},d0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceMax",r,(n,a,o)=>{let u=[];for(let d=0;d<n.rank;d++)(o.indexOf(d)>=0||o.length===0)&&u.push(n.indicesSet("input_indices",d,0));return[`${u.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = max(value, ${n.getByIndices("input_indices")});`,""]})},f0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceMean",r,(n,a,o)=>{let u=1;for(let d=0;d<n.rank;d++)(o.indexOf(d)>=0||o.length===0)&&(u*=t.inputs[0].dims[d]);return["var sum = f32(0);","",`sum += f32(${n.getByIndices("input_indices")});`,`let value = ${a.type.value}(sum / ${u});`]})},p0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceMin",r,(n,a,o)=>{let u=[];for(let d=0;d<n.rank;d++)(o.indexOf(d)>=0||o.length===0)&&u.push(`input_indices[${d}] = 0;`);return[`${u.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = min(value, ${n.getByIndices("input_indices")});`,""]})},h0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceProd",r,(n,a)=>[`var value = ${a.type.storage}(1);`,"",`value *= ${n.getByIndices("input_indices")};`,""])},m0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceSum",r,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,""])},_0=(t,r)=>{Xa(t.inputs),Ya(t,"ReduceSumSquare",r,(n,a)=>[`var t = ${a.type.value}(0); var value = ${a.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += t * t;`,""])},Za=(t,r,n)=>{if(r.length===0)return n;let a=1,o=1;for(let u=0;u<r.length;u++)r.indexOf(u)===-1?a*=t[u]:o*=t[u];return o<32&&a>1024},Jb=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?f0(t,r):Vb(t,r)},eM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?l0(t,r):Gb(t,r)},tM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?u0(t,r):Wb(t,r)},nM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?c0(t,r):Hb(t,r)},sM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?d0(t,r):qb(t,r)},rM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?p0(t,r):Kb(t,r)},aM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?h0(t,r):Qb(t,r)},iM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?m0(t,r):Xb(t,r)},oM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?_0(t,r):Yb(t,r)},lM=(t,r)=>{Za(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?o0(t,r):Zb(t,r)}}),f_,uM,cM,e1,c3=at(()=>{Nt(),xs(),C1(),f_=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},uM=(t,r)=>{f_(t.inputs);let n=(a,o,u)=>{let d=[];for(let c=0;c<a.rank;c++)(u.indexOf(c)>=0||u.length===0)&&d.push(`input_indices[${c}] = 0;`);return[`${d.join(`
`)}`,`var value = ${a.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${a.getByIndices("input_indices")} ${r.selectLastIndex>0?"<=":"<"} value) {
         value = ${a.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",o.setByOffset("global_idx","best_index")]};t.compute(mm("ArgMin",{hint:r.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[r.axis],7,r.keepDims),{inputs:[0]})},cM=(t,r)=>{f_(t.inputs);let n=(a,o,u)=>{let d=[];for(let c=0;c<a.rank;c++)(u.indexOf(c)>=0||u.length===0)&&d.push(`input_indices[${c}] = 0;`);return[`${d.join(`
`)}`,`var value = ${a.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${a.getByIndices("input_indices")} ${r.selectLastIndex>0?">=":">"} value) {
         value = ${a.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",o.setByOffset("global_idx","best_index")]};t.compute(mm("argMax",{hint:r.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[r.axis],7,r.keepDims),{inputs:[0]})},e1=t=>Sn(t)}),g0,em,y0,b0,M0,Xp,v0,dM,S1=at(()=>{Nt(),tn(),T1(),sn(),g0=(t,r)=>{let n=t[0],a=t[1],o=t[2],u=t[3],d=t[4],c=t[5];if(d&&c)throw new Error("Attention cannot have both past and attention_bias");if(n.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let f=n.dims[0],p=n.dims[1],g=n.dims[2];if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(a.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(a.dims[0]!==g)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(o.dims[0]!==a.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let _=o.dims[0]/3,h=_,w=h;if(r.qkvHiddenSizes.length>0){if(r.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let L of r.qkvHiddenSizes)if(L%r.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");_=r.qkvHiddenSizes[0],h=r.qkvHiddenSizes[1],w=r.qkvHiddenSizes[2]}let M=p;if(_!==h)throw new Error("qkv_hidden_sizes first element should be same as the second");if(o.dims[0]!==_+h+w)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let x=0;if(d){if(h!==w)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(d.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(d.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(d.dims[1]!==f)throw new Error('Input "past" second dimension must be batch_size');if(d.dims[2]!==r.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(d.dims[4]!==h/r.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');r.pastPresentShareBuffer||(x=d.dims[3])}let F=M+x,E=-1,T=0;if(u)throw new Error("Mask not supported");if(d)throw new Error("past is not supported");if(c){if(c.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(c.dims[0]!==f||c.dims[1]!==r.numHeads||c.dims[2]!==p||c.dims[3]!==F)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:f,sequenceLength:p,pastSequenceLength:x,kvSequenceLength:M,totalSequenceLength:F,maxSequenceLength:E,inputHiddenSize:g,hiddenSize:_,vHiddenSize:w,headSize:Math.floor(_/r.numHeads),vHeadSize:Math.floor(w/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:T,scale:r.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},em=(t,r,n)=>r&&t?`
      let total_sequence_length_input = u32(${r.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${n?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,y0=(t,r,n,a,o,u,d,c)=>{let f=_s(d?1:u),p=64,g=u/f;g<p&&(p=32);let _=Math.ceil(u/f/p),h=[{type:12,data:r},{type:12,data:n},{type:12,data:a},{type:12,data:o},{type:12,data:g},{type:12,data:_}],w=Ys(t.dataType,f),M=yr(1,f),x=["type"];d&&x.push("type"),c&&x.push("type");let F=E=>{let T=St("x",t.dataType,t.dims,f),L=[T],O=d?We("seq_lens",d.dataType,d.dims):void 0;O&&L.push(O);let S=c?We("total_sequence_length_input",c.dataType,c.dims):void 0;S&&L.push(S);let $=yr(t.dataType),C=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${p}>;
  var<workgroup> thread_sum: array<f32, ${p}>;
  ${E.registerUniforms(C).declareVariables(...L)}
  ${E.mainStart([p,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${em(O,S,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${p}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${d?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${M}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${M}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(f){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${f}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${p}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${M}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${M}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(f){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${f}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${p}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${T.type.value}(${$}(1.0) / ${$}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${M}(x[offset + i]);
        x[offset + i] = ${T.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${d?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${T.type.value}(${$}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${p};${w};${f}`,inputDependencies:x},getShaderSource:F,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:o,z:r*n},programUniforms:h})}},b0=(t,r,n,a,o,u,d,c,f)=>{let p=d+u.kvSequenceLength,g=[u.batchSize,u.numHeads,u.sequenceLength,p],_=t>1&&a,h=u.kvNumHeads?u.kvNumHeads:u.numHeads,w=_?[u.batchSize,h,p,u.headSize]:void 0,M=u.nReps?u.nReps:1,x=u.scale===0?1/Math.sqrt(u.headSize):u.scale,F=_s(u.headSize),E=u.headSize/F,T=12,L={x:Math.ceil(p/T),y:Math.ceil(u.sequenceLength/T),z:u.batchSize*u.numHeads},O=[{type:12,data:u.sequenceLength},{type:12,data:E},{type:12,data:p},{type:12,data:u.numHeads},{type:12,data:u.headSize},{type:1,data:x},{type:12,data:d},{type:12,data:u.kvSequenceLength},{type:12,data:M}],S=_&&a&&Fe.size(a.dims)>0,$=["type","type"];S&&$.push("type"),o&&$.push("type"),c&&$.push("type"),f&&$.push("type");let C=[{dims:g,dataType:r.dataType,gpuDataType:0}];_&&C.push({dims:w,dataType:r.dataType,gpuDataType:0});let k=U=>{let V=We("q",r.dataType,r.dims,F),re=We("key",n.dataType,n.dims,F),ne=[V,re];if(S){let ge=We("past_key",a.dataType,a.dims,F);ne.push(ge)}o&&ne.push(We("attention_bias",o.dataType,o.dims));let W=c?We("seq_lens",c.dataType,c.dims):void 0;W&&ne.push(W);let ce=f?We("total_sequence_length_input",f.dataType,f.dims):void 0;ce&&ne.push(ce);let ae=St("output",r.dataType,g),H=[ae];_&&H.push(St("present_key",r.dataType,w,F));let se=yr(1,F),ie=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${T}u;

  var<workgroup> tileQ: array<${V.type.storage}, ${T*T}>;
  var<workgroup> tileK: array<${V.type.storage}, ${T*T}>;
  ${U.registerUniforms(ie).declareVariables(...ne,...H)}
  ${U.mainStart([T,T,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${M===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${M===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${em(W,ce,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${S&&_?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${_?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${se}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${S&&_?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${_?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${se}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(F){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${F}`)}})()};
        output[outputIdx] = ${ae.type.value} (sum * uniforms.alpha) + ${o?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${F};${o!==void 0};${a!==void 0};${t}`,inputDependencies:$},getRunData:()=>({outputs:C,dispatchGroup:L,programUniforms:O}),getShaderSource:k}},M0=(t,r,n,a,o,u,d=void 0,c=void 0)=>{let f=u+o.kvSequenceLength,p=o.nReps?o.nReps:1,g=o.vHiddenSize*p,_=t>1&&a,h=o.kvNumHeads?o.kvNumHeads:o.numHeads,w=_?[o.batchSize,h,f,o.headSize]:void 0,M=[o.batchSize,o.sequenceLength,g],x=12,F={x:Math.ceil(o.vHeadSize/x),y:Math.ceil(o.sequenceLength/x),z:o.batchSize*o.numHeads},E=[{type:12,data:o.sequenceLength},{type:12,data:f},{type:12,data:o.vHeadSize},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:12,data:g},{type:12,data:u},{type:12,data:o.kvSequenceLength},{type:12,data:p}],T=_&&a&&Fe.size(a.dims)>0,L=["type","type"];T&&L.push("type"),d&&L.push("type"),c&&L.push("type");let O=[{dims:M,dataType:r.dataType,gpuDataType:0}];_&&O.push({dims:w,dataType:r.dataType,gpuDataType:0});let S=$=>{let C=We("probs",r.dataType,r.dims),k=We("v",n.dataType,n.dims),U=[C,k];T&&U.push(We("past_value",a.dataType,a.dims));let V=d?We("seq_lens",d.dataType,d.dims):void 0;d&&U.push(V);let re=c?We("total_sequence_length_input",c.dataType,c.dims):void 0;c&&U.push(re);let ne=[St("output",r.dataType,M)];_&&ne.push(St("present_value",r.dataType,w));let W=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${x}u;
  var<workgroup> tileQ: array<${C.type.value}, ${x*x}>;
  var<workgroup> tileV: array<${C.type.value}, ${x*x}>;
  ${$.registerUniforms(W).declareVariables(...U,...ne)}
  ${$.mainStart([x,x,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${p===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${p===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${em(V,re,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${T&&_?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${_?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${C.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${T&&_?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${_?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${a!==void 0};${t}`,inputDependencies:L},getRunData:()=>({outputs:O,dispatchGroup:F,programUniforms:E}),getShaderSource:S}},Xp=(t,r,n,a,o,u,d,c,f,p,g=void 0,_=void 0)=>{let h=Math.min(t.outputCount,1+(d?1:0)+(c?1:0)),w=h>1?p.pastSequenceLength:0,M=w+p.kvSequenceLength,x=f&&Fe.size(f.dims)>0?f:void 0,F=[r,n];h>1&&d&&Fe.size(d.dims)>0&&F.push(d),x&&F.push(x),g&&F.push(g),_&&F.push(_);let E=t.compute(b0(h,r,n,d,x,p,w,g,_),{inputs:F,outputs:h>1?[-1,1]:[-1]})[0];t.compute(y0(E,p.batchSize,p.numHeads,w,p.sequenceLength,M,g,_),{inputs:g&&_?[E,g,_]:[E],outputs:[]});let T=[E,a];h>1&&c&&Fe.size(c.dims)>0&&T.push(c),g&&T.push(g),_&&T.push(_),t.compute(M0(h,E,a,c,p,w,g,_),{inputs:T,outputs:h>1?[0,2]:[0]})},v0=(t,r)=>{let n=[r.batchSize,r.numHeads,r.sequenceLength,r.headSize],a=r.sequenceLength,o=r.inputHiddenSize,u=r.headSize,d=12,c={x:Math.ceil(r.headSize/d),y:Math.ceil(r.sequenceLength/d),z:r.batchSize*r.numHeads},f=[t.inputs[0],t.inputs[1],t.inputs[2]],p=[{type:12,data:a},{type:12,data:o},{type:12,data:u},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:r.hiddenSize},{type:12,data:r.hiddenSize+r.hiddenSize+r.vHiddenSize}],g=_=>{let h=St("output_q",f[0].dataType,n),w=St("output_k",f[0].dataType,n),M=St("output_v",f[0].dataType,n),x=We("input",f[0].dataType,f[0].dims),F=We("weight",f[1].dataType,f[1].dims),E=We("bias",f[2].dataType,f[2].dims),T=x.type.storage,L=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${d}u;
  var<workgroup> tileInput: array<${T}, ${d*d}>;
  var<workgroup> tileWeightQ: array<${T}, ${d*d}>;
  var<workgroup> tileWeightK: array<${T}, ${d*d}>;
  var<workgroup> tileWeightV: array<${T}, ${d*d}>;
  ${_.registerUniforms(L).declareVariables(x,F,E,h,w,M)}
  ${_.mainStart([d,d,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${T}(0);
    var valueK = ${T}(0);
    var valueV = ${T}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:c,programUniforms:p}),getShaderSource:g},{inputs:f,outputs:[-1,-1,-1]})},dM=(t,r)=>{let n=g0(t.inputs,r),[a,o,u]=v0(t,n);return Xp(t,a,o,u,t.inputs[4],void 0,void 0,void 0,t.inputs[5],n)}}),w0,x0,T0,fM,d3=at(()=>{ai(),Nt(),tn(),xs(),sn(),w0=(t,r)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let n=(a,o,u)=>{let d=o.length;if(d!==a.length)throw new Error(`${u}: num dimensions != ${d}`);o.forEach((c,f)=>{if(c!==a[f])throw new Error(`${u}: dim[${f}] do not match`)})};if(t[0].dims.length>1){let a=r.format==="NHWC"?r.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,r.spatial?2:void 0);n(t[1].dims,a,"Invalid input scale"),n(t[2].dims,a,"Invalid input B"),n(t[3].dims,a,"Invalid input mean"),n(t[4].dims,a,"Invalid input var")}else n(t[1].dims,[1],"Invalid input scale"),n(t[2].dims,[1],"Invalid input B"),n(t[3].dims,[1],"Invalid input mean"),n(t[4].dims,[1],"Invalid input var")},x0=(t,r)=>{let{epsilon:n,spatial:a,format:o}=r,u=t[0].dims,d=a?_s(u[u.length-1]):1,c=o==="NHWC"&&u.length>1?d:1,f=Fe.size(u)/d,p=a,g=p?u.length:u,_=We("x",t[0].dataType,t[0].dims,d),h=We("scale",t[1].dataType,t[1].dims,c),w=We("bias",t[2].dataType,t[2].dims,c),M=We("inputMean",t[3].dataType,t[3].dims,c),x=We("inputVar",t[4].dataType,t[4].dims,c),F=St("y",t[0].dataType,g,d),E=()=>{let L="";if(a)L=`let cOffset = ${u.length===1?"0u":o==="NHWC"?`outputIndices[${u.length-1}] / ${d}`:"outputIndices[1]"};`;else if(o==="NCHW")L=`
            ${F.indicesSet("outputIndices","0","0")}
            let cOffset = ${F.indicesToOffset("outputIndices")};`;else{L=`var cIndices = ${h.type.indices}(0);
                       cIndices[0] = outputIndices[${u.length-1}];`;for(let O=1;O<h.rank;O++)L+=`cIndices[${O}] = outputIndices[${O}];`;L+=`let cOffset = ${h.indicesToOffset("cIndices")};`}return L},T=L=>`
  const epsilon = ${n};
  ${L.registerUniform("outputSize","u32").declareVariables(_,h,w,M,x,F)}
  ${L.mainStart()}
  ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${F.offsetToIndices(`global_idx * ${d}`)};
    ${E()}
    let scale = ${h.getByOffset("cOffset")};
    let bias = ${w.getByOffset("cOffset")};
    let inputMean = ${M.getByOffset("cOffset")};
    let inputVar = ${x.getByOffset("cOffset")};
    let x = ${_.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${F.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${r.epsilon}_${r.format}_${a}_${d}`,inputDependencies:p?["rank","type","type","type","type"]:void 0},getShaderSource:T,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:p?[{type:12,data:f},...Lt(u)]:[{type:12,data:f}]})}},T0=t=>Sn(t),fM=(t,r)=>{let{inputs:n,outputCount:a}=t,o=T0({...r,outputCount:a});if(ts.webgpu.validateInputContent&&w0(n,o),r.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(x0(n,o))}}),E0,C0,pM,f3=at(()=>{tn(),sn(),E0=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},C0=t=>{let r=t[0].dims,n=t[0].dims[2],a=Fe.size(r)/4,o=t[0].dataType,u=We("input",o,r,4),d=We("bias",o,[n],4),c=We("residual",o,r,4),f=St("output",o,r,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)}}),getShaderSource:p=>`
  const channels = ${n}u / 4;
  ${p.declareVariables(u,d,c,f)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes(a)}
    let value = ${u.getByOffset("global_idx")}
      + ${d.getByOffset("global_idx % channels")} + ${c.getByOffset("global_idx")};
    ${f.setByOffset("global_idx","value")}
  }`}},pM=t=>{E0(t.inputs),t.compute(C0(t.inputs))}}),S0,wn,hM,mM,_M,gM,yM,bM,MM,vM,wM,P0,xM,TM,EM,CM,Wp,SM,dm,PM,AM,OM,$M,DM,kM,LM,IM,zM,FM,RM,BM,NM,jM,UM,VM,p_,GM,t1,n1,WM,HM,qM,A0,O0,KM,P1=at(()=>{Nt(),tn(),xs(),sn(),S0=(t,r,n,a,o,u,d)=>{let c=Math.ceil(r/4),f="";typeof o=="string"?f=`${o}(a)`:f=o("a");let p=We("inputData",n,[c],4),g=St("outputData",a,[c],4),_=[{name:"vec_size",type:"u32"}];return d&&_.push(...d),`
      ${t.registerUniforms(_).declareVariables(p,g)}

  ${u??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${p.getByOffset("global_idx")};
    ${g.setByOffset("global_idx",f)}
  }`},wn=(t,r,n,a,o,u=t.dataType,d,c)=>{let f=[{type:12,data:Math.ceil(Fe.size(t.dims)/4)}];return d&&f.push(...d),{name:r,shaderCache:{hint:o,inputDependencies:["type"]},getShaderSource:p=>S0(p,Fe.size(t.dims),t.dataType,u,n,a,c),getRunData:p=>({outputs:[{dims:t.dims,dataType:u}],dispatchGroup:{x:Math.ceil(Fe.size(p[0].dims)/64/4)},programUniforms:f})}},hM=t=>{t.compute(wn(t.inputs[0],"Abs","abs"))},mM=t=>{t.compute(wn(t.inputs[0],"Acos","acos"))},_M=t=>{t.compute(wn(t.inputs[0],"Acosh","acosh"))},gM=t=>{t.compute(wn(t.inputs[0],"Asin","asin"))},yM=t=>{t.compute(wn(t.inputs[0],"Asinh","asinh"))},bM=t=>{t.compute(wn(t.inputs[0],"Atan","atan"))},MM=t=>{t.compute(wn(t.inputs[0],"Atanh","atanh"))},vM=t=>Sn(t),wM=(t,r)=>{let n;switch(r.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${r.to}`)}t.compute(wn(t.inputs[0],"Cast",n,void 0,r.cacheKey,r.to))},P0=t=>{let r,n,a=t.length>=2&&t[1].data!==0,o=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:r=a?t[1].getFloat32Array()[0]:-34028234663852886e22,n=o?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:r=a?t[1].getUint16Array()[0]:64511,n=o?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return Sn({min:r,max:n})},xM=(t,r)=>{let n=r||P0(t.inputs),a=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"Clip",o=>`clamp(${o}, vec4<${a}>(uniforms.min), vec4<${a}>(uniforms.max))`,void 0,n.cacheKey,void 0,[{type:t.inputs[0].dataType,data:n.min},{type:t.inputs[0].dataType,data:n.max}],[{name:"min",type:a},{name:"max",type:a}]),{inputs:[0]})},TM=t=>{t.compute(wn(t.inputs[0],"Ceil","ceil"))},EM=t=>{t.compute(wn(t.inputs[0],"Cos","cos"))},CM=t=>{t.compute(wn(t.inputs[0],"Cosh","cosh"))},Wp=t=>Sn(t),SM=(t,r)=>{let n=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"Elu",a=>`elu_vf32(${a})`,`
  const elu_alpha_ = ${n}(${r.alpha});

  fn elu_f32(a: ${n}) -> ${n} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,r.cacheKey))},dm=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,PM=t=>{let r=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"Erf",n=>`erf_vf32(${n})`,dm(r)))},AM=t=>{t.compute(wn(t.inputs[0],"Exp","exp"))},OM=t=>{t.compute(wn(t.inputs[0],"Floor","floor"))},$M=t=>{let r=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"Gelu",n=>`0.5 * ${n} * (1.0 + erf_vf32(${n} * 0.7071067811865475))`,dm(r)))},DM=(t,r)=>{let n=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"LeakyRelu",a=>`select(leaky_relu_alpha_ * ${a}, ${a}, ${a} >= vec4<${n}>(0.0))`,`const leaky_relu_alpha_ = ${n}(${r.alpha});`,r.cacheKey))},kM=t=>{t.compute(wn(t.inputs[0],"Not",r=>`!${r}`))},LM=t=>{t.compute(wn(t.inputs[0],"Neg",r=>`-${r}`))},IM=t=>{t.compute(wn(t.inputs[0],"Reciprocal",r=>`1.0/${r}`))},zM=t=>{let r=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"Relu",n=>`select(vec4<${r}>(0.0), ${n}, ${n} > vec4<${r}>(0.0))`))},FM=t=>{t.compute(wn(t.inputs[0],"Sigmoid",r=>`(1.0 / (1.0 + exp(-${r})))`))},RM=t=>Sn(t),BM=(t,r)=>{let n=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"HardSigmoid",a=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${r.alpha} * ${a} + vec4<${n}>(${r.beta})))`,void 0,r.cacheKey))},NM=t=>{t.compute(wn(t.inputs[0],"Sin","sin"))},jM=t=>{t.compute(wn(t.inputs[0],"Sinh","sinh"))},UM=t=>{t.compute(wn(t.inputs[0],"Sqrt","sqrt"))},VM=t=>{t.compute(wn(t.inputs[0],"Tan","tan"))},p_=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,GM=t=>{t.compute(wn(t.inputs[0],"Tanh",p_))},t1=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${p_("v")};
}
`,n1=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,WM=t=>{let r=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"FastGelu",n1,t1(r),void 0,t.inputs[0].dataType))},HM=(t,r)=>{let n=yr(t.inputs[0].dataType);return t.compute(wn(t.inputs[0],"ThresholdedRelu",a=>`select(vec4<${n}>(0.0), ${a}, ${a} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${n}>(${r.alpha});`,r.cacheKey)),0},qM=t=>{t.compute(wn(t.inputs[0],"Log","log"))},A0=(t,r)=>`
const alpha = vec4<${t}>(${r});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,O0=t=>`quick_gelu_impl(${t})`,KM=(t,r)=>{let n=yr(t.inputs[0].dataType);t.compute(wn(t.inputs[0],"QuickGelu",O0,A0(n,r.alpha),r.cacheKey,t.inputs[0].dataType))}}),$0,D0,QM,p3=at(()=>{tn(),sn(),P1(),$0=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},D0=t=>{let r=t[0].dims.slice();r[2]=r[2]/2;let n=We("input",t[0].dataType,t[0].dims,4),a=We("bias",t[0].dataType,[t[0].dims[2]],4),o=St("output",t[0].dataType,r,4),u=Fe.size(r)/4,d=Ys(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)}}),getShaderSource:c=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${c.declareVariables(n,a,o)}

  ${dm(d)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(u)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${o.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},QM=t=>{$0(t.inputs),t.compute(D0(t.inputs))}}),k0,L0,Ja,XM,YM,ZM,JM,ev,tv,nv,sv,rv,av,h3=at(()=>{Nt(),tn(),sn(),k0=(t,r,n,a,o,u,d,c,f,p,g,_)=>{let h,w;typeof c=="string"?h=w=(T,L)=>`${c}((${T}),(${L}))`:typeof c=="function"?h=w=c:(h=c.scalar,w=c.vector);let M=St("outputData",g,a.length,4),x=We("aData",f,r.length,4),F=We("bData",p,n.length,4),E;if(o)if(u){let T=Fe.size(r)===1,L=Fe.size(n)===1,O=r.length>0&&r[r.length-1]%4===0,S=n.length>0&&n[n.length-1]%4===0;T||L?E=M.setByOffset("global_idx",w(T?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"),L?`${F.type.value}(${F.getByOffset("0")}.x)`:F.getByOffset("global_idx"))):E=`
            let outputIndices = ${M.offsetToIndices("global_idx * 4u")};
            let offsetA = ${x.broadcastedIndicesToOffset("outputIndices",M)};
            let offsetB = ${F.broadcastedIndicesToOffset("outputIndices",M)};
            ${M.setByOffset("global_idx",w(d||O?x.getByOffset("offsetA / 4u"):`${x.type.value}(${x.getByOffset("offsetA / 4u")}[offsetA % 4u])`,d||S?F.getByOffset("offsetB / 4u"):`${F.type.value}(${F.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else E=M.setByOffset("global_idx",w(x.getByOffset("global_idx"),F.getByOffset("global_idx")));else{if(!u)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let T=(L,O,S="")=>{let $=`aData[indexA${O}][componentA${O}]`,C=`bData[indexB${O}][componentB${O}]`;return`
            let outputIndices${O} = ${M.offsetToIndices(`global_idx * 4u + ${O}u`)};
            let offsetA${O} = ${x.broadcastedIndicesToOffset(`outputIndices${O}`,M)};
            let offsetB${O} = ${F.broadcastedIndicesToOffset(`outputIndices${O}`,M)};
            let indexA${O} = offsetA${O} / 4u;
            let indexB${O} = offsetB${O} / 4u;
            let componentA${O} = offsetA${O} % 4u;
            let componentB${O} = offsetB${O} % 4u;
            ${L}[${O}] = ${S}(${h($,C)});
          `};g===9?E=`
            var data = vec4<u32>(0);
            ${T("data",0,"u32")}
            ${T("data",1,"u32")}
            ${T("data",2,"u32")}
            ${T("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:E=`
            ${T("outputData[global_idx]",0)}
            ${T("outputData[global_idx]",1)}
            ${T("outputData[global_idx]",2)}
            ${T("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(x,F,M)}

        ${_??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${E}
      }`},L0=(t,r,n,a,o,u,d=n.dataType)=>{let c=n.dims.map(x=>Number(x)??1),f=a.dims.map(x=>Number(x)??1),p=!Fe.areEqual(c,f),g=c,_=Fe.size(c),h=!1,w=!1,M=[p];if(p){let x=Ld.calcShape(c,f,!1);if(!x)throw new Error("Can't perform binary op on the given tensors");g=x.slice(),_=Fe.size(g);let F=Fe.size(c)===1,E=Fe.size(f)===1,T=c.length>0&&c[c.length-1]%4===0,L=f.length>0&&f[f.length-1]%4===0;M.push(F),M.push(E),M.push(T),M.push(L);let O=1;for(let S=1;S<g.length;S++){let $=c[c.length-S],C=f[f.length-S];if($===C)O*=$;else break}O%4===0?(w=!0,h=!0):(F||E||T||L)&&(h=!0)}else h=!0;return M.push(h),{name:t,shaderCache:{hint:r+M.map(x=>x.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:x=>k0(x,c,f,g,h,p,w,o,n.dataType,a.dataType,d,u),getRunData:()=>({outputs:[{dims:g,dataType:d}],dispatchGroup:{x:Math.ceil(_/64/4)},programUniforms:[{type:12,data:Math.ceil(Fe.size(g)/4)},...Lt(c,f,g)]})}},Ja=(t,r,n,a,o,u)=>{t.compute(L0(r,o??"",t.inputs[0],t.inputs[1],n,a,u))},XM=t=>{Ja(t,"Add",(r,n)=>`${r}+${n}`)},YM=t=>{Ja(t,"Div",(r,n)=>`${r}/${n}`)},ZM=t=>{Ja(t,"Equal",{scalar:(r,n)=>`u32(${r}==${n})`,vector:(r,n)=>`vec4<u32>(${r}==${n})`},void 0,void 0,9)},JM=t=>{Ja(t,"Mul",(r,n)=>`${r}*${n}`)},ev=t=>{let r=We("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;Ja(t,"Pow",{scalar:(n,a)=>`pow_custom(${n},${a})`,vector:(n,a)=>`pow_vector_custom(${n},${a})`},`
    fn pow_custom(a : ${r}, b : ${r}) -> ${r} {
      if (b == ${r}(0.0)) {
        return ${r}(1.0);
      } else if (a < ${r}(0.0) && f32(b) != floor(f32(b))) {
        return ${r}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${r}(1.0), round(f32(abs(b) % ${r}(2.0))) != 1.0) * ${r}(${r==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${r}>, b : vec4<${r}>) -> vec4<${r}> {
      // TODO: implement vectorized pow
      return vec4<${r}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},tv=t=>{Ja(t,"Sub",(r,n)=>`${r}-${n}`)},nv=t=>{Ja(t,"Greater",{scalar:(r,n)=>`u32(${r}>${n})`,vector:(r,n)=>`vec4<u32>(${r}>${n})`},void 0,void 0,9)},sv=t=>{Ja(t,"Less",{scalar:(r,n)=>`u32(${r}<${n})`,vector:(r,n)=>`vec4<u32>(${r}<${n})`},void 0,void 0,9)},rv=t=>{Ja(t,"GreaterOrEqual",{scalar:(r,n)=>`u32(${r}>=${n})`,vector:(r,n)=>`vec4<u32>(${r}>=${n})`},void 0,void 0,9)},av=t=>{Ja(t,"LessOrEqual",{scalar:(r,n)=>`u32(${r}<=${n})`,vector:(r,n)=>`vec4<u32>(${r}<=${n})`},void 0,void 0,9)}}),I0,z0,F0,R0,iv,ov,m3=at(()=>{Nt(),tn(),xs(),sn(),I0=(t,r)=>{if(!t||t.length<1)throw new Error("too few inputs");let n=0,a=t[n],o=a.dataType,u=a.dims.length;t.forEach((d,c)=>{if(c!==n){if(d.dataType!==o)throw new Error("input tensors should be one type");if(d.dims.length!==u)throw new Error("input tensors should have the same shape");d.dims.forEach((f,p)=>{if(p!==r&&f!==a.dims[p])throw new Error("non concat dimensions must match")})}})},z0=(t,r)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${r});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,F0=(t,r)=>{let n=t.length,a=[];for(let o=0;o<n;++o){let u=r.setByOffset("global_idx",t[o].getByIndices("indices"));n===1?a.push(u):o===0?a.push(`if (inputIndex == ${o}u) { ${u} }`):o===n-1?a.push(`else { ${u} }`):a.push(`else if (inputIndex == ${o}) { ${u} }`)}return a.join(`
`)},R0=(t,r,n,a)=>{let o=Fe.size(n),u=new Array(t.length),d=new Array(t.length),c=0,f=[],p=[],g=[{type:12,data:o}];for(let x=0;x<t.length;++x)c+=t[x].dims[r],u[x]=c,p.push(t[x].dims.length),d[x]=We(`input${x}`,a,p[x]),f.push("rank"),g.push({type:12,data:u[x]});for(let x=0;x<t.length;++x)g.push(...Lt(t[x].dims));g.push(...Lt(n));let _=St("output",a,n.length),h=_.indicesGet("indices",r),w=Array.from(Array(u.length).keys()).map(x=>`uniforms.sizeInConcatAxis${x}`).join(","),M=x=>`

  ${(()=>{x.registerUniform("outputSize","u32");for(let F=0;F<t.length;F++)x.registerUniform(`sizeInConcatAxis${F}`,"u32");return x.declareVariables(...d,_)})()}

  ${z0(u.length,w)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${_.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${h});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${u.length}u>(${w});
      ${h} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${F0(d,_)}
  }`;return{name:"Concat",shaderCache:{hint:`${r}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:n,dataType:a}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:g}),getShaderSource:M}},iv=(t,r)=>{let n=t.inputs,a=n[0].dims,o=Fe.normalizeAxis(r.axis,a.length);I0(n,o);let u=a.slice();u[o]=n.reduce((c,f)=>c+(f.dims.length>o?f.dims[o]:0),0);let d=n.filter(c=>Fe.size(c.dims)>0);t.compute(R0(d,o,u,n[0].dataType),{inputs:d})},ov=t=>Sn({axis:t.axis})}),Yu,Zu,Ju,A1,tc=at(()=>{Nt(),tn(),Yu=(t,r,n="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${r}(0.0));`;case"Sigmoid":return`value = (${r}(1.0) / (${r}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${r}(${n}(uniforms.clip_min)), ${r}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${r}(0.0), min(${r}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${r}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},Zu=(t,r)=>{t.activation==="Clip"?r.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?r.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&r.push({type:1,data:t.alpha})},Ju=(t,r)=>{t.activation==="Clip"?r.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?r.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&r.push({name:"alpha",type:"f32"})},A1=t=>{let r=t?.activation||"";if(r==="HardSigmoid"){let[n,a]=t?.activation_params||[.2,.5];return{activation:r,alpha:n,beta:a}}else if(r==="Clip"){let[n,a]=t?.activation_params||[kb,Lb];return{activation:r,clipMax:a,clipMin:n}}else if(r==="LeakyRelu"){let[n]=t?.activation_params||[.01];return{activation:r,alpha:n}}return{activation:r}}}),rr,lv,O1=at(()=>{rr=(t,r)=>{switch(t){case 1:return r;case 2:return`vec2<${r}>`;case 3:return`vec3<${r}>`;case 4:return`vec4<${r}>`;default:throw new Error(`${t}-component is not supported.`)}},lv=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),uv,_3=at(()=>{uv=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),qp,$1,D1=at(()=>{Nt(),tn(),sn(),tc(),qp=(t,r,n,a,o)=>{let u=a-n;return`
      ${Array.from({length:n}).map((d,c)=>`
      if (${At(r.shape,c,r.rank)} != 1) {
        ${r.indicesSet(t,c,At(o,c+u,a))}
      } else {
        ${r.indicesSet(t,c,0)}
      }`).join("")}
`},$1=(t,r,n,a,o=!1,u)=>{let d=t[0].dims,c=t[1].dims,f=d[d.length-2],p=c[c.length-1],g=d[d.length-1],_=_s(p),h=_s(g),w=_s(f),M=Fe.size(n)/_/w,x=t.length>2,F=a?a.slice(0,-2):n.slice(0,-2),E=[Fe.size(F),f,p],T=[{type:12,data:M},{type:12,data:f},{type:12,data:p},{type:12,data:g}];Zu(r,T),T.push(...Lt(F,d,c)),x&&T.push(...Lt(t[2].dims)),T.push(...Lt(E));let L=O=>{let S=E1("batch_dims",t[0].dataType,F.length),$=We("a",t[0].dataType,d.length,h),C=We("b",t[1].dataType,c.length,_),k=St("output",t[0].dataType,E.length,_),U=Ys(k.type.tensor),V=Yu(r,k.type.value,U),re=[$,C],ne="";if(x){let ae=o?_:1;re.push(We("bias",t[2].dataType,t[2].dims.length,ae)),ne=`${o?`value += bias[col / ${ae}];`:`value += ${k.type.value}(bias[row + i]);`}`}let W=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Ju(r,W);let ce=()=>{let ae=`var a_data: ${$.type.value};`;for(let H=0;H<h;H++)ae+=`
              let b_data${H} = b[(b_offset + (k + ${H}) * uniforms.N + col) / ${_}];`;for(let H=0;H<w;H++){ae+=`a_data = a[(a_offset + (row + ${H}) * uniforms.K + k) / ${h}];`;for(let se=0;se<h;se++)ae+=`
            values[${H}] = fma(${C.type.value}(a_data${h===1?"":`[${se}]`}), b_data${se}, values[${H}]);
`}return ae};return`
  ${O.registerUniforms(W).registerInternalVariables(S).declareVariables(...re,k)}
  ${O.mainStart()}
    ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${_})) * ${_};
    var index1 = global_idx / (uniforms.N / ${_});
    let stride1 = uniforms.M / ${w};
    let row = (index1 % stride1) * ${w};
    let batch = index1 / stride1;

    ${n.length===2?"":`let batch_indices = ${S.offsetToIndices("batch")};`}

    var a_indices: ${$.type.indices};
    ${qp("a_indices",$,$.rank-2,S.rank,"batch_indices")}
    ${$.indicesSet("a_indices",$.rank-2,0)}
    ${$.indicesSet("a_indices",$.rank-1,0)}
    let a_offset = ${$.indicesToOffset("a_indices")};

    var b_indices: ${C.type.indices};
    ${qp("b_indices",C,C.rank-2,S.rank,"batch_indices")}
    ${C.indicesSet("b_indices",C.rank-2,0)}
    ${C.indicesSet("b_indices",C.rank-1,0)}
    let b_offset = ${C.indicesToOffset("b_indices")};
    var values: array<${k.type.value}, ${w}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${h}) {
      ${ce()}
    }
    for (var i = 0u; i < ${w}u; i++) {
      var value = values[i];
      ${ne}
      ${V}
      let cur_indices = ${k.type.indices}(batch, row + i, col);
      let offset = ${k.indicesToOffset("cur_indices")};
      ${k.setByOffset(`offset / ${_}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${r.activation};${_};${h};${w};${o}`,inputDependencies:x?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:u?u(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(M/64)},programUniforms:T}),getShaderSource:L}}}),B0,N0,s1,h_,j0,r1,U0,_m,k1=at(()=>{Nt(),tn(),sn(),tc(),D1(),O1(),B0=(t,r)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${r?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${r?", batchIndices":""});
        `,N0=(t,r)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${r===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${r===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${r===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,s1=(t,r,n="f32",a,o=!1,u=32,d=!1,c=32)=>{let f=r[1]*t[1],p=r[0]*t[0],g=o?f:u,_=o?u:f,h=g/r[0],w=u/r[1];if(!((o&&h===4&&t[1]===4||!o&&(h===3||h===4))&&g%r[0]===0&&u%r[1]===0&&t[0]===4))throw new Error(`If transposeA ${o} is true, innerElementSize ${h} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${h} must be 3 or 4.
  tileAWidth ${g} must be divisible by workgroupSize[0]${r[0]}. tileInner ${u} must be divisible by workgroupSize[1] ${r[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${h}<${n}>, ${g/h}>, ${_}>;
var<workgroup> mm_Bsub: array<array<vec4<${n}>, ${p/t[0]}>, ${u}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${h};
const tileInner = ${u};

@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${d?"0":"i32(globalId.z)"};
  ${a?`let batchIndices = ${a.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${f};

  let num_tiles = ${d?`${Math.ceil(c/u)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${d?`i32(globalId.z) * ${c}`:"0"};

  var acc: array<vec4<${n}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${w};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${B0(o,a)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${a?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${h===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${N0(o,h)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},h_=(t,r)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${r?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${r?", batchIndices":""});
            `,j0=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",r1=(t,r,n="f32",a,o=!1,u=32,d=!1,c=32,f=!1)=>{let p=t[1]*r[1],g=t[0]*r[0],_=o?p:u,h=o?u:p;if(!(h%r[1]===0&&_%r[0]===0&&u%r[1]===0))throw new Error(`tileAHight ${h} must be divisible by workgroupSize[1]${r[1]}, tileAWidth ${_} must be divisible by workgroupSize[0]${r[0]}, tileInner ${u} must be divisible by workgroupSize[1]${r[1]}`);let w=h/r[1],M=_/r[0],x=u/r[1],F=f?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${p};
    let globalColStart = i32(workgroupId.x) * ${g};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${h}; inputRow = inputRow + ${r[1]}) {
        for (var inputCol = localCol; inputCol < ${_}; inputCol = inputCol + ${r[0]}) {
          ${h_(o,a)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${u}; inputRow = inputRow + ${r[1]}) {
            for (var inputCol = localCol; inputCol < ${g}; inputCol = inputCol + ${r[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${a?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${n}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${r[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${o?`mm_Asub[k][localRow + innerRow * ${r[1]}];`:`mm_Asub[localRow + innerRow * ${r[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${r[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${r[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${p};

let tileRowA = i32(localId.y) * ${w};
let tileColA = i32(localId.x) * ${M};
let tileRowB = i32(localId.y) * ${x};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${M}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${h_(o,a)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${x}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${a?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${n}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${j0(o)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${n}, ${_}>, ${h}>;
  var<workgroup> mm_Bsub : array<array<${n}, ${g}>, ${u}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${u};

@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${d?"0":"i32(globalId.z)"};
    ${a?`let batchIndices = ${a.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${d?`${Math.ceil(c/u)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${d?`i32(globalId.z) * ${c}`:"0"};

    var acc : array<array<${n}, colPerThread>, rowPerThread>;
    ${F}
  }
`},U0=(t,r,n,a,o=!1)=>{let[u,d,c,f]=a,p=Ys(a[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${u.type.indices}) -> ${rr(t,p)} {
      var value = ${rr(t,p)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${d.type.indices};
        ${qp("aIndices",d,d.rank-2,u.rank,"batchIndices")}
        ${d.indicesSet("aIndices",d.rank-2,"u32(row)")}
        ${d.indicesSet("aIndices",d.rank-1,"u32(colIn)")}
        value = ${d.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${u.type.indices}) -> ${rr(t,p)} {
      var value = ${rr(t,p)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${c.type.indices};
        ${qp("bIndices",c,c.rank-2,u.rank,"batchIndices")}
        ${c.indicesSet("bIndices",c.rank-2,"u32(row)")}
        ${c.indicesSet("bIndices",c.rank-1,"u32(colIn)")}
        value = ${c.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${rr(t,p)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${r?`value = value + ${o?"bias[colIn]":`${rr(t,p)}(bias[row])`};`:""}
        ${n}
        ${f.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},_m=(t,r,n,a,o=!1,u)=>{let d=t[0].dims,c=t[1].dims,f=d.slice(0,-2),p=c.slice(0,-2),g=a?a.slice(0,-2):n.slice(0,-2),_=Fe.size(g),h=d[d.length-2],w=d[d.length-1],M=c[c.length-1],x=w%4===0&&M%4===0,F=h<=8?[4,1,1]:[4,4,1],E=[8,8,1],T=[Math.ceil(M/E[0]/F[0]),Math.ceil(h/E[1]/F[1]),Math.ceil(_/E[2]/F[2])],L=x?4:1,O=[...f,h,w/L],S=O.length,$=[...p,w,M/L],C=$.length,k=[_,h,M/L],U=[{type:6,data:h},{type:6,data:M},{type:6,data:w}];Zu(r,U),U.push(...Lt(g,O,$));let V=["rank","rank"],re=t.length>2;re&&(U.push(...Lt(t[2].dims)),V.push("rank")),U.push(...Lt(k));let ne=W=>{let ce=g.length,ae=E1("batchDims",t[0].dataType,ce,1),H=Ys(t[0].dataType),se=We("a",t[0].dataType,S,L),ie=We("b",t[1].dataType,C,L),ge=St("result",t[0].dataType,k.length,L),q=[se,ie];if(re){let pe=o?L:1;q.push(We("bias",t[2].dataType,t[2].dims.length,pe))}let j=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Ju(r,j);let R=Ys(ge.type.tensor),X=Yu(r,ge.type.value,R),G=U0(L,re,X,[ae,se,ie,ge],o);return`
  ${W.registerUniforms(j).registerInternalVariables(ae).declareVariables(...q,ge)}
  ${G}
  ${x?s1(F,E,H,ae):r1(F,E,H,ae)}
                   `};return{name:"MatMul",shaderCache:{hint:`${F};${r.activation};${x};${o}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:u?u(n):n,dataType:t[0].dataType}],dispatchGroup:{x:T[0],y:T[1],z:T[2]},programUniforms:U}),getShaderSource:ne}}}),V0,cv,g3=at(()=>{Nt(),vo(),sn(),tc(),O1(),_3(),k1(),V0=(t,r,n,a,o=!1,u,d=4,c=4,f=4,p="f32")=>{let g=U=>{switch(U){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${p}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${U} is not supported.`)}},_=U=>{switch(U){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${U} is not supported.`)}},h=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,w=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,M=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",x=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",F=t?"row":"col",E=t?"col":"row",T=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${F} / outWidth;
    let outCol = ${F} % outWidth;

    let WRow = ${E} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${E} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${E} % inChannels;
    var resData = ${rr(d,p)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${M} && xCol >= 0 && xCol < ${x}) {
      ${h}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${g(d)}
    }
    return resData;`,L=t?r&&a?`
    let col = colIn * ${d};
    ${T}`:`
    let col = colIn * ${d};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${T}
    }
    return ${rr(d,p)}(0.0);`:a&&n?`
    let col = colIn * ${d};
    ${T}`:`
    let col = colIn * ${d};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${T}
    }
    return ${rr(d,p)}(0.0);`,O=t?a&&n?_(c):`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_(c)}
    }
    return ${rr(c,p)}(0.0);`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${_(c)}
    }
    return ${rr(c,p)}(0.0);`,S=rr(f,p),$=rr(t?d:c,p),C=rr(t?c:d,p),k=Yu(u,S,p);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${$} {
      ${t?L:O}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${C} {
      ${t?O:L}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${S}) {
      let col = colIn * ${f};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${w}
      ${lv(o)}
      ${k}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},cv=(t,r,n,a,o,u,d,c,f)=>{let p=r.format==="NHWC",g=p?t[0].dims[3]:t[0].dims[1],_=n[0],h=p?n[2]:n[3],w=p?n[1]:n[2],M=p?n[3]:n[1],x=p&&(g%4===0||g%3===0)&&M%4===0,F=p?M:h*w,E=p?h*w:M,T=[8,8,1],L=a<=8?[4,1,1]:[4,4,1],O=[Math.ceil(F/T[0]/L[0]),Math.ceil(E/T[1]/L[1]),Math.ceil(_/T[2]/L[2])];hn("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${O}`);let S=x?p&&g%4!==0?3:4:1,$=T[1]*L[1],C=T[0]*L[0],k=Math.max(T[0]*S,T[1]),U=a%$===0,V=o%C===0,re=u%k===0,ne=x?[S,4,4]:[1,1,1],W=[{type:6,data:a},{type:6,data:o},{type:6,data:u},{type:6,data:[r.pads[0],r.pads[1]]},{type:6,data:r.strides},{type:6,data:r.dilations}];Zu(r,W),W.push(...Lt(t[0].dims,t[1].dims));let ce=["rank","rank"];d&&(W.push(...Lt(t[2].dims)),ce.push("rank")),W.push(...Lt(n));let ae=H=>{let se=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Ju(r,se);let ie=x?4:1,ge=Ys(t[0].dataType),q=`
      fn setOutputAtIndex(flatIndex : i32, value : ${x?`vec4<${ge}>`:ge}) {
        result[flatIndex] = ${x?`vec4<${ge}>`:ge}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${x?`vec4<${ge}>`:ge}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${x?"/ 4":""}, value);
      }`,j=We("x",t[0].dataType,t[0].dims.length,S===3?1:S),R=We("w",t[1].dataType,t[1].dims.length,ie),X=[j,R],G=St("result",t[0].dataType,n.length,ie);if(d){let pe=We("bias",t[2].dataType,t[2].dims.length,ie);X.push(pe),q+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${x?`vec4<${ge}>`:ge} {
          return bias[coords.${p?"w":"y"}${x?"/ 4":""}];
        }`}return`
        ${uv("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${H.registerUniforms(se).declareVariables(...X,G)}
        ${q}
        ${V0(p,U,V,re,d,r,ne[0],ne[1],ne[2],ge)}
        ${x?s1(L,T,ge,void 0,!p,k):r1(L,T,ge,void 0,!p,k,!1,void 0,c)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${r.cacheKey};${S};${x};${U};${V};${re};${$};${C};${k}`,inputDependencies:ce},getRunData:()=>({outputs:[{dims:f?f(n):n,dataType:t[0].dataType}],dispatchGroup:{x:O[0],y:O[1],z:O[2]},programUniforms:W}),getShaderSource:ae}}}),G0,m_,Fp,W0,__,H0,dv,fv,y3=at(()=>{Nt(),vo(),tn(),sn(),tc(),O1(),G0=t=>{let r=1;for(let n=0;n<t.length;n++)r*=t[n];return r},m_=t=>typeof t=="number"?[t,t,t]:t,Fp=(t,r)=>r<=1?t:t+(t-1)*(r-1),W0=(t,r,n,a=1)=>{let o=Fp(r,a);return Math.floor((t[0]*(n-1)-n+o)/2)},__=(t,r,n,a,o)=>{o==null&&(o=W0(t,r[0],a[0]));let u=[0,0,0,n];for(let d=0;d<3;d++)t[d]+2*o>=r[d]&&(u[d]=Math.trunc((t[d]-r[d]+2*o)/a[d]+1));return u},H0=(t,r,n,a,o,u,d,c,f,p)=>{let g,_,h,w;if(t==="VALID"&&(t=0),typeof t=="number"){g={top:t,bottom:t,left:t,right:t,front:t,back:t};let M=__([r,n,a,1],[c,f,p],1,[o,u,d],t);_=M[0],h=M[1],w=M[2]}else if(Array.isArray(t)){if(!t.every((x,F,E)=>x===E[0]))throw Error(`Unsupported padding parameter: ${t}`);g={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let M=__([r,n,a,1],[c,f,p],1,[o,u,d],t[0]);_=M[0],h=M[1],w=M[2]}else if(t==="SAME_UPPER"){_=Math.ceil(r/o),h=Math.ceil(n/u),w=Math.ceil(a/d);let M=(_-1)*o+c-r,x=(h-1)*u+f-n,F=(w-1)*d+p-a,E=Math.floor(M/2),T=M-E,L=Math.floor(x/2),O=x-L,S=Math.floor(F/2),$=F-S;g={top:L,bottom:O,left:S,right:$,front:E,back:T}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:g,outDepth:_,outHeight:h,outWidth:w}},dv=(t,r,n,a,o,u=!1,d="channelsLast")=>{let c,f,p,g,_;if(d==="channelsLast")[c,f,p,g,_]=t;else if(d==="channelsFirst")[c,_,f,p,g]=t;else throw new Error(`Unknown dataFormat ${d}`);let[h,,w,M,x]=r,[F,E,T]=m_(n),[L,O,S]=m_(a),$=Fp(w,L),C=Fp(M,O),k=Fp(x,S),{padInfo:U,outDepth:V,outHeight:re,outWidth:ne}=H0(o,f,p,g,F,E,T,$,C,k),W=u?h*_:h,ce=[0,0,0,0,0];return d==="channelsFirst"?ce=[c,W,V,re,ne]:d==="channelsLast"&&(ce=[c,V,re,ne,W]),{batchSize:c,dataFormat:d,inDepth:f,inHeight:p,inWidth:g,inChannels:_,outDepth:V,outHeight:re,outWidth:ne,outChannels:W,padInfo:U,strideDepth:F,strideHeight:E,strideWidth:T,filterDepth:w,filterHeight:M,filterWidth:x,effectiveFilterDepth:$,effectiveFilterHeight:C,effectiveFilterWidth:k,dilationDepth:L,dilationHeight:O,dilationWidth:S,inShape:t,outShape:ce,filterShape:r}},fv=(t,r,n,a,o,u)=>{let d=u==="channelsLast";d?t[0].dims[3]:t[0].dims[1];let c=[64,1,1],f={x:n.map((F,E)=>E)},p=[Math.ceil(G0(f.x.map(F=>n[F]))/c[0]),1,1];hn("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${p}`);let g=1,_=Fe.size(n),h=[{type:12,data:_},{type:12,data:a},{type:12,data:o},{type:12,data:r.strides},{type:12,data:r.dilations}];Zu(r,h),h.push(...Lt(t[0].dims,t[1].dims));let w=["rank","rank"],M=t.length===3;M&&(h.push(...Lt(t[2].dims)),w.push("rank")),h.push(...Lt(n));let x=F=>{let E=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:a.length},{name:"pads",type:"u32",length:o.length},{name:"strides",type:"u32",length:r.strides.length},{name:"dilations",type:"u32",length:r.dilations.length}];Ju(r,E);let T=1,L=Ys(t[0].dataType),O=We("x",t[0].dataType,t[0].dims.length,g),S=We("W",t[1].dataType,t[1].dims.length,T),$=[O,S],C=St("result",t[0].dataType,n.length,T),k="";if(M){let re=We("bias",t[2].dataType,t[2].dims.length,T);$.push(re),k+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${L} {
          return bias[${d?At("coords",4,5):At("coords",1,5)}];
        }`}let U=rr(g,L),V=Yu(r,U,L);return`
            ${k}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${O.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${S.getByIndices("aIndices")};
            }
          ${F.registerUniforms(E).declareVariables(...$,C)}
          ${F.mainStart()}
          ${F.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${C.offsetToIndices("global_idx")};
              let batch = ${At("coords",0,O.rank)};
              let d2 = ${d?At("coords",O.rank-1,O.rank):At("coords",1,O.rank)};
              let xFRCCorner = vec3<u32>(${d?At("coords",1,O.rank):At("coords",2,O.rank)},
              ${d?At("coords",2,O.rank):At("coords",3,O.rank)},
              ${d?At("coords",3,O.rank):At("coords",4,O.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${d?At("uniforms.x_shape",1,O.rank):At("uniforms.x_shape",2,O.rank)};
              let xShapeZ = ${d?At("uniforms.x_shape",2,O.rank):At("uniforms.x_shape",3,O.rank)};
              let xShapeW = ${d?At("uniforms.x_shape",3,O.rank):At("uniforms.x_shape",4,O.rank)};
              let xShapeU = ${d?At("uniforms.x_shape",4,O.rank):At("uniforms.x_shape",1,O.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${d?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${d?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${d?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${d?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${M?"value = value + getBiasByOutputCoords(coords)":""};
              ${V}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${r.cacheKey};${d};${g};${M}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:p[0],y:p[1],z:p[2]},programUniforms:h}),getShaderSource:x}}}),pv,hv,b3=at(()=>{Nt(),tn(),sn(),tc(),pv=(t,r,n,a)=>{let o=t.length>2,u=o?"value += b[output_channel];":"",d=t[0].dims,c=t[1].dims,f=r.format==="NHWC",p=f?n[3]:n[1],g=p/r.group,_=f&&g>=4?_s(p):1,h=Fe.size(n)/_,w=[{type:12,data:h},{type:12,data:r.dilations},{type:12,data:[r.strides[0],r.strides[1]]},{type:12,data:[r.pads[0],r.pads[1]]},{type:12,data:g}];Zu(r,w),w.push(...Lt(d,[c[0],c[1],c[2],c[3]/_]));let M=o?["rank","rank","rank"]:["rank","rank"];w.push(...Lt([n[0],n[1],n[2],n[3]/_]));let x=F=>{let E=St("output",t[0].dataType,n.length,_),T=Ys(E.type.tensor),L=Yu(r,E.type.value,T),O=We("x",t[0].dataType,d.length),S=We("w",t[1].dataType,c.length,_),$=[O,S];o&&$.push(We("b",t[2].dataType,t[2].dims,_));let C=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:r.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Ju(r,C);let k=f?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${O.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${S.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${O.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${S.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${F.registerUniforms(C).declareVariables(...$,E)}

  ${F.mainStart()}
    ${F.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${E.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${f?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${f?1:2}], outputIndices[${f?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${_} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${f?2:1}];

    var value: ${E.type.value} = ${E.type.value}(0);
    ${k}
    ${u}
    ${L}
    ${E.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${r.cacheKey}_${_}`,inputDependencies:M},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:w}),getShaderSource:x}},hv=(t,r,n,a)=>{let o=t.length>2,u=_s(n[3]),d=_s(n[2]),c=Fe.size(n)/u/d,f=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/u],p=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/u],g=[n[0],n[1],n[2],n[3]/u],_=[{type:12,data:c},{type:6,data:[r.strides[0],r.strides[1]]},{type:6,data:[r.pads[0],r.pads[1]]}];Zu(r,_),_.push(...Lt(f,p,g));let h=(d-1)*r.strides[1]+p[1],w=M=>{let x=St("output",t[0].dataType,g.length,u),F=Ys(x.type.tensor),E=Yu(r,x.type.value,F),T=We("x",t[0].dataType,f.length,u),L=We("w",t[1].dataType,p.length,u),O=[T,L];o&&O.push(We("b",t[2].dataType,t[2].dims,u));let S=o?"value += b[output_channel];":"",$=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Ju(r,$),`
  ${M.registerUniforms($).declareVariables(...O,x)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${d}u;
    let col = (index1 % width1) * ${d}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${T.type.value}, ${h}>;
    var values: array<${x.type.value}, ${d}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${p[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${h}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${T.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${T.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${p[1]}; w_width++) {
          let w_val = ${L.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${d}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${d}u; i++) {
      var value = values[i];
      ${S}
      ${E}
      ${x.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${r.cacheKey};${u};${d};${h};${p[0]};${p[1]}`,inputDependencies:o?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:_}),getShaderSource:w}}}),q0,tm,K0,nm,a1,g_,Q0,X0,i1,M3=at(()=>{tn(),g3(),y3(),k1(),b3(),tc(),D1(),vl(),q0=(t,r,n,a,o,u)=>{let d=t[0],c=t.slice(u?1:2,u?3:4),f=c.length,p=r[0],g=r.slice(2).map((h,w)=>h+(h-1)*(n[w]-1)),_=c.map((h,w)=>h+a[w]+a[w+f]).map((h,w)=>Math.floor((h-g[w]+o[w])/o[w]));return _.splice(0,0,d),_.splice(u?3:1,0,p),_},tm=[2,3,1,0],K0=(t,r)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[r.format==="NHWC"?t[0].dims.length-1:1],a=t[1].dims[1]*r.group;if(n!==a)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let o=t[0].dims.length-2;if(r.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(r.strides.length!==o)throw new Error(`strides should be ${o}D`);if(r.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(r.kernelShape.length!==0&&r.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},nm=(t,r)=>{let n=t.kernelShape.slice();n.length<r[1].dims.length-2&&n.push(...Array(r[1].dims.length-2-n.length).fill(0));for(let u=2;u<r[1].dims.length;++u)n[u-2]===0&&(n[u-2]=r[1].dims[u]);let a=t.pads.slice();hm.adjustPadsBasedOnAutoPad(r[0].dims,t.strides,t.dilations,n,a,t.format==="NHWC",t.autoPad);let o=Object.assign({},t);return Object.assign(o,{kernelShape:n,pads:a}),o},a1=t=>{let r=A1(t),n=t.format,a=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],o=t.dilations,u=t.group,d=t.kernel_shape,c=t.pads,f=t.strides,p=t.w_is_const();return{autoPad:a,format:n,dilations:o,group:u,kernelShape:d,pads:c,strides:f,wIsConst:p,...r,cacheKey:`${t.format};${r.activation};`}},g_=(t,r,n,a)=>{let o=n.format==="NHWC",u=q0(r[0].dims,r[1].dims,n.dilations,n.pads,n.strides,o);if(n.group!==1){let $=[r[0]];if(o){let C=t.kernelCustomData.wT??t.compute(Yr(r[1],tm),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=C),$.push(C)}else $.push(r[1]);r.length===3&&$.push(r[2]),!t.adapterInfo.isArchitecture("ampere")&&o&&r[1].dims[0]===n.group&&r[1].dims[1]===1&&n.dilations[0]===1&&n.dilations[1]===1?t.compute(hv($,n,u,a),{inputs:$}):t.compute(pv($,n,u,a),{inputs:$});return}let d=r.length===3,c=r[0].dims[o?1:2],f=r[0].dims[o?2:3],p=r[0].dims[o?3:1],g=r[1].dims[2],_=r[1].dims[3],h=u[o?1:2],w=u[o?2:3],M=u[o?3:1],x=o&&g===c&&_===f&&n.pads[0]===0&&n.pads[1]===0;if(x||g===1&&_===1&&n.dilations[0]===1&&n.dilations[1]===1&&n.strides[0]===1&&n.strides[1]===1&&n.pads[0]===0&&n.pads[1]===0){let $=u[0],C,k,U,V=[];if(o){let W=t.kernelCustomData.wT??t.compute(Yr(r[1],tm),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=W),x){let ce=c*f*p;C=r[0].reshape([1,$,ce]),k=W.reshape([1,ce,M]),U=[1,$,M]}else C=r[0].reshape([$,c*f,p]),k=W.reshape([1,p,M]),U=[$,h*w,M];V.push(C),V.push(k)}else C=r[0].reshape([$,p,c*f]),k=r[1].reshape([1,M,p]),U=[$,M,h*w],V.push(k),V.push(C);d&&V.push(r[2]);let re=U[2],ne=V[0].dims[V[0].dims.length-1];re<8&&ne<8?t.compute($1(V,n,u,U,o,a),{inputs:V}):t.compute(_m(V,n,u,U,o,a),{inputs:V});return}let F=!0,E=t.kernelCustomData.wT??t.compute(Yr(r[1],tm),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=E);let T=[r[0],E];d&&T.push(r[2]);let L=o?h*w:M,O=o?M:h*w,S=g*_*p;t.compute(cv(T,n,u,L,O,S,d,F,a),{inputs:T})},Q0=(t,r)=>{let n=r.format==="NHWC",a=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&a.push(t.inputs[2]);let o=[0,r.pads[0],0,r.pads[1]],u=[1].concat(r.strides),d=[1].concat(r.dilations),c=[1].concat(r.kernelShape),f=nm({...r,pads:o,strides:u,dilations:d,kernelShape:c},a);g_(t,a,f,p=>n?[p[0],p[2],p[3]]:[p[0],p[1],p[3]])},X0=(t,r,n)=>{let a=n.format==="NHWC"?"channelsLast":"channelsFirst",o=nm(n,r),u=n.autoPad==="NOTSET"?n.pads:n.autoPad,d=dv(r[0].dims,r[1].dims,n.strides,n.dilations,u,!1,a);t.compute(fv(r,o,d.outShape,[d.filterDepth,d.filterHeight,d.filterWidth],[d.padInfo.front,d.padInfo.top,d.padInfo.left],a))},i1=(t,r)=>{if(K0(t.inputs,r),t.inputs[0].dims.length===3)Q0(t,r);else if(t.inputs[0].dims.length===5)X0(t,t.inputs,r);else{let n=nm(r,t.inputs);g_(t,t.inputs,n)}}}),mv,v3=at(()=>{Nt(),vo(),tn(),sn(),mv=(t,r,n)=>{let a=t.length>2,o=r.outputShape,u=r.format==="NHWC",d=r.group,c=t[1].dims,f=c[2]/d,p=c[3],g=u?_s(f):1,_=u&&p===1&&f>=4,h=_?Math.floor(f/4)*4:Math.floor(f/g)*g,w=f-h,M=u?_s(p):1,x=u?p===1?g:M:1,F=Fe.size(o)/M,E=[Math.ceil(F/64),1,1];hn("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${E}`);let T=["rank","rank"],L=[r.strides[0],r.strides[1]],O=[r.kernelShape[u?1:2],r.kernelShape[u?2:3]],S=[r.dilations[0],r.dilations[1]],$=[O[0]+(r.dilations[0]<=1?0:(r.kernelShape[u?1:2]-1)*(r.dilations[0]-1)),O[1]+(r.dilations[1]<=1?0:(r.kernelShape[u?2:3]-1)*(r.dilations[1]-1))],C=[$[0]-1-Math.floor((r.pads[0]+r.pads[2])/2),$[1]-1-Math.floor((r.pads[1]+r.pads[3])/2)],k=[{type:12,data:F},{type:12,data:L},{type:12,data:O},{type:12,data:S},{type:12,data:$},{type:6,data:C},{type:12,data:h},{type:12,data:f},{type:12,data:p},...Lt(t[0].dims,t[1].dims)];a&&(k.push(...Lt(t[2].dims)),T.push("rank")),k.push(...Lt(o));let U=V=>{let re=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:L.length},{name:"filter_dims",type:"u32",length:O.length},{name:"dilations",type:"u32",length:O.length},{name:"effective_filter_dims",type:"u32",length:$.length},{name:"pads",type:"i32",length:C.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],ne=Ys(t[0].dataType),W=u?1:2,ce=u?2:3,ae=u?3:1,H=We("W",t[1].dataType,t[1].dims.length,x),se=We("Dy",t[0].dataType,t[0].dims.length,g),ie=[se,H];a&&ie.push(We("bias",t[2].dataType,[o[ae]].length,M));let ge=St("result",t[0].dataType,o.length,M),q=()=>{let X="";if(_)g===4?X+=`
        let xValue = ${se.getByOffset("x_offset")};
        let wValue = ${H.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:g===2?X+=`
          dotProd = dotProd + dot(vec4<${ne}>(${se.getByOffset("x_offset")}, ${se.getByOffset("x_offset + 1u")}), vec4<${ne}>(${H.getByOffset("w_offset")}, ${H.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:g===1&&(X+=`
          dotProd = dotProd + dot(vec4<${ne}>(${se.getByOffset("x_offset")}, ${se.getByOffset("x_offset + 1u")}, ${se.getByOffset("x_offset + 2u")}, ${se.getByOffset("x_offset + 3u")}), vec4<${ne}>(${H.getByOffset("w_offset")}, ${H.getByOffset("w_offset + 1u")}, ${H.getByOffset("w_offset + 2u")}, ${H.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(X+=`
                  let xValue = ${u?se.getByOffset(`${se.indicesToOffset(`${se.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${g}`):se.get("batch","inputChannel","idyR","idyC")};
        `,g===1)X+=`
          let w_offset = ${H.indicesToOffset(`${H.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${H.getByOffset(`w_offset / ${x}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let G=0;G<g;G++)X+=`
            let wValue${G} = ${H.getByOffset(`${H.indicesToOffset(`${H.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${G}, wOutChannel)`)} / ${x}`)};
            dotProd = dotProd + xValue[${G}] * wValue${G};`;return X},j=()=>{if(w===0)return"";if(!_)throw new Error(`packInputAs4 ${_} is not true.`);let X="";if(g===1){X+="dotProd = dotProd";for(let G=0;G<w;G++)X+=`
            + ${se.getByOffset(`x_offset + ${G}`)} * ${H.getByOffset(`w_offset + ${G}`)}`;X+=";"}else if(g===2){if(w!==2)throw new Error(`Invalid inputChannelsRemainder ${w}.`);X+=`
          let xValue = ${se.getByOffset("x_offset")};
          let wValue = ${H.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return X},R=`
            let outputIndices = ${ge.offsetToIndices(`global_idx * ${M}`)};
            let batch = ${ge.indicesGet("outputIndices",0)};
            let d1 = ${ge.indicesGet("outputIndices",ae)};
            let r = ${ge.indicesGet("outputIndices",W)};
            let c = ${ge.indicesGet("outputIndices",ce)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ge.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${ne}(dyRCorner) + ${ne}(wR)) / ${ne}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${ne}(uniforms.Dy_shape[${W}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${ne}(dyCCorner) + ${ne}(wC)) / ${ne}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${ne}(uniforms.Dy_shape[${ce}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${_?`
                var x_offset = ${se.indicesToOffset(`${se.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${g};
                var w_offset = ${H.indicesToOffset(`${H.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${x};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${_?4:g}) {
                  ${q()}
                  inputChannel = inputChannel + ${_?4:g};
                }
                ${j()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${a?` + bias[d1 / ${M}]`:""};
            ${ge.setByOffset("global_idx","value")};
          `;return`
    ${V.registerUniforms(re).declareVariables(...ie,ge)}
      ${V.mainStart()}
      ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${R}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${r.cacheKey};${g}${x}${M}${_}${w}`,inputDependencies:T},getRunData:()=>({dispatchGroup:{x:E[0],y:E[1],z:E[2]},outputs:[{dims:n?n(o):o,dataType:t[0].dataType}],programUniforms:k}),getShaderSource:U}}}),Y0,Z0,J0,y_,_v,e2,b_,t2,gv,w3=at(()=>{v3(),tc(),vl(),Y0=(t,r,n,a,o,u)=>(t-1)*r+n+(a-1)*o+1-u,Z0=(t,r,n,a,o)=>{let u=Math.floor(t/2);r==="SAME_UPPER"?(n[a]=u,n[o]=t-u):r==="SAME_LOWER"&&(n[a]=t-u,n[o]=u)},J0=(t,r,n,a,o,u,d,c,f,p)=>{let g=t.length-2,_=p.length===0;f.length<g&&f.push(...Array(g-f.length).fill(0));let h=t[0],w=r[c?3:1]*o;for(let M=0,x=t.length-g-(c?1:0);M<g;++M,++x){let F=t[x],E=_?F*d[M]:p[M],T=Y0(F,d[M],u[M],r[x],n[M],E);Z0(T,a,u,M,M+g),_&&p.push(d[M]*(F-1)+f[M]+(r[x]-1)*n[M]+1-u[M]-u[M+g])}p.splice(0,0,h),p.splice(c?3:1,0,w)},y_=(t,r)=>{let n=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((_,h)=>_*h,1)===0){n.length=0;for(let _=2;_<r[1].dims.length;++_)n.push(r[1].dims[_])}let a=t.format==="NHWC";n.splice(0,0,r[1].dims[0]),n.splice(a?3:1,0,r[1].dims[1]);let o=t.pads.slice(),u=t.outputShape.slice(),d=t.outputPadding.slice(),c=r[0].dims,f=t.dilations.slice();if(f.reduce((_,h)=>_+h,0)===0){let _=r[0].dims.length-2;f=new Array(_).fill(1)}let p=t.strides.slice();if(p.reduce((_,h)=>_+h,0)===0){let _=r[0].dims.length-2;p=new Array(_).fill(1)}J0(c,n,f,t.autoPad,t.group,o,p,a,d,u);let g=Object.assign({},t);return Object.assign(g,{kernelShape:n,pads:o,outputPadding:d,outputShape:u,dilations:f,strides:p}),g},_v=t=>{let r=A1(t),n=t.format,a=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],o=t.dilations,u=t.group,d=t.kernelShape,c=t.pads,f=t.strides,p=t.wIsConst(),g=t.outputPadding,_=t.outputShape;return{autoPad:a,format:n,dilations:o,group:u,kernelShape:d,outputPadding:g,outputShape:_,pads:c,strides:f,wIsConst:p,...r,cacheKey:`${t.format};${r.activation};`}},e2=(t,r)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[r.format==="NHWC"?t[0].dims.length-1:1],a=t[1].dims[0];if(n!==a)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let o=t[1].dims[1]*r.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==o))throw new Error("invalid bias");let u=t[0].dims.length-2;if(r.dilations.reduce((d,c)=>d+c,0)>0&&r.dilations.length!==u)throw new Error(`dilations should be ${u}D`);if(r.strides.reduce((d,c)=>d+c,0)>0&&r.strides.length!==u)throw new Error(`strides should be ${u}D`);if(r.pads.reduce((d,c)=>d+c,0)>0&&r.pads.length!==u*2)throw new Error(`pads should be ${u*2}D`);if(r.outputPadding.length!==u&&r.outputPadding.length!==0)throw new Error(`output_padding should be ${u}D`);if(r.kernelShape.reduce((d,c)=>d+c,0)>0&&r.kernelShape.length!==0&&r.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(r.outputShape.length!==0&&r.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},b_=(t,r,n,a)=>{let o=t.kernelCustomData.wT??t.compute(Yr(r[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=o);let u=[r[0],o];r.length===3&&u.push(r[2]),t.compute(mv(u,n,a),{inputs:u})},t2=(t,r)=>{let n=r.format==="NHWC",a=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&a.push(t.inputs[2]);let o=r.kernelShape;(o.length===0||o[0]===0)&&(o=[t.inputs[1].dims[2]]);let u=r.dilations;(u.length===0||u[0]===0)&&(u=[1]);let d=r.strides;(d.length===0||d[0]===0)&&(d=[1]);let c=r.pads;c.length===0&&(c=[0,0]),c=[0,c[0],0,c[1]],d=[1].concat(d),u=[1].concat(u),o=[1].concat(o);let f=r.outputPadding;f=[0].concat(f);let p=y_({...r,pads:c,strides:d,dilations:u,kernelShape:o,outputPadding:f},a);b_(t,a,p,g=>n?[g[0],g[2],g[3]]:[g[0],g[1],g[3]])},gv=(t,r)=>{if(e2(t.inputs,r),t.inputs[0].dims.length===3)t2(t,r);else{let n=y_(r,t.inputs);b_(t,t.inputs,n)}}}),n2,yv,bv,x3=at(()=>{Nt(),tn(),xs(),sn(),n2=(t,r,n,a)=>{let o=Fe.size(r),u=r.length,d=We("input",t,u),c=St("output",t,u),f=n.dataType===6?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),p=Fe.normalizeAxis(f,u),g=_=>{let h=` i32(${d.indicesGet("inputIndices","uniforms.axis")}) `,w=At("uniforms.input_shape","uniforms.axis",u),M=a.reverse?h+(a.exclusive?" + 1":""):"0",x=a.reverse?w:h+(a.exclusive?"":" + 1");return`
                ${_.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(d,c)}
                ${_.mainStart()}
                  ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${c.offsetToIndices("global_idx")};
                  var sum = ${c.type.value}(0);
                  let first : i32 = ${M};
                  let last : i32 = ${x};
                  for (var i : i32 = first; i < last; i++) {
                    ${d.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${d.getByIndices("inputIndices")};
                  }
                  ${c.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:a.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},{type:12,data:p},...Lt(r,r)]}),getShaderSource:g}},yv=(t,r)=>{let n=t.inputs[0].dims,a=t.inputs[0].dataType,o=t.inputs[1];t.compute(n2(a,n,o,r),{inputs:[0]})},bv=t=>{let r=t.exclusive===1,n=t.reverse===1;return Sn({exclusive:r,reverse:n})}}),s2,r2,a2,Mv,vv,T3=at(()=>{Nt(),tn(),xs(),sn(),s2=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},r2=(t,r,n,a)=>{let o=[];o.push(`fn perm(i: ${a.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`);for(let u=0;u<r;++u)o.push(n.indicesSet("a",t[u],`i[${u}]`));return o.push("return a;}"),o.join(`
`)},a2=(t,r)=>{let n,a,o,u,d,c,f=r.format==="NHWC",p=r.blocksize,g=r.mode==="DCR";f?([n,a,o,u]=t.dims,d=g?[n,a,o,p,p,u/p**2]:[n,a,o,u/p**2,p,p],c=g?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,a,o,u]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],d=g?[n,p,p,u/p**2,a,o]:[n,u/p**2,p,p,a,o],c=g?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let _=t.reshape(d),h=_.dims.length,w=t.dataType,M=We("a",w,h),x=St("output",w,h),F=E=>`
  ${E.registerUniform("output_size","u32").declareVariables(M,x)}

  ${r2(c,h,M,x)}

  ${E.mainStart()}
    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",M.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${r.blocksize};${r.mode}`,inputDependencies:["rank"]},getRunData:E=>{let T=f?[n,a*p,o*p,u/p**2]:[n,u/p**2,a*p,o*p],L=Fe.size(T),O=_.dims,S=Fe.sortBasedOnPerm(O,c);return{outputs:[{dims:T,dataType:E[0].dataType}],dispatchGroup:{x:Math.ceil(L/64)},programUniforms:[{type:12,data:L},...Lt(O,S)]}},getShaderSource:F}},Mv=(t,r)=>{s2(t.inputs),t.compute(a2(t.inputs[0],r))},vv=t=>Sn({blocksize:t.blocksize,mode:t.mode,format:t.format})}),sm,Rp,M_,i2,o2,l2,u2,v_,c2,wv,xv,E3=at(()=>{Nt(),tn(),xs(),sn(),sm="[a-zA-Z]|\\.\\.\\.",Rp="("+sm+")+",M_="^"+Rp+"$",i2="("+Rp+",)*"+Rp,o2="^"+i2+"$",l2=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,r){let n=this.symbolToIndices.get(t);n===void 0?n=[r]:n.push(r),this.symbolToIndices.set(t,n)}},u2=class{constructor(t,r){this.equation=r,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,a]=r.includes("->")?r.split("->",2):[r,""];if(!n.match(RegExp(o2)))throw new Error("Invalid LHS term");if(n.split(",").forEach((o,u)=>{let d=t[u].dims.slice();if(!o.match(RegExp(M_)))throw new Error("Invalid LHS term");let c=this.processTerm(o,!0,d,u);this.lhs.push(c)}),a==="")a+=[...this.symbolToInfo.entries()].filter(([o,u])=>u.count===1||o==="...").map(([o])=>o).join("");else if(!a.match(RegExp(Rp)))throw new Error("Invalid RHS");a.match(RegExp(sm,"g"))?.forEach(o=>{if(o==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let u=this.symbolToInfo.get(o);if(u===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(u.dimValue)}}),this.rhs=this.processTerm(a,!1,this.outputDims)}addSymbol(t,r,n){let a=this.symbolToInfo.get(t);if(a!==void 0){if(a.dimValue!==r&&a.count!==1)throw new Error("Dimension mismatch");a.count++,a.inputIndices.push(n)}else a={count:1,dimValue:r,inputIndices:[n]};this.symbolToInfo.set(t,a)}processTerm(t,r,n,a=-1){let o=n.length,u=!1,d=[],c=0;if(!t.match(RegExp(M_))&&!r&&t!=="")throw new Error("Invalid LHS term");let f=t.match(RegExp(sm,"g")),p=new l2(a);return f?.forEach((g,_)=>{if(g==="..."){if(u)throw new Error("Only one ellipsis is allowed per input term");u=!0;let h=o-f.length+1;if(h<0)throw new Error("Ellipsis out of bounds");if(d=n.slice(c,c+h),this.hasEllipsis){if(this.ellipsisDims.length!==d.length||this.ellipsisDims.toString()!==d.toString())throw new Error("Ellipsis dimensions mismatch")}else if(r)this.hasEllipsis=!0,this.ellipsisDims=d;else throw new Error("Ellipsis must be specified in the LHS");for(let w=0;w<d.length;w++){let M=String.fromCharCode(48+w);p.addSymbol(M,_+w),this.addSymbol(M,n[c++],a)}}else p.addSymbol(g,_+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(g,n[c++],a)}),p}},v_=t=>t+"_max",c2=(t,r,n,a)=>{let o=t.map(p=>p.length).map((p,g)=>We(`input${g}`,r,p)),u=Fe.size(a),d=St("output",r,a.length),c=[...n.symbolToInfo.keys()].filter(p=>!n.rhs.symbolToIndices.has(p)),f=p=>{let g=[],_="var prod = 1.0;",h="var sum = 0.0;",w="sum += prod;",M=[],x=[],F=[],E=[],T=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((O,S)=>{if(n.rhs.symbolToIndices.has(S)){let $=n.rhs.symbolToIndices.get(S)?.[0];$!==void 0&&n.lhs.forEach((C,k)=>{if(O.inputIndices.includes(k)){let U=C.symbolToIndices.get(S);if(U===void 0)throw new Error("Invalid symbol error");U.forEach(V=>{g.push(`${o[k].indicesSet(`input${k}Indices`,V,d.indicesGet("outputIndices",$))}`)})}})}else n.lhs.forEach(($,C)=>{if(O.inputIndices.includes(C)){let k=$.symbolToIndices.get(S);if(k===void 0)throw new Error("Invalid symbol error");k.forEach(U=>{M.push(`${o[C].indicesSet(`input${C}Indices`,U,`${S}`)}`)}),E.push(`prod *= ${o[C].getByIndices(`input${C}Indices`)};`)}}),x.push(`for(var ${S}: u32 = 0; ${S} < uniforms.${v_(S)}; ${S}++) {`),F.push("}")});let L=T?[...g,`let sum = ${o.map((O,S)=>O.getByIndices(`input${S}Indices`)).join(" * ")};`]:[...g,h,...x,...M,_,...E,w,...F];return`
            ${p.registerUniforms(c.map(O=>({name:`${v_(O)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...o,d)}

            ${p.mainStart()}
            ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${d.offsetToIndices("global_idx")};
            ${o.map((O,S)=>`var input${S}Indices: ${o[S].type.indices};`).join(`
`)}
            ${L.join(`
`)};
            ${d.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let p=c.filter(_=>n.symbolToInfo.has(_)).map(_=>({type:12,data:n.symbolToInfo.get(_)?.dimValue||0}));p.push({type:12,data:u});let g=t.map((_,h)=>[...Lt(_)]).reduce((_,h)=>_.concat(h),p);return g.push(...Lt(a)),{outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:g}},getShaderSource:f}},wv=(t,r)=>{let n=new u2(t.inputs,r.equation),a=n.outputDims,o=t.inputs.map((u,d)=>u.dims);t.compute(c2(o,t.inputs[0].dataType,n,a))},xv=t=>{let r=t.equation.replace(/\s+/g,"");return Sn({equation:r})}}),d2,w_,f2,p2,Tv,C3=at(()=>{Nt(),tn(),sn(),d2=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let r=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),a=n.length<r.length?0:n.length-r.length,o=r.length<n.length?0:r.length-n.length;for(;a<n.length&&o<r.length;++a,++o)if(n[a]!==r[o]&&n[a]!==1&&r[o]!==1)throw new Error("Expand requires shape to be broadcastable to input")},w_=(t,r)=>{let n=t.length-r.length,a=[];for(let o=0;o<n;++o)a.push(t[o]);for(let o=0;o<r.length;++o)a.push(r[o]===1?t[o+n]:r[o]);return a},f2=(t,r)=>t.length>r.length?w_(t,r):w_(r,t),p2=t=>{let r=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),a=f2(r,n),o=t[0].dataType,u=o===9||Fe.size(r)===1,d=o===9||r.length>0&&r[r.length-1]%4===0?4:1,c=u||a.length>0&&a[a.length-1]%4===0?4:1,f=Math.ceil(Fe.size(a)/c),p=_=>{let h=We("input",o,r.length,d),w=St("output",o,a.length,c),M;if(o===9){let x=(F,E,T="")=>`
          let outputIndices${E} = ${w.offsetToIndices(`outputOffset + ${E}u`)};
          let offset${E} = ${h.broadcastedIndicesToOffset(`outputIndices${E}`,w)};
          let index${E} = offset${E} / 4u;
          let component${E} = offset${E} % 4u;
          ${F}[${E}] = ${T}(${h.getByOffset(`index${E}`)}[component${E}]);
        `;M=`
        let outputOffset = global_idx * ${c};
        var data = vec4<u32>(0);
        ${x("data",0,"u32")}
        ${x("data",1,"u32")}
        ${x("data",2,"u32")}
        ${x("data",3,"u32")}
        ${w.setByOffset("global_idx","data")}
      }`}else M=`
        let outputIndices = ${w.offsetToIndices(`global_idx * ${c}`)};
        let inputOffset = ${h.broadcastedIndicesToOffset("outputIndices",w)};
        let data = ${w.type.value}(${h.getByOffset(`inputOffset / ${d}`)});
        ${w.setByOffset("global_idx","data")}
      }`;return`
    ${_.registerUniform("vec_size","u32").declareVariables(h,w)}
    ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${M}`},g=[{type:12,data:f},...Lt(r,a)];return{name:"Expand",shaderCache:{hint:`${a.length};${d}${c}`,inputDependencies:["rank"]},getShaderSource:p,getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:g})}},Tv=t=>{d2(t.inputs),t.compute(p2(t.inputs),{inputs:[0]})}}),h2,Ev,S3=at(()=>{Nt(),tn(),sn(),P1(),h2=t=>{let r=t[0].dataType,n=Fe.size(t[0].dims),a=Fe.size(t[1].dims),o=a%4===0,u=d=>{let c=We("x",r,[1],4),f=We("bias",r,[1],4),p=St("y",r,[1],4),g=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],_=w=>`
      let bias${w}_offset: u32 = (global_idx * 4 + ${w}) % uniforms.bias_size;
      let bias${w} = ${f.getByOffset(`bias${w}_offset / 4`)}[bias${w}_offset % 4];`,h=o?`
      let bias = ${f.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${_(0)}${_(1)}${_(2)}${_(3)}
      let bias = ${c.type.value}(bias0, bias1, bias2, bias3);`;return`${d.registerUniforms(g).declareVariables(c,f,p)}

    ${t1(yr(r))}

    ${d.mainStart(Id)}
      ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${c.getByOffset("global_idx")};
      ${h}
      let x_in = x + bias;
      ${p.setByOffset("global_idx",n1("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${o}`,inputDependencies:["type","type"]},getShaderSource:u,getRunData:d=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:a}],dispatchGroup:{x:Math.ceil(n/Id/4)}})}},Ev=t=>{t.inputs.length<2||Fe.size(t.inputs[1].dims)===0?WM(t):t.compute(h2(t.inputs))}}),m2,_2,Cv,Sv,P3=at(()=>{Nt(),tn(),xs(),sn(),m2=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},_2=(t,r)=>{let n=t[0].dims,a=t[1].dims,o=n.length,u=Fe.normalizeAxis(r.axis,o),d=n.slice(0);d.splice(u,1,...a);let c=n[u],f=t[0].dataType===9?4:1,p=Math.ceil(Fe.size(d)/f),g=[{type:12,data:p},{type:6,data:c},{type:12,data:u},...Lt(t[0].dims,t[1].dims,d)],_=h=>{let w=We("data",t[0].dataType,t[0].dims.length,f),M=We("inputIndices",t[1].dataType,t[1].dims.length),x=St("output",t[0].dataType,d.length,f),F=T=>{let L=a.length,O=`var indicesIndices${T}  = ${M.type.indices}(0);`;for(let S=0;S<L;S++)O+=`${L>1?`indicesIndices${T}[${S}]`:`indicesIndices${T}`} = ${d.length>1?`outputIndices${T}[uniforms.axis + ${S}]`:`outputIndices${T}`};`;O+=`
          var idx${T} = ${M.getByIndices(`indicesIndices${T}`)};
          if (idx${T} < 0) {
            idx${T} = idx${T} + uniforms.axisDimLimit;
          }
          var dataIndices${T} : ${w.type.indices};
        `;for(let S=0,$=0;S<o;S++)S===u?(O+=`${o>1?`dataIndices${T}[${S}]`:`dataIndices${T}`} = u32(idx${T});`,$+=L):(O+=`${o>1?`dataIndices${T}[${S}]`:`dataIndices${T}`} = ${d.length>1?`outputIndices${T}[${$}]`:`outputIndices${T}`};`,$++);return O},E;if(t[0].dataType===9){let T=(L,O,S="")=>`
          let outputIndices${O} = ${x.offsetToIndices(`outputOffset + ${O}u`)};
          ${F(O)};
          let offset${O} = ${w.indicesToOffset(`dataIndices${O}`)};
          let index${O} = offset${O} / 4u;
          let component${O} = offset${O} % 4u;
          ${L}[${O}] = ${S}(${w.getByOffset(`index${O}`)}[component${O}]);
        `;E=`
        let outputOffset = global_idx * ${f};
        var value = vec4<u32>(0);
        ${T("value",0,"u32")}
        ${T("value",1,"u32")}
        ${T("value",2,"u32")}
        ${T("value",3,"u32")}
        ${x.setByOffset("global_idx","value")}
      `}else E=`
      let outputIndices = ${x.offsetToIndices("global_idx")};
      ${F("")};
      let value = ${w.getByIndices("dataIndices")};
      ${x.setByOffset("global_idx","value")};
      `;return`
      ${h.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(w,M,x)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${E}
      }`};return{name:"Gather",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:d,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:g}),getShaderSource:_}},Cv=t=>Sn({axis:t.axis}),Sv=(t,r)=>{let n=t.inputs;m2(n),t.compute(_2(t.inputs,r))}}),g2,Pv,Av,A3=at(()=>{Nt(),tn(),sn(),g2=(t,r,n,a,o,u,d,c,f)=>{let p=[{type:12,data:u},{type:12,data:a},{type:12,data:o},{type:12,data:n},{type:12,data:d},{type:12,data:c},{type:12,data:f}],g=[u];p.push(...Lt(r.dims,g));let _=h=>{let w=We("indices_data",r.dataType,r.dims.length),M=St("input_slice_offsets_data",12,1,1),x=[w,M],F=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:o.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${h.registerUniforms(F).declareVariables(...x)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${o.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${n.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${o.length}_${n.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:g,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:_},{inputs:[r],outputs:[-1]})[0]},Pv=(t,r)=>{let n=t.inputs,a=n[0].dims,o=n[0].dataType,u=n[1].dims,d=u[u.length-1],c=Fe.sizeToDimension(u,u.length-1),f=Fe.sizeFromDimension(a,r.batchDims+d),p=Fe.sizeToDimension(a,r.batchDims),g=Fe.sizeFromDimension(a,r.batchDims),_=c/p,h=new Array(d),w=f;for(let O=0;O<d;++O)h[d-1-O]=w,w*=a[r.batchDims+d-1-O];let M=g2(t,n[1],h,r.batchDims,a,c,_,g,d),x=r.batchDims+d;if(x>a.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let F=u.slice(0,-1).concat(a.slice(x)),E=Fe.size(F),T=[{type:12,data:E},{type:12,data:f},...Lt(n[0].dims,M.dims,F)],L=O=>{let S=We("data",n[0].dataType,n[0].dims.length),$=We("slice_offsets",12,M.dims.length),C=St("output",n[0].dataType,F.length);return`
          ${O.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(S,$,C)}
            ${O.mainStart()}
            ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:F,dataType:o}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:T}),getShaderSource:L},{inputs:[n[0],M]})},Av=t=>({batchDims:t.batch_dims,cacheKey:""})}),y2,b2,Ov,$v,O3=at(()=>{Nt(),tn(),xs(),sn(),y2=(t,r)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=Fe.normalizeAxis(r.quantizeAxis,t[0].dims.length),a=r.blockSize,o=t[0],u=t[2],d=t.length===4?t[3]:void 0;if(u.dims.length!==o.dims.length||!o.dims.map((c,f)=>f===n?Math.ceil(c/a)===u.dims[f]:c===u.dims[f]).reduce((c,f)=>c&&f,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(d){if(d.dataType!==o.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(d.dims.length!==u.dims.length||!d.dims.map((c,f)=>c===u.dims[f]).reduce((c,f)=>c&&f,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},b2=(t,r)=>{let n=t[0].dims,a=t[1].dims,o=n.length,u=Fe.normalizeAxis(r.gatherAxis,o),d=Fe.normalizeAxis(r.quantizeAxis,o),c=n.slice(0);c.splice(u,1,...a);let f=Fe.size(c),p=t[2].dataType,g=t[0].dataType===22,_=[{type:12,data:f},{type:12,data:d},{type:12,data:u},{type:12,data:r.blockSize},...Lt(...t.map((w,M)=>w.dims),c)],h=w=>{let M=We("data",t[0].dataType,t[0].dims.length),x=We("inputIndices",t[1].dataType,t[1].dims.length),F=We("scales",t[2].dataType,t[2].dims.length),E=t.length>3?We("zeroPoint",t[3].dataType,t[3].dims.length):void 0,T=St("output",p,c.length),L=[M,x,F];E&&L.push(E);let O=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${w.registerUniforms(O).declareVariables(...L,T)}
        ${w.mainStart()}
        let output_indices = ${T.offsetToIndices("global_idx")};
        var indices_indices = ${x.type.indices}(0);
        ${a.length>1?`
          for (var i: u32 = 0; i < ${a.length}; i++) {
            let index = ${T.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${x.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${T.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${M.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${T.indicesGet("output_indices","i")};
          ${M.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${x.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${n[u]};
        }
        ${M.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${c.length}; i++) {
          let index = ${T.indicesGet("output_indices",`i + ${a.length} - 1`)};
          ${M.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${M.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${M.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${g?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${F.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${F.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${F.getByIndices("scale_indices")};
        ${E?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${E.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${E.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${g?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${yr(p)}(quantized_data - zero_point) * scale;
        ${T.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${r.cacheKey};${t.filter((w,M)=>M!==1).map(w=>w.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(w,M)=>"rank")},getRunData:()=>({outputs:[{dims:c,dataType:p}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:_}),getShaderSource:h}},Ov=(t,r)=>{let n=t.inputs;y2(n,r),t.compute(b2(t.inputs,r))},$v=t=>Sn({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),M2,v2,Dv,kv,$3=at(()=>{Nt(),tn(),xs(),sn(),M2=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},v2=(t,r)=>{let n=t[0].dims,a=t[0].dataType,o=n.length,u=t[1].dims,d=t[1].dataType,c=Fe.normalizeAxis(r.axis,o),f=n[c],p=u.slice(0),g=Fe.size(p),_=We("input",a,o),h=We("indicesInput",d,u.length),w=St("output",a,p.length),M=[{type:12,data:g},{type:6,data:f},{type:12,data:c}];return M.push(...Lt(n,u,p)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:p,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:M}),getShaderSource:x=>`
      ${x.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(_,h,w)}
      ${x.mainStart()}
      ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${w.offsetToIndices("global_idx")};

      var idx = ${h.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${_.type.indices}(outputIndices);
      ${_.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${_.getByIndices("inputIndices")};

      ${w.setByOffset("global_idx","value")};
  }`}},Dv=t=>Sn({axis:t.axis}),kv=(t,r)=>{let n=t.inputs;M2(n),t.compute(v2(t.inputs,r))}}),w2,x2,Lv,Iv,D3=at(()=>{Nt(),tn(),sn(),w2=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},x2=(t,r)=>{let n=t[0].dims.slice(),a=t[1].dims.slice(),[o,u,d]=Db.getShapeOfGemmResult(n,r.transA,a,r.transB,t.length===3?t[2].dims:void 0),c=[o,u];if(!c)throw new Error("Can't use gemm on the given tensors");let f=16,p=Math.ceil(u/f),g=Math.ceil(o/f),_=!0,h=Fe.size(c),w=[{type:12,data:_?p:h},{type:12,data:o},{type:12,data:u},{type:12,data:d},{type:1,data:r.alpha},{type:1,data:r.beta}],M=["type","type"];t.length===3&&(w.push(...Lt(t[2].dims)),M.push("rank")),w.push(...Lt(c));let x=E=>{let T="";r.transA&&r.transB?T="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":r.transA&&!r.transB?T="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!r.transA&&r.transB?T="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!r.transA&&!r.transB&&(T="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let L=r.alpha===1?"":"value *= uniforms.alpha;",O=We("a",t[0].dataType,t[0].dims),S=We("b",t[1].dataType,t[1].dims),$=O.type.value,C=null,k=[O,S];t.length===3&&(C=We("c",t[2].dataType,t[2].dims.length),k.push(C));let U=St("output",t[0].dataType,c.length);k.push(U);let V=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${E.registerUniforms(V).declareVariables(...k)}

  ${E.mainStart()}
    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${$}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${T}
    }

    ${L}
    ${C!=null?`let cOffset = ${C.broadcastedIndicesToOffset("vec2(m, n)",U)}; value += ${$}(uniforms.beta) * ${C.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},F=E=>{let T=We("a",t[0].dataType,t[0].dims),L=We("b",t[1].dataType,t[1].dims),O=null,S=[T,L];t.length===3&&(O=We("c",t[2].dataType,t[2].dims.length),S.push(O));let $=St("output",t[0].dataType,c.length);S.push($);let C=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],k="",U="";r.transA&&r.transB?(U=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${T.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${L.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):r.transA&&!r.transB?(U=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${T.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${L.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!r.transA&&r.transB?(U=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${T.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${L.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!r.transA&&!r.transB&&(U=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${T.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${L.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let V=r.alpha===1?"":"value *= uniforms.alpha;";return`
  ${E.registerUniforms(C).declareVariables(...S)}
  var<workgroup> tile_a: array<array<${T.type.storage}, ${f}>, ${f}>;
  var<workgroup> tile_b: array<array<${L.type.storage}, ${f}>, ${f}>;
  ${E.mainStart([f,f,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${f};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${f};
    let num_tiles = (uniforms.K - 1) / ${f} + 1;
    var k_start = 0u;
    var value = ${$.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${U}
      k_start = k_start + ${f};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${f}; k++) {
        ${k}
      }
      workgroupBarrier();
    }

    ${V}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${O!=null?`let cOffset = ${O.broadcastedIndicesToOffset("vec2(m, n)",$)}; value += ${$.type.value}(uniforms.beta) * ${O.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return _?{name:"GemmShared",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:M},getRunData:()=>({outputs:[{dims:c,dataType:t[0].dataType}],dispatchGroup:{x:p*g},programUniforms:w}),getShaderSource:F}:{name:"Gemm",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:M},getRunData:()=>({outputs:[{dims:c,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:w}),getShaderSource:x}},Lv=t=>{let r=t.transA,n=t.transB,a=t.alpha,o=t.beta;return{transA:r,transB:n,alpha:a,beta:o,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},Iv=(t,r)=>{w2(t.inputs),t.compute(x2(t.inputs,r))}}),Di,bo,Vu,Gu,T2,E2,C2,S2,P2,A2,O2,$2,zv,Fv,k3=at(()=>{Nt(),tn(),xs(),sn(),[Di,bo,Vu,Gu]=[0,1,2,3],T2=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},E2=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,C2=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,S2=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,P2=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,A2=(t,r,n)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${r} {
     var pixel = ${r}(0);
     var indices = vec4<u32>(0);
     indices[${Di}] = batch;
     indices[${bo}] = channel;`+(()=>{switch(n.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Vu}] = u32(r);
            indices[${Gu}] = u32(c);
          } else {
            return ${r}(0);
          }
        `;case"border":return`
          indices[${Vu}] = u32(clamp(r, 0, H - 1));
          indices[${Gu}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Vu}] = gs_reflect(r, border[1], border[3]);
          indices[${Gu}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${n.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,O2=(t,r,n)=>(()=>{switch(n.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Di}], indices[${bo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Di}], indices[${bo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Di}], indices[${bo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Di}], indices[${bo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Di}], indices[${bo}], border);

          let dx2 = ${r}(f32(x2) - x);
          let dx1 = ${r}(x - f32(x1));
          let dy2 = ${r}(f32(y2) - y);
          let dy1 = ${r}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${r}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Di}], indices[${bo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${n.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,$2=(t,r)=>{let n=We("x",t[0].dataType,t[0].dims.length),a=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],o=We("grid",t[1].dataType,a.length,2),u=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];r.format==="NHWC"&&(u=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[Di,bo,Vu,Gu]=[0,3,1,2]);let d=St("output",t[0].dataType,u.length),c=n.type.value,f=Fe.size(u),p=[{type:12,data:f},...Lt(t[0].dims,a,u)],g=_=>`
  ${_.registerUniform("output_size","u32").declareVariables(n,o,d)}
  ${E2}
  ${C2(c)}
  ${S2(r)}
  ${P2(r)}
  ${A2(n,c,r)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Vu}]);
      let W_in = i32(uniforms.x_shape[${Gu}]);

      ${r.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${d.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Di}], indices[${Vu}], indices[${Gu}]);
      let nxy = ${o.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${O2(d,c,r)}
  }`;return{name:"GridSample",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:["type","type"]},getRunData:_=>{let h=Fe.size(u);return{outputs:[{dims:u,dataType:_[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:p}},getShaderSource:g}},zv=(t,r)=>{T2(t.inputs),t.compute($2(t.inputs,r))},Fv=t=>Sn({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),Cr,D2,Rv,x_,k2,Hp,Bv,Nv=at(()=>{Nt(),tn(),xs(),T1(),S1(),sn(),vl(),Cr=(t,r)=>t.length>r&&t[r].dims.length>0?t[r]:void 0,D2=(t,r)=>{let n=t[0],a=Cr(t,1),o=Cr(t,2),u=Cr(t,3),d=Cr(t,4),c=Cr(t,5),f=Cr(t,6),p=Cr(t,7);if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let g=n.dims[0],_=n.dims[1],h=n.dims.length===3?n.dims[2]:r.numHeads*n.dims[4],w=_,M=0,x=0,F=Math.floor(h/r.numHeads);if(f&&p&&Fe.size(f.dims)&&Fe.size(p.dims)){if(f.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(f.dims[0]!==g||f.dims[1]!==r.numHeads||f.dims[3]!==F)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(p.dims[0]!==g||p.dims[1]!==r.numHeads||p.dims[3]!==F)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[2]!==p.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(p.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');M=f.dims[2],x=f.dims[2]}else if(f&&Fe.size(f.dims)||p&&Fe.size(p.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let E;if(a&&Fe.size(a.dims)>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(a.dims.length<3||a.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==a.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(a.dims.length===3){if(a.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');E=2,w=a.dims[1]}else if(a.dims.length===5){if(a.dims[2]!==r.numHeads||a.dims[3]!==2||a.dims[4]!==F)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(o)throw new Error('Expect "value" be none when "key" has packed kv format.');E=5,w=a.dims[1]}else{if(a.dims[1]!==r.numHeads||a.dims[3]!==F)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');E=0,w=a.dims[2]}}else{if(n.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==r.numHeads||n.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');E=3}if(u&&Fe.size(u.dims)>0){if(u.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(a&&a.dims.length===5&&a.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let T=M+w,L=0;if(d&&Fe.size(d.dims)>0){L=8;let C=d.dims;throw C.length===1?C[0]===g?L=1:C[0]===3*g+2&&(L=3):C.length===2&&C[0]===g&&C[1]===T&&(L=5),L===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let O=!1,S=h;if(o&&Fe.size(o.dims)>0){if(o.dims.length!==3&&o.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==o.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(o.dims.length===3){if(w!==o.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');S=o.dims[2]}else{if(w!==o.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');S=o.dims[1]*o.dims[3],O=!0}}let $=!1;if(d&&Fe.size(d.dims)>0)throw new Error("Key padding mask is not supported");if(c&&Fe.size(c.dims)>0){if(c.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(c.dims[0]!==g||c.dims[1]!==r.numHeads||c.dims[2]!==_||c.dims[3]!==T)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:g,sequenceLength:_,pastSequenceLength:M,kvSequenceLength:w,totalSequenceLength:T,maxSequenceLength:x,inputHiddenSize:0,hiddenSize:h,vHiddenSize:S,headSize:F,vHeadSize:Math.floor(S/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:L,scale:r.scale,broadcastResPosBias:$,passPastInKv:O,qkvFormat:E}},Rv=t=>Sn({...t}),x_=Sn({perm:[0,2,1,3]}),k2=(t,r,n,a,o,u,d)=>{let c=[a,o,u],f=Fe.size(c),p=[{type:12,data:f},{type:12,data:d},{type:12,data:u}],g=_=>{let h=St("qkv_with_bias",r.dataType,c),w=We("qkv",r.dataType,c),M=We("bias",n.dataType,c),x=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${_.registerUniforms(x).declareVariables(w,M,h)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:c,dataType:r.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:p}),getShaderSource:g},{inputs:[r,n],outputs:[-1]})[0]},Hp=(t,r,n,a,o,u,d,c)=>{let f=u;if(d&&Fe.size(d.dims)>0){if(a===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return f=k2(t,u,d,r,a,n*o,c),f=f.reshape([r,a,n,o]),n===1||a===1?f:t.compute(Yr(f,x_.perm),{inputs:[f],outputs:[-1]})[0]}else return u.dims.length===3&&(f=u.reshape([r,a,n,o])),n===1||a===1?f:t.compute(Yr(f,x_.perm),{inputs:[f],outputs:[-1]})[0]},Bv=(t,r)=>{let n=D2(t.inputs,r),a=t.inputs[0],o=Cr(t.inputs,1),u=Cr(t.inputs,2),d=Cr(t.inputs,3),c=Cr(t.inputs,4),f=Cr(t.inputs,5),p=Cr(t.inputs,6),g=Cr(t.inputs,7);if(a.dims.length===5)throw new Error("Packed QKV is not implemented");if(o?.dims.length===5)throw new Error("Packed KV is not implemented");let _=o&&u&&o.dims.length===4&&u.dims.length===4,h=Hp(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,a,d,0);if(_)return Xp(t,h,o,u,c,void 0,p,g,f,n);if(!o||!u)throw new Error("key and value must be provided");let w=Hp(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,o,d,n.hiddenSize),M=Hp(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,u,d,2*n.hiddenSize);Xp(t,h,w,M,c,void 0,p,g,f,n)}}),L2,I2,z2,F2,o1,jv,Uv,Vv=at(()=>{Nt(),tn(),xs(),sn(),L2=t=>{if(!t||t.length<1)throw new Error("too few inputs")},I2=(t,r)=>{let n=[],a=r.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(o=>n.push(Number(o))),a=n.length),Sn({numOutputs:a,axis:r.axis,splitSizes:n})},z2=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${At("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,F2=t=>{let r=t.length,n=[];for(let a=0;a<r;++a){let o=t[a].setByIndices("indices","input[global_idx]");r===1?n.push(o):a===0?n.push(`if (output_number == ${a}u) { ${o} }`):a===r-1?n.push(`else { ${o} }`):n.push(`else if (output_number == ${a}) { ${o} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${n.join(`
`)}
      }`},o1=(t,r)=>{let n=t[0].dims,a=Fe.size(n),o=t[0].dataType,u=Fe.normalizeAxis(r.axis,n.length),d=new Array(r.numOutputs),c=We("input",o,n.length),f=new Array(r.numOutputs),p=[],g=[],_=0,h=[{type:12,data:a}];for(let M=0;M<r.numOutputs;M++){_+=r.splitSizes[M],f[M]=_;let x=n.slice();x[u]=r.splitSizes[M],g.push(x),d[M]=St(`output${M}`,o,x.length),p.push({dims:g[M],dataType:t[0].dataType})}h.push({type:12,data:f},...Lt(n,...g));let w=M=>`
  ${M.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",f.length).declareVariables(c,...d)}
  ${z2(f.length)}
  ${F2(d)}

  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${c.offsetToIndices("global_idx")};
    var index = ${c.indicesGet("indices",u)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${At("uniforms.size_in_split_axis","output_number - 1u",f.length)};
      ${c.indicesSet("indices",u,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getShaderSource:w,getRunData:()=>({outputs:p,dispatchGroup:{x:Math.ceil(a/64)},programUniforms:h})}},jv=(t,r)=>{L2(t.inputs);let n=t.inputs.length===1?r:I2(t.inputs,r);t.compute(o1(t.inputs,n),{inputs:[0]})},Uv=t=>{let r=t.axis,n=t.splitSizes,a=t.numOutputs<0?n.length:t.numOutputs;if(a!==n.length)throw new Error("numOutputs and splitSizes lengh must be equal");return Sn({axis:r,numOutputs:a,splitSizes:n})}}),R2,gm,Gv,Wv=at(()=>{Nt(),tn(),xs(),sn(),R2=(t,r)=>{let[n,a,o,u]=t,{numHeads:d,rotaryEmbeddingDim:c}=r;if(n.dims.length!==3&&n.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!Fe.areEqual(a.dims,[])&&!Fe.areEqual(a.dims,[1])&&a.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${a.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(u.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${u.dims.length}`);if(!Fe.areEqual(o.dims,u.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(c>0&&d===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let f=n.dims[0],p=n.dims[n.dims.length-2],g=o.dims[0],_=Fe.sizeFromDimension(n.dims,1)/p,h=c===0?o.dims[1]*2:_/d;if(c>h)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(a.dims.length===2){if(f!==a.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${a.dims[0]}`);if(p!==a.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${a.dims[1]}`)}if(h/2!==o.dims[1]&&c/2!==o.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${o.dims[1]}`);if(p>g)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},gm=(t,r)=>{let{interleaved:n,numHeads:a,rotaryEmbeddingDim:o,scale:u}=r,d=t[0].dims[0],c=Fe.sizeFromDimension(t[0].dims,1),f=t[0].dims[t[0].dims.length-2],p=c/f,g=t[2].dims[1],_=o===0?g*2:p/a,h=new Array(d,f,p/_,_-g),w=Fe.computeStrides(h),M=[{type:1,data:u},{type:12,data:h},{type:12,data:w},...t[0].dims.length===3?new Array({type:12,data:[c,p,_,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[c,_,f*_,1]}):[],...Lt(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],x=F=>{let E=We("input",t[0].dataType,t[0].dims.length),T=We("position_ids",t[1].dataType,t[1].dims.length),L=We("cos_cache",t[2].dataType,t[2].dims.length),O=We("sin_cache",t[3].dataType,t[3].dims.length),S=St("output",t[0].dataType,t[0].dims.length);return F.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:h.length},{name:"global_strides",type:"u32",length:w.length},{name:"input_output_strides",type:"u32",length:w.length}]),`
        ${F.declareVariables(E,T,L,O,S)}

        ${F.mainStart(Id)}
          let half_rotary_emb_dim = uniforms.${L.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${F.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${T.broadcastedIndicesToOffset("bsnh.xy",St("",T.type.tensor,2))};
            let position_id =
                u32(${T.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});
            let j = i + select(half_rotary_emb_dim, 1, ${n});
            let re = ${E.getByOffset("i")} * ${L.get("position_id","bsnh[3]")} -
                ${E.getByOffset("j")} * ${O.get("position_id","bsnh[3]")};
            ${S.setByOffset("i","re")}
            let im = ${E.getByOffset("i")} * ${O.get("position_id","bsnh[3]")} +
                ${E.getByOffset("j")} * ${L.get("position_id","bsnh[3]")};
            ${S.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${S.setByOffset("k",E.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:Sn({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Fe.size(h)/Id)},programUniforms:M})}},Gv=(t,r)=>{R2(t.inputs,r),t.compute(gm(t.inputs,r))}}),B2,N2,T_,j2,Hv,L3=at(()=>{xs(),Nt(),S1(),Nv(),Vv(),vl(),Wv(),sn(),B2=(t,r)=>{if(r.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=t[0],a=t[1],o=t[2],u=t[3],d=t[4];if(r.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(r.localWindowSize!==-1)throw new Error("Local attention is not supported");if(r.softcap!==0)throw new Error("Softcap is not supported");if(r.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(r.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=!1,f=n.dims[0],p=n.dims[1],g=n.dims.length===3?c?n.dims[2]/3:n.dims[2]:r.numHeads*n.dims[4],_=p,h=0,w=!a||a.dims.length===0,M=Math.floor(w?g/(r.numHeads+2*r.kvNumHeads):g/r.numHeads);w&&(g=M*r.numHeads);let x=u&&u.dims.length!==0,F=d&&d.dims.length!==0;if(x&&u.dims.length===4&&u.dims[0]===f&&u.dims[1]!==r.kvNumHeads&&u.dims[2]===r.kvNumHeads&&u.dims[3]===M)throw new Error("BSNH pastKey/pastValue is not supported");if(x&&F){if(u.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(d.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');h=u.dims[2]}else if(x||F)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let E=1;if(a&&a.dims.length>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(a.dims.length<3||a.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==a.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(a.dims.length===3){if(n.dims[2]%a.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');_=a.dims[1]}else if(a.dims.length===5){if(a.dims[2]!==r.numHeads||a.dims[3]!==2||a.dims[4]!==M)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(o)throw new Error('Expect "value" be none when "key" has packed kv format.');_=a.dims[1]}else{if(a.dims[1]!==r.numHeads||a.dims[3]!==M)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');_=a.dims[2]}}else{if(n.dims.length!==3&&n.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(n.dims.length===5&&(n.dims[2]!==r.numHeads||n.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');E=3}let T=0,L=!1,O=r.kvNumHeads?M*r.kvNumHeads:g;if(o&&o.dims.length>0){if(o.dims.length!==3&&o.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==o.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(o.dims.length===3){if(_!==o.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');O=o.dims[2]}else{if(_!==o.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');O=o.dims[1]*o.dims[3],L=!0}}let S=t.length>4?t[5]:void 0;if(S&&S.dims.length!==1&&S.dims[0]!==f)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:f,sequenceLength:p,pastSequenceLength:h,kvSequenceLength:_,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:g,vHiddenSize:O,headSize:M,vHeadSize:Math.floor(O/r.kvNumHeads),numHeads:r.numHeads,kvNumHeads:r.kvNumHeads,nReps:r.numHeads/r.kvNumHeads,pastPresentShareBuffer:!1,maskType:T,scale:r.scale,broadcastResPosBias:!1,passPastInKv:L,qkvFormat:E}},N2=Sn({perm:[0,2,1,3]}),T_=(t,r,n)=>{let a=r,o=n.kvNumHeads;return r.dims.length===3&&n.kvSequenceLength!==0&&(a=r.reshape([n.batchSize,n.kvSequenceLength,o,n.headSize]),a=t.compute(Yr(a,N2.perm),{inputs:[a],outputs:[-1]})[0]),a},j2=(t,r,n,a)=>{let o=7,u=["type","type"],d=[t*r],c=t*r,f=[{type:12,data:c},{type:12,data:r},{type:12,data:t}],p=g=>{let _=We("seq_lens",n.dataType,n.dims),h=We("total_seq_lens",a.dataType,a.dims),w=St("pos_ids",o,d),M=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${g.registerUniforms(M).declareVariables(_,h,w)}
  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${h.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${_.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${w.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${w.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${w.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${r}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:d,dataType:o}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:f}),getShaderSource:p}},Hv=(t,r)=>{let n=B2(t.inputs,r);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(t.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let a=t.inputs[0],o=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,u=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,d=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,c=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,f=t.inputs.length>4?t.inputs[5]:void 0,p=t.inputs.length>5?t.inputs[6]:void 0,g=n.kvNumHeads?n.kvNumHeads:n.numHeads,_=Sn({axis:2,numOutputs:3,splitSizes:[n.numHeads*n.headSize,g*n.headSize,g*n.headSize]}),[h,w,M]=!o&&!u?t.compute(o1([a],_),{inputs:[a],outputs:[-1,-1,-1]}):[a,o,u],x,F;if(r.doRotary){let O=t.compute(j2(n.batchSize,n.sequenceLength,f,p),{inputs:[f,p],outputs:[-1]})[0],S=t.inputs[7],$=t.inputs[8],C=Sn({interleaved:r.rotaryInterleaved!==0,numHeads:n.numHeads,rotaryEmbeddingDim:0,scale:r.scale}),k=[h,O,S,$],U=[-1];x=t.compute(gm(k,C),{inputs:k,outputs:U})[0],k.splice(0,1,w);let V=Sn({interleaved:r.rotaryInterleaved!==0,numHeads:n.kvNumHeads,rotaryEmbeddingDim:0,scale:r.scale});F=t.compute(gm(k,V),{inputs:k,outputs:U})[0]}let E=Hp(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,r.doRotary?x:h,void 0,0),T=T_(t,r.doRotary?F:w,n),L=T_(t,M,n);Xp(t,E,T,L,void 0,void 0,d,c,void 0,n,f,p)}}),E_,U2,V2,qv,I3=at(()=>{Nt(),tn(),vl(),sn(),E_=(t,r,n,a,o,u,d,c)=>{let f=_s(u),p=f===1?"f32":`vec${f}f`,g=f===1?"vec2f":`mat2x${f}f`,_=o*d,h=64;_===1&&(h=256);let w=[o,d,u/f],M=[o,d,2],x=["rank","type","type"],F=[];F.push(...Lt(w,M));let E=T=>{let L=We("x",r.dataType,3,f),O=We("scale",n.dataType,n.dims),S=We("bias",a.dataType,a.dims),$=St("output",1,3,2),C=[L,O,S,$];return`
  var<workgroup> workgroup_shared : array<${g}, ${h}>;
  const workgroup_size = ${h}u;
  ${T.declareVariables(...C)}
  ${T.mainStart(h)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${p}(0);
    var squared_sum = ${p}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${p}(${L.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${g}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Ml("workgroup_shared[0][0]",f)} / f32(hight * ${f});
      let squared_sum_final = ${Ml("workgroup_shared[0][1]",f)} / f32(hight * ${f});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${c}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${f};${c};${h}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:M,dataType:1}],dispatchGroup:{x:_},programUniforms:F}),getShaderSource:E},{inputs:[r,n,a],outputs:[-1]})[0]},U2=(t,r,n)=>{let a=r[0].dims,o=a,u=2,d=a[0],c=a[1],f=Fe.sizeFromDimension(a,u),p=_s(f),g=Fe.size(o)/p,_=E_(t,r[0],r[1],r[2],d,f,c,n.epsilon),h=[d,c,f/p],w=[d,c],M=["type","none"],x=F=>{let E=We("x",r[0].dataType,h.length,p),T=We("scale_shift",1,w.length,2),L=St("output",r[0].dataType,h.length,p),O=[E,T,L];return`
  ${F.registerUniform("output_size","u32").declareVariables(...O)}
  ${F.mainStart()}
  ${F.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${L.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${T.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${E.getByOffset("global_idx")} * ${L.type.value}(scale_shift.x) + ${L.type.value}(scale_shift.y);
      ${L.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${p}`,inputDependencies:M},getRunData:()=>({outputs:[{dims:o,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:[{type:12,data:g},...Lt(h,w,h)]}),getShaderSource:x},{inputs:[r[0],_]})},V2=(t,r,n)=>{let a=r[0].dims,o=a,u=a[0],d=a[a.length-1],c=Fe.sizeFromDimension(a,1)/d,f=_s(d),p=Fe.size(o)/f,g=[{type:12,data:c},{type:12,data:Math.floor(d/f)}],_=["type","type"],h=!1,w=[0,a.length-1];for(let E=0;E<a.length-2;E++)h=h||a[E+1]!==1,w.push(E+1);h=h&&a[a.length-1]!==1;let M=h?t.compute(Yr(t.inputs[0],w),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:a.length},(E,T)=>a[w[T]])),x=E_(t,M,r[1],r[2],u,c,d,n.epsilon),F=E=>{let T=Ys(r[0].dataType),L=f===1?"vec2f":`mat${f}x2f`,O=C=>{let k=C===0?"x":"y",U=f===1?"f32":`vec${f}f`;switch(f){case 1:return`${T}(${U}(scale.${k}))`;case 2:return`vec2<${T}>(${U}(scale[0].${k}, scale[1].${k}))`;case 4:return`vec4<${T}>(${U}(scale[0].${k}, scale[1].${k}, scale[2].${k}, scale[3].${k}))`;default:throw new Error(`Not supported compoents ${f}`)}},S=We("input",r[0].dataType,r[0].dims,f),$=St("output",r[0].dataType,o,f);return`
  @group(0) @binding(0) var<storage, read> input : array<${S.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${L}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${$.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${E.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${O(0)}, ${O(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${f}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:o,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:g}),getShaderSource:F},{inputs:[r[0],x]})},qv=(t,r)=>{r.format==="NHWC"?V2(t,t.inputs,r):U2(t,t.inputs,r)}}),G2,W2,Kv,z3=at(()=>{Nt(),tn(),sn(),G2=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},W2=(t,r,n)=>{let a=r.simplified,o=t[0].dims,u=t[1],d=!a&&t[2],c=o,f=Fe.normalizeAxis(r.axis,o.length),p=Fe.sizeToDimension(o,f),g=Fe.sizeFromDimension(o,f),_=Fe.size(u.dims),h=d?Fe.size(d.dims):0;if(_!==g||d&&h!==g)throw new Error(`Size of X.shape()[axis:] == ${g}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${_} and bias size of ${h}`);let w=[];for(let S=0;S<o.length;++S)S<f?w.push(o[S]):w.push(1);let M=_s(g),x=["type","type"],F=[{type:12,data:p},{type:1,data:g},{type:12,data:Math.floor(g/M)},{type:1,data:r.epsilon}];d&&x.push("type");let E=n>1,T=n>2,L=S=>{let $=Ys(t[0].dataType),C=[We("x",t[0].dataType,t[0].dims,M),We("scale",u.dataType,u.dims,M)];d&&C.push(We("bias",d.dataType,d.dims,M)),C.push(St("output",t[0].dataType,c,M)),E&&C.push(St("mean_data_output",1,w)),T&&C.push(St("inv_std_output",1,w));let k=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${S.registerUniforms(k).declareVariables(...C)}
  ${S.mainStart()}
    ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Z_("f32",M)};
    var mean_square_vector = ${Z_("f32",M)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Dd($,M,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Ml("mean_vector",M)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Ml("mean_square_vector",M)} / uniforms.norm_size ${a?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Dd($,M,"x[j + offset]")};
      let f32scale = ${Dd($,M,"scale[j]")};
      output[j + offset] = ${C[0].type.value}((f32input ${a?"":"- mean"}) * inv_std_dev * f32scale
        ${d?`+ ${Dd($,M,"bias[j]")}`:""}
      );
    }

    ${E?"mean_data_output[global_idx] = mean":""};
    ${T?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},O=[{dims:c,dataType:t[0].dataType}];return E&&O.push({dims:w,dataType:1}),T&&O.push({dims:w,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${M};${n};${a}`,inputDependencies:x},getRunData:()=>({outputs:O,dispatchGroup:{x:Math.ceil(p/64)},programUniforms:F}),getShaderSource:L}},Kv=(t,r)=>{G2(t.inputs),t.compute(W2(t.inputs,r,t.outputCount))}}),H2,Qv,F3=at(()=>{tn(),D1(),k1(),H2=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},Qv=t=>{H2(t.inputs);let r=Ld.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!r)throw new Error("Can't use matmul on the given tensors");let n=r[r.length-1],a=t.inputs[0].dims[t.inputs[0].dims.length-1];if(n<8&&a<8)t.compute($1(t.inputs,{activation:""},r));else{let o=r[r.length-2],u=Fe.size(t.inputs[0].dims.slice(0,-2)),d=Fe.size(t.inputs[1].dims.slice(0,-2));if(u!==1&&o===1&&d===1){let c=t.inputs[0].reshape([1,u,a]),f=t.inputs[1].reshape([1,a,n]),p=[1,u,n],g=[c,f];t.compute(_m(g,{activation:""},r,p),{inputs:g})}else t.compute(_m(t.inputs,{activation:""},r))}}}),q2,K2,Q2,Xv,Yv,R3=at(()=>{Nt(),tn(),xs(),sn(),q2=(t,r)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=t[0],a=n.dims.length;if(n.dims[a-1]!==r.k)throw new Error("The last dim of input shape does not match the k value");let o=Math.floor((r.k+r.blockSize-1)/r.blockSize),u=r.blockSize/8*r.bits,d=t[1];if(!Fe.areEqual(d.dims,[r.n,o,u]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let c=t[2].dims;if(Fe.size(c)!==r.n*o)throw new Error("scales input size error.");if(t.length===4){let f=t[3].dims,p=r.bits>4?r.n*o:r.n*Math.floor((o+1)/2);if(Fe.size(f)!==p)throw new Error("zeroPoints input size error.")}},K2=(t,r)=>{let n=t[0].dims,a=n.length,o=n[a-2],u=r.k,d=r.n,c=n.slice(0,a-2),f=Fe.size(c),p=t[1].dims[2]/4,g=t[0].dataType,_=_s(r.k),h=_s(p),w=_s(d),M=c.concat([o,d]),x=o>1&&d/w%2===0?2:1,F=Fe.size(M)/w/x,E=64,T=[],L=[f,o,u/_],O=Fe.convertShape(t[1].dims).slice();O.splice(-1,1,p/h),T.push(...Lt(L)),T.push(...Lt(O)),T.push(...Lt(t[2].dims)),t.length===4&&T.push(...Lt(Fe.convertShape(t[3].dims)));let S=[f,o,d/w];T.push(...Lt(S));let $=C=>{let k=L.length,U=We("a",t[0].dataType,k,_),V=We("b",12,O.length,h),re=We("scales",t[2].dataType,t[2].dims.length),ne=[U,V,re],W=t.length===4?We("zero_points",12,t[3].dims.length):void 0;W&&ne.push(W);let ce=S.length,ae=St("output",t[0].dataType,ce,w),H=Ys(t[0].dataType),se=(()=>{switch(_){case 1:return`array<${H}, 8>`;case 2:return`mat4x2<${H}>`;case 4:return`mat2x4<${H}>`;default:throw new Error(`${_}-component is not supported.`)}})(),ie=()=>{let j=`
          // reuse a data
            var input_offset = ${U.indicesToOffset(`${U.type.indices}(batch, row, word_offset)`)};
            var a_data: ${se};
            for (var j: u32 = 0; j < ${8/_}; j++) {
              a_data[j] = ${U.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let R=0;R<w*x;R++)j+=`
            b_value = ${h===1?`b${R}_data`:`b${R}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${se}(${Array.from({length:4},(X,G)=>`${H}(b_value_lower[${G}]), ${H}(b_value_upper[${G}])`).join(", ")});
            b_dequantized_values = ${_===1?`${se}(${Array.from({length:8},(X,G)=>`(b_quantized_values[${G}] - ${W?`zero_point${R}`:"zero_point"}) * scale${R}`).join(", ")});`:`(b_quantized_values - ${se}(${Array(8).fill(`${W?`zero_point${R}`:"zero_point"}`).join(",")})) * scale${R};`};
            workgroup_shared[local_id.x * ${x} + ${Math.floor(R/w)}]${w>1?`[${R%w}]`:""} += ${Array.from({length:8/_},(X,G)=>`${_===1?`a_data[${G}] * b_dequantized_values[${G}]`:`dot(a_data[${G}], b_dequantized_values[${G}])`}`).join(" + ")};
          `;return j},ge=()=>{let j=`
            var col_index = col * ${w};
            ${W?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${H}(8);`}
            `;for(let R=0;R<w*x;R++)j+=`
            let scale${R} = ${re.getByOffset("col_index * nBlocksPerCol + block")};
            ${W?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${W.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${R} = ${H}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return j},q=()=>{let j=`col_index = col * ${w};`;for(let R=0;R<w*x;R++)j+=`
            let b${R}_data = ${V.getByIndices(`${V.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return j+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${se};
            var b_dequantized_values: ${se};`,j};return`
        var<workgroup> workgroup_shared: array<${ae.type.value}, ${x*E}>;
        ${C.declareVariables(...ne,ae)}
        ${C.mainStart([E,1,1])}
          let output_indices = ${ae.offsetToIndices(`(global_idx / ${E}) * ${x}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${E}) {
            //process one block
            var word_offset: u32 = block * ${r.blockSize/_};
            ${ge()}
            for (var word: u32 = 0; word < ${p}; word += ${h}) {
              ${q()}
              for (var i: u32 = 0; i < ${h}; i++) {
                ${ie()}
                word_offset += ${8/_};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${x}) {
            var output_value: ${ae.type.value} = ${ae.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${E}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${x};
            }
            ${ae.setByIndices(`${ae.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${r.blockSize};${r.bits};${_};${h};${w};${x};${E}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:M,dataType:g}],dispatchGroup:{x:F},programUniforms:T}),getShaderSource:$}},Q2=(t,r)=>{let n=t[0].dims,a=n.length,o=n[a-2],u=r.k,d=r.n,c=n.slice(0,a-2),f=Fe.size(c),p=t[1].dims[2]/4,g=t[0].dataType,_=_s(r.k),h=_s(p),w=c.concat([o,d]),M=128,x=d%8===0?8:d%4===0?4:1,F=M/x,E=F*h*8,T=E/_,L=E/r.blockSize,O=Fe.size(w)/x,S=[],$=[f,o,u/_],C=Fe.convertShape(t[1].dims).slice();C.splice(-1,1,p/h),S.push(...Lt($)),S.push(...Lt(C)),S.push(...Lt(t[2].dims)),t.length===4&&S.push(...Lt(Fe.convertShape(t[3].dims)));let k=[f,o,d];S.push(...Lt(k));let U=V=>{let re=$.length,ne=We("a",t[0].dataType,re,_),W=We("b",12,C.length,h),ce=We("scales",t[2].dataType,t[2].dims.length),ae=[ne,W,ce],H=t.length===4?We("zero_points",12,t[3].dims.length):void 0;H&&ae.push(H);let se=k.length,ie=St("output",t[0].dataType,se),ge=Ys(t[0].dataType),q=()=>{switch(_){case 1:return`
          let a_data0 = vec4<${ge}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ge}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ge}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ge}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${_}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${ne.type.value}, ${T}>;
        var<workgroup> inter_results: array<array<${ie.type.value}, ${F}>, ${x}>;
        ${V.declareVariables(...ae,ie)}
        ${V.mainStart([F,x,1])}
          let output_indices = ${ie.offsetToIndices(`workgroup_index * ${x}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${L} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${T};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${T}; a_offset += ${M})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${ne.getByIndices(`${ne.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${ne.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${L} + local_id.x;
            ${H?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${H.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ge}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ge}(8);`}
            let scale = ${ce.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${W.getByIndices(`${W.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${r.blockSize/_};
            for (var i: u32 = 0; i < ${h}; i++) {
              ${q()}
              let b_value = ${h===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ge}>(${Array.from({length:4},(j,R)=>`${ge}(b_value_lower[${R}]), ${ge}(b_value_upper[${R}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ge}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(j,R)=>`${`dot(a_data${R}, b_dequantized_values[${R}])`}`).join(" + ")};
              word_offset += ${8/_};
            }
            workgroupBarrier();
          }

          if (local_idx < ${x}) {
            var output_value: ${ie.type.value} = ${ie.type.value}(0);
            for (var b = 0u; b < ${F}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${ie.setByIndices(`${ie.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${r.blockSize};${_};${h};${F};${x}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:w,dataType:g}],dispatchGroup:{x:O},programUniforms:S}),getShaderSource:U}},Xv=(t,r)=>{q2(t.inputs,r),r.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(Q2(t.inputs,r)):t.compute(K2(t.inputs,r))},Yv=t=>Sn(t)}),X2,Y2,Z2,J2,ey,ty,ny,sy,Zv,B3=at(()=>{Nt(),tn(),sn(),X2=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let r=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(r=t[3].dims[0]*2===t[1].dims[0]),!r)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Y2=(t,r,n)=>{let a="";for(let o=r-1;o>=0;--o)a+=`
            k = i32(${t.indicesGet("indices",o)}) - ${At("uniforms.pads",o,n)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${At("uniforms.x_shape",o,r)})) {
              break;
            }
            offset += k * i32(${At("uniforms.x_strides",o,r)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${a}
            value = x[offset];
          }
      `},Z2=(t,r,n)=>{let a="";for(let o=r-1;o>=0;--o)a+=`
                k = i32(${t.indicesGet("indices",o)}) - ${At("uniforms.pads",o,n)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${At("uniforms.x_shape",o,r)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${At("uniforms.x_shape",o,r)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${At("uniforms.x_strides",o,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},J2=(t,r,n)=>{let a="";for(let o=r-1;o>=0;--o)a+=`
                k = i32(${t.indicesGet("indices",o)}) - ${At("uniforms.pads",o,n)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${At("uniforms.x_shape",o,r)})) {
                  k = i32(${At("uniforms.x_shape",o,r)}) - 1;
                }
                offset += k * i32(${At("uniforms.x_strides",o,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},ey=(t,r,n)=>{let a="";for(let o=r-1;o>=0;--o)a+=`
                k = i32(${t.indicesGet("indices",o)}) - ${At("uniforms.pads",o,n)};
                if (k < 0)  {
                  k += i32(${At("uniforms.x_shape",o,r)}]);
                }
                if (k >= i32(${At("uniforms.x_shape",o,r)})) {
                  k -= i32(${At("uniforms.x_shape",o,r)});
                }
                offset += k * i32(${At("uniforms.x_strides",o,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},ty=(t,r,n)=>{switch(n.mode){case 0:return Y2(t,r,n.pads.length);case 1:return Z2(t,r,n.pads.length);case 2:return J2(t,r,n.pads.length);case 3:return ey(t,r,n.pads.length);default:throw new Error("Invalid mode")}},ny=(t,r)=>{let n=Fe.padShape(t[0].dims.slice(),r.pads),a=t[0].dims,o=Fe.size(n),u=[{type:12,data:o},{type:6,data:r.pads}],d=t.length>=3&&t[2].data;r.mode===0&&u.push({type:d?t[2].dataType:1,data:r.value}),u.push(...Lt(t[0].dims,n));let c=["rank"],f=p=>{let g=St("output",t[0].dataType,n.length),_=We("x",t[0].dataType,a.length),h=_.type.value,w=ty(g,a.length,r),M=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:r.pads.length}];return r.mode===0&&M.push({name:"constant_value",type:d?h:"f32"}),`
            ${p.registerUniforms(M).declareVariables(_,g)}
            ${p.mainStart()}
            ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${g.offsetToIndices("global_idx")};

            var value = ${h}(0);
            ${w}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${r.mode}${d}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Fe.size(n)/64)},programUniforms:u}),getShaderSource:f}},sy=(t,r)=>{if(t.length>1){let n=t[1].getBigInt64Array(),a=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,o=t[0].dims.length,u=new Int32Array(2*o).fill(0);if(t.length>=4){let c=t[3].getBigInt64Array();for(let f=0;f<c.length;f++)u[Number(c[f])]=Number(n[f]),u[Number(c[f])+o]=Number(n[f+c.length])}else n.forEach((c,f)=>u[Number(f)]=Number(c));let d=[];return u.forEach(c=>d.push(c)),{mode:r.mode,value:a,pads:d}}else return r},Zv=(t,r)=>{X2(t.inputs);let n=sy(t.inputs,r);t.compute(ny(t.inputs,n),{inputs:[0]})}}),Bp,C_,S_,P_,A_,ry,ay,O_,$_,Jv,ew,D_,tw,nw,k_,sw,rw,aw,iw,N3=at(()=>{ai(),Nt(),tn(),sn(),Bp=t=>{if(ts.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},C_=(t,r,n)=>{let a=r.format==="NHWC",o=t.dims.slice();a&&o.splice(1,0,o.pop());let u=Object.hasOwnProperty.call(r,"dilations"),d=r.kernelShape.slice(),c=r.strides.slice(),f=u?r.dilations.slice():[],p=r.pads.slice();hm.adjustPoolAttributes(n,o,d,c,f,p);let g=hm.computePoolOutputShape(n,o,c,f,d,p,r.autoPad),_=Object.assign({},r);u?Object.assign(_,{kernelShape:d,strides:c,pads:p,dilations:f,cacheKey:r.cacheKey}):Object.assign(_,{kernelShape:d,strides:c,pads:p,cacheKey:r.cacheKey});let h=g.slice();return h.push(h.splice(1,1)[0]),[_,a?h:g]},S_=(t,r)=>{let n=r.format==="NHWC",a=Fe.size(t),o=Fe.size(r.kernelShape),u=[{type:12,data:a},{type:12,data:o}],d=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(r.kernelShape.length<=2){let c=r.kernelShape[r.kernelShape.length-1],f=r.strides[r.strides.length-1],p=r.pads[r.pads.length/2-1],g=r.pads[r.pads.length-1],_=!!(p+g);u.push({type:12,data:c},{type:12,data:f},{type:12,data:p},{type:12,data:g}),d.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let h=!1;if(r.kernelShape.length===2){let w=r.kernelShape[r.kernelShape.length-2],M=r.strides[r.strides.length-2],x=r.pads[r.pads.length/2-2],F=r.pads[r.pads.length-2];h=!!(x+F),u.push({type:12,data:w},{type:12,data:M},{type:12,data:x},{type:12,data:F}),d.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[u,d,!0,_,h]}else{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let c=Fe.computeStrides(r.kernelShape);u.push({type:12,data:c},{type:12,data:r.pads},{type:12,data:r.strides}),d.push({name:"kernelStrides",type:"u32",length:c.length},{name:"pads",type:"u32",length:r.pads.length},{name:"strides",type:"u32",length:r.strides.length});let f=r.pads.reduce((p,g)=>p+g);return[u,d,!!f,!1,!1]}},P_=(t,r,n,a,o,u,d,c,f,p,g,_)=>{let h=o.format==="NHWC",w=r.type.value,M=St("output",r.type.tensor,a);if(o.kernelShape.length<=2){let x="",F="",E="",T=n-(h?2:1);if(g?x=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${T}] = indices[${T}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${T}] < 0 || xIndices[${T}]
                      >= uniforms.x_shape[${T}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${r.indicesToOffset("xIndices")}];
                  ${u}
                }`:x=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${T}] = indices[${T}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${r.indicesToOffset("xIndices")}];
                  ${u}
                }`,o.kernelShape.length===2){let L=n-(h?3:2);_?F=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${L}] = indices[${L}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${L}] < 0 || xIndices[${L}] >= uniforms.x_shape[${L}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:F=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${L}] = indices[${L}] * uniforms.sh - uniforms.phStart + j;
                `,E=`
              }
            `}return`
            ${t.registerUniforms(f).declareVariables(r,M)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${M.offsetToIndices("global_idx")};
              var xIndices = ${M.offsetToIndices("global_idx")};

              var value = ${w}(${c});
              var pad = 0;
              ${F}
              ${x}
              ${E}
              ${d}

              output[global_idx] = value;
            }`}else{if(h)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let x=o.kernelShape.length,F=o.pads.length,E="";return p?E=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${r.indicesToOffset("xIndices")}];
                ${u}
              }`:E=`
              }
              let x_val = x[${r.indicesToOffset("xIndices")}];
              ${u}
            `,`
            ${t.registerUniforms(f).declareVariables(r,M)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${M.offsetToIndices("global_idx")};
              var xIndices = ${M.offsetToIndices("global_idx")};

              var offsets: array<u32, ${x}>;

              var value = ${w}(${c});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${x-1}u; j++) {
                  offsets[j] = offset / ${At("uniforms.kernelStrides","j",x)};
                  offset -= offsets[j] * ${At("uniforms.kernelStrides","j",x)};
                }
                offsets[${x-1}] = offset;

                isPad = false;
                for (var j = ${n-x}u; j < ${n}u; j++) {
                  xIndices[j] = indices[j] * ${At("uniforms.strides",`j - ${n-x}u`,x)}
                    + offsets[j - ${n-x}u] - ${At("uniforms.pads","j - 2u",F)};
                  ${E}
              }
              ${d}

              output[global_idx] = value;
            }`}},A_=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,ry=t=>`${A_(t)};${t.countIncludePad}`,ay=t=>`${A_(t)};${t.storageOrder};${t.dilations}`,O_=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),$_=(t,r,n,a)=>{let[o,u]=C_(r,a,n),d=We("x",r.dataType,r.dims.length),c=d.type.value,f="value += x_val;",p="";o.countIncludePad?p+=`value /= ${c}(uniforms.kernelSize);`:p+=`value /= ${c}(i32(uniforms.kernelSize) - pad);`;let[g,_,h,w,M]=S_(u,o);g.push(...Lt(r.dims,u));let x=["rank"];return{name:t,shaderCache:{hint:`${a.cacheKey};${h};${w};${M}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:u,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(Fe.size(u)/64)},programUniforms:g}),getShaderSource:F=>P_(F,d,r.dims.length,u.length,o,f,p,0,_,h,w,M)}},Jv=t=>{let r=t.count_include_pad!==0,n=O_(t);if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let a={countIncludePad:r,...n,cacheKey:""};return{...a,cacheKey:ry(a)}},ew=(t,r)=>{Bp(t.inputs),t.compute($_("AveragePool",t.inputs[0],!1,r))},D_={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},tw=t=>{let r=t.format;return{format:r,...D_,cacheKey:r}},nw=(t,r)=>{Bp(t.inputs),t.compute($_("GlobalAveragePool",t.inputs[0],!0,r))},k_=(t,r,n,a)=>{let[o,u]=C_(r,a,n),d=`
      value = max(x_val, value);
    `,c="",f=We("x",r.dataType,r.dims.length),p=["rank"],[g,_,h,w,M]=S_(u,o);return g.push(...Lt(r.dims,u)),{name:t,shaderCache:{hint:`${a.cacheKey};${h};${w};${M}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:u,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(Fe.size(u)/64)},programUniforms:g}),getShaderSource:x=>P_(x,f,r.dims.length,u.length,o,d,c,r.dataType===10?-65504:-1e5,_,h,w,M)}},sw=(t,r)=>{Bp(t.inputs),t.compute(k_("MaxPool",t.inputs[0],!1,r))},rw=t=>{let r=t.storage_order,n=t.dilations,a=O_(t);if(r!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(a.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let o={storageOrder:r,dilations:n,...a,cacheKey:""};return{...o,cacheKey:ay(o)}},aw=t=>{let r=t.format;return{format:r,...D_,cacheKey:r}},iw=(t,r)=>{Bp(t.inputs),t.compute(k_("GlobalMaxPool",t.inputs[0],!0,r))}}),iy,oy,ow,lw,j3=at(()=>{Nt(),tn(),xs(),sn(),iy=(t,r)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((n,a)=>n===t[2].dims[a]).reduce((n,a)=>n&&a,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(r.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((o,u)=>u===r.axis||o===t[0].dims[u]).reduce((o,u)=>o&&u,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=t[0].dims[r.axis],a=t[1].dims[r.axis];if(r.blockSize<Math.ceil(n/a)||r.blockSize>Math.ceil(n/(a-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},oy=(t,r)=>{let n=Fe.normalizeAxis(r.axis,t[0].dims.length),a=t[0].dataType,o=a===3,u=t[0].dims,d=t[1].dataType,c=Fe.size(u),f=a===3||a===2,p=f?[Math.ceil(Fe.size(t[0].dims)/4)]:t[0].dims,g=t[1].dims,_=t.length>2?t[2]:void 0,h=_?f?[Math.ceil(Fe.size(_.dims)/4)]:_.dims:void 0,w=g.length===0||g.length===1&&g[0]===1,M=w===!1&&g.length===1,x=_s(c),F=w&&(!f||x===4),E=F?x:1,T=F&&!f?x:1,L=We("input",f?12:a,p.length,T),O=We("scale",d,g.length),S=_?We("zero_point",f?12:a,h.length):void 0,$=St("output",d,u.length,E),C=[L,O];S&&C.push(S);let k=[p,g];_&&k.push(h);let U=[{type:12,data:c/E},{type:12,data:n},{type:12,data:r.blockSize},...Lt(...k,u)],V=re=>{let ne=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${re.registerUniforms(ne).declareVariables(...C,$)}
      ${re.mainStart()}
          ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${$.offsetToIndices("global_idx")};

          // Set input x
          ${f?`
            let input = ${L.getByOffset("global_idx / 4")};
            let x_vec = ${o?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${E===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${L.getByOffset("global_idx")};`};

          // Set scale input
          ${w?`let scale_value= ${O.getByOffset("0")}`:M?`
            let scale_index = ${$.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${O.getByOffset("scale_index")};`:`
            var scale_indices: ${O.type.indices} = output_indices;
            let index = ${O.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${O.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${O.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${S?w?f?`
                let zero_point_input = ${S.getByOffset("0")};
                let zero_point_vec =  ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${S.getByOffset("0")}`:M?f?`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${S.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${S.getByOffset("zero_point_index")};`:f?`
                let zero_point_offset = ${O.indicesToOffset("scale_indices")};
                let zero_point_input = ${S.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${o?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${S.getByIndices("scale_indices")};`:`let zero_point_value = ${f?o?"i32":"u32":L.type.value}(0);`};
      // Compute and write output
      ${$.setByOffset("global_idx",`${$.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:r.cacheKey,inputDependencies:S?["rank","rank","rank"]:["rank","rank"]},getShaderSource:V,getRunData:()=>({outputs:[{dims:u,dataType:d}],dispatchGroup:{x:Math.ceil(c/E/64),y:1,z:1},programUniforms:U})}},ow=(t,r)=>{iy(t.inputs,r),t.compute(oy(t.inputs,r))},lw=t=>Sn({axis:t.axis,blockSize:t.blockSize})}),ly,uy,uw,U3=at(()=>{ai(),Nt(),sn(),ly=(t,r,n)=>{let a=t===r,o=t<r&&n<0,u=t>r&&n>0;if(a||o||u)throw new Error("Range these inputs' contents are invalid.")},uy=(t,r,n,a)=>{let o=Math.abs(Math.ceil((r-t)/n)),u=[o],d=o,c=[{type:12,data:d},{type:a,data:t},{type:a,data:n},...Lt(u)],f=p=>{let g=St("output",a,u.length),_=g.type.value,h=[{name:"outputSize",type:"u32"},{name:"start",type:_},{name:"delta",type:_}];return`
        ${p.registerUniforms(h).declareVariables(g)}
        ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${_}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${a}`},getShaderSource:f,getRunData:()=>({outputs:[{dims:u,dataType:a}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:c})}},uw=t=>{let r=0,n=0,a=0;t.inputs[0].dataType===6?(r=t.inputs[0].getInt32Array()[0],n=t.inputs[1].getInt32Array()[0],a=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(r=t.inputs[0].getFloat32Array()[0],n=t.inputs[1].getFloat32Array()[0],a=t.inputs[2].getFloat32Array()[0]),ts.webgpu.validateInputContent&&ly(r,n,a),t.compute(uy(r,n,a,t.inputs[0].dataType),{inputs:[]})}}),cy,L_,I_,dy,cw,dw,V3=at(()=>{Nt(),tn(),xs(),sn(),cy=(t,r,n,a)=>{if(t!=="none"&&a!=="i32"&&a!=="u32"&&a!=="f32")throw new Error(`Input ${a} is not supported with reduction ${t}.`);let o=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,u=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${r}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${r}=${n};`;case"add":return a==="i32"||a==="u32"?`atomicAdd(&${r}, bitcast<${a}>(${n}));`:`
              ${o}bitcast<${a}>(oldValue) + (${n})${u}`;case"max":return a==="i32"||a==="u32"?`atomicMax(&${r}, bitcast<${a}>(${n}));`:`
                ${o}max(bitcast<f32>(oldValue), (${n}))${u}`;case"min":return a==="i32"||a==="u32"?`atomicMin(&${r}, bitcast<${a}>(${n}));`:`${o}min(bitcast<${a}>(oldValue), (${n}))${u}`;case"mul":return`${o}(bitcast<${a}>(oldValue) * (${n}))${u}`;default:throw new Error(`Reduction ${t} is not supported.`)}},L_=(t,r)=>`${t===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${r?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${r?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,I_=(t,r,n)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${n?"global_idx":"idx"} + i];
        ${cy(t.reduction,"output[data_offset + i]","value",r)}
      }`,dy=(t,r)=>{let n=t[0].dims,a=t[1].dims,o=n,u=1,d=Math.ceil(Fe.size(a)/u),c=a[a.length-1],f=Fe.sizeFromDimension(n,c),p=Fe.sizeFromDimension(a,0)/c,g=[{type:12,data:d},{type:12,data:c},{type:12,data:f},...Lt(t[1].dims,t[2].dims,o)],_=h=>{let w=We("indices",t[1].dataType,t[1].dims.length),M=We("updates",t[2].dataType,t[2].dims.length,u),x=r.reduction!=="none"&&r.reduction!==""?Bb("output",t[0].dataType,o.length):St("output",t[0].dataType,o.length,u);return`
      ${h.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(w,M,x)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${r.reduction==="none"}) {
    for (var i = 0; i < ${p}; i = i + 1) {
      for (var j = i + 1; j < ${p}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${r.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${p}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${L_(n.length,!1)}
      }
      ${I_(r,x.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${L_(n.length,!0)}
  }
  ${I_(r,x.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${r.cacheKey}_${r.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:g}),getShaderSource:_}},cw=t=>Sn({reduction:t.reduction}),dw=(t,r)=>{t.compute(dy(t.inputs,r),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),fy,py,hy,z_,my,_y,gy,yy,by,My,vy,wy,F_,xy,Ty,Ey,Cy,Sy,fw,pw,G3=at(()=>{Nt(),tn(),xs(),sn(),fy=(t,r)=>{if(t.every(n=>n>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(r.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(r.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},py=(t,r,n)=>{r.every(o=>o>=0&&o<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let a=new Array(n).fill(1);return r.forEach((o,u)=>a[o]=t[u]),a},hy=(t,r,n,a,o,u)=>{let[d,c,f]=n>10?[1,2,3]:[-1,t.length>1?1:-1,-1],p=t[0].dims.length;if(d>0&&t.length>d&&t[d].dims.length>0)t[d].getFloat32Array().forEach(g=>u.push(g));else if(r.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(c>0&&t.length>c&&t[c].dims.length===1&&t[c].dims[0]>0){if(t[c].getFloat32Array().forEach(g=>a.push(g)),a.length!==0&&a.length!==p&&n>=18&&a.length!==r.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");fy(a,r),r.axes.length>0&&py(a,r.axes,p).forEach((g,_)=>a[_]=g)}if(f>0&&t.length>f&&t[f].dims.length===1&&t[f].dims[0]>0&&(t[f].getBigInt64Array().forEach(g=>o.push(Number(g))),o.length!==0&&o.length!==p&&n>=18&&o.length!==r.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(r.axes.length>0){if(a.length!==0&&a.length!==r.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(o.length!==0&&o.length!==r.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof a<"u"&&typeof o<"u"&&a.length>0&&o.length>p)throw new Error("Resize requires only of scales or sizes to be specified")},z_=(t,r,n,a)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${r});
  let whole = ${a}(big / (${n}));
  let fract = ${a}(big % (${n})) / ${a}(${n});
  return whole + fract;
`,my=(t,r)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${r} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${r}(xResized) / ${r}(xScale);
          } else {
            ${z_("xResized","lengthOriginal","lengthResized",r)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${r}(xResized) + 0.5) / ${r}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${r}(xResized) + 0.5) / ${r}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${z_("xResized","lengthOriginal - 1","lengthResized - 1",r)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${r}(roiStart) * ${r}(lengthOriginal - 1) +
                        (${r}(xResized) * ${r}(roiEnd - roiStart) * ${r}(lengthOriginal - 1)) /
                        ${r}(lengthResized - 1);
                  } else {
                    return 0.5 * ${r}(roiStart + roiEnd) * ${r}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${r}xScale * ${r}(lengthResized);
                  const adjustment = ${r}(lengthResized) / outputWidth;
                  const center = ${r}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;case"half_pixel":return`return ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",_y=(t,r,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(r<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",gy=(t,r,n)=>{let a=new Array(n).fill(0).concat(new Array(n).fill(1)),o=t.length===0?a:t.slice();return r.length>0?(r.forEach((u,d)=>{a[u]=o[d],a[d+n]=o[r.length+d]}),a):o},yy=(t,r,n,a)=>{let o=[];if(n.length>0)if(a.length>0){if(t.forEach(u=>o.push(u)),Math.max(...a)>t.length)throw new Error("axes is out of bound");a.forEach((u,d)=>o[u]=n[d])}else n.forEach(u=>o.push(u));else{if(r.length===0)throw new Error("Resize requires either scales or sizes.");o=t.map((u,d)=>Math.round(u*r[d]))}return o},by=(t,r,n)=>{let a=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(u=>r[u]),Number.MAX_VALUE):Math.min(...r,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(u=>r[u]),Number.MIN_VALUE):Math.max(...r,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();r.fill(1,0,r.length);let o=t.slice();return n.axes.length>0?(n.axes.forEach(u=>r[u]=a),n.axes.forEach(u=>o[u]=Math.round(t[u]*r[u]))):(r.fill(a,0,r.length),o.forEach((u,d)=>o[d]=Math.round(u*r[d]))),o},My=(t,r,n,a,o)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${n.length}> {
      var original_indices: array<${t.type.value}, ${n.length}>;
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${At("uniforms.scales","i",a)};
        var roi_low = ${At("uniforms.roi","i",o)};
        var roi_hi = ${At("uniforms.roi",`i + ${r.length}`,o)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${At("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${At("uniforms.output_shape","i",n.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,vy=(t,r,n,a,o,u,d)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${r.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${a.length}; i++) {
        var output_index = ${r.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${At("uniforms.scales","i",o)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${At("uniforms.roi","i",u)};
          var roi_hi = ${At("uniforms.roi",`i + ${n.length}`,u)};
          var input_shape_i = ${At("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${At("uniforms.output_shape","i",a.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${d} || (original_idx >= 0 && original_idx < ${r.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${r.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,wy=(t,r)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${At("uniforms.input_shape","i",r.length)}) {
          return false;
        }
      }
      return true;
    }`,F_=(t,r,n,a)=>t.rank>a?`
    ${t.indicesSet("input_indices",r,"channel")};
    ${t.indicesSet("input_indices",n,"batch")};
`:"",xy=(t,r,n,a,o)=>{let[u,d,c,f]=n.length===2?[-1,0,1,-1]:[0,2,3,1],p=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${p} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",d,`max(0, min(row, ${n[d]} - 1))`)};
      ${t.indicesSet("input_indices",c,`max(0, min(col, ${n[c]} - 1))`)};
      ${F_(t,f,u,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${r.type.indices}) -> ${p} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${p} = originalIndices[${d}];
      var col:${p} = originalIndices[${c}];
      ${a?`if (row < 0 || row > (${n[d]} - 1) || col < 0 || col > (${n[c]} - 1)) {
        return ${o};
      }`:""};
      row = max(0, min(row, ${n[d]} - 1));
      col = max(0, min(col, ${n[c]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${n.length>2?`u32(originalIndices[${f}])`:"0"};
      var batch: u32 =  ${n.length>2?`u32(originalIndices[${u}])`:"0"};
      var x11: ${p} = getInputValue(batch, channel, row1, col1);
      var x12: ${p} = getInputValue(batch, channel, row1, col2);
      var x21: ${p} = getInputValue(batch, channel, row2, col1);
      var x22: ${p} = getInputValue(batch, channel, row2, col2);
      var dx1: ${p} = abs(row - ${p}(row1));
      var dx2: ${p} = abs(${p}(row2) - row);
      var dy1: ${p} = abs(col - ${p}(col1));
      var dy2: ${p} = abs(${p}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Ty=(t,r,n,a,o,u,d,c,f,p)=>{let g=n.length===2,[_,h]=g?[0,1]:[2,3],w=t.type.value,M=x=>{let F=x===_?"row":"col";return`
      fn ${F}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${r.type.indices}) -> ${w} {
        var output_index = ${r.indicesGet("output_indices",x)};
        var originalIdx: ${w} = getOriginalCoordinateFromResizedCoordinate(output_index, ${o[x]},
        ${a[x]}, ${n[x]}, ${u[x]}, ${u[x]} + ${n.length});
        var fractOriginalIdx: ${w} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${c} && (originalIdx < 0 || originalIdx > (${n[x]} - 1))) {
          return ${f};
        }
        var data: array<${w}, 4> = array<${w}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${F}: ${w} = originalIdx + ${w}(i);
          if (${F} < 0 || ${F} >= ${n[x]}) {
            ${p?`coefs[i + 1] = 0.0;
                        continue;`:c?`return ${f};`:`${F} = max(0, min(${F}, ${n[x]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",x,`u32(${F})`)};
          data[i + 1] = ${x===_?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${M(_)};
    ${M(h)};
  fn getCubicInterpolationCoefs(s: ${w}) -> array<${w}, 4> {
    var absS = abs(s);
    var coeffs: array<${w}, 4> = array<${w}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${w} = 1.0 - absS;
    var twoMinusAbsS: ${w} = 2.0 - absS;
    var onePlusAbsS: ${w} = 1.0 + absS;
    coeffs[0] = ((${d} * onePlusAbsS - 5 * ${d}) * onePlusAbsS + 8 * ${d}) * onePlusAbsS - 4 * ${d};
    coeffs[1] = ((${d} + 2) * absS - (${d} + 3)) * absS * absS + 1;
    coeffs[2] = ((${d} + 2) * oneMinusAbsS - (${d} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${d} * twoMinusAbsS - 5 * ${d}) * twoMinusAbsS + 8 * ${d}) * twoMinusAbsS - 4 * ${d};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${w}, 4>, coefs: array<${w}, 4>) -> ${w} {
    var coefsSum: ${w} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${r.type.indices}) -> ${w} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},Ey=(t,r,n,a,o)=>{let[u,d,c,f,p]=n.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],g=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${g} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",d,`max(0, min(depth, ${n[d]} - 1))`)};
      ${t.indicesSet("input_indices",c,`max(0, min(height, ${n[c]} - 1))`)};
      ${t.indicesSet("input_indices",f,`max(0, min(width, ${n[f]} - 1))`)};
      ${F_(t,p,u,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${r.type.indices}) -> ${g} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${g} = originalIndices[${d}];
      var height:${g} = originalIndices[${c}];
      var width:${g} = originalIndices[${f}];
      ${a?`if (depth < 0 || depth > (${n[d]} - 1) || height < 0 || height > (${n[c]} - 1) || width < 0 || (width > ${n[f]} - 1)) {
      return ${o};
        }`:""};

    depth = max(0, min(depth, ${n[d]} - 1));
      height = max(0, min(height, ${n[c]} - 1));
      width = max(0, min(width, ${n[f]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${n.length>3?`u32(originalIndices[${p}])`:"0"};
      var batch: u32 =  ${n.length>3?`u32(originalIndices[${u}])`:"0"};

      var x111: ${g} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${g} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${g} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${g} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${g} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${g} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${g} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${g} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${g} = abs(depth - ${g}(depth1));
      var dx2: ${g} = abs(${g}(depth2) - depth);
      var dy1: ${g} = abs(height - ${g}(height1));
      var dy2: ${g} = abs(${g}(height2) - height);
      var dz1: ${g} = abs(width - ${g}(width1));
      var dz2: ${g} = abs(${g}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},Cy=(t,r,n,a,o,u)=>{let d=t.dims,c=gy(u,r.axes,d.length),f=yy(d,a,o,r.axes),p=a.slice();a.length===0&&(p=d.map((T,L)=>T===0?1:f[L]/T),r.keepAspectRatioPolicy!=="stretch"&&(f=by(d,p,r)));let g=St("output",t.dataType,f.length),_=We("input",t.dataType,d.length),h=Fe.size(f),w=d.length===f.length&&d.every((T,L)=>T===f[L]),M=r.coordinateTransformMode==="tf_crop_and_resize",x=r.extrapolationValue,F=_.type.value,E=T=>`
      ${w?"":`
      ${my(r.coordinateTransformMode,F)};
      ${(()=>{switch(r.mode){case"nearest":return`
              ${wy(_,d)};
              ${_y(r.nearestMode,n,F)};
              ${vy(_,g,d,f,p.length,c.length,M)};
              `;case"linear":return`
              ${My(g,d,f,p.length,c.length)};
              ${(()=>{if(d.length===2||d.length===4)return`${xy(_,g,d,M,x)}`;if(d.length===3||d.length===5)return`${Ey(_,g,d,M,x)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(d.length===2||d.length===4)return`${Ty(_,g,d,f,p,c,r.cubicCoeffA,M,r.extrapolationValue,r.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${T.registerUniform("output_size","u32").registerUniform("scales","f32",p.length).registerUniform("roi","f32",c.length).declareVariables(_,g)}
      ${T.mainStart()}
        ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${w?"output[global_idx] = input[global_idx];":`
        let output_indices = ${g.offsetToIndices("global_idx")};
        var input_indices: ${_.type.indices};
        ${(()=>{switch(r.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${_.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${r.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${d.length===2||d.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${r.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${r.cacheKey}|${n}|${p.length>0?r.mode==="cubic"?p:p.length:""}|${o.length>0?o:""}|${c.length>0?c:""}|${w}|${r.mode==="nearest"?d.length:d}`,inputDependencies:["rank"]},getShaderSource:E,getRunData:()=>({outputs:[{dims:f,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},{type:1,data:p},{type:1,data:c},...Lt(d,f)]})}},Sy=t=>{let r=t.customDataBuffer;return new Uint32Array(r,r.byteOffset,1)[0]},fw=(t,r)=>{let n=[],a=[],o=[],u=Sy(t);if(r.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");hy(t.inputs,r,u,n,a,o),t.compute(Cy(t.inputs[0],r,u,n,a,o),{inputs:[0]})},pw=t=>{let r=t.antialias,n=t.axes,a=t.coordinateTransformMode,o=t.cubicCoeffA,u=t.excludeOutside!==0,d=t.extrapolationValue,c=t.keepAspectRatioPolicy,f=t.mode,p=t.nearestMode===""?"simple":t.nearestMode;return Sn({antialias:r,axes:n,coordinateTransformMode:a,cubicCoeffA:o,excludeOutside:u,extrapolationValue:d,keepAspectRatioPolicy:c,mode:f,nearestMode:p})}}),Py,Ay,hw,W3=at(()=>{Nt(),tn(),sn(),Py=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let r=t[0],n=t[1],a=t[2];if(r.dataType!==n.dataType||r.dataType!==a.dataType)throw new Error("All inputs must have the same data type");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Input must be 2D or 3D");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Skip must be 2D or 3D");let o=r.dims[r.dims.length-1],u=r.dims[r.dims.length-2];if(n.dims[n.dims.length-1]!==o)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==u)throw new Error("Skip must have the same sequence length as input");if(a.dims.length!==1)throw new Error("Gamma must be 1D");if(a.dims[a.dims.length-1]!==o)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let d=t[3];if(d.dims.length!==1)throw new Error("Beta must be 1D");if(d.dims[d.dims.length-1]!==o)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let d=t[4];if(d.dims.length!==1)throw new Error("Bias must be 1D");if(d.dims[d.dims.length-1]!==o)throw new Error("Bias must have the same hidden size as input")}},Ay=(t,r,n,a)=>{let o=r.simplified,u=t[0].dims,d=Fe.size(u),c=u,f=d,p=u.slice(-1)[0],g=a?u.slice(0,-1).concat(1):[],_=!o&&t.length>3,h=t.length>4,w=a&&n>1,M=a&&n>2,x=n>3,F=64,E=_s(p),T=[{type:12,data:f},{type:12,data:E},{type:12,data:p},{type:1,data:r.epsilon}],L=S=>{let $=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],C=[We("x",t[0].dataType,t[0].dims,E),We("skip",t[1].dataType,t[1].dims,E),We("gamma",t[2].dataType,t[2].dims,E)];_&&C.push(We("beta",t[3].dataType,t[3].dims,E)),h&&C.push(We("bias",t[4].dataType,t[4].dims,E)),C.push(St("output",t[0].dataType,c,E)),w&&C.push(St("mean_output",1,g)),M&&C.push(St("inv_std_output",1,g)),x&&C.push(St("input_skip_bias_sum",t[0].dataType,c,E));let k=Ys(t[0].dataType),U=Ys(1,E);return`

      ${S.registerUniforms($).declareVariables(...C)}
      var<workgroup> sum_shared : array<${U}, ${F}>;
      var<workgroup> sum_squared_shared : array<${U}, ${F}>;

      ${S.mainStart([F,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${F};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${F};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${F-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${h?"bias[offset1d + i]":k+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${x?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Dd(k,E,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${F};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Ml("sum",E)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Ml("square_sum",E)} / f32(uniforms.hidden_size) ${o?"":"- mean * mean"} + uniforms.epsilon);
        ${w?"mean_output[global_idx] = mean;":""}
        ${M?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${o?"":`- ${k}(mean)`}) *
            ${k}(inv_std_dev) * gamma[offset1d + i]
            ${_?"+ beta[offset1d + i]":""};
        }
      }`},O=[{dims:c,dataType:t[0].dataType}];return n>1&&O.push({dims:g,dataType:1}),n>2&&O.push({dims:g,dataType:1}),n>3&&O.push({dims:u,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${E};${w};${M};${x}`,inputDependencies:t.map((S,$)=>"type")},getShaderSource:L,getRunData:()=>({outputs:O,dispatchGroup:{x:Math.ceil(f/p)},programUniforms:T})}},hw=(t,r)=>{Py(t.inputs);let n=[0];t.outputCount>1&&n.push(-3),t.outputCount>2&&n.push(-3),t.outputCount>3&&n.push(3),t.compute(Ay(t.inputs,r,t.outputCount,!1),{outputs:n})}}),Oy,Np,$y,R_,Dy,ky,mw,_w,H3=at(()=>{Nt(),tn(),xs(),sn(),Oy=(t,r)=>{if(!t||t.length<1)throw new Error("too few inputs");if(r.axes.length!==0){if(r.axes.length!==r.starts.length||r.axes.length!==r.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(r.starts.length!==r.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((n,a)=>{if(t[a+1].dataType!==6&&t[a+1].dataType!==7)throw new Error(`Input ${a} must be an array of int32 or int64`)})},Np=(t,r)=>{let n=[];if(t.length>r)if(t[r].dataType===7)t[r].getBigInt64Array().forEach(a=>n.push(Number(a)));else if(t[r].dataType===6)t[r].getInt32Array().forEach(a=>n.push(Number(a)));else throw new Error(`Input ${r} must be an array of int32 or int64`);return n},$y=(t,r)=>{if(t.length>1){let n=Np(t,1),a=Np(t,2),o=Np(t,3);return o.length===0&&(o=[...Array(t[0].dims.length).keys()]),Sn({starts:n,ends:a,axes:o})}else return r},R_=(t,r,n,a,o)=>{let u=t;return t<0&&(u+=n[a[r]]),o[r]<0?Math.max(0,Math.min(u,n[a[r]]-1)):Math.max(0,Math.min(u,n[a[r]]))},Dy=(t,r,n)=>`fn calculateInputIndices(output_indices: ${r.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${n.length}; i >= 0; i--) {
            let input_shape_i = ${At("uniforms.input_shape","i",n.length)};
            let steps_i = ${At("uniforms.steps","i",n.length)};
            let signs_i = ${At("uniforms.signs","i",n.length)};
            let starts_i = ${At("uniforms.starts","i",n.length)};
            var output_index = ${r.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,ky=(t,r)=>{let n=t[0].dims,a=Fe.size(n),o=r.axes.length>0?Fe.normalizeAxes(r.axes,n.length):[...Array(n.length).keys()],u=Np(t,4);u.forEach(E=>E!==0||(()=>{throw new Error("step cannot be 0")})),u.length===0&&(u=Array(o.length).fill(1));let d=r.starts.map((E,T)=>R_(E,T,n,o,u)),c=r.ends.map((E,T)=>R_(E,T,n,o,u));if(o.length!==d.length||o.length!==c.length)throw new Error("start, ends and axes should have the same number of elements");if(o.length!==n.length)for(let E=0;E<n.length;++E)o.includes(E)||(d.splice(E,0,0),c.splice(E,0,n[E]),u.splice(E,0,1));let f=u.map(E=>Math.sign(E));u.forEach((E,T,L)=>{if(E<0){let O=(c[T]-d[T])/E,S=d[T],$=S+O*u[T];d[T]=$,c[T]=S,L[T]=-E}});let p=n.slice(0);o.forEach((E,T)=>{p[E]=Math.ceil((c[E]-d[E])/u[E])});let g={dims:p,dataType:t[0].dataType},_=St("output",t[0].dataType,p.length),h=We("input",t[0].dataType,t[0].dims.length),w=Fe.size(p),M=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:d.length},{name:"signs",type:"i32",length:f.length},{name:"steps",type:"u32",length:u.length}],x=[{type:12,data:w},{type:12,data:d},{type:6,data:f},{type:12,data:u},...Lt(t[0].dims,p)],F=E=>`
      ${E.registerUniforms(M).declareVariables(h,_)}
        ${Dy(h,_,n)}
        ${E.mainStart()}
          ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${_.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${_.setByOffset("global_idx",h.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${f.length}_${d.length}_${u.length}`,inputDependencies:["rank"]},getShaderSource:F,getRunData:()=>({outputs:[g],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:x})}},mw=(t,r)=>{Oy(t.inputs,r);let n=$y(t.inputs,r);t.compute(ky(t.inputs,n),{inputs:[0]})},_w=t=>{let r=t.starts,n=t.ends,a=t.axes;return Sn({starts:r,ends:n,axes:a})}}),Ly,Iy,gw,yw,q3=at(()=>{Nt(),tn(),xs(),vl(),sn(),Ly=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},Iy=(t,r)=>{let n=t.inputs[0],a=n.dims,o=Fe.size(a),u=a.length,d=Fe.normalizeAxis(r.axis,u),c=d<a.length-1,f,p=[];c?(p=Array.from({length:u},(C,k)=>k),p[d]=u-1,p[u-1]=d,f=t.compute(Yr(n,p),{inputs:[n],outputs:[-1]})[0]):f=n;let g=f.dims,_=g[u-1],h=o/_,w=_s(_),M=_/w,x=64;h===1&&(x=256);let F=(C,k)=>k===4?`max(max(${C}.x, ${C}.y), max(${C}.z, ${C}.w))`:k===2?`max(${C}.x, ${C}.y)`:k===3?`max(max(${C}.x, ${C}.y), ${C}.z)`:C,E=We("x",f.dataType,f.dims,w),T=St("result",f.dataType,f.dims,w),L=E.type.value,O=Ys(f.dataType)==="f32"?`var threadMax = ${L}(-3.402823e+38f);`:`var threadMax = ${L}(-65504.0h);`,S=C=>`
      var<workgroup> rowMaxShared : ${L};
      var<workgroup> rowSumShared : ${L};
      var<workgroup> threadShared : array<${L}, ${x}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${L} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${L}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${C.registerUniform("packedCols","i32").declareVariables(E,T)}
      ${C.mainStart(x)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${x};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${O}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${L}(${F("threadShared[0]",w)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${L}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${L}(${Ml("threadShared[0]",w)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,$=t.compute({name:"Softmax",shaderCache:{hint:`${w};${x}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:g,dataType:f.dataType}],dispatchGroup:{x:h},programUniforms:[{type:6,data:M}]}),getShaderSource:S},{inputs:[f],outputs:[c?-1:0]})[0];c&&t.compute(Yr($,p),{inputs:[$]})},gw=(t,r)=>{Ly(t.inputs),Iy(t,r)},yw=t=>Sn({axis:t.axis})}),B_,zy,Fy,Ry,bw,K3=at(()=>{Nt(),tn(),sn(),B_=t=>Array.from(t.getBigInt64Array(),Number),zy=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(B_(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},Fy=(t,r)=>{let n=[];for(let a=0;a<t.length;++a)n.push(t[a]*r[a]);return n},Ry=(t,r)=>{let n=t[0].dims,a=r??B_(t[1]),o=Fy(n,a),u=Fe.size(o),d=t[0].dataType,c=We("input",d,n.length),f=St("output",d,o.length),p=g=>`
      const inputShape = ${c.indices(...n)};
      ${g.registerUniform("output_size","u32").declareVariables(c,f)}
      ${g.mainStart()}
      ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${f.offsetToIndices("global_idx")};
      var input_indices: ${c.type.indices};
      for (var i = 0; i < ${n.length}; i++) {
        let input_dim_i = ${c.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${f.indicesGet("output_indices","i")}  % input_dim_i;

        ${c.indicesSet("input_indices","i","input_dim_value")}
      }
      ${f.setByOffset("global_idx",c.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${a}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:[{type:12,data:u},...Lt(t[0].dims,o)]}),getShaderSource:p}},bw=t=>{zy(t.inputs),t.compute(Ry(t.inputs),{inputs:[0]})}}),By,Ny,Mw,Q3=at(()=>{Nt(),tn(),sn(),By=(t,r,n,a,o)=>{let u=St("output_data",o,n.length,4),d=We("a_data",r[1].dataType,r[1].dims.length,4),c=We("b_data",r[2].dataType,r[2].dims.length,4),f=We("c_data",r[0].dataType,r[0].dims.length,4),p,g=(_,h,w)=>`select(${h}, ${_}, ${w})`;if(!a)p=u.setByOffset("global_idx",g(d.getByOffset("global_idx"),c.getByOffset("global_idx"),f.getByOffset("global_idx")));else{let _=(h,w,M="")=>{let x=`a_data[index_a${w}][component_a${w}]`,F=`b_data[index_b${w}][component_b${w}]`,E=`bool(c_data[index_c${w}] & (0xffu << (component_c${w} * 8)))`;return`
            let output_indices${w} = ${u.offsetToIndices(`global_idx * 4u + ${w}u`)};
            let offset_a${w} = ${d.broadcastedIndicesToOffset(`output_indices${w}`,u)};
            let offset_b${w} = ${c.broadcastedIndicesToOffset(`output_indices${w}`,u)};
            let offset_c${w} = ${f.broadcastedIndicesToOffset(`output_indices${w}`,u)};
            let index_a${w} = offset_a${w} / 4u;
            let index_b${w} = offset_b${w} / 4u;
            let index_c${w} = offset_c${w} / 4u;
            let component_a${w} = offset_a${w} % 4u;
            let component_b${w} = offset_b${w} % 4u;
            let component_c${w} = offset_c${w} % 4u;
            ${h}[${w}] = ${M}(${g(x,F,E)});
          `};o===9?p=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:p=`
            ${_("output_data[global_idx]",0)}
            ${_("output_data[global_idx]",1)}
            ${_("output_data[global_idx]",2)}
            ${_("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(f,d,c,u)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${p}
      }`},Ny=t=>{let r=t[1].dims,n=t[2].dims,a=t[0].dims,o=t[1].dataType,u=!(Fe.areEqual(r,n)&&Fe.areEqual(n,a)),d=r,c=Fe.size(r);if(u){let p=Ld.calcShape(Ld.calcShape(r,n,!1),a,!1);if(!p)throw new Error("Can't perform where op on the given tensors");d=p,c=Fe.size(d)}let f=Math.ceil(c/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:p=>By(p,t,d,u,o),getRunData:()=>({outputs:[{dims:d,dataType:o}],dispatchGroup:{x:Math.ceil(c/64/4)},programUniforms:[{type:12,data:f},...Lt(a,r,n,d)]})}},Mw=t=>{t.compute(Ny(t.inputs))}}),vw,X3=at(()=>{c3(),S1(),d3(),f3(),p3(),h3(),m3(),M3(),w3(),x3(),T3(),E3(),C3(),S3(),P3(),A3(),O3(),$3(),D3(),k3(),L3(),I3(),z3(),F3(),R3(),Nv(),B3(),N3(),j3(),U3(),V3(),C1(),G3(),Wv(),W3(),H3(),q3(),Vv(),K3(),vl(),P1(),Q3(),vw=new Map([["Abs",[hM]],["Acos",[mM]],["Acosh",[_M]],["Add",[XM]],["ArgMax",[cM,e1]],["ArgMin",[uM,e1]],["Asin",[gM]],["Asinh",[yM]],["Atan",[bM]],["Atanh",[MM]],["Attention",[dM]],["AveragePool",[ew,Jv]],["BatchNormalization",[fM]],["BiasAdd",[pM]],["BiasSplitGelu",[QM]],["Cast",[wM,vM]],["Ceil",[TM]],["Clip",[xM]],["Concat",[iv,ov]],["Conv",[i1,a1]],["ConvTranspose",[gv,_v]],["Cos",[EM]],["Cosh",[CM]],["CumSum",[yv,bv]],["DepthToSpace",[Mv,vv]],["DequantizeLinear",[ow,lw]],["Div",[YM]],["Einsum",[wv,xv]],["Elu",[SM,Wp]],["Equal",[ZM]],["Erf",[PM]],["Exp",[AM]],["Expand",[Tv]],["FastGelu",[Ev]],["Floor",[OM]],["FusedConv",[i1,a1]],["Gather",[Sv,Cv]],["GatherElements",[kv,Dv]],["GatherBlockQuantized",[Ov,$v]],["GatherND",[Pv,Av]],["Gelu",[$M]],["Gemm",[Iv,Lv]],["GlobalAveragePool",[nw,tw]],["GlobalMaxPool",[iw,aw]],["Greater",[nv]],["GreaterOrEqual",[rv]],["GridSample",[zv,Fv]],["GroupQueryAttention",[Hv]],["HardSigmoid",[BM,RM]],["InstanceNormalization",[qv]],["LayerNormalization",[Kv]],["LeakyRelu",[DM,Wp]],["Less",[sv]],["LessOrEqual",[av]],["Log",[qM]],["MatMul",[Qv]],["MatMulNBits",[Xv,Yv]],["MaxPool",[sw,rw]],["Mul",[JM]],["MultiHeadAttention",[Bv,Rv]],["Neg",[LM]],["Not",[kM]],["Pad",[Zv]],["Pow",[ev]],["QuickGelu",[KM,Wp]],["Range",[uw]],["Reciprocal",[IM]],["ReduceMin",[rM]],["ReduceMean",[Jb]],["ReduceMax",[sM]],["ReduceSum",[iM]],["ReduceProd",[aM]],["ReduceL1",[eM]],["ReduceL2",[tM]],["ReduceLogSum",[lM]],["ReduceLogSumExp",[nM]],["ReduceSumSquare",[oM]],["Relu",[zM]],["Resize",[fw,pw]],["RotaryEmbedding",[Gv]],["ScatterND",[dw,cw]],["Sigmoid",[FM]],["Sin",[NM]],["Sinh",[jM]],["Slice",[mw,_w]],["SkipLayerNormalization",[hw]],["Split",[jv,Uv]],["Sqrt",[UM]],["Softmax",[gw,yw]],["Sub",[tv]],["Tan",[VM]],["Tanh",[GM]],["ThresholdedRelu",[HM,Wp]],["Tile",[bw]],["Transpose",[jb,Ub]],["Where",[Mw]]])}),ww,Y3=at(()=>{ai(),vo(),sn(),ww=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,r){this.repo.set(t,r)}run(t,r,n,a,o){ri(t.programInfo.name);let u=this.backend.device,d=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let c=[];for(let p of r)c.push({binding:c.length,resource:{buffer:p.buffer}});for(let p of n)c.push({binding:c.length,resource:{buffer:p.buffer}});o&&c.push({binding:c.length,resource:o});let f=u.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:c,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let p={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:f,dispatchGroup:a};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(p)}d.setPipeline(t.computePipeline),d.setBindGroup(0,f),d.dispatchWorkgroups(...a),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),wa(t.programInfo.name)}dispose(){}build(t,r){ri(t.name);let n=this.backend.device,a=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(p=>{n.features.has(p.feature)&&a.push(`enable ${p.extension};`)});let o=Nb(r,this.backend.device.limits),u=t.getShaderSource(o),d=`${a.join(`
`)}
${o.additionalImplementations}
${u}`,c=n.createShaderModule({code:d,label:t.name});hn("verbose",()=>`[WebGPU] ${t.name} shader code: ${d}`);let f=n.createComputePipeline({compute:{module:c,entryPoint:"main"},layout:"auto",label:t.name});return wa(t.name),{programInfo:t,computePipeline:f,uniformVariablesInfo:o.variablesInfo}}normalizeDispatchGroupSize(t){let r=typeof t=="number"?t:t.x,n=typeof t=="number"?1:t.y||1,a=typeof t=="number"?1:t.z||1,o=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(r<=o&&n<=o&&a<=o)return[r,n,a];let u=r*n*a,d=Math.ceil(Math.sqrt(u));if(d>o){if(d=Math.ceil(Math.cbrt(u)),d>o)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[d,d,d]}else return[d,d,1]}}}),xw={};zd(xw,{WebGpuBackend:()=>Tw});var jy,Uy,Vy,Tw,Z3=at(()=>{ai(),Nt(),vo(),Ib(),l3(),X3(),Y3(),jy=(t,r)=>{if(r.length!==t.length)throw new Error(`inputDependencies length ${r.length} is not equal to inputTensors length ${t.length}.`);let n=[];for(let a=0;a<t.length;++a){let o=t[a].dataType;switch(r[a]){case"none":{n.push("");break}case"type":{n.push(`${o}`);break}case"rank":{let u=t[a].dims.length;n.push(`${o};${u}`);break}case"dims":{let u=t[a].dims.join(",");n.push(`${o};${u}`);break}default:throw new Error(`unsupported input dependency: ${r[a]}`)}}return n.join("|")},Uy=(t,r,n)=>{let a=t.name;return t.shaderCache?.hint&&(a+="["+t.shaderCache.hint+"]"),a+=":"+n+`:${jy(r,t.shaderCache?.inputDependencies??new Array(r.length).fill("dims"))}`,a},Vy=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},Tw=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,r){this.env=t;let n=[],a={requiredLimits:{maxComputeWorkgroupStorageSize:r.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.limits.maxStorageBufferBindingSize,maxBufferSize:r.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:r.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:r.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:r.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:r.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},o=u=>r.features.has(u)&&n.push(u)&&!0;o("chromium-experimental-timestamp-query-inside-passes")||o("timestamp-query"),o("shader-f16"),o("subgroups"),this.device=await r.requestDevice(a),this.adapterInfo=new Vy(r.info||await r.requestAdapterInfo()),this.gpuDataManager=Rb(this),this.programManager=new ww(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,w1(t.logLevel,!!t.debug),this.device.onuncapturederror=u=>{u.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${u.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:r,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),r={};this.queryType==="at-passes"&&(r.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(r)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;ri(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{let r=new BigUint64Array(t.getMappedRange()),n=this.pendingQueries.get(t);for(let a=0;a<r.length/2;a++){let o=n[a],u=o.kernelId,d=this.kernels.get(u),c=d.kernelType,f=d.kernelName,p=o.programName,g=o.inputTensorViews,_=o.outputTensorViews,h=r[a*2],w=r[a*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=h);let M=Number(h-this.queryTimeBase),x=Number(w-this.queryTimeBase);if(!Number.isSafeInteger(M)||!Number.isSafeInteger(x))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:g.map(F=>({dims:F.dims,dataType:Mo(F.dataType)})),outputsMetadata:_.map(F=>({dims:F.dims,dataType:Mo(F.dataType)})),kernelId:u,kernelType:c,kernelName:f,programName:p,startTime:M,endTime:x});else{let F="";g.forEach((T,L)=>{F+=`input[${L}]: [${T.dims}] | ${Mo(T.dataType)}, `});let E="";_.forEach((T,L)=>{E+=`output[${L}]: [${T.dims}] | ${Mo(T.dataType)}, `}),console.log(`[profiling] kernel "${u}|${c}|${f}|${p}" ${F}${E}execution time: ${x-M} ns`)}Qp("GPU",`${p}::${h}::${w}`)}t.unmap(),this.pendingQueries.delete(t)}),wa()}run(t,r,n,a,o,u){ri(t.name);let d=[];for(let T=0;T<r.length;++T){let L=r[T].data;if(L===0)continue;let O=this.gpuDataManager.get(L);if(!O)throw new Error(`no GPU data for input: ${L}`);d.push(O)}let{outputs:c,dispatchGroup:f,programUniforms:p}=t.getRunData(r),g=n.length===0?c.map((T,L)=>L):n;if(g.length!==c.length)throw new Error(`Output size ${g.length} must be equal to ${c.length}.`);let _=[],h=[];for(let T=0;T<c.length;++T){if(!Number.isInteger(g[T])||g[T]<-3||g[T]>=u)throw new Error(`Invalid output index: ${g[T]}`);if(g[T]===-3)continue;let L=g[T]===-1,O=g[T]===-2,S=L||O?o(c[T].dataType,c[T].dims):a(g[T],c[T].dataType,c[T].dims);if(_.push(S),S.data===0)continue;let $=this.gpuDataManager.get(S.data);if(!$)throw new Error(`no GPU data for output: ${S.data}`);if(L&&this.temporaryData.push($),O){let C=this.kernelPersistentData.get(this.currentKernelId);C||(C=[],this.kernelPersistentData.set(this.currentKernelId,C)),C.push($)}h.push($)}if(d.length!==r.length||h.length!==_.length){if(h.length===0)return wa(t.name),_;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let w;if(p){let T=0,L=[];p.forEach(C=>{let k=typeof C.data=="number"?[C.data]:C.data;if(k.length===0)return;let U=C.type===10?2:4,V,re;C.type===10?(re=k.length>4?16:k.length>2?8:k.length*U,V=k.length>4?16:U*k.length):(re=k.length<=2?k.length*U:16,V=16),T=Math.ceil(T/re)*re,L.push(T);let ne=C.type===10?8:4;T+=k.length>4?Math.ceil(k.length/ne)*V:k.length*U});let O=16;T=Math.ceil(T/O)*O;let S=new ArrayBuffer(T);p.forEach((C,k)=>{let U=L[k],V=typeof C.data=="number"?[C.data]:C.data;if(C.type===6)new Int32Array(S,U,V.length).set(V);else if(C.type===12)new Uint32Array(S,U,V.length).set(V);else if(C.type===10)new Uint16Array(S,U,V.length).set(V);else if(C.type===1)new Float32Array(S,U,V.length).set(V);else throw new Error(`Unsupported uniform type: ${Mo(C.type)}`)});let $=this.gpuDataManager.create(T,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer($.buffer,0,S,0,T),this.gpuDataManager.release($.id),w={offset:0,size:T,buffer:$.buffer}}let M=this.programManager.normalizeDispatchGroupSize(f),x=M[1]===1&&M[2]===1,F=Uy(t,r,x),E=this.programManager.getArtifact(F);if(E||(E=this.programManager.build(t,M),this.programManager.setArtifact(F,E),hn("info",()=>`[artifact] key: ${F}, programName: ${t.name}`)),p&&E.uniformVariablesInfo){if(p.length!==E.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${E.uniformVariablesInfo.length}, got ${p.length} in program "${E.programInfo.name}".`);for(let T=0;T<p.length;T++){let L=p[T],O=L.type,S=typeof L.data=="number"?1:L.data.length,[$,C]=E.uniformVariablesInfo[T];if(O!==$||S!==C)throw new Error(`Uniform variable ${T} mismatch: expect type ${$} with size ${C}, got type ${O} with size ${S} in program "${E.programInfo.name}".`)}}if(hn("info",()=>`[ProgramManager] run "${t.name}" (key=${F}) with ${M[0]}x${M[1]}x${M[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let T={kernelId:this.currentKernelId,programName:E.programInfo.name,inputTensorViews:r,outputTensorViews:_};this.pendingKernels.push(T),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(T)}return this.programManager.run(E,d,h,M,w),wa(t.name),_}upload(t,r){this.gpuDataManager.upload(t,r)}memcpy(t,r){this.gpuDataManager.memcpy(t,r)}async download(t,r){await this.gpuDataManager.download(t,r)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,r,n,a){let o=vw.get(t);if(!o)throw new Error(`kernel not implemented: ${t}`);let u={kernelType:t,kernelName:a,kernelEntry:o[0],attributes:[o[1],n]};this.kernels.set(r,u)}releaseKernel(t){let r=this.kernelPersistentData.get(t);if(r){for(let n of r)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,r,n){let a=this.kernels.get(t);if(!a)throw new Error(`kernel not created: ${t}`);let o=a.kernelType,u=a.kernelName,d=a.kernelEntry,c=a.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${o}] ${u}" is not allowed to be called recursively`);this.currentKernelId=t,c[0]&&(c[1]=c[0](c[1]),c[0]=void 0),hn("info",()=>`[WebGPU] Start to run kernel "[${o}] ${u}"...`);let f=this.env.debug;this.temporaryData=[];try{return f&&this.device.pushErrorScope("validation"),d(r,c[1]),0}catch(p){return n.push(Promise.resolve(`[WebGPU] Kernel "[${o}] ${u}" failed. ${p}`)),1}finally{f&&n.push(this.device.popErrorScope().then(p=>p?`GPU validation error for kernel "[${o}] ${u}": ${p.message}`:null));for(let p of this.temporaryData)this.gpuDataManager.release(p.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,r,n,a){let o=this.sessionExternalDataMapping.get(t);o||(o=new Map,this.sessionExternalDataMapping.set(t,o));let u=o.get(r),d=this.gpuDataManager.registerExternalBuffer(n,a,u);return o.set(r,[d,n]),d}unregisterBuffers(t){let r=this.sessionExternalDataMapping.get(t);r&&(r.forEach(n=>this.gpuDataManager.unregisterExternalBuffer(n[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let r=this.gpuDataManager.get(t);if(!r)throw new Error(`no GPU data for buffer: ${t}`);return r.buffer}createDownloader(t,r,n){return async()=>{let a=await Y_(this,t,r);return x1(a.buffer,n)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){hn("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){hn("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){hn("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),r=this.capturedPendingKernels.get(this.currentSessionId),n=t.length;this.pendingKernels=[];for(let a=0;a<n;a++){let o=this.getComputePassEncoder(),u=t[a];this.writeTimestamp(this.pendingDispatchNumber*2),o.setPipeline(u.computePipeline),o.setBindGroup(0,u.bindGroup),o.dispatchWorkgroups(...u.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(r[a]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),Ew={};zd(Ew,{init:()=>Cw});var rm,Gy,Cw,J3=at(()=>{Nt(),vo(),tn(),o3(),rm=class Sw{constructor(r,n,a,o){this.module=r,this.dataType=n,this.data=a,this.dims=o}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let r=Fe.size(this.dims);return r===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,r)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let r=Fe.size(this.dims);return r===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,r)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let r=Fe.size(this.dims);return r===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,r)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let r=Fe.size(this.dims);return r===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,r)}reshape(r){if(Fe.size(r)!==Fe.size(this.dims))throw new Error("Invalid new shape");return new Sw(this.module,this.dataType,this.data,r)}},Gy=class{constructor(t,r,n){this.module=t,this.backend=r,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=r.adapterInfo;let a=t.PTR_SIZE,o=n/t.PTR_SIZE,u=a===4?"i32":"i64";this.opKernelContext=Number(t.getValue(a*o++,u));let d=Number(t.getValue(a*o++,u));this.outputCount=Number(t.getValue(a*o++,u)),this.customDataOffset=Number(t.getValue(a*o++,"*")),this.customDataSize=Number(t.getValue(a*o++,u));let c=[];for(let f=0;f<d;f++){let p=Number(t.getValue(a*o++,u)),g=Number(t.getValue(a*o++,"*")),_=Number(t.getValue(a*o++,u)),h=[];for(let w=0;w<_;w++)h.push(Number(t.getValue(a*o++,u)));c.push(new rm(t,p,g,h))}this.inputs=c}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,r){let n=r?.inputs?.map(d=>typeof d=="number"?this.inputs[d]:d)??this.inputs,a=r?.outputs??[],o=(d,c,f)=>new rm(this.module,c,this.output(d,f),f),u=(d,c)=>{let f=Qu(d,c);if(!f)throw new Error(`Unsupported data type: ${d}`);let p=f>0?this.backend.gpuDataManager.create(f).id:0;return new rm(this.module,d,p,c)};return this.backend.run(t,n,a,o,u,this.outputCount)}output(t,r){let n=this.module.stackSave();try{let a=this.module.PTR_SIZE,o=a===4?"i32":"i64",u=this.module.stackAlloc((1+r.length)*a);this.module.setValue(u,r.length,o);for(let d=0;d<r.length;d++)this.module.setValue(u+a*(d+1),r[d],o);return this.module._JsepOutput(this.opKernelContext,t,u)}catch(a){throw new Error(`Failed to generate kernel's output[${t}] with dims [${r}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${a}`)}finally{this.module.stackRestore(n)}}},Cw=async(t,r,n,a)=>{let o=r.jsepInit;if(!o)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let u=(Z3(),Kp(xw)).WebGpuBackend,d=new u;await d.initialize(n,a),o("webgpu",[d,c=>d.alloc(Number(c)),c=>d.free(c),(c,f,p,g=!1)=>{if(g)hn("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(c)}, dst=${Number(f)}, size=${Number(p)}`),d.memcpy(Number(c),Number(f));else{hn("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(c)}, gpuDataId=${Number(f)}, size=${Number(p)}`);let _=r.HEAPU8.subarray(Number(c>>>0),Number(c>>>0)+Number(p));d.upload(Number(f),_)}},async(c,f,p)=>{hn("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${c}, dataOffset=${f}, size=${p}`),await d.download(Number(c),()=>r.HEAPU8.subarray(Number(f)>>>0,Number(f+p)>>>0))},(c,f,p)=>d.createKernel(c,Number(f),p,r.UTF8ToString(r._JsepGetNodeName(Number(f)))),c=>d.releaseKernel(c),(c,f,p,g)=>{hn("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${p}, kernel=${c}, contextDataOffset=${f}`);let _=new Gy(r,d,Number(f));return d.computeKernel(Number(c),_,g)},()=>d.captureBegin(),()=>d.captureEnd(),()=>d.replay()])}else{let u=new Fb(n);o("webnn",[u,()=>u.reserveTensorId(),d=>u.releaseTensorId(d),async(d,c,f,p,g)=>u.ensureTensor(d,c,f,p,g),(d,c)=>{u.uploadTensor(d,c)},async(d,c)=>u.downloadTensor(d,c)])}}}),Wy,L1,I1,yl,Hy,N_,ym,z1,F1,j_,R1,B1,N1,Pw=at(()=>{r3(),a3(),Nt(),ec(),g1(),$b(),Wy=(t,r)=>{Xn()._OrtInit(t,r)!==0&&Fn("Can't initialize onnxruntime.")},L1=async t=>{Wy(t.wasm.numThreads,pm(t.logLevel))},I1=async(t,r)=>{Xn().asyncInit?.();{let n=(J3(),Kp(Ew)).init;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let a=t.webgpu.adapter;if(a){if(typeof a.limits!="object"||typeof a.features!="object"||typeof a.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let o=t.webgpu.powerPreference;if(o!==void 0&&o!=="low-power"&&o!=="high-performance")throw new Error(`Invalid powerPreference setting: "${o}"`);let u=t.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(a=await navigator.gpu.requestAdapter({powerPreference:o,forceFallbackAdapter:u}),!a)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await n("webgpu",Xn(),t,a)}if(r==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await n("webnn",Xn(),t)}}},yl=new Map,Hy=t=>{let r=Xn(),n=r.stackSave();try{let a=r.PTR_SIZE,o=r.stackAlloc(2*a);r._OrtGetInputOutputCount(t,o,o+a)!==0&&Fn("Can't get session input/output count.");let u=a===4?"i32":"i64";return[Number(r.getValue(o,u)),Number(r.getValue(o+a,u))]}finally{r.stackRestore(n)}},N_=(t,r)=>{let n=Xn(),a=n.stackSave(),o=0;try{let u=n.PTR_SIZE,d=n.stackAlloc(2*u);n._OrtGetInputOutputMetadata(t,r,d,d+u)!==0&&Fn("Can't get session input/output metadata.");let c=Number(n.getValue(d,"*"));o=Number(n.getValue(d+u,"*"));let f=n.HEAP32[o/4];if(f===0)return[c,0];let p=n.HEAPU32[o/4+1],g=[];for(let _=0;_<p;_++){let h=Number(n.getValue(o+8+_*u,"*"));g.push(h!==0?n.UTF8ToString(h):Number(n.getValue(o+8+(_+p)*u,"*")))}return[c,f,g]}finally{n.stackRestore(a),o!==0&&n._OrtFree(o)}},ym=t=>{let r=Xn(),n=r._malloc(t.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return r.HEAPU8.set(t,n),[n,t.byteLength]},z1=async(t,r)=>{let n,a,o=Xn();Array.isArray(t)?[n,a]=t:t.buffer===o.HEAPU8.buffer?[n,a]=[t.byteOffset,t.byteLength]:[n,a]=ym(t);let u=0,d=0,c=0,f=[],p=[],g=[];try{if([d,f]=await Ob(r),r?.externalData&&o.mountExternalData){let O=[];for(let S of r.externalData){let $=typeof S=="string"?S:S.path;O.push(v1(typeof S=="string"?S:S.data).then(C=>{o.mountExternalData($,C)}))}await Promise.all(O)}for(let O of r?.executionProviders??[])if((typeof O=="string"?O:O.name)==="webnn"){if(o.shouldTransferToMLTensor=!1,typeof O!="string"){let S=O,$=S?.context,C=S?.gpuDevice,k=S?.deviceType,U=S?.powerPreference;$?o.currentContext=$:C?o.currentContext=await o.webnnCreateMLContext(C):o.currentContext=await o.webnnCreateMLContext({deviceType:k,powerPreference:U})}else o.currentContext=await o.webnnCreateMLContext();break}u=await o._OrtCreateSession(n,a,d),o.webgpuOnCreateSession?.(u),u===0&&Fn("Can't create a session."),o.jsepOnCreateSession?.(),o.currentContext&&(o.webnnRegisterMLContext(u,o.currentContext),o.currentContext=void 0,o.shouldTransferToMLTensor=!0);let[_,h]=Hy(u),w=!!r?.enableGraphCapture,M=[],x=[],F=[],E=[],T=[];for(let O=0;O<_;O++){let[S,$,C]=N_(u,O);S===0&&Fn("Can't get an input name."),p.push(S);let k=o.UTF8ToString(S);M.push(k),F.push($===0?{name:k,isTensor:!1}:{name:k,isTensor:!0,type:Mo($),shape:C})}for(let O=0;O<h;O++){let[S,$,C]=N_(u,O+_);S===0&&Fn("Can't get an output name."),g.push(S);let k=o.UTF8ToString(S);x.push(k),E.push($===0?{name:k,isTensor:!1}:{name:k,isTensor:!0,type:Mo($),shape:C});{if(w&&r?.preferredOutputLocation===void 0){T.push("gpu-buffer");continue}let U=typeof r?.preferredOutputLocation=="string"?r.preferredOutputLocation:r?.preferredOutputLocation?.[k]??"cpu";if(U!=="cpu"&&U!=="cpu-pinned"&&U!=="gpu-buffer"&&U!=="ml-tensor")throw new Error(`Not supported preferred output location: ${U}.`);if(w&&U!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${U}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);T.push(U)}}let L=null;return T.some(O=>O==="gpu-buffer"||O==="ml-tensor")&&(c=o._OrtCreateBinding(u),c===0&&Fn("Can't create IO binding."),L={handle:c,outputPreferredLocations:T,outputPreferredLocationsEncoded:T.map(O=>Q_(O))}),yl.set(u,[u,p,g,L,w,!1]),[u,M,x,F,E]}catch(_){throw p.forEach(h=>o._OrtFree(h)),g.forEach(h=>o._OrtFree(h)),c!==0&&o._OrtReleaseBinding(c)!==0&&Fn("Can't release IO binding."),u!==0&&o._OrtReleaseSession(u)!==0&&Fn("Can't release session."),_}finally{o._free(n),d!==0&&o._OrtReleaseSessionOptions(d)!==0&&Fn("Can't release session options."),f.forEach(_=>o._free(_)),o.unmountExternalData?.()}},F1=t=>{let r=Xn(),n=yl.get(t);if(!n)throw new Error(`cannot release session. invalid session id: ${t}`);let[a,o,u,d,c]=n;d&&(c&&r._OrtClearBoundOutputs(d.handle)!==0&&Fn("Can't clear bound outputs."),r._OrtReleaseBinding(d.handle)!==0&&Fn("Can't release IO binding.")),r.jsepOnReleaseSession?.(t),r.webnnOnReleaseSession?.(t),r.webgpuOnReleaseSession?.(t),o.forEach(f=>r._OrtFree(f)),u.forEach(f=>r._OrtFree(f)),r._OrtReleaseSession(a)!==0&&Fn("Can't release session."),yl.delete(t)},j_=async(t,r,n,a,o,u,d=!1)=>{if(!t){r.push(0);return}let c=Xn(),f=c.PTR_SIZE,p=t[0],g=t[1],_=t[3],h=_,w,M;if(p==="string"&&(_==="gpu-buffer"||_==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(d&&_!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${u} when enableGraphCapture is true.`);if(_==="gpu-buffer"){let E=t[2].gpuBuffer;M=Qu(Od(p),g);{let T=c.jsepRegisterBuffer;if(!T)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');w=T(a,u,E,M)}}else if(_==="ml-tensor"){let E=t[2].mlTensor;M=Qu(Od(p),g);let T=c.webnnRegisterMLTensor;if(!T)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');w=T(a,E,Od(p),g)}else{let E=t[2];if(Array.isArray(E)){M=f*E.length,w=c._malloc(M),n.push(w);for(let T=0;T<E.length;T++){if(typeof E[T]!="string")throw new TypeError(`tensor data at index ${T} is not a string`);c.setValue(w+T*f,ei(E[T],n),"*")}}else{let T=c.webnnIsGraphInput;if(p!=="string"&&T){let L=c.UTF8ToString(o);if(T(a,L)){let O=Od(p);M=Qu(O,g),h="ml-tensor";let S=c.webnnCreateTemporaryTensor,$=c.webnnUploadTensor;if(!S||!$)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let C=await S(a,O,g);$(C,new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),w=C}else M=E.byteLength,w=c._malloc(M),n.push(w),c.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,M),w)}else M=E.byteLength,w=c._malloc(M),n.push(w),c.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,M),w)}}let x=c.stackSave(),F=c.stackAlloc(4*g.length);try{g.forEach((T,L)=>c.setValue(F+L*f,T,f===4?"i32":"i64"));let E=c._OrtCreateTensor(Od(p),w,M,F,g.length,Q_(h));E===0&&Fn(`Can't create tensor for input/output. session=${a}, index=${u}.`),r.push(E)}finally{c.stackRestore(x)}},R1=async(t,r,n,a,o,u)=>{let d=Xn(),c=d.PTR_SIZE,f=yl.get(t);if(!f)throw new Error(`cannot run inference. invalid session id: ${t}`);let p=f[0],g=f[1],_=f[2],h=f[3],w=f[4],M=f[5],x=r.length,F=a.length,E=0,T=[],L=[],O=[],S=[],$=d.stackSave(),C=d.stackAlloc(x*c),k=d.stackAlloc(x*c),U=d.stackAlloc(F*c),V=d.stackAlloc(F*c);try{[E,T]=Ab(u);for(let W=0;W<x;W++)await j_(n[W],L,S,t,g[r[W]],r[W],w);for(let W=0;W<F;W++)await j_(o[W],O,S,t,_[a[W]],x+a[W],w);for(let W=0;W<x;W++)d.setValue(C+W*c,L[W],"*"),d.setValue(k+W*c,g[r[W]],"*");for(let W=0;W<F;W++)d.setValue(U+W*c,O[W],"*"),d.setValue(V+W*c,_[a[W]],"*");if(h&&!M){let{handle:W,outputPreferredLocations:ce,outputPreferredLocationsEncoded:ae}=h;if(g.length!==x)throw new Error(`input count from feeds (${x}) is expected to be always equal to model's input count (${g.length}).`);for(let H=0;H<x;H++){let se=r[H];await d._OrtBindInput(W,g[se],L[H])!==0&&Fn(`Can't bind input[${H}] for session=${t}.`)}for(let H=0;H<F;H++){let se=a[H];o[H]?.[3]?d._OrtBindOutput(W,_[se],O[H],0)!==0&&Fn(`Can't bind pre-allocated output[${H}] for session=${t}.`):d._OrtBindOutput(W,_[se],0,ae[se])!==0&&Fn(`Can't bind output[${H}] to ${ce[H]} for session=${t}.`)}yl.set(t,[p,g,_,h,w,!0])}d.jsepOnRunStart?.(p),d.webnnOnRunStart?.(p);let re;h?re=await d._OrtRunWithBinding(p,h.handle,F,U,E):re=await d._OrtRun(p,k,C,x,V,F,U,E),re!==0&&Fn("failed to call OrtRun().");let ne=[];for(let W=0;W<F;W++){let ce=Number(d.getValue(U+W*c,"*"));if(ce===O[W]){ne.push(o[W]);continue}let ae=d.stackSave(),H=d.stackAlloc(4*c),se=!1,ie,ge=0;try{d._OrtGetTensorData(ce,H,H+c,H+2*c,H+3*c)!==0&&Fn(`Can't access output tensor data on index ${W}.`);let q=c===4?"i32":"i64",j=Number(d.getValue(H,q));ge=d.getValue(H+c,"*");let R=d.getValue(H+c*2,"*"),X=Number(d.getValue(H+c*3,q)),G=[];for(let Ie=0;Ie<X;Ie++)G.push(Number(d.getValue(R+Ie*c,q)));d._OrtFree(R)!==0&&Fn("Can't free memory for tensor dims.");let pe=G.reduce((Ie,Ne)=>Ie*Ne,1);ie=Mo(j);let Te=h?.outputPreferredLocations[a[W]];if(ie==="string"){if(Te==="gpu-buffer"||Te==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Ie=[];for(let Ne=0;Ne<pe;Ne++){let dt=d.getValue(ge+Ne*c,"*"),je=d.getValue(ge+(Ne+1)*c,"*"),oe=Ne===pe-1?void 0:je-dt;Ie.push(d.UTF8ToString(dt,oe))}ne.push([ie,G,Ie,"cpu"])}else if(Te==="gpu-buffer"&&pe>0){let Ie=d.jsepGetBuffer;if(!Ie)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Ne=Ie(ge),dt=Qu(j,pe);if(dt===void 0||!b1(ie))throw new Error(`Unsupported data type: ${ie}`);se=!0,ne.push([ie,G,{gpuBuffer:Ne,download:d.jsepCreateDownloader(Ne,dt,ie),dispose:()=>{d._OrtReleaseTensor(ce)!==0&&Fn("Can't release tensor.")}},"gpu-buffer"])}else if(Te==="ml-tensor"&&pe>0){let Ie=d.webnnEnsureTensor,Ne=d.webnnIsInt64Supported;if(!Ie||!Ne)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Qu(j,pe)===void 0||!M1(ie))throw new Error(`Unsupported data type: ${ie}`);if(ie==="int64"&&!Ne(t))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let dt=await Ie(t,ge,j,G,!1);se=!0,ne.push([ie,G,{mlTensor:dt,download:d.webnnCreateMLTensorDownloader(ge,ie),dispose:()=>{d.webnnReleaseTensorId(ge),d._OrtReleaseTensor(ce)}},"ml-tensor"])}else{let Ie=y1(ie),Ne=new Ie(pe);new Uint8Array(Ne.buffer,Ne.byteOffset,Ne.byteLength).set(d.HEAPU8.subarray(ge,ge+Ne.byteLength)),ne.push([ie,G,Ne,"cpu"])}}finally{d.stackRestore(ae),ie==="string"&&ge&&d._free(ge),se||d._OrtReleaseTensor(ce),d.webnnOnRunEnd?.(p)}}return h&&!w&&(d._OrtClearBoundOutputs(h.handle)!==0&&Fn("Can't clear bound outputs."),yl.set(t,[p,g,_,h,w,!1])),ne}finally{d.stackRestore($),L.forEach(re=>d._OrtReleaseTensor(re)),O.forEach(re=>d._OrtReleaseTensor(re)),S.forEach(re=>d._free(re)),E!==0&&d._OrtReleaseRunOptions(E),T.forEach(re=>d._free(re))}},B1=t=>{let r=Xn(),n=yl.get(t);if(!n)throw new Error("invalid session id");let a=n[0],o=r._OrtEndProfiling(a);o===0&&Fn("Can't get an profile file name."),r._OrtFree(o)},N1=t=>{let r=[];for(let n of t){let a=n[2];!Array.isArray(a)&&"buffer"in a&&r.push(a.buffer)}return r}}),bl,ba,Pd,jp,Up,am,U_,im,Wu,Hu,qy,Aw,Ow,$w,Dw,kw,Lw,Iw,zw=at(()=>{ai(),Pw(),ec(),m1(),bl=()=>!!ts.wasm.proxy&&typeof document<"u",Pd=!1,jp=!1,Up=!1,im=new Map,Wu=(t,r)=>{let n=im.get(t);n?n.push(r):im.set(t,[r])},Hu=()=>{if(Pd||!jp||Up||!ba)throw new Error("worker not ready")},qy=t=>{switch(t.data.type){case"init-wasm":Pd=!1,t.data.err?(Up=!0,U_[1](t.data.err)):(jp=!0,U_[0]()),am&&(URL.revokeObjectURL(am),am=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=im.get(t.data.type);t.data.err?r.shift()[1](t.data.err):r.shift()[0](t.data.out);break}}},Aw=async()=>{if(!jp){if(Pd)throw new Error("multiple calls to 'initWasm()' detected.");if(Up)throw new Error("previous call to 'initWasm()' failed.");if(Pd=!0,bl())return new Promise((t,r)=>{ba?.terminate(),Sb().then(([n,a])=>{try{ba=a,ba.onerror=u=>r(u),ba.onmessage=qy,U_=[t,r];let o={type:"init-wasm",in:ts};!o.in.wasm.wasmPaths&&(n||K_)&&(o.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href}),ba.postMessage(o),am=n}catch(o){r(o)}},r)});try{await _1(ts.wasm),await L1(ts),jp=!0}catch(t){throw Up=!0,t}finally{Pd=!1}}},Ow=async t=>{if(bl())return Hu(),new Promise((r,n)=>{Wu("init-ep",[r,n]);let a={type:"init-ep",in:{epName:t,env:ts}};ba.postMessage(a)});await I1(ts,t)},$w=async t=>bl()?(Hu(),new Promise((r,n)=>{Wu("copy-from",[r,n]);let a={type:"copy-from",in:{buffer:t}};ba.postMessage(a,[t.buffer])})):ym(t),Dw=async(t,r)=>{if(bl()){if(r?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Hu(),new Promise((n,a)=>{Wu("create",[n,a]);let o={type:"create",in:{model:t,options:{...r}}},u=[];t instanceof Uint8Array&&u.push(t.buffer),ba.postMessage(o,u)})}else return z1(t,r)},kw=async t=>{if(bl())return Hu(),new Promise((r,n)=>{Wu("release",[r,n]);let a={type:"release",in:t};ba.postMessage(a)});F1(t)},Lw=async(t,r,n,a,o,u)=>{if(bl()){if(n.some(d=>d[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(o.some(d=>d))throw new Error("pre-allocated output tensor is not supported for proxy.");return Hu(),new Promise((d,c)=>{Wu("run",[d,c]);let f=n,p={type:"run",in:{sessionId:t,inputIndices:r,inputs:f,outputIndices:a,options:u}};ba.postMessage(p,N1(f))})}else return R1(t,r,n,a,o,u)},Iw=async t=>{if(bl())return Hu(),new Promise((r,n)=>{Wu("end-profiling",[r,n]);let a={type:"end-profiling",in:t};ba.postMessage(a)});B1(t)}}),V_,Ky,Fw,eT=at(()=>{ai(),zw(),Nt(),h1(),$b(),V_=(t,r)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${r()}`)}},Ky=t=>{switch(t[3]){case"cpu":return new ti(t[0],t[2],t[1]);case"gpu-buffer":{let r=t[0];if(!b1(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:n,download:a,dispose:o}=t[2];return ti.fromGpuBuffer(n,{dataType:r,dims:t[1],download:a,dispose:o})}case"ml-tensor":{let r=t[0];if(!M1(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:n,download:a,dispose:o}=t[2];return ti.fromMLTensor(n,{dataType:r,dims:t[1],download:a,dispose:o})}default:throw new Error(`invalid data location: ${t[3]}`)}},Fw=class{async fetchModelAndCopyToWasmMemory(t){return $w(await v1(t))}async loadModel(t,r){ri();let n;typeof t=="string"?n=await this.fetchModelAndCopyToWasmMemory(t):n=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Dw(n,r),wa()}async dispose(){return kw(this.sessionId)}async run(t,r,n){ri();let a=[],o=[];Object.entries(t).forEach(_=>{let h=_[0],w=_[1],M=this.inputNames.indexOf(h);if(M===-1)throw new Error(`invalid input '${h}'`);a.push(w),o.push(M)});let u=[],d=[];Object.entries(r).forEach(_=>{let h=_[0],w=_[1],M=this.outputNames.indexOf(h);if(M===-1)throw new Error(`invalid output '${h}'`);u.push(w),d.push(M)});let c=a.map((_,h)=>V_(_,()=>`input "${this.inputNames[o[h]]}"`)),f=u.map((_,h)=>_?V_(_,()=>`output "${this.outputNames[d[h]]}"`):null),p=await Lw(this.sessionId,o,c,d,f,n),g={};for(let _=0;_<p.length;_++)g[this.outputNames[d[_]]]=u[_]??Ky(p[_]);return wa(),g}startProfiling(){}endProfiling(){Iw(this.sessionId)}}}),Rw={};zd(Rw,{OnnxruntimeWebAssemblyBackend:()=>u1,initializeFlags:()=>l1,wasmBackend:()=>Bw});var l1,u1,Bw,tT=at(()=>{ai(),zw(),eT(),l1=()=>{(typeof ts.wasm.initTimeout!="number"||ts.wasm.initTimeout<0)&&(ts.wasm.initTimeout=0);let t=ts.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),ts.wasm.simd=!1),typeof ts.wasm.proxy!="boolean"&&(ts.wasm.proxy=!1),typeof ts.wasm.trace!="boolean"&&(ts.wasm.trace=!1),typeof ts.wasm.numThreads!="number"||!Number.isInteger(ts.wasm.numThreads)||ts.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)ts.wasm.numThreads=1;else{let r=typeof navigator>"u"?jx("node:os").cpus().length:navigator.hardwareConcurrency;ts.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},u1=class{async init(t){l1(),await Aw(),await Ow(t)}async createInferenceSessionHandler(t,r){let n=new Fw;return await n.loadModel(t,r),n}},Bw=new u1});ai();ai();ai();var nT="1.22.0-dev.20250409-89f8206ba4",sT=vb;{let t=(tT(),Kp(Rw)).wasmBackend;Xu("webgpu",t,5),Xu("webnn",t,5),Xu("cpu",t,10),Xu("wasm",t,10)}Object.defineProperty(ts.versions,"web",{value:nT,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rT=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return p1},get TRACE(){return Qp},get TRACE_FUNC_BEGIN(){return ri},get TRACE_FUNC_END(){return wa},get Tensor(){return ti},default:sT,get env(){return ts},get registerBackend(){return Xu}},Symbol.toStringTag,{value:"Module"}));var G_={},aT={"onnxruntime-common":(t=>{t.exports=Fx}),"onnxruntime-web":(t=>{t.exports=rT}),"?2ce3":(()=>{}),"?7992":(()=>{}),"?5af5":(()=>{}),"?2b25":(()=>{}),"?db59":(()=>{}),"?383f":(()=>{}),"?fa4b":(()=>{}),"./node_modules/@huggingface/jinja/dist/index.js":((t,r,n)=>{n.r(r),n.d(r,{Environment:()=>ct,Interpreter:()=>bt,Template:()=>Fr,parse:()=>Te,tokenize:()=>g});var a=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),o=class{constructor(I,ue){this.value=I,this.type=ue}};function u(I){return/\w/.test(I)}function d(I){return/[0-9]/.test(I)}var c=[["{%",a.OpenStatement],["%}",a.CloseStatement],["{{",a.OpenExpression],["}}",a.CloseExpression],["(",a.OpenParen],[")",a.CloseParen],["{",a.OpenCurlyBracket],["}",a.CloseCurlyBracket],["[",a.OpenSquareBracket],["]",a.CloseSquareBracket],[",",a.Comma],[".",a.Dot],[":",a.Colon],["|",a.Pipe],["<=",a.ComparisonBinaryOperator],[">=",a.ComparisonBinaryOperator],["==",a.ComparisonBinaryOperator],["!=",a.ComparisonBinaryOperator],["<",a.ComparisonBinaryOperator],[">",a.ComparisonBinaryOperator],["+",a.AdditiveBinaryOperator],["-",a.AdditiveBinaryOperator],["~",a.AdditiveBinaryOperator],["*",a.MultiplicativeBinaryOperator],["/",a.MultiplicativeBinaryOperator],["%",a.MultiplicativeBinaryOperator],["=",a.Equals]],f=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function p(I,ue={}){return I.endsWith(`
`)&&(I=I.slice(0,-1)),ue.lstrip_blocks&&(I=I.replace(/^[ \t]*({[#%-])/gm,"$1")),ue.trim_blocks&&(I=I.replace(/([#%-]})\n/g,"$1")),I.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function g(I,ue={}){const Y=[],le=p(I,ue);let he=0,Se=0;const He=Mt=>{let Ct="";for(;Mt(le[he]);){if(le[he]==="\\"){if(++he,he>=le.length)throw new SyntaxError("Unexpected end of input");const ft=le[he++],Xt=f.get(ft);if(Xt===void 0)throw new SyntaxError(`Unexpected escaped character: ${ft}`);Ct+=Xt;continue}if(Ct+=le[he++],he>=le.length)throw new SyntaxError("Unexpected end of input")}return Ct};e:for(;he<le.length;){const Mt=Y.at(-1)?.type;if(Mt===void 0||Mt===a.CloseStatement||Mt===a.CloseExpression||Mt===a.Comment){let ft="";for(;he<le.length&&!(le[he]==="{"&&(le[he+1]==="%"||le[he+1]==="{"||le[he+1]==="#"));)ft+=le[he++];if(ft.length>0){Y.push(new o(ft,a.Text));continue}}if(le[he]==="{"&&le[he+1]==="#"){he+=2;let ft="";for(;le[he]!=="#"||le[he+1]!=="}";){if(he+2>=le.length)throw new SyntaxError("Missing end of comment tag");ft+=le[he++]}Y.push(new o(ft,a.Comment)),he+=2;continue}He(ft=>/\s/.test(ft));const Ct=le[he];if(Ct==="-"||Ct==="+"){const ft=Y.at(-1)?.type;if(ft===a.Text||ft===void 0)throw new SyntaxError(`Unexpected character: ${Ct}`);switch(ft){case a.Identifier:case a.NumericLiteral:case a.StringLiteral:case a.CloseParen:case a.CloseSquareBracket:break;default:{++he;const Xt=He(d);Y.push(new o(`${Ct}${Xt}`,Xt.length>0?a.NumericLiteral:a.UnaryOperator));continue}}}for(const[ft,Xt]of c){if(ft==="}}"&&Se>0)continue;if(le.slice(he,he+ft.length)===ft){Y.push(new o(ft,Xt)),Xt===a.OpenExpression?Se=0:Xt===a.OpenCurlyBracket?++Se:Xt===a.CloseCurlyBracket&&--Se,he+=ft.length;continue e}}if(Ct==="'"||Ct==='"'){++he;const ft=He(Xt=>Xt!==Ct);Y.push(new o(ft,a.StringLiteral)),++he;continue}if(d(Ct)){let ft=He(d);if(le[he]==="."&&d(le[he+1])){++he;const Xt=He(d);ft=`${ft}.${Xt}`}Y.push(new o(ft,a.NumericLiteral));continue}if(u(Ct)){const ft=He(u);Y.push(new o(ft,a.Identifier));continue}throw new SyntaxError(`Unexpected character: ${Ct}`)}return Y}var _=class{type="Statement"},h=class extends _{constructor(I){super(),this.body=I}type="Program"},w=class extends _{constructor(I,ue,Y){super(),this.test=I,this.body=ue,this.alternate=Y}type="If"},M=class extends _{constructor(I,ue,Y,le){super(),this.loopvar=I,this.iterable=ue,this.body=Y,this.defaultBlock=le}type="For"},x=class extends _{type="Break"},F=class extends _{type="Continue"},E=class extends _{constructor(I,ue,Y){super(),this.assignee=I,this.value=ue,this.body=Y}type="Set"},T=class extends _{constructor(I,ue,Y){super(),this.name=I,this.args=ue,this.body=Y}type="Macro"},L=class extends _{constructor(I){super(),this.value=I}type="Comment"},O=class extends _{type="Expression"},S=class extends O{constructor(I,ue,Y){super(),this.object=I,this.property=ue,this.computed=Y}type="MemberExpression"},$=class extends O{constructor(I,ue){super(),this.callee=I,this.args=ue}type="CallExpression"},C=class extends O{constructor(I){super(),this.value=I}type="Identifier"},k=class extends O{constructor(I){super(),this.value=I}type="Literal"},U=class extends k{type="IntegerLiteral"},V=class extends k{type="FloatLiteral"},re=class extends k{type="StringLiteral"},ne=class extends k{type="ArrayLiteral"},W=class extends k{type="TupleLiteral"},ce=class extends k{type="ObjectLiteral"},ae=class extends O{constructor(I,ue,Y){super(),this.operator=I,this.left=ue,this.right=Y}type="BinaryExpression"},H=class extends O{constructor(I,ue){super(),this.operand=I,this.filter=ue}type="FilterExpression"},se=class extends _{constructor(I,ue){super(),this.filter=I,this.body=ue}type="FilterStatement"},ie=class extends O{constructor(I,ue){super(),this.lhs=I,this.test=ue}type="SelectExpression"},ge=class extends O{constructor(I,ue,Y){super(),this.operand=I,this.negate=ue,this.test=Y}type="TestExpression"},q=class extends O{constructor(I,ue){super(),this.operator=I,this.argument=ue}type="UnaryExpression"},j=class extends O{constructor(I=void 0,ue=void 0,Y=void 0){super(),this.start=I,this.stop=ue,this.step=Y}type="SliceExpression"},R=class extends O{constructor(I,ue){super(),this.key=I,this.value=ue}type="KeywordArgumentExpression"},X=class extends O{constructor(I){super(),this.argument=I}type="SpreadExpression"},G=class extends _{constructor(I,ue,Y){super(),this.call=I,this.callerArgs=ue,this.body=Y}type="CallStatement"},pe=class extends O{constructor(I,ue,Y){super(),this.condition=I,this.trueExpr=ue,this.falseExpr=Y}type="Ternary"};function Te(I){const ue=new h([]);let Y=0;function le(Ze,rt){const vt=I[Y++];if(!vt||vt.type!==Ze)throw new Error(`Parser Error: ${rt}. ${vt.type} !== ${Ze}.`);return vt}function he(Ze){if(!Ct(Ze))throw new SyntaxError(`Expected ${Ze}`);++Y}function Se(){switch(I[Y].type){case a.Comment:return new L(I[Y++].value);case a.Text:return ft();case a.OpenStatement:return Xt();case a.OpenExpression:return Kt();default:throw new SyntaxError(`Unexpected token type: ${I[Y].type}`)}}function He(...Ze){return Y+Ze.length<=I.length&&Ze.every((rt,vt)=>rt===I[Y+vt].type)}function Mt(...Ze){return I[Y]?.type===a.OpenStatement&&I[Y+1]?.type===a.Identifier&&Ze.includes(I[Y+1]?.value)}function Ct(...Ze){return Y+Ze.length<=I.length&&Ze.every((rt,vt)=>I[Y+vt].type==="Identifier"&&rt===I[Y+vt].value)}function ft(){return new re(le(a.Text,"Expected text token").value)}function Xt(){if(le(a.OpenStatement,"Expected opening statement token"),I[Y].type!==a.Identifier)throw new SyntaxError(`Unknown statement, got ${I[Y].type}`);const Ze=I[Y].value;let rt;switch(Ze){case"set":++Y,rt=qn();break;case"if":++Y,rt=dn(),le(a.OpenStatement,"Expected {% token"),he("endif"),le(a.CloseStatement,"Expected %} token");break;case"macro":++Y,rt=Nn(),le(a.OpenStatement,"Expected {% token"),he("endmacro"),le(a.CloseStatement,"Expected %} token");break;case"for":++Y,rt=Bn(),le(a.OpenStatement,"Expected {% token"),he("endfor"),le(a.CloseStatement,"Expected %} token");break;case"call":{++Y;let vt=null;He(a.OpenParen)&&(vt=ds());const Pn=Hs();if(Pn.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const ea=ds();le(a.CloseStatement,"Expected closing statement token");const Mr=[];for(;!Mt("endcall");)Mr.push(Se());le(a.OpenStatement,"Expected '{%'"),he("endcall"),le(a.CloseStatement,"Expected closing statement token");const Ca=new $(Pn,ea);rt=new G(Ca,vt,Mr);break}case"break":++Y,le(a.CloseStatement,"Expected closing statement token"),rt=new x;break;case"continue":++Y,le(a.CloseStatement,"Expected closing statement token"),rt=new F;break;case"filter":{++Y;let vt=Hs();vt instanceof C&&He(a.OpenParen)&&(vt=Un(vt)),le(a.CloseStatement,"Expected closing statement token");const Pn=[];for(;!Mt("endfilter");)Pn.push(Se());le(a.OpenStatement,"Expected '{%'"),he("endfilter"),le(a.CloseStatement,"Expected '%}'"),rt=new se(vt,Pn);break}default:throw new SyntaxError(`Unknown statement type: ${Ze}`)}return rt}function Kt(){le(a.OpenExpression,"Expected opening expression token");const Ze=cs();return le(a.CloseExpression,"Expected closing expression token"),Ze}function qn(){const Ze=Tn();let rt=null;const vt=[];if(He(a.Equals))++Y,rt=Tn();else{for(le(a.CloseStatement,"Expected %} token");!Mt("endset");)vt.push(Se());le(a.OpenStatement,"Expected {% token"),he("endset")}return le(a.CloseStatement,"Expected closing statement token"),new E(Ze,rt,vt)}function dn(){const Ze=cs();le(a.CloseStatement,"Expected closing statement token");const rt=[],vt=[];for(;!Mt("elif","else","endif");)rt.push(Se());if(Mt("elif")){++Y,++Y;const Pn=dn();vt.push(Pn)}else if(Mt("else"))for(++Y,++Y,le(a.CloseStatement,"Expected closing statement token");!Mt("endif");)vt.push(Se());return new w(Ze,rt,vt)}function Nn(){const Ze=Hs();if(Ze.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const rt=ds();le(a.CloseStatement,"Expected closing statement token");const vt=[];for(;!Mt("endmacro");)vt.push(Se());return new T(Ze,rt,vt)}function Tn(Ze=!1){const rt=Ze?Hs:cs,vt=[rt()],Pn=He(a.Comma);for(;Pn&&(++Y,vt.push(rt()),!!He(a.Comma)););return Pn?new W(vt):vt[0]}function Bn(){const Ze=Tn(!0);if(!(Ze instanceof C||Ze instanceof W))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Ze.type} instead`);if(!Ct("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++Y;const rt=cs();le(a.CloseStatement,"Expected closing statement token");const vt=[];for(;!Mt("endfor","else");)vt.push(Se());const Pn=[];if(Mt("else"))for(++Y,++Y,le(a.CloseStatement,"Expected closing statement token");!Mt("endfor");)Pn.push(Se());return new M(Ze,rt,vt,Pn)}function cs(){return js()}function js(){const Ze=jn();if(Ct("if")){++Y;const rt=jn();if(Ct("else")){++Y;const vt=js();return new pe(rt,Ze,vt)}else return new ie(Ze,rt)}return Ze}function jn(){let Ze=Rr();for(;Ct("or");){const rt=I[Y];++Y;const vt=Rr();Ze=new ae(rt,Ze,vt)}return Ze}function Rr(){let Ze=Pr();for(;Ct("and");){const rt=I[Y];++Y;const vt=Pr();Ze=new ae(rt,Ze,vt)}return Ze}function Pr(){let Ze;for(;Ct("not");){const rt=I[Y];++Y;const vt=Pr();Ze=new q(rt,vt)}return Ze??Gs()}function Gs(){let Ze=Jr();for(;;){let rt;if(Ct("not","in"))rt=new o("not in",a.Identifier),Y+=2;else if(Ct("in"))rt=I[Y++];else if(He(a.ComparisonBinaryOperator))rt=I[Y++];else break;const vt=Jr();Ze=new ae(rt,Ze,vt)}return Ze}function Jr(){let Ze=Ar();for(;He(a.AdditiveBinaryOperator);){const rt=I[Y];++Y;const vt=Ar();Ze=new ae(rt,Ze,vt)}return Ze}function lr(){const Ze=Ws(Hs());return He(a.OpenParen)?Un(Ze):Ze}function Un(Ze){let rt=new $(Ze,ds());return rt=Ws(rt),He(a.OpenParen)&&(rt=Un(rt)),rt}function ds(){le(a.OpenParen,"Expected opening parenthesis for arguments list");const Ze=ns();return le(a.CloseParen,"Expected closing parenthesis for arguments list"),Ze}function ns(){const Ze=[];for(;!He(a.CloseParen);){let rt;if(I[Y].type===a.MultiplicativeBinaryOperator&&I[Y].value==="*"){++Y;const vt=cs();rt=new X(vt)}else if(rt=cs(),He(a.Equals)){if(++Y,!(rt instanceof C))throw new SyntaxError("Expected identifier for keyword argument");const vt=cs();rt=new R(rt,vt)}Ze.push(rt),He(a.Comma)&&++Y}return Ze}function gs(){const Ze=[];let rt=!1;for(;!He(a.CloseSquareBracket);)He(a.Colon)?(Ze.push(void 0),++Y,rt=!0):(Ze.push(cs()),He(a.Colon)&&(++Y,rt=!0));if(Ze.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(rt){if(Ze.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new j(...Ze)}return Ze[0]}function Ws(Ze){for(;He(a.Dot)||He(a.OpenSquareBracket);){const rt=I[Y];++Y;let vt;const Pn=rt.type===a.OpenSquareBracket;if(Pn)vt=gs(),le(a.CloseSquareBracket,"Expected closing square bracket");else if(vt=Hs(),vt.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Ze=new S(Ze,vt,Pn)}return Ze}function Ar(){let Ze=ar();for(;He(a.MultiplicativeBinaryOperator);){const rt=I[Y++],vt=ar();Ze=new ae(rt,Ze,vt)}return Ze}function ar(){let Ze=Ea();for(;Ct("is");){++Y;const rt=Ct("not");rt&&++Y;const vt=Hs();if(!(vt instanceof C))throw new SyntaxError("Expected identifier for the test");Ze=new ge(Ze,rt,vt)}return Ze}function Ea(){let Ze=lr();for(;He(a.Pipe);){++Y;let rt=Hs();if(!(rt instanceof C))throw new SyntaxError("Expected identifier for the filter");He(a.OpenParen)&&(rt=Un(rt)),Ze=new H(Ze,rt)}return Ze}function Hs(){const Ze=I[Y++];switch(Ze.type){case a.NumericLiteral:{const rt=Ze.value;return rt.includes(".")?new V(Number(rt)):new U(Number(rt))}case a.StringLiteral:{let rt=Ze.value;for(;He(a.StringLiteral);)rt+=I[Y++].value;return new re(rt)}case a.Identifier:return new C(Ze.value);case a.OpenParen:{const rt=Tn();return le(a.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),rt}case a.OpenSquareBracket:{const rt=[];for(;!He(a.CloseSquareBracket);)rt.push(cs()),He(a.Comma)&&++Y;return++Y,new ne(rt)}case a.OpenCurlyBracket:{const rt=new Map;for(;!He(a.CloseCurlyBracket);){const vt=cs();le(a.Colon,"Expected colon between key and value in object literal");const Pn=cs();rt.set(vt,Pn),He(a.Comma)&&++Y}return++Y,new ce(rt)}default:throw new SyntaxError(`Unexpected token: ${Ze.type}`)}}for(;Y<I.length;)ue.body.push(Se());return ue}function Ie(I,ue,Y=1){ue===void 0&&(ue=I,I=0);const le=[];for(let he=I;he<ue;he+=Y)le.push(he);return le}function Ne(I,ue,Y,le=1){const he=Math.sign(le);he>=0?(ue=(ue??=0)<0?Math.max(I.length+ue,0):Math.min(ue,I.length),Y=(Y??=I.length)<0?Math.max(I.length+Y,0):Math.min(Y,I.length)):(ue=(ue??=I.length-1)<0?Math.max(I.length+ue,-1):Math.min(ue,I.length-1),Y=(Y??=-1)<-1?Math.max(I.length+Y,-1):Math.min(Y,I.length-1));const Se=[];for(let He=ue;he*He<he*Y;He+=le)Se.push(I[He]);return Se}function dt(I){return I.replace(/\b\w/g,ue=>ue.toUpperCase())}function je(I){return oe(new Date,I)}function oe(I,ue){const Y=new Intl.DateTimeFormat(void 0,{month:"long"}),le=new Intl.DateTimeFormat(void 0,{month:"short"}),he=Se=>Se<10?"0"+Se:Se.toString();return ue.replace(/%[YmdbBHM%]/g,Se=>{switch(Se){case"%Y":return I.getFullYear().toString();case"%m":return he(I.getMonth()+1);case"%d":return he(I.getDate());case"%b":return le.format(I);case"%B":return Y.format(I);case"%H":return he(I.getHours());case"%M":return he(I.getMinutes());case"%%":return"%";default:return Se}})}function ve(I){return I.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function te(I,ue,Y,le){if(le===0)return I;let he=le==null||le<0?1/0:le;const Se=ue.length===0?new RegExp("(?=)","gu"):new RegExp(ve(ue),"gu");return I.replaceAll(Se,He=>he>0?(--he,Y):He)}var De=class extends Error{},Xe=class extends Error{},Be=class{type="RuntimeValue";value;builtins=new Map;constructor(I=void 0){this.value=I}__bool__(){return new Ke(!!this.value)}toString(){return String(this.value)}},Ee=class extends Be{type="IntegerValue"},Ve=class extends Be{type="FloatValue";toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},ke=class extends Be{type="StringValue";builtins=new Map([["upper",new ut(()=>new ke(this.value.toUpperCase()))],["lower",new ut(()=>new ke(this.value.toLowerCase()))],["strip",new ut(()=>new ke(this.value.trim()))],["title",new ut(()=>new ke(dt(this.value)))],["capitalize",new ut(()=>new ke(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new Ee(this.value.length)],["rstrip",new ut(()=>new ke(this.value.trimEnd()))],["lstrip",new ut(()=>new ke(this.value.trimStart()))],["startswith",new ut(I=>{if(I.length===0)throw new Error("startswith() requires at least one argument");const ue=I[0];if(ue instanceof ke)return new Ke(this.value.startsWith(ue.value));if(ue instanceof Re){for(const Y of ue.value){if(!(Y instanceof ke))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(Y.value))return new Ke(!0)}return new Ke(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new ut(I=>{if(I.length===0)throw new Error("endswith() requires at least one argument");const ue=I[0];if(ue instanceof ke)return new Ke(this.value.endsWith(ue.value));if(ue instanceof Re){for(const Y of ue.value){if(!(Y instanceof ke))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(Y.value))return new Ke(!0)}return new Ke(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new ut(I=>{const ue=I[0]??new st;if(!(ue instanceof ke||ue instanceof st))throw new Error("sep argument must be a string or null");const Y=I[1]??new Ee(-1);if(!(Y instanceof Ee))throw new Error("maxsplit argument must be a number");let le=[];if(ue instanceof st){const he=this.value.trimStart();for(const{0:Se,index:He}of he.matchAll(/\S+/g)){if(Y.value!==-1&&le.length>=Y.value&&He!==void 0){le.push(Se+he.slice(He+Se.length));break}le.push(Se)}}else{if(ue.value==="")throw new Error("empty separator");le=this.value.split(ue.value),Y.value!==-1&&le.length>Y.value&&le.push(le.splice(Y.value).join(ue.value))}return new Re(le.map(he=>new ke(he)))})],["replace",new ut(I=>{if(I.length<2)throw new Error("replace() requires at least two arguments");const ue=I[0],Y=I[1];if(!(ue instanceof ke&&Y instanceof ke))throw new Error("replace() arguments must be strings");let le;if(I.length>2?I[2].type==="KeywordArgumentsValue"?le=I[2].value.get("count")??new st:le=I[2]:le=new st,!(le instanceof Ee||le instanceof st))throw new Error("replace() count argument must be a number or null");return new ke(te(this.value,ue.value,Y.value,le.value))})]])},Ke=class extends Be{type="BooleanValue"},et=class extends Be{type="ObjectValue";__bool__(){return new Ke(this.value.size>0)}builtins=new Map([["get",new ut(([I,ue])=>{if(!(I instanceof ke))throw new Error(`Object key must be a string: got ${I.type}`);return this.value.get(I.value)??ue??new st})],["items",new ut(()=>this.items())],["keys",new ut(()=>this.keys())],["values",new ut(()=>this.values())]]);items(){return new Re(Array.from(this.value.entries()).map(([I,ue])=>new Re([new ke(I),ue])))}keys(){return new Re(Array.from(this.value.keys()).map(I=>new ke(I)))}values(){return new Re(Array.from(this.value.values()))}},ht=class extends et{type="KeywordArgumentsValue"},Re=class extends Be{type="ArrayValue";builtins=new Map([["length",new Ee(this.value.length)]]);__bool__(){return new Ke(this.value.length>0)}},Tt=class extends Re{type="TupleValue"},ut=class extends Be{type="FunctionValue"},st=class extends Be{type="NullValue"},mt=class extends Be{type="UndefinedValue"},ct=class{constructor(I){this.parent=I}variables=new Map([["namespace",new ut(I=>{if(I.length===0)return new et(new Map);if(I.length!==1||!(I[0]instanceof et))throw new Error("`namespace` expects either zero arguments or a single object argument");return I[0]})]]);tests=new Map([["boolean",I=>I.type==="BooleanValue"],["callable",I=>I instanceof ut],["odd",I=>{if(!(I instanceof Ee))throw new Error(`cannot odd on ${I.type}`);return I.value%2!==0}],["even",I=>{if(!(I instanceof Ee))throw new Error(`cannot even on ${I.type}`);return I.value%2===0}],["false",I=>I.type==="BooleanValue"&&!I.value],["true",I=>I.type==="BooleanValue"&&I.value],["none",I=>I.type==="NullValue"],["string",I=>I.type==="StringValue"],["number",I=>I instanceof Ee||I instanceof Ve],["integer",I=>I instanceof Ee],["iterable",I=>I.type==="ArrayValue"||I.type==="StringValue"],["mapping",I=>I.type==="ObjectValue"],["lower",I=>{const ue=I.value;return I.type==="StringValue"&&ue===ue.toLowerCase()}],["upper",I=>{const ue=I.value;return I.type==="StringValue"&&ue===ue.toUpperCase()}],["none",I=>I.type==="NullValue"],["defined",I=>I.type!=="UndefinedValue"],["undefined",I=>I.type==="UndefinedValue"],["equalto",(I,ue)=>I.value===ue.value],["eq",(I,ue)=>I.value===ue.value]]);set(I,ue){return this.declareVariable(I,nn(ue))}declareVariable(I,ue){if(this.variables.has(I))throw new SyntaxError(`Variable already declared: ${I}`);return this.variables.set(I,ue),ue}setVariable(I,ue){return this.variables.set(I,ue),ue}resolve(I){if(this.variables.has(I))return this;if(this.parent)return this.parent.resolve(I);throw new Error(`Unknown variable: ${I}`)}lookupVariable(I){try{return this.resolve(I).variables.get(I)??new mt}catch{return new mt}}};function lt(I){I.set("false",!1),I.set("true",!0),I.set("none",null),I.set("raise_exception",ue=>{throw new Error(ue)}),I.set("range",Ie),I.set("strftime_now",je),I.set("True",!0),I.set("False",!1),I.set("None",null)}var bt=class{global;constructor(I){this.global=I??new ct}run(I){return this.evaluate(I,this.global)}evaluateBinaryExpression(I,ue){const Y=this.evaluate(I.left,ue);switch(I.operator.value){case"and":return Y.__bool__().value?this.evaluate(I.right,ue):Y;case"or":return Y.__bool__().value?Y:this.evaluate(I.right,ue)}const le=this.evaluate(I.right,ue);switch(I.operator.value){case"==":return new Ke(Y.value==le.value);case"!=":return new Ke(Y.value!=le.value)}if(Y instanceof mt||le instanceof mt){if(le instanceof mt&&["in","not in"].includes(I.operator.value))return new Ke(I.operator.value==="not in");throw new Error(`Cannot perform operation ${I.operator.value} on undefined values`)}else{if(Y instanceof st||le instanceof st)throw new Error("Cannot perform operation on null values");if(I.operator.value==="~")return new ke(Y.value.toString()+le.value.toString());if((Y instanceof Ee||Y instanceof Ve)&&(le instanceof Ee||le instanceof Ve)){const he=Y.value,Se=le.value;switch(I.operator.value){case"+":case"-":case"*":{const He=I.operator.value==="+"?he+Se:I.operator.value==="-"?he-Se:he*Se;return Y instanceof Ve||le instanceof Ve?new Ve(He):new Ee(He)}case"/":return new Ve(he/Se);case"%":{const He=he%Se;return Y instanceof Ve||le instanceof Ve?new Ve(He):new Ee(He)}case"<":return new Ke(he<Se);case">":return new Ke(he>Se);case">=":return new Ke(he>=Se);case"<=":return new Ke(he<=Se)}}else if(Y instanceof Re&&le instanceof Re)switch(I.operator.value){case"+":return new Re(Y.value.concat(le.value))}else if(le instanceof Re){const he=le.value.find(Se=>Se.value===Y.value)!==void 0;switch(I.operator.value){case"in":return new Ke(he);case"not in":return new Ke(!he)}}}if(Y instanceof ke||le instanceof ke)switch(I.operator.value){case"+":return new ke(Y.value.toString()+le.value.toString())}if(Y instanceof ke&&le instanceof ke)switch(I.operator.value){case"in":return new Ke(le.value.includes(Y.value));case"not in":return new Ke(!le.value.includes(Y.value))}if(Y instanceof ke&&le instanceof et)switch(I.operator.value){case"in":return new Ke(le.value.has(Y.value));case"not in":return new Ke(!le.value.has(Y.value))}throw new SyntaxError(`Unknown operator "${I.operator.value}" between ${Y.type} and ${le.type}`)}evaluateArguments(I,ue){const Y=[],le=new Map;for(const he of I)if(he.type==="SpreadExpression"){const Se=he,He=this.evaluate(Se.argument,ue);if(!(He instanceof Re))throw new Error(`Cannot unpack non-iterable type: ${He.type}`);for(const Mt of He.value)Y.push(Mt)}else if(he.type==="KeywordArgumentExpression"){const Se=he;le.set(Se.key.value,this.evaluate(Se.value,ue))}else{if(le.size>0)throw new Error("Positional arguments must come before keyword arguments");Y.push(this.evaluate(he,ue))}return[Y,le]}applyFilter(I,ue,Y){if(ue.type==="Identifier"){const le=ue;if(le.value==="tojson")return new ke(un(I));if(I instanceof Re)switch(le.value){case"list":return I;case"first":return I.value[0];case"last":return I.value[I.value.length-1];case"length":return new Ee(I.value.length);case"reverse":return new Re(I.value.reverse());case"sort":return new Re(I.value.sort((he,Se)=>{if(he.type!==Se.type)throw new Error(`Cannot compare different types: ${he.type} and ${Se.type}`);switch(he.type){case"IntegerValue":case"FloatValue":return he.value-Se.value;case"StringValue":return he.value.localeCompare(Se.value);default:throw new Error(`Cannot compare type: ${he.type}`)}}));case"join":return new ke(I.value.map(he=>he.value).join(""));case"string":return new ke(un(I));case"unique":{const he=new Set,Se=[];for(const He of I.value)he.has(He.value)||(he.add(He.value),Se.push(He));return new Re(Se)}default:throw new Error(`Unknown ArrayValue filter: ${le.value}`)}else if(I instanceof ke)switch(le.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const he=I.builtins.get(le.value);if(he instanceof ut)return he.value([],Y);if(he instanceof Ee)return he;throw new Error(`Unknown StringValue filter: ${le.value}`)}case"trim":return new ke(I.value.trim());case"indent":return new ke(I.value.split(`
`).map((he,Se)=>Se===0||he.length===0?he:"    "+he).join(`
`));case"join":case"string":return I;case"int":{const he=parseInt(I.value,10);return new Ee(isNaN(he)?0:he)}case"float":{const he=parseFloat(I.value);return new Ve(isNaN(he)?0:he)}default:throw new Error(`Unknown StringValue filter: ${le.value}`)}else if(I instanceof Ee||I instanceof Ve)switch(le.value){case"abs":return I instanceof Ee?new Ee(Math.abs(I.value)):new Ve(Math.abs(I.value));case"int":return new Ee(Math.floor(I.value));case"float":return new Ve(I.value);default:throw new Error(`Unknown NumericValue filter: ${le.value}`)}else if(I instanceof et)switch(le.value){case"items":return new Re(Array.from(I.value.entries()).map(([he,Se])=>new Re([new ke(he),Se])));case"length":return new Ee(I.value.size);default:throw new Error(`Unknown ObjectValue filter: ${le.value}`)}else if(I instanceof Ke)switch(le.value){case"bool":return new Ke(I.value);case"int":return new Ee(I.value?1:0);case"float":return new Ve(I.value?1:0);case"string":return new ke(I.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${le.value}`)}throw new Error(`Cannot apply filter "${le.value}" to type: ${I.type}`)}else if(ue.type==="CallExpression"){const le=ue;if(le.callee.type!=="Identifier")throw new Error(`Unknown filter: ${le.callee.type}`);const he=le.callee.value;if(he==="tojson"){const[,Se]=this.evaluateArguments(le.args,Y),He=Se.get("indent")??new st;if(!(He instanceof Ee||He instanceof st))throw new Error("If set, indent must be a number");return new ke(un(I,He.value))}else if(he==="join"){let Se;if(I instanceof ke)Se=Array.from(I.value);else if(I instanceof Re)Se=I.value.map(ft=>ft.value);else throw new Error(`Cannot apply filter "${he}" to type: ${I.type}`);const[He,Mt]=this.evaluateArguments(le.args,Y),Ct=He.at(0)??Mt.get("separator")??new ke("");if(!(Ct instanceof ke))throw new Error("separator must be a string");return new ke(Se.join(Ct.value))}else if(he==="int"||he==="float"){const[Se,He]=this.evaluateArguments(le.args,Y),Mt=Se.at(0)??He.get("default")??(he==="int"?new Ee(0):new Ve(0));if(I instanceof ke){const Ct=he==="int"?parseInt(I.value,10):parseFloat(I.value);return isNaN(Ct)?Mt:he==="int"?new Ee(Ct):new Ve(Ct)}else{if(I instanceof Ee||I instanceof Ve)return I;if(I instanceof Ke)return he==="int"?new Ee(I.value?1:0):new Ve(I.value?1:0);throw new Error(`Cannot apply filter "${he}" to type: ${I.type}`)}}else if(he==="default"){const[Se,He]=this.evaluateArguments(le.args,Y),Mt=Se[0]??new ke(""),Ct=Se[1]??He.get("boolean")??new Ke(!1);if(!(Ct instanceof Ke))throw new Error("`default` filter flag must be a boolean");return I instanceof mt||Ct.value&&!I.__bool__().value?Mt:I}if(I instanceof Re){switch(he){case"selectattr":case"rejectattr":{const Se=he==="selectattr";if(I.value.some(Kt=>!(Kt instanceof et)))throw new Error(`\`${he}\` can only be applied to array of objects`);if(le.args.some(Kt=>Kt.type!=="StringLiteral"))throw new Error(`arguments of \`${he}\` must be strings`);const[He,Mt,Ct]=le.args.map(Kt=>this.evaluate(Kt,Y));let ft;if(Mt){const Kt=Y.tests.get(Mt.value);if(!Kt)throw new Error(`Unknown test: ${Mt.value}`);ft=Kt}else ft=(...Kt)=>Kt[0].__bool__().value;const Xt=I.value.filter(Kt=>{const qn=Kt.value.get(He.value),dn=qn?ft(qn,Ct):!1;return Se?dn:!dn});return new Re(Xt)}case"map":{const[,Se]=this.evaluateArguments(le.args,Y);if(Se.has("attribute")){const He=Se.get("attribute");if(!(He instanceof ke))throw new Error("attribute must be a string");const Mt=Se.get("default"),Ct=I.value.map(ft=>{if(!(ft instanceof et))throw new Error("items in map must be an object");return ft.value.get(He.value)??Mt??new mt});return new Re(Ct)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${he}`)}else if(I instanceof ke){switch(he){case"indent":{const[Se,He]=this.evaluateArguments(le.args,Y),Mt=Se.at(0)??He.get("width")??new Ee(4);if(!(Mt instanceof Ee))throw new Error("width must be a number");const Ct=Se.at(1)??He.get("first")??new Ke(!1),ft=Se.at(2)??He.get("blank")??new Ke(!1),Xt=I.value.split(`
`),Kt=" ".repeat(Mt.value),qn=Xt.map((dn,Nn)=>!Ct.value&&Nn===0||!ft.value&&dn.length===0?dn:Kt+dn);return new ke(qn.join(`
`))}case"replace":{const Se=I.builtins.get("replace");if(!(Se instanceof ut))throw new Error("replace filter not available");const[He,Mt]=this.evaluateArguments(le.args,Y);return Se.value([...He,new ht(Mt)],Y)}}throw new Error(`Unknown StringValue filter: ${he}`)}else throw new Error(`Cannot apply filter "${he}" to type: ${I.type}`)}throw new Error(`Unknown filter: ${ue.type}`)}evaluateFilterExpression(I,ue){const Y=this.evaluate(I.operand,ue);return this.applyFilter(Y,I.filter,ue)}evaluateTestExpression(I,ue){const Y=this.evaluate(I.operand,ue),le=ue.tests.get(I.test.value);if(!le)throw new Error(`Unknown test: ${I.test.value}`);const he=le(Y);return new Ke(I.negate?!he:he)}evaluateSelectExpression(I,ue){return this.evaluate(I.test,ue).__bool__().value?this.evaluate(I.lhs,ue):new mt}evaluateUnaryExpression(I,ue){const Y=this.evaluate(I.argument,ue);switch(I.operator.value){case"not":return new Ke(!Y.value);default:throw new SyntaxError(`Unknown operator: ${I.operator.value}`)}}evaluateTernaryExpression(I,ue){return this.evaluate(I.condition,ue).__bool__().value?this.evaluate(I.trueExpr,ue):this.evaluate(I.falseExpr,ue)}evalProgram(I,ue){return this.evaluateBlock(I.body,ue)}evaluateBlock(I,ue){let Y="";for(const le of I){const he=this.evaluate(le,ue);he.type!=="NullValue"&&he.type!=="UndefinedValue"&&(Y+=he.toString())}return new ke(Y)}evaluateIdentifier(I,ue){return ue.lookupVariable(I.value)}evaluateCallExpression(I,ue){const[Y,le]=this.evaluateArguments(I.args,ue);le.size>0&&Y.push(new ht(le));const he=this.evaluate(I.callee,ue);if(he.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${he.type}`);return he.value(Y,ue)}evaluateSliceExpression(I,ue,Y){if(!(I instanceof Re||I instanceof ke))throw new Error("Slice object must be an array or string");const le=this.evaluate(ue.start,Y),he=this.evaluate(ue.stop,Y),Se=this.evaluate(ue.step,Y);if(!(le instanceof Ee||le instanceof mt))throw new Error("Slice start must be numeric or undefined");if(!(he instanceof Ee||he instanceof mt))throw new Error("Slice stop must be numeric or undefined");if(!(Se instanceof Ee||Se instanceof mt))throw new Error("Slice step must be numeric or undefined");return I instanceof Re?new Re(Ne(I.value,le.value,he.value,Se.value)):new ke(Ne(Array.from(I.value),le.value,he.value,Se.value).join(""))}evaluateMemberExpression(I,ue){const Y=this.evaluate(I.object,ue);let le;if(I.computed){if(I.property.type==="SliceExpression")return this.evaluateSliceExpression(Y,I.property,ue);le=this.evaluate(I.property,ue)}else le=new ke(I.property.value);let he;if(Y instanceof et){if(!(le instanceof ke))throw new Error(`Cannot access property with non-string: got ${le.type}`);he=Y.value.get(le.value)??Y.builtins.get(le.value)}else if(Y instanceof Re||Y instanceof ke)if(le instanceof Ee)he=Y.value.at(le.value),Y instanceof ke&&(he=new ke(Y.value.at(le.value)));else if(le instanceof ke)he=Y.builtins.get(le.value);else throw new Error(`Cannot access property with non-string/non-number: got ${le.type}`);else{if(!(le instanceof ke))throw new Error(`Cannot access property with non-string: got ${le.type}`);he=Y.builtins.get(le.value)}return he instanceof Be?he:new mt}evaluateSet(I,ue){const Y=I.value?this.evaluate(I.value,ue):this.evaluateBlock(I.body,ue);if(I.assignee.type==="Identifier"){const le=I.assignee.value;ue.setVariable(le,Y)}else if(I.assignee.type==="TupleLiteral"){const le=I.assignee;if(!(Y instanceof Re))throw new Error(`Cannot unpack non-iterable type in set: ${Y.type}`);const he=Y.value;if(he.length!==le.value.length)throw new Error(`Too ${le.value.length>he.length?"few":"many"} items to unpack in set`);for(let Se=0;Se<le.value.length;++Se){const He=le.value[Se];if(He.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${He.type}`);ue.setVariable(He.value,he[Se])}}else if(I.assignee.type==="MemberExpression"){const le=I.assignee,he=this.evaluate(le.object,ue);if(!(he instanceof et))throw new Error("Cannot assign to member of non-object");if(le.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");he.value.set(le.property.value,Y)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(I.assignee)}`);return new st}evaluateIf(I,ue){const Y=this.evaluate(I.test,ue);return this.evaluateBlock(Y.__bool__().value?I.body:I.alternate,ue)}evaluateFor(I,ue){const Y=new ct(ue);let le,he;if(I.iterable.type==="SelectExpression"){const ft=I.iterable;he=this.evaluate(ft.lhs,Y),le=ft.test}else he=this.evaluate(I.iterable,Y);if(!(he instanceof Re||he instanceof et))throw new Error(`Expected iterable or object type in for loop: got ${he.type}`);he instanceof et&&(he=he.keys());const Se=[],He=[];for(let ft=0;ft<he.value.length;++ft){const Xt=new ct(Y),Kt=he.value[ft];let qn;if(I.loopvar.type==="Identifier")qn=dn=>dn.setVariable(I.loopvar.value,Kt);else if(I.loopvar.type==="TupleLiteral"){const dn=I.loopvar;if(Kt.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${Kt.type}`);const Nn=Kt;if(dn.value.length!==Nn.value.length)throw new Error(`Too ${dn.value.length>Nn.value.length?"few":"many"} items to unpack`);qn=Tn=>{for(let Bn=0;Bn<dn.value.length;++Bn){if(dn.value[Bn].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${dn.value[Bn].type}`);Tn.setVariable(dn.value[Bn].value,Nn.value[Bn])}}}else throw new Error(`Invalid loop variable(s): ${I.loopvar.type}`);le&&(qn(Xt),!this.evaluate(le,Xt).__bool__().value)||(Se.push(Kt),He.push(qn))}let Mt="",Ct=!0;for(let ft=0;ft<Se.length;++ft){const Xt=new Map([["index",new Ee(ft+1)],["index0",new Ee(ft)],["revindex",new Ee(Se.length-ft)],["revindex0",new Ee(Se.length-ft-1)],["first",new Ke(ft===0)],["last",new Ke(ft===Se.length-1)],["length",new Ee(Se.length)],["previtem",ft>0?Se[ft-1]:new mt],["nextitem",ft<Se.length-1?Se[ft+1]:new mt]]);Y.setVariable("loop",new et(Xt)),He[ft](Y);try{const Kt=this.evaluateBlock(I.body,Y);Mt+=Kt.value}catch(Kt){if(Kt instanceof Xe)continue;if(Kt instanceof De)break;throw Kt}Ct=!1}if(Ct){const ft=this.evaluateBlock(I.defaultBlock,Y);Mt+=ft.value}return new ke(Mt)}evaluateMacro(I,ue){return ue.setVariable(I.name.value,new ut((Y,le)=>{const he=new ct(le);Y=Y.slice();let Se;Y.at(-1)?.type==="KeywordArgumentsValue"&&(Se=Y.pop());for(let He=0;He<I.args.length;++He){const Mt=I.args[He],Ct=Y[He];if(Mt.type==="Identifier"){const ft=Mt;if(!Ct)throw new Error(`Missing positional argument: ${ft.value}`);he.setVariable(ft.value,Ct)}else if(Mt.type==="KeywordArgumentExpression"){const ft=Mt,Xt=Ct??Se?.value.get(ft.key.value)??this.evaluate(ft.value,he);he.setVariable(ft.key.value,Xt)}else throw new Error(`Unknown argument type: ${Mt.type}`)}return this.evaluateBlock(I.body,he)})),new st}evaluateCallStatement(I,ue){const Y=new ut((Mt,Ct)=>{const ft=new ct(Ct);if(I.callerArgs)for(let Xt=0;Xt<I.callerArgs.length;++Xt){const Kt=I.callerArgs[Xt];if(Kt.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${Kt.type}`);ft.setVariable(Kt.value,Mt[Xt]??new mt)}return this.evaluateBlock(I.body,ft)}),[le,he]=this.evaluateArguments(I.call.args,ue);le.push(new ht(he));const Se=this.evaluate(I.call.callee,ue);if(Se.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${Se.type}`);const He=new ct(ue);return He.setVariable("caller",Y),Se.value(le,He)}evaluateFilterStatement(I,ue){const Y=this.evaluateBlock(I.body,ue);return this.applyFilter(Y,I.filter,ue)}evaluate(I,ue){if(!I)return new mt;switch(I.type){case"Program":return this.evalProgram(I,ue);case"Set":return this.evaluateSet(I,ue);case"If":return this.evaluateIf(I,ue);case"For":return this.evaluateFor(I,ue);case"Macro":return this.evaluateMacro(I,ue);case"CallStatement":return this.evaluateCallStatement(I,ue);case"Break":throw new De;case"Continue":throw new Xe;case"IntegerLiteral":return new Ee(I.value);case"FloatLiteral":return new Ve(I.value);case"StringLiteral":return new ke(I.value);case"ArrayLiteral":return new Re(I.value.map(Y=>this.evaluate(Y,ue)));case"TupleLiteral":return new Tt(I.value.map(Y=>this.evaluate(Y,ue)));case"ObjectLiteral":{const Y=new Map;for(const[le,he]of I.value){const Se=this.evaluate(le,ue);if(!(Se instanceof ke))throw new Error(`Object keys must be strings: got ${Se.type}`);Y.set(Se.value,this.evaluate(he,ue))}return new et(Y)}case"Identifier":return this.evaluateIdentifier(I,ue);case"CallExpression":return this.evaluateCallExpression(I,ue);case"MemberExpression":return this.evaluateMemberExpression(I,ue);case"UnaryExpression":return this.evaluateUnaryExpression(I,ue);case"BinaryExpression":return this.evaluateBinaryExpression(I,ue);case"FilterExpression":return this.evaluateFilterExpression(I,ue);case"FilterStatement":return this.evaluateFilterStatement(I,ue);case"TestExpression":return this.evaluateTestExpression(I,ue);case"SelectExpression":return this.evaluateSelectExpression(I,ue);case"Ternary":return this.evaluateTernaryExpression(I,ue);case"Comment":return new st;default:throw new SyntaxError(`Unknown node type: ${I.type}`)}}};function nn(I){switch(typeof I){case"number":return Number.isInteger(I)?new Ee(I):new Ve(I);case"string":return new ke(I);case"boolean":return new Ke(I);case"undefined":return new mt;case"object":return I===null?new st:Array.isArray(I)?new Re(I.map(nn)):new et(new Map(Object.entries(I).map(([ue,Y])=>[ue,nn(Y)])));case"function":return new ut((ue,Y)=>{const le=I(...ue.map(he=>he.value))??null;return nn(le)});default:throw new Error(`Cannot convert to runtime value: ${I}`)}}function un(I,ue,Y){const le=Y??0;switch(I.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(I.value);case"ArrayValue":case"ObjectValue":{const he=ue?" ".repeat(ue):"",Se=`
`+he.repeat(le),He=Se+he;if(I.type==="ArrayValue"){const Mt=I.value.map(Ct=>un(Ct,ue,le+1));return ue?`[${He}${Mt.join(`,${He}`)}${Se}]`:`[${Mt.join(", ")}]`}else{const Mt=Array.from(I.value.entries()).map(([Ct,ft])=>{const Xt=`"${Ct}": ${un(ft,ue,le+1)}`;return ue?`${He}${Xt}`:Xt});return ue?`{${Mt.join(",")}${Se}}`:`{${Mt.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${I.type}`)}}var It=`
`,os="{%- ",Ts=" -%}";function Os(I){switch(I.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return I.operator.value==="and"?1:I.operator.value==="in"||I.operator.value==="not in"?2:0}return 0}function Zs(I,ue="	"){const Y=typeof ue=="number"?" ".repeat(ue):ue;return $s(I.body,0,Y).replace(/\n$/,"")}function Rn(...I){return os+I.join(" ")+Ts}function $s(I,ue,Y){return I.map(le=>xa(le,ue,Y)).join(It)}function xa(I,ue,Y){const le=Y.repeat(ue);switch(I.type){case"Program":return $s(I.body,ue,Y);case"If":return Zr(I,ue,Y);case"For":return br(I,ue,Y);case"Set":return Ta(I,ue,Y);case"Macro":return Dt(I,ue,Y);case"Break":return le+Rn("break");case"Continue":return le+Rn("continue");case"CallStatement":return zr(I,ue,Y);case"FilterStatement":return xn(I,ue,Y);case"Comment":return le+"{# "+I.value+" #}";default:return le+"{{- "+qt(I)+" -}}"}}function Zr(I,ue,Y){const le=Y.repeat(ue),he=[];let Se=I;for(;Se&&(he.push({test:Se.test,body:Se.body}),Se.alternate.length===1&&Se.alternate[0].type==="If");)Se=Se.alternate[0];let He=le+Rn("if",qt(he[0].test))+It+$s(he[0].body,ue+1,Y);for(let Mt=1;Mt<he.length;++Mt)He+=It+le+Rn("elif",qt(he[Mt].test))+It+$s(he[Mt].body,ue+1,Y);return Se&&Se.alternate.length>0&&(He+=It+le+Rn("else")+It+$s(Se.alternate,ue+1,Y)),He+=It+le+Rn("endif"),He}function br(I,ue,Y){const le=Y.repeat(ue);let he="";if(I.iterable.type==="SelectExpression"){const He=I.iterable;he=`${qt(He.lhs)} if ${qt(He.test)}`}else he=qt(I.iterable);let Se=le+Rn("for",qt(I.loopvar),"in",he)+It+$s(I.body,ue+1,Y);return I.defaultBlock.length>0&&(Se+=It+le+Rn("else")+It+$s(I.defaultBlock,ue+1,Y)),Se+=It+le+Rn("endfor"),Se}function Ta(I,ue,Y){const le=Y.repeat(ue),he=qt(I.assignee),Se=I.value?qt(I.value):"",He=le+Rn("set",`${he}${I.value?" = "+Se:""}`);return I.body.length===0?He:He+It+$s(I.body,ue+1,Y)+It+le+Rn("endset")}function Dt(I,ue,Y){const le=Y.repeat(ue),he=I.args.map(qt).join(", ");return le+Rn("macro",`${I.name.value}(${he})`)+It+$s(I.body,ue+1,Y)+It+le+Rn("endmacro")}function zr(I,ue,Y){const le=Y.repeat(ue),he=I.callerArgs&&I.callerArgs.length>0?`(${I.callerArgs.map(qt).join(", ")})`:"",Se=qt(I.call);let He=le+Rn(`call${he}`,Se)+It;return He+=$s(I.body,ue+1,Y)+It,He+=le+Rn("endcall"),He}function xn(I,ue,Y){const le=Y.repeat(ue),he=I.filter.type==="Identifier"?I.filter.value:qt(I.filter);let Se=le+Rn("filter",he)+It;return Se+=$s(I.body,ue+1,Y)+It,Se+=le+Rn("endfilter"),Se}function qt(I,ue=-1){switch(I.type){case"SpreadExpression":return`*${qt(I.argument)}`;case"Identifier":return I.value;case"IntegerLiteral":return`${I.value}`;case"FloatLiteral":return`${I.value}`;case"StringLiteral":return JSON.stringify(I.value);case"BinaryExpression":{const Y=I,le=Os(Y),he=qt(Y.left,le),Se=qt(Y.right,le+1),He=`${he} ${Y.operator.value} ${Se}`;return le<ue?`(${He})`:He}case"UnaryExpression":{const Y=I;return Y.operator.value+(Y.operator.value==="not"?" ":"")+qt(Y.argument,1/0)}case"CallExpression":{const Y=I,le=Y.args.map(qt).join(", ");return`${qt(Y.callee)}(${le})`}case"MemberExpression":{const Y=I;let le=qt(Y.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(Y.object.type)||(le=`(${le})`);let he=qt(Y.property);return!Y.computed&&Y.property.type!=="Identifier"&&(he=`(${he})`),Y.computed?`${le}[${he}]`:`${le}.${he}`}case"FilterExpression":{const Y=I,le=qt(Y.operand,1/0);return Y.filter.type==="CallExpression"?`${le} | ${qt(Y.filter)}`:`${le} | ${Y.filter.value}`}case"SelectExpression":{const Y=I;return`${qt(Y.lhs)} if ${qt(Y.test)}`}case"TestExpression":{const Y=I;return`${qt(Y.operand)} is${Y.negate?" not":""} ${Y.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const Y=I.value.map(qt),le=I.type==="ArrayLiteral"?"[]":"()";return`${le[0]}${Y.join(", ")}${le[1]}`}case"ObjectLiteral":return`{${Array.from(I.value.entries()).map(([le,he])=>`${qt(le)}: ${qt(he)}`).join(", ")}}`;case"SliceExpression":{const Y=I,le=Y.start?qt(Y.start):"",he=Y.stop?qt(Y.stop):"",Se=Y.step?`:${qt(Y.step)}`:"";return`${le}:${he}${Se}`}case"KeywordArgumentExpression":{const Y=I;return`${Y.key.value}=${qt(Y.value)}`}case"Ternary":{const Y=I,le=`${qt(Y.trueExpr)} if ${qt(Y.condition,0)} else ${qt(Y.falseExpr)}`;return ue>-1?`(${le})`:le}default:throw new Error(`Unknown expression type: ${I.type}`)}}var Fr=class{parsed;constructor(I){const ue=g(I,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=Te(ue)}render(I){const ue=new ct;if(lt(ue),I)for(const[he,Se]of Object.entries(I))ue.set(he,Se);return new bt(ue).run(this.parsed).value}format(I){return Zs(this.parsed,I?.indent||"	")}}}),"./src/backends/onnx.js":((t,r,n)=>{var a;n.r(r),n.d(r,{Tensor:()=>c.Tensor,createInferenceSession:()=>F,deviceToExecutionProviders:()=>M,isONNXProxy:()=>L,isONNXTensor:()=>E});var o=n("./src/env.js"),u=n("?2ce3"),d=n("onnxruntime-web"),c=n("onnxruntime-common");const f=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),p=[];let g,_;const h=Symbol.for("onnxruntime");if(h in globalThis)_=globalThis[h];else if(o.apis.IS_NODE_ENV){switch(_=u??(a||(a=n.t(u,2))),process.platform){case"win32":p.push("dml");break;case"linux":process.arch==="x64"&&p.push("cuda");break}p.push("cpu"),g=["cpu"]}else _=d,o.apis.IS_WEBNN_AVAILABLE&&p.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),o.apis.IS_WEBGPU_AVAILABLE&&p.push("webgpu"),p.push("wasm"),g=["wasm"];const w=_.InferenceSession;function M(O=null){if(!O)return g;switch(O){case"auto":return p;case"gpu":return p.filter(S=>["webgpu","cuda","dml","webnn-gpu"].includes(S))}if(p.includes(O))return[f[O]??O];throw new Error(`Unsupported device: "${O}". Should be one of: ${p.join(", ")}.`)}let x=null;async function F(O,S,$){x&&await x;const C=w.create(O,S);x??=C;const k=await C;return k.config=$,k}function E(O){return O instanceof _.Tensor}const T=_?.env;T?.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!T.wasm.wasmPaths&&(T.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${o.env.version}/dist/`),T.wasm.proxy=!1),T?.webgpu&&(T.webgpu.powerPreference="high-performance");function L(){return T?.wasm?.proxy}o.env.backends.onnx=T}),"./src/base/feature_extraction_utils.js":((t,r,n)=>{n.r(r),n.d(r,{FeatureExtractor:()=>d,validate_audio_inputs:()=>c});var a=n("./src/utils/constants.js"),o=n("./src/utils/generic.js"),u=n("./src/utils/hub.js");class d extends o.Callable{constructor(p){super(),this.config=p}static async from_pretrained(p,g={}){const _=await(0,u.getModelJSON)(p,a.FEATURE_EXTRACTOR_NAME,!0,g);return new this(_)}}function c(f,p){if(!(f instanceof Float32Array||f instanceof Float64Array))throw new Error(`${p} expects input to be a Float32Array or a Float64Array, but got ${f?.constructor?.name??typeof f} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}}),"./src/base/image_processors_utils.js":((t,r,n)=>{n.r(r),n.d(r,{ImageProcessor:()=>O,center_to_corners_format:()=>_,post_process_instance_segmentation:()=>L,post_process_object_detection:()=>h,post_process_panoptic_segmentation:()=>T,post_process_semantic_segmentation:()=>w});var a=n("./src/utils/generic.js"),o=n("./src/utils/tensor.js"),u=n("./src/utils/maths.js");n("./src/utils/image.js");var d=n("./src/utils/core.js"),c=n("./src/utils/hub.js"),f=n("./src/utils/constants.js");function p(S,$,C=0,k=null){const U=S/$;let V=(0,u.bankers_round)(U)*$;return k!==null&&V>k&&(V=Math.floor(U)*$),V<C&&(V=Math.ceil(U)*$),V}function g([S,$],C){return[Math.max(Math.floor(S/C),1)*C,Math.max(Math.floor($/C),1)*C]}function _([S,$,C,k]){return[S-C/2,$-k/2,S+C/2,$+k/2]}function h(S,$=.5,C=null,k=!1){const U=S.logits,V=S.pred_boxes,[re,ne,W]=U.dims;if(C!==null&&C.length!==re)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ce=[];for(let ae=0;ae<re;++ae){let H=C!==null?C[ae]:null,se={boxes:[],classes:[],scores:[]},ie=U[ae],ge=V[ae];for(let q=0;q<ne;++q){let j=ie[q],R=[],X;if(k){X=j.sigmoid().data;for(let G=0;G<X.length;++G)X[G]>$&&R.push(G)}else{let G=(0,u.max)(j.data)[1];if(G===W-1||(X=(0,u.softmax)(j.data),X[G]<$))continue;R.push(G)}for(const G of R){let pe=ge[q].data;pe=_(pe),H!==null&&(pe=pe.map((Te,Ie)=>Te*H[(Ie+1)%2])),se.boxes.push(pe),se.classes.push(G),se.scores.push(X[G])}}ce.push(se)}return ce}function w(S,$=null){const C=S.logits,k=C.dims[0];if($!==null&&$.length!==k)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const U=[];for(let V=0;V<k;++V){const re=$!==null?$[V]:null;let ne=C[V];re!==null&&(ne=(0,o.interpolate)(ne,re,"bilinear",!1));const[W,ce]=re??ne.dims.slice(-2),ae=new o.Tensor("int32",new Int32Array(W*ce),[W,ce]),H=ne[0].data,se=ae.data;for(let q=1;q<ne.dims[0];++q){const j=ne[q].data;for(let R=0;R<j.length;++R)j[R]>H[R]&&(H[R]=j[R],se[R]=q)}const ie=new Array(ne.dims[0]);for(let q=0;q<se.length;++q){const j=se[q];ie[j]=j}const ge=ie.filter(q=>q!==void 0);U.push({segmentation:ae,labels:ge})}return U}function M(S,$,C,k){const U=[],V=[],re=[];for(let ne=0;ne<S.dims[0];++ne){const W=S[ne],ce=$[ne],ae=(0,u.max)(W.data)[1];if(ae===k)continue;const se=(0,u.softmax)(W.data)[ae];se>C&&(U.push(ce),V.push(se),re.push(ae))}return[U,V,re]}function x(S,$,C,k=.5,U=.8){const V=[];let re=0,ne=0;const W=$[C].data;for(let ae=0;ae<S.length;++ae)S[ae]===C&&(V.push(ae),++re),W[ae]>=k&&++ne;let ce=re>0&&ne>0;return ce&&(ce=re/ne>U),[ce,V]}function F(S,$,C,k,U,V=null,re=null){const[ne,W]=re??S[0].dims,ce=new o.Tensor("int32",new Int32Array(ne*W),[ne,W]),ae=[];if(re!==null)for(let q=0;q<S.length;++q)S[q]=(0,o.interpolate)(S[q],re,"bilinear",!1);const H=new Int32Array(S[0].data.length),se=new Float32Array(S[0].data.length);for(let q=0;q<S.length;++q){let j=$[q];const R=S[q].data;for(let X=0;X<R.length;++X)R[X]*=j,R[X]>se[X]&&(H[X]=q,se[X]=R[X])}let ie=0;const ge=ce.data;for(let q=0;q<C.length;++q){const j=C[q],[R,X]=x(H,S,q,k,U);if(R){++ie;for(const G of X)ge[G]=ie;ae.push({id:ie,label_id:j,score:$[q]})}}return[ce,ae]}function E(S,$,C=28,k=3136,U=784*1280){if(S<C||$<C)throw new Error(`height:${S} or width:${$} must be larger than factor:${C}`);if(Math.max(S,$)/Math.min(S,$)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(S,$)/Math.min(S,$)}`);let V=Math.round(S/C)*C,re=Math.round($/C)*C;if(V*re>U){const ne=Math.sqrt(S*$/U);V=Math.floor(S/ne/C)*C,re=Math.floor($/ne/C)*C}else if(V*re<k){const ne=Math.sqrt(k/(S*$));V=Math.ceil(S*ne/C)*C,re=Math.ceil($*ne/C)*C}return[V,re]}function T(S,$=.5,C=.5,k=.8,U=null,V=null){U===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),U=new Set);const re=S.class_queries_logits??S.logits,W=(S.masks_queries_logits??S.pred_masks).sigmoid();let[ce,ae,H]=re.dims;if(H-=1,V!==null&&V.length!==ce)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let se=[];for(let ie=0;ie<ce;++ie){let ge=V!==null?V[ie]:null,q=re[ie],j=W[ie],[R,X,G]=M(q,j,$,H);if(G.length===0){let[Ie,Ne]=ge??j.dims.slice(-2),dt=new o.Tensor("int32",new Int32Array(Ie*Ne).fill(-1),[Ie,Ne]);se.push({segmentation:dt,segments_info:[]});continue}let[pe,Te]=F(R,X,G,C,k,U,ge);se.push({segmentation:pe,segments_info:Te})}return se}function L(S,$=.5,C=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class O extends a.Callable{constructor($){super(),this.image_mean=$.image_mean??$.mean,this.image_std=$.image_std??$.std,this.resample=$.resample??2,this.do_rescale=$.do_rescale??!0,this.rescale_factor=$.rescale_factor??1/255,this.do_normalize=$.do_normalize,this.do_thumbnail=$.do_thumbnail,this.size=$.size??$.image_size,this.do_resize=$.do_resize??this.size!==void 0,this.size_divisibility=$.size_divisibility??$.size_divisor,this.do_center_crop=$.do_center_crop,this.crop_size=$.crop_size,this.do_convert_rgb=$.do_convert_rgb??!0,this.do_crop_margin=$.do_crop_margin,this.pad_size=$.pad_size,this.do_pad=$.do_pad,this.min_pixels=$.min_pixels,this.max_pixels=$.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=$.do_flip_channel_order??!1,this.config=$}async thumbnail($,C,k=2){const U=$.height,V=$.width,re=C.height,ne=C.width;let W=Math.min(U,re),ce=Math.min(V,ne);return W===U&&ce===V?$:(U>V?ce=Math.floor(V*W/U):V>U&&(W=Math.floor(U*ce/V)),await $.resize(ce,W,{resample:k}))}async crop_margin($,C=200){const k=$.clone().grayscale(),U=(0,u.min)(k.data)[0],re=(0,u.max)(k.data)[0]-U;if(re===0)return $;const ne=C/255;let W=k.width,ce=k.height,ae=0,H=0;const se=k.data;for(let ie=0;ie<k.height;++ie){const ge=ie*k.width;for(let q=0;q<k.width;++q)(se[ge+q]-U)/re<ne&&(W=Math.min(W,q),ce=Math.min(ce,ie),ae=Math.max(ae,q),H=Math.max(H,ie))}return $=await $.crop([W,ce,ae,H]),$}pad_image($,C,k,{mode:U="constant",center:V=!1,constant_values:re=0}={}){const[ne,W,ce]=C;let ae,H;if(typeof k=="number"?(ae=k,H=k):k==="square"?ae=H=Math.max(ne,W):(ae=k.width,H=k.height),ae!==W||H!==ne){const se=new Float32Array(ae*H*ce);if(Array.isArray(re))for(let q=0;q<se.length;++q)se[q]=re[q%ce];else re!==0&&se.fill(re);const[ie,ge]=V?[Math.floor((ae-W)/2),Math.floor((H-ne)/2)]:[0,0];for(let q=0;q<ne;++q){const j=(q+ge)*ae,R=q*W;for(let X=0;X<W;++X){const G=(j+X+ie)*ce,pe=(R+X)*ce;for(let Te=0;Te<ce;++Te)se[G+Te]=$[pe+Te]}}if(U==="symmetric"){if(V)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const q=ne-1,j=W-1;for(let R=0;R<H;++R){const X=R*ae,G=(0,d.calculateReflectOffset)(R,q)*W;for(let pe=0;pe<ae;++pe){if(R<ne&&pe<W)continue;const Te=(X+pe)*ce,Ie=(G+(0,d.calculateReflectOffset)(pe,j))*ce;for(let Ne=0;Ne<ce;++Ne)se[Te+Ne]=$[Ie+Ne]}}}$=se,C=[H,ae,ce]}return[$,C]}rescale($){for(let C=0;C<$.length;++C)$[C]=this.rescale_factor*$[C]}get_resize_output_image_size($,C){const[k,U]=$.size;let V,re;if(this.do_thumbnail){const{height:ne,width:W}=C;V=Math.min(ne,W)}else Number.isInteger(C)?(V=C,re=this.config.max_size??V):C!==void 0&&(V=C.shortest_edge,re=C.longest_edge);if(V!==void 0||re!==void 0){const ne=V===void 0?1:Math.max(V/k,V/U),W=k*ne,ce=U*ne,ae=re===void 0?1:Math.min(re/W,re/ce);let H=Math.floor(Number((W*ae).toFixed(2))),se=Math.floor(Number((ce*ae).toFixed(2)));return this.size_divisibility!==void 0&&([H,se]=g([H,se],this.size_divisibility)),[H,se]}else if(C!==void 0&&C.width!==void 0&&C.height!==void 0){let ne=C.width,W=C.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let ce=W/U,ae=ne/k;Math.abs(1-ae)<Math.abs(1-ce)?ce=ae:ae=ce,W=p(ce*U,this.config.ensure_multiple_of),ne=p(ae*k,this.config.ensure_multiple_of)}return[ne,W]}else{if(this.size_divisibility!==void 0)return g([k,U],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const ne=this.config.patch_size*this.config.merge_size;return E(U,k,ne,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(C)}`)}}async resize($){const[C,k]=this.get_resize_output_image_size($,this.size);return await $.resize(C,k,{resample:this.resample})}async preprocess($,{do_normalize:C=null,do_pad:k=null,do_convert_rgb:U=null,do_convert_grayscale:V=null,do_flip_channel_order:re=null}={}){this.do_crop_margin&&($=await this.crop_margin($));const[ne,W]=$.size;if(U??this.do_convert_rgb?$=$.rgb():V&&($=$.grayscale()),this.do_resize&&($=await this.resize($)),this.do_thumbnail&&($=await this.thumbnail($,this.size,this.resample)),this.do_center_crop){let ie,ge;Number.isInteger(this.crop_size)?(ie=this.crop_size,ge=this.crop_size):(ie=this.crop_size.width,ge=this.crop_size.height),$=await $.center_crop(ie,ge)}const ce=[$.height,$.width];let ae=Float32Array.from($.data),H=[$.height,$.width,$.channels];if(this.do_rescale&&this.rescale(ae),C??this.do_normalize){let ie=this.image_mean;Array.isArray(this.image_mean)||(ie=new Array($.channels).fill(ie));let ge=this.image_std;if(Array.isArray(this.image_std)||(ge=new Array($.channels).fill(ie)),ie.length!==$.channels||ge.length!==$.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${ie.length}) and \`image_std\` (${ge.length}) must match the number of channels in the image (${$.channels}).`);for(let q=0;q<ae.length;q+=$.channels)for(let j=0;j<$.channels;++j)ae[q+j]=(ae[q+j]-ie[j])/ge[j]}if(k??this.do_pad){if(this.pad_size)[ae,H]=this.pad_image(ae,[$.height,$.width,$.channels],this.pad_size);else if(this.size_divisibility){const[ie,ge]=g([H[1],H[0]],this.size_divisibility);[ae,H]=this.pad_image(ae,H,{width:ie,height:ge})}}if(re??this.do_flip_channel_order){if(H[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let ie=0;ie<ae.length;ie+=3){const ge=ae[ie];ae[ie]=ae[ie+2],ae[ie+2]=ge}}const se=new o.Tensor("float32",ae,H).permute(2,0,1);return{original_size:[W,ne],reshaped_input_size:ce,pixel_values:se}}async _call($,...C){Array.isArray($)||($=[$]);const k=await Promise.all($.map(V=>this.preprocess(V)));return{pixel_values:(0,o.stack)(k.map(V=>V.pixel_values),0),original_sizes:k.map(V=>V.original_size),reshaped_input_sizes:k.map(V=>V.reshaped_input_size)}}static async from_pretrained($,C={}){const k=await(0,c.getModelJSON)($,f.IMAGE_PROCESSOR_NAME,!0,C);return new this(k)}}}),"./src/base/processing_utils.js":((t,r,n)=>{n.r(r),n.d(r,{Processor:()=>d});var a=n("./src/utils/constants.js"),o=n("./src/utils/generic.js"),u=n("./src/utils/hub.js");class d extends o.Callable{static classes=["image_processor_class","tokenizer_class","feature_extractor_class"];static uses_processor_config=!1;static uses_chat_template_file=!1;constructor(f,p,g){super(),this.config=f,this.components=p,this.chat_template=g}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(f,p={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(f,{tokenize:!1,chat_template:this.chat_template??void 0,...p})}batch_decode(...f){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...f)}decode(...f){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...f)}async _call(f,...p){for(const g of[this.image_processor,this.feature_extractor,this.tokenizer])if(g)return g(f,...p);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(f,p={}){const[g,_,h]=await Promise.all([this.uses_processor_config?(0,u.getModelJSON)(f,a.PROCESSOR_NAME,!0,p):{},Promise.all(this.classes.filter(w=>w in this).map(async w=>{const M=await this[w].from_pretrained(f,p);return[w.replace(/_class$/,""),M]})).then(Object.fromEntries),this.uses_chat_template_file?(0,u.getModelText)(f,a.CHAT_TEMPLATE_NAME,!0,p):null]);return new this(g,_,h)}}}),"./src/configs.js":((t,r,n)=>{n.r(r),n.d(r,{AutoConfig:()=>g,PretrainedConfig:()=>p,getCacheShapes:()=>c});var a=n("./src/utils/core.js"),o=n("./src/utils/hub.js");async function u(_,h){return await(0,o.getModelJSON)(_,"config.json",!0,h)}function d(_){const h={};let w={};switch(_.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":w=d(_.text_config);break;case"moondream1":w=d(_.phi_config);break;case"musicgen":w=d(_.decoder);break;case"multi_modality":w=d(_.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":h.num_heads="n_head",h.num_layers="n_layer",h.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":h.num_heads="num_attention_heads",h.num_layers="num_hidden_layers",h.hidden_size="hidden_size";break;case"llama":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":h.num_heads="num_key_value_heads",h.num_layers="num_hidden_layers",h.hidden_size="hidden_size",h.num_attention_heads="num_attention_heads",h.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":h.num_heads="num_key_value_heads",h.num_layers="num_hidden_layers",h.dim_kv="head_dim";break;case"openelm":h.num_heads="num_kv_heads",h.num_layers="num_transformer_layers",h.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":h.num_heads="num_heads",h.num_layers="num_layers",h.hidden_size="hidden_size";break;case"bloom":h.num_heads="n_head",h.num_layers="n_layer",h.hidden_size="hidden_size";break;case"mpt":h.num_heads="n_heads",h.num_layers="n_layers",h.hidden_size="d_model";break;case"exaone":h.num_heads="num_key_value_heads",h.num_layers="num_layers",h.dim_kv="head_dim",h.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":h.num_decoder_layers="num_decoder_layers",h.num_decoder_heads="num_heads",h.decoder_dim_kv="d_kv",h.num_encoder_layers="num_layers",h.num_encoder_heads="num_heads",h.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":h.num_decoder_layers="decoder_layers",h.num_decoder_heads="decoder_attention_heads",h.decoder_hidden_size="d_model",h.num_encoder_layers="encoder_layers",h.num_encoder_heads="encoder_attention_heads",h.encoder_hidden_size="d_model";break;case"speecht5":h.num_decoder_layers="decoder_layers",h.num_decoder_heads="decoder_attention_heads",h.decoder_hidden_size="hidden_size",h.num_encoder_layers="encoder_layers",h.num_encoder_heads="encoder_attention_heads",h.encoder_hidden_size="hidden_size";break;case"trocr":h.num_encoder_layers=h.num_decoder_layers="decoder_layers",h.num_encoder_heads=h.num_decoder_heads="decoder_attention_heads",h.encoder_hidden_size=h.decoder_hidden_size="d_model";break;case"musicgen_decoder":h.num_encoder_layers=h.num_decoder_layers="num_hidden_layers",h.num_encoder_heads=h.num_decoder_heads="num_attention_heads",h.encoder_hidden_size=h.decoder_hidden_size="hidden_size";break;case"moonshine":h.num_decoder_layers="decoder_num_hidden_layers",h.num_decoder_heads="decoder_num_key_value_heads",h.num_encoder_layers="encoder_num_hidden_layers",h.num_encoder_heads="encoder_num_key_value_heads",h.encoder_hidden_size=h.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const x=d(_.decoder),F="num_decoder_layers"in x,E=(0,a.pick)(_,["model_type","is_encoder_decoder"]);return F?(E.num_decoder_layers=x.num_decoder_layers,E.num_decoder_heads=x.num_decoder_heads,E.decoder_hidden_size=x.decoder_hidden_size,E.num_encoder_layers=x.num_encoder_layers,E.num_encoder_heads=x.num_encoder_heads,E.encoder_hidden_size=x.encoder_hidden_size):(E.num_layers=x.num_layers,E.num_heads=x.num_heads,E.hidden_size=x.hidden_size),E}const M={...w,...(0,a.pick)(_,["model_type","multi_query","is_encoder_decoder"])};for(const x in h)M[x]=_[h[x]];return M}function c(_,h){if(_.model_type==="lfm2"){const w=h?.prefix??"past_key_values",M=w==="present"?"present":"past",x={},{layer_types:F,num_attention_heads:E,num_key_value_heads:T,hidden_size:L,conv_L_cache:O}=_,S=L/E,$=h?.batch_size??1;for(let C=0;C<F.length;++C)if(F[C]==="full_attention")for(const k of["key","value"])x[`${w}.${C}.${k}`]=[$,T,0,S];else if(F[C]==="conv")x[`${M}_conv.${C}`]=[$,L,O];else throw new Error(`Unsupported layer type: ${F[C]}`);return x}return f(_,h)}function f(_,{prefix:h="past_key_values",batch_size:w=1}={}){const M={},x=_.normalized_config;if(x.is_encoder_decoder&&"num_encoder_heads"in x&&"num_decoder_heads"in x){const F=x.encoder_dim_kv??x.encoder_hidden_size/x.num_encoder_heads,E=x.decoder_dim_kv??x.decoder_hidden_size/x.num_decoder_heads,T=[w,x.num_encoder_heads,0,F],L=[w,x.num_decoder_heads,0,E];for(let O=0;O<x.num_decoder_layers;++O)M[`${h}.${O}.encoder.key`]=T,M[`${h}.${O}.encoder.value`]=T,M[`${h}.${O}.decoder.key`]=L,M[`${h}.${O}.decoder.value`]=L}else{const F=x.num_heads,E=x.num_layers,T=x.dim_kv??x.hidden_size/(x.num_attention_heads??F);if(x.model_type==="falcon"){const L=[w*F,0,T];for(let O=0;O<E;++O)M[`${h}.${O}.key`]=L,M[`${h}.${O}.value`]=L}else if(x.multi_query){const L=[w*F,0,2*T];for(let O=0;O<E;++O)M[`${h}.${O}.key_value`]=L}else if(x.model_type==="bloom"){const L=[w*F,T,0],O=[w*F,0,T];for(let S=0;S<E;++S)M[`${h}.${S}.key`]=L,M[`${h}.${S}.value`]=O}else if(x.model_type==="openelm")for(let L=0;L<E;++L){const O=[w,F[L],0,T];M[`${h}.${L}.key`]=O,M[`${h}.${L}.value`]=O}else{const L=[w,F,0,T];for(let O=0;O<E;++O)M[`${h}.${O}.key`]=L,M[`${h}.${O}.value`]=L}}return M}class p{model_type=null;is_encoder_decoder=!1;max_position_embeddings;"transformers.js_config";constructor(h){Object.assign(this,h),this.normalized_config=d(this)}static async from_pretrained(h,{progress_callback:w=null,config:M=null,cache_dir:x=null,local_files_only:F=!1,revision:E="main"}={}){M&&!(M instanceof p)&&(M=new p(M));const T=M??await u(h,{progress_callback:w,config:M,cache_dir:x,local_files_only:F,revision:E});return new this(T)}}class g{static async from_pretrained(...h){return p.from_pretrained(...h)}}}),"./src/env.js":((t,r,n)=>{n.r(r),n.d(r,{apis:()=>E,env:()=>C});var a=n("?db59"),o=n("?383f"),u=n("?fa4b");const d="3.7.2",c=typeof window<"u"&&typeof window.document<"u",f=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes(self.constructor?.name),p=typeof self<"u"&&"caches"in self,g=typeof navigator<"u"&&"gpu"in navigator,_=typeof navigator<"u"&&"ml"in navigator,h=typeof process<"u",w=h&&process?.release?.name==="node",M=!k(a),x=!k(o),F=typeof globalThis.Deno<"u",E=Object.freeze({IS_BROWSER_ENV:c,IS_WEBWORKER_ENV:f,IS_WEB_CACHE_AVAILABLE:p,IS_WEBGPU_AVAILABLE:g,IS_WEBNN_AVAILABLE:_,IS_PROCESS_AVAILABLE:h,IS_NODE_ENV:w,IS_FS_AVAILABLE:M,IS_PATH_AVAILABLE:x}),T=M&&x;let L="./";if(T){const U=Object(import.meta).url;U?L=o.dirname(o.dirname(u.fileURLToPath(U))):typeof __dirname<"u"&&(L=o.dirname(__dirname))}const O=T?o.join(L,"/.cache/"):null,S="/models/",$=T?o.join(L,S):S,C={version:d,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(c||f),localModelPath:$,useFS:M,useBrowserCache:p&&!F,useFSCache:M,cacheDir:O,useCustomCache:!1,customCache:null};function k(U){return Object.keys(U).length===0}}),"./src/generation/configuration_utils.js":((t,r,n)=>{n.r(r),n.d(r,{GenerationConfig:()=>o});var a=n("./src/utils/core.js");class o{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=!1;max_time=null;do_sample=!1;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=!0;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=!1;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=!1;exponential_decay_length_penalty=null;suppress_tokens=null;streamer=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=!1;output_hidden_states=!1;output_scores=!1;return_dict_in_generate=!1;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(d){Object.assign(this,(0,a.pick)(d,Object.getOwnPropertyNames(this)))}}}),"./src/generation/logits_process.js":((t,r,n)=>{n.r(r),n.d(r,{ClassifierFreeGuidanceLogitsProcessor:()=>E,ForcedBOSTokenLogitsProcessor:()=>f,ForcedEOSTokenLogitsProcessor:()=>p,LogitsProcessor:()=>u,LogitsProcessorList:()=>c,LogitsWarper:()=>d,MinLengthLogitsProcessor:()=>M,MinNewTokensLengthLogitsProcessor:()=>x,NoBadWordsLogitsProcessor:()=>F,NoRepeatNGramLogitsProcessor:()=>h,RepetitionPenaltyLogitsProcessor:()=>w,SuppressTokensAtBeginLogitsProcessor:()=>g,TemperatureLogitsWarper:()=>T,TopKLogitsWarper:()=>O,TopPLogitsWarper:()=>L,WhisperTimeStampLogitsProcessor:()=>_});var a=n("./src/utils/generic.js");n("./src/utils/tensor.js");var o=n("./src/utils/maths.js");class u extends a.Callable{_call($,C){throw Error("`_call` should be implemented in a subclass")}}class d extends a.Callable{_call($,C){throw Error("`_call` should be implemented in a subclass")}}class c extends a.Callable{constructor(){super(),this.processors=[]}push($){this.processors.push($)}extend($){this.processors.push(...$)}_call($,C){let k=C;for(const U of this.processors)k=U($,k);return k}[Symbol.iterator](){return this.processors.values()}}class f extends u{constructor($){super(),this.bos_token_id=$}_call($,C){for(let k=0;k<$.length;++k)if($[k].length===1){const U=C[k].data;U.fill(-1/0),U[this.bos_token_id]=0}return C}}class p extends u{constructor($,C){super(),this.max_length=$,this.eos_token_id=Array.isArray(C)?C:[C]}_call($,C){for(let k=0;k<$.length;++k)if($[k].length===this.max_length-1){const U=C[k].data;U.fill(-1/0);for(const V of this.eos_token_id)U[V]=0}return C}}class g extends u{constructor($,C){super(),this.begin_suppress_tokens=$,this.begin_index=C}_call($,C){for(let k=0;k<$.length;++k)if($[k].length===this.begin_index){const U=C[k].data;for(const V of this.begin_suppress_tokens)U[V]=-1/0}return C}}class _ extends u{constructor($,C){super(),this.eos_token_id=Array.isArray($.eos_token_id)?$.eos_token_id[0]:$.eos_token_id,this.no_timestamps_token_id=$.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=C.length,C.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=$.max_initial_timestamp_index}_call($,C){for(let k=0;k<$.length;++k){const U=C[k].data;if(U[this.no_timestamps_token_id]=-1/0,$[k].length===this.begin_index-1){U.fill(-1/0),U[this.timestamp_begin]=0;continue}const V=$[k].slice(this.begin_index),re=V.length>=1&&V[V.length-1]>=this.timestamp_begin,ne=V.length<2||V[V.length-2]>=this.timestamp_begin;if(re&&(ne?U.subarray(this.timestamp_begin).fill(-1/0):U.subarray(0,this.eos_token_id).fill(-1/0)),$[k].length===this.begin_index&&this.max_initial_timestamp_index!==null){const H=this.timestamp_begin+this.max_initial_timestamp_index;U.subarray(H+1).fill(-1/0)}const W=(0,o.log_softmax)(U),ce=Math.log(W.subarray(this.timestamp_begin).map(Math.exp).reduce((H,se)=>H+se)),ae=(0,o.max)(W.subarray(0,this.timestamp_begin))[0];ce>ae&&U.subarray(0,this.timestamp_begin).fill(-1/0)}return C}}class h extends u{constructor($){super(),this.no_repeat_ngram_size=$}getNgrams($){const C=$.length,k=[];for(let V=0;V<C+1-this.no_repeat_ngram_size;++V){const re=[];for(let ne=0;ne<this.no_repeat_ngram_size;++ne)re.push($[V+ne]);k.push(re.map(Number))}const U=new Map;for(const V of k){const re=V.slice(0,V.length-1),ne=JSON.stringify(re),W=U.get(ne)??[];W.push(V[V.length-1]),U.set(ne,W)}return U}getGeneratedNgrams($,C){const k=C.slice(C.length+1-this.no_repeat_ngram_size,C.length);return $.get(JSON.stringify(k.map(Number)))??[]}calcBannedNgramTokens($){const C=[];if($.length+1<this.no_repeat_ngram_size)return C;{const k=this.getNgrams($);return this.getGeneratedNgrams(k,$)}}_call($,C){for(let k=0;k<$.length;++k){const U=C[k].data,V=this.calcBannedNgramTokens($[k]);for(const re of V)U[re]=-1/0}return C}}class w extends u{constructor($){super(),this.penalty=$}_call($,C){for(let k=0;k<$.length;++k){const U=C[k].data;for(const V of new Set($[k])){const re=Number(V);U[re]<0?U[re]*=this.penalty:U[re]/=this.penalty}}return C}}class M extends u{constructor($,C){super(),this.min_length=$,this.eos_token_id=Array.isArray(C)?C:[C]}_call($,C){for(let k=0;k<$.length;++k)if($[k].length<this.min_length){const U=C[k].data;for(const V of this.eos_token_id)U[V]=-1/0}return C}}class x extends u{constructor($,C,k){super(),this.prompt_length_to_skip=$,this.min_new_tokens=C,this.eos_token_id=Array.isArray(k)?k:[k]}_call($,C){for(let k=0;k<$.length;++k)if($[k].length-this.prompt_length_to_skip<this.min_new_tokens){const V=C[k].data;for(const re of this.eos_token_id)V[re]=-1/0}return C}}class F extends u{constructor($,C){super(),this.bad_words_ids=$,this.eos_token_id=Array.isArray(C)?C:[C]}_call($,C){for(let k=0;k<$.length;++k){const U=C[k].data,V=$[k];for(const re of this.bad_words_ids){if(V.length<re.length-1)continue;let ne=!0;for(let W=1;W<=re.length-1;++W)if(re.at(-W-1)!=V.at(-W)){ne=!1;break}ne&&(U[re.at(-1)]=-1/0)}}return C}}class E extends u{constructor($){if(super(),$<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${$}.`);this.guidance_scale=$}_call($,C){if(C.dims[0]!==2*$.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${C.dims[0]} for the logits and ${$.length} for the input ids.`);const k=$.length,U=C.slice([0,k],null),V=C.slice([k,C.dims[0]],null);for(let re=0;re<V.data.length;++re)V.data[re]+=(U.data[re]-V.data[re])*this.guidance_scale;return V}}class T extends d{constructor($){super(),this.temperature=$}_call($,C){const k=C.data;for(let U=0;U<k.length;++U)k[U]/=this.temperature;return C}}class L extends d{constructor($,{filter_value:C=-1/0,min_tokens_to_keep:k=1}={}){if(super(),$<0||$>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${$}`);if(!Number.isInteger(k)||k<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${k}`);this.top_p=$,this.filter_value=C,this.min_tokens_to_keep=k}}class O extends d{constructor($,{filter_value:C=-1/0,min_tokens_to_keep:k=1}={}){if(super(),!Number.isInteger($)||$<0)throw new Error(`\`top_k\` must be a positive integer, but is ${$}`);this.top_k=Math.max($,k),this.filter_value=C}}}),"./src/generation/logits_sampler.js":((t,r,n)=>{n.r(r),n.d(r,{LogitsSampler:()=>d});var a=n("./src/utils/generic.js"),o=n("./src/utils/tensor.js"),u=n("./src/utils/maths.js");n("./src/generation/configuration_utils.js");class d extends a.Callable{constructor(_){super(),this.generation_config=_}async _call(_){return this.sample(_)}async sample(_){throw Error("sample should be implemented in subclasses.")}getLogits(_,h){let w=_.dims.at(-1),M=_.data;if(h===-1)M=M.slice(-w);else{let x=h*w;M=M.slice(x,x+w)}return M}randomSelect(_){let h=0;for(let M=0;M<_.length;++M)h+=_[M];let w=Math.random()*h;for(let M=0;M<_.length;++M)if(w-=_[M],w<=0)return M;return 0}static getSampler(_){if(_.do_sample)return new f(_);if(_.num_beams>1)return new p(_);if(_.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${_.num_return_sequences}.`);return new c(_)}}class c extends d{async sample(_){const h=(0,u.max)(_.data)[1];return[[BigInt(h),0]]}}class f extends d{async sample(_){let h=_.dims.at(-1);this.generation_config.top_k>0&&(h=Math.min(this.generation_config.top_k,h));const[w,M]=await(0,o.topk)(_,h),x=(0,u.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},()=>{const F=this.randomSelect(x);return[M.data[F],Math.log(x[F])]})}}class p extends d{async sample(_){let h=_.dims.at(-1);this.generation_config.top_k>0&&(h=Math.min(this.generation_config.top_k,h));const[w,M]=await(0,o.topk)(_,h),x=(0,u.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},(F,E)=>[M.data[E],Math.log(x[E])])}}}),"./src/generation/stopping_criteria.js":((t,r,n)=>{n.r(r),n.d(r,{EosTokenCriteria:()=>c,InterruptableStoppingCriteria:()=>f,MaxLengthCriteria:()=>d,StoppingCriteria:()=>o,StoppingCriteriaList:()=>u});var a=n("./src/utils/generic.js");class o extends a.Callable{_call(g,_){throw Error("StoppingCriteria needs to be subclassed")}}class u extends a.Callable{constructor(){super(),this.criteria=[]}push(g){this.criteria.push(g)}extend(g){g instanceof u?g=g.criteria:g instanceof o&&(g=[g]),this.criteria.push(...g)}_call(g,_){const h=new Array(g.length).fill(!1);for(const w of this.criteria){const M=w(g,_);for(let x=0;x<h.length;++x)h[x]||=M[x]}return h}[Symbol.iterator](){return this.criteria.values()}}class d extends o{constructor(g,_=null){super(),this.max_length=g,this.max_position_embeddings=_}_call(g){return g.map(_=>_.length>=this.max_length)}}class c extends o{constructor(g){super(),Array.isArray(g)||(g=[g]),this.eos_token_id=g}_call(g,_){return g.map(h=>{const w=h.at(-1);return this.eos_token_id.some(M=>w==M)})}}class f extends o{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(g,_){return new Array(g.length).fill(this.interrupted)}}}),"./src/generation/streamers.js":((t,r,n)=>{n.r(r),n.d(r,{BaseStreamer:()=>d,TextStreamer:()=>f,WhisperTextStreamer:()=>p});var a=n("./src/utils/core.js"),o=n("./src/tokenizers.js"),u=n("./src/env.js");class d{put(_){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const c=u.apis.IS_PROCESS_AVAILABLE?g=>process.stdout.write(g):g=>console.log(g);class f extends d{constructor(_,{skip_prompt:h=!1,callback_function:w=null,token_callback_function:M=null,skip_special_tokens:x=!0,decode_kwargs:F={},...E}={}){super(),this.tokenizer=_,this.skip_prompt=h,this.callback_function=w??c,this.token_callback_function=M,this.decode_kwargs={skip_special_tokens:x,...F,...E},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(_){if(_.length>1)throw Error("TextStreamer only supports batch size of 1");const h=this.next_tokens_are_prompt;if(h&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const w=_[0];this.token_callback_function?.(w),this.token_cache=(0,a.mergeArrays)(this.token_cache,w);const M=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let x;h||M.endsWith(`
`)?(x=M.slice(this.print_len),this.token_cache=[],this.print_len=0):M.length>0&&(0,o.is_chinese_char)(M.charCodeAt(M.length-1))?(x=M.slice(this.print_len),this.print_len+=x.length):(x=M.slice(this.print_len,M.lastIndexOf(" ")+1),this.print_len+=x.length),this.on_finalized_text(x,!1)}end(){let _;this.token_cache.length>0?(_=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):_="",this.next_tokens_are_prompt=!0,this.on_finalized_text(_,!0)}on_finalized_text(_,h){_.length>0&&this.callback_function?.(_),h&&this.callback_function===c&&u.apis.IS_PROCESS_AVAILABLE&&this.callback_function?.(`
`)}}class p extends f{constructor(_,{skip_prompt:h=!1,callback_function:w=null,token_callback_function:M=null,on_chunk_start:x=null,on_chunk_end:F=null,on_finalize:E=null,time_precision:T=.02,skip_special_tokens:L=!0,decode_kwargs:O={}}={}){super(_,{skip_prompt:h,skip_special_tokens:L,callback_function:w,token_callback_function:M,decode_kwargs:O}),this.timestamp_begin=_.timestamp_begin,this.on_chunk_start=x,this.on_chunk_end=F,this.on_finalize=E,this.time_precision=T,this.waiting_for_timestamp=!1}put(_){if(_.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const h=_[0];if(h.length===1){const w=Number(h[0])-this.timestamp_begin;if(w>=0){const M=w*this.time_precision;this.waiting_for_timestamp?this.on_chunk_end?.(M):this.on_chunk_start?.(M),this.waiting_for_timestamp=!this.waiting_for_timestamp,this.token_callback_function?.(h);return}}return super.put(_)}end(){super.end(),this.on_finalize?.()}}}),"./src/models.js":((t,r,n)=>{n.r(r),n.d(r,{ASTForAudioClassification:()=>ui,ASTModel:()=>Cl,ASTPreTrainedModel:()=>xo,AlbertForMaskedLM:()=>Yt,AlbertForQuestionAnswering:()=>ot,AlbertForSequenceClassification:()=>yt,AlbertModel:()=>gt,AlbertPreTrainedModel:()=>pt,ArceeForCausalLM:()=>En,ArceeModel:()=>yn,ArceePreTrainedModel:()=>Wt,AutoModel:()=>rl,AutoModelForAudioClassification:()=>al,AutoModelForAudioFrameClassification:()=>Td,AutoModelForAudioTextToText:()=>kh,AutoModelForCTC:()=>xd,AutoModelForCausalLM:()=>Ch,AutoModelForDepthEstimation:()=>Bu,AutoModelForDocumentQuestionAnswering:()=>bp,AutoModelForImageClassification:()=>Hn,AutoModelForImageFeatureExtraction:()=>$h,AutoModelForImageMatting:()=>_o,AutoModelForImageSegmentation:()=>gp,AutoModelForImageTextToText:()=>Dh,AutoModelForImageToImage:()=>ga,AutoModelForMaskGeneration:()=>wm,AutoModelForMaskedLM:()=>wd,AutoModelForNormalEstimation:()=>xm,AutoModelForObjectDetection:()=>Mm,AutoModelForPoseEstimation:()=>Oh,AutoModelForQuestionAnswering:()=>Sh,AutoModelForSemanticSegmentation:()=>bm,AutoModelForSeq2SeqLM:()=>wh,AutoModelForSequenceClassification:()=>vd,AutoModelForSpeechSeq2Seq:()=>xh,AutoModelForTextToSpectrogram:()=>Th,AutoModelForTextToWaveform:()=>Eh,AutoModelForTokenClassification:()=>vh,AutoModelForUniversalSegmentation:()=>Ah,AutoModelForVision2Seq:()=>Ph,AutoModelForXVector:()=>yp,AutoModelForZeroShotObjectDetection:()=>vm,BartForConditionalGeneration:()=>ss,BartForSequenceClassification:()=>ks,BartModel:()=>mn,BartPretrainedModel:()=>qs,BaseModelOutput:()=>Xe,BeitForImageClassification:()=>Ac,BeitModel:()=>Pc,BeitPreTrainedModel:()=>Sc,BertForMaskedLM:()=>Ve,BertForQuestionAnswering:()=>et,BertForSequenceClassification:()=>ke,BertForTokenClassification:()=>Ke,BertModel:()=>Ee,BertPreTrainedModel:()=>Be,BlenderbotForConditionalGeneration:()=>Gn,BlenderbotModel:()=>Zn,BlenderbotPreTrainedModel:()=>gn,BlenderbotSmallForConditionalGeneration:()=>li,BlenderbotSmallModel:()=>ta,BlenderbotSmallPreTrainedModel:()=>Js,BloomForCausalLM:()=>Zp,BloomModel:()=>Ud,BloomPreTrainedModel:()=>Fo,CLIPModel:()=>Oa,CLIPPreTrainedModel:()=>cr,CLIPSegForImageSegmentation:()=>Po,CLIPSegModel:()=>$a,CLIPSegPreTrainedModel:()=>Ls,CLIPTextModel:()=>hc,CLIPTextModelWithProjection:()=>fi,CLIPVisionModel:()=>Fl,CLIPVisionModelWithProjection:()=>Rl,CamembertForMaskedLM:()=>ft,CamembertForQuestionAnswering:()=>qn,CamembertForSequenceClassification:()=>Xt,CamembertForTokenClassification:()=>Kt,CamembertModel:()=>Ct,CamembertPreTrainedModel:()=>Mt,CausalLMOutput:()=>qa,CausalLMOutputWithPast:()=>Em,ChineseCLIPModel:()=>Nl,ChineseCLIPPreTrainedModel:()=>Bl,ClapAudioModelWithProjection:()=>Jf,ClapModel:()=>lh,ClapPreTrainedModel:()=>Kn,ClapTextModelWithProjection:()=>uh,CodeGenForCausalLM:()=>nt,CodeGenModel:()=>Ue,CodeGenPreTrainedModel:()=>ye,CohereForCausalLM:()=>Bd,CohereModel:()=>vi,CoherePreTrainedModel:()=>jr,ConvBertForMaskedLM:()=>xn,ConvBertForQuestionAnswering:()=>I,ConvBertForSequenceClassification:()=>qt,ConvBertForTokenClassification:()=>Fr,ConvBertModel:()=>zr,ConvBertPreTrainedModel:()=>Dt,ConvNextForImageClassification:()=>Tf,ConvNextModel:()=>xf,ConvNextPreTrainedModel:()=>pu,ConvNextV2ForImageClassification:()=>Cf,ConvNextV2Model:()=>Gc,ConvNextV2PreTrainedModel:()=>Ef,DFineForObjectDetection:()=>ir,DFineModel:()=>Lc,DFinePreTrainedModel:()=>ru,DINOv3ConvNextModel:()=>hu,DINOv3ConvNextPreTrainedModel:()=>Kc,DINOv3ViTModel:()=>qo,DINOv3ViTPreTrainedModel:()=>Pf,DPTForDepthEstimation:()=>df,DPTModel:()=>Nc,DPTPreTrainedModel:()=>Bc,DacDecoderModel:()=>fo,DacDecoderOutput:()=>Dn,DacEncoderModel:()=>Ga,DacEncoderOutput:()=>pn,DacModel:()=>hr,DacPreTrainedModel:()=>an,DebertaForMaskedLM:()=>Tn,DebertaForQuestionAnswering:()=>js,DebertaForSequenceClassification:()=>Bn,DebertaForTokenClassification:()=>cs,DebertaModel:()=>Nn,DebertaPreTrainedModel:()=>dn,DebertaV2ForMaskedLM:()=>Pr,DebertaV2ForQuestionAnswering:()=>lr,DebertaV2ForSequenceClassification:()=>Gs,DebertaV2ForTokenClassification:()=>Jr,DebertaV2Model:()=>Rr,DebertaV2PreTrainedModel:()=>jn,DecisionTransformerModel:()=>Ua,DecisionTransformerPreTrainedModel:()=>rp,DeiTForImageClassification:()=>ou,DeiTModel:()=>ca,DeiTPreTrainedModel:()=>iu,DepthAnythingForDepthEstimation:()=>pf,DepthAnythingPreTrainedModel:()=>ff,DepthProForDepthEstimation:()=>du,DepthProPreTrainedModel:()=>to,DetrForObjectDetection:()=>zn,DetrForSegmentation:()=>ps,DetrModel:()=>rn,DetrObjectDetectionOutput:()=>Vo,DetrPreTrainedModel:()=>Ur,DetrSegmentationOutput:()=>eo,Dinov2ForImageClassification:()=>Sf,Dinov2Model:()=>Hc,Dinov2PreTrainedModel:()=>Wc,Dinov2WithRegistersForImageClassification:()=>rh,Dinov2WithRegistersModel:()=>sh,Dinov2WithRegistersPreTrainedModel:()=>qc,DistilBertForMaskedLM:()=>Ar,DistilBertForQuestionAnswering:()=>Ws,DistilBertForSequenceClassification:()=>ns,DistilBertForTokenClassification:()=>gs,DistilBertModel:()=>ds,DistilBertPreTrainedModel:()=>Un,DonutSwinModel:()=>wf,DonutSwinPreTrainedModel:()=>vf,EfficientNetForImageClassification:()=>Pu,EfficientNetModel:()=>ld,EfficientNetPreTrainedModel:()=>Su,ElectraForMaskedLM:()=>le,ElectraForQuestionAnswering:()=>He,ElectraForSequenceClassification:()=>he,ElectraForTokenClassification:()=>Se,ElectraModel:()=>Y,ElectraPreTrainedModel:()=>ue,Ernie4_5_ForCausalLM:()=>rd,Ernie4_5_Model:()=>da,Ernie4_5_PretrainedModel:()=>sd,EsmForMaskedLM:()=>Hs,EsmForSequenceClassification:()=>Ze,EsmForTokenClassification:()=>rt,EsmModel:()=>Ea,EsmPreTrainedModel:()=>ar,ExaoneForCausalLM:()=>Rd,ExaoneModel:()=>aa,ExaonePreTrainedModel:()=>Gl,FalconForCausalLM:()=>Zo,FalconModel:()=>Eu,FalconPreTrainedModel:()=>ad,FastViTForImageClassification:()=>Zd,FastViTModel:()=>Yd,FastViTPreTrainedModel:()=>Xi,Florence2ForConditionalGeneration:()=>Ll,Florence2PreTrainedModel:()=>fc,GLPNForDepthEstimation:()=>Vc,GLPNModel:()=>Mf,GLPNPreTrainedModel:()=>Uc,GPT2LMHeadModel:()=>Ao,GPT2Model:()=>Ui,GPT2PreTrainedModel:()=>ji,GPTBigCodeForCausalLM:()=>J,GPTBigCodeModel:()=>K,GPTBigCodePreTrainedModel:()=>N,GPTJForCausalLM:()=>D,GPTJModel:()=>y,GPTJPreTrainedModel:()=>_i,GPTNeoForCausalLM:()=>Vi,GPTNeoModel:()=>sa,GPTNeoPreTrainedModel:()=>Da,GPTNeoXForCausalLM:()=>ra,GPTNeoXModel:()=>Nr,GPTNeoXPreTrainedModel:()=>Gi,Gemma2ForCausalLM:()=>wi,Gemma2Model:()=>vn,Gemma2PreTrainedModel:()=>as,Gemma3ForCausalLM:()=>xi,Gemma3Model:()=>bc,Gemma3PreTrainedModel:()=>$r,Gemma3nForConditionalGeneration:()=>Br,Gemma3nPreTrainedModel:()=>Aa,GemmaForCausalLM:()=>er,GemmaModel:()=>yc,GemmaPreTrainedModel:()=>ql,GlmForCausalLM:()=>dr,GlmModel:()=>Yp,GlmPreTrainedModel:()=>yi,GraniteForCausalLM:()=>ia,GraniteModel:()=>Mi,GranitePreTrainedModel:()=>fr,GroundingDinoForObjectDetection:()=>Of,GroundingDinoPreTrainedModel:()=>Af,GroupViTModel:()=>Xd,GroupViTPreTrainedModel:()=>eu,HeliumForCausalLM:()=>Vl,HeliumModel:()=>Fd,HeliumPreTrainedModel:()=>gi,HieraForImageClassification:()=>nf,HieraModel:()=>zc,HieraPreTrainedModel:()=>lu,HubertForCTC:()=>Us,HubertForSequenceClassification:()=>Uf,HubertModel:()=>zs,HubertPreTrainedModel:()=>oh,IJepaForImageClassification:()=>eh,IJepaModel:()=>Wd,IJepaPreTrainedModel:()=>Gd,Idefics3ForConditionalGeneration:()=>So,Idefics3PreTrainedModel:()=>pc,ImageMattingOutput:()=>Lh,JAISLMHeadModel:()=>Or,JAISModel:()=>jl,JAISPreTrainedModel:()=>mi,JinaCLIPModel:()=>Bi,JinaCLIPPreTrainedModel:()=>Ri,JinaCLIPTextModel:()=>xr,JinaCLIPVisionModel:()=>Ni,Lfm2ForCausalLM:()=>mc,Lfm2Model:()=>ka,Lfm2PreTrainedModel:()=>ys,LiteWhisperForConditionalGeneration:()=>dc,LlamaForCausalLM:()=>Ut,LlamaModel:()=>Et,LlamaPreTrainedModel:()=>_t,LlavaForConditionalGeneration:()=>Eo,LlavaOnevisionForConditionalGeneration:()=>Co,LlavaPreTrainedModel:()=>kl,LlavaQwen2ForCausalLM:()=>di,LongT5ForConditionalGeneration:()=>On,LongT5Model:()=>Vn,LongT5PreTrainedModel:()=>In,M2M100ForConditionalGeneration:()=>Lf,M2M100Model:()=>ro,M2M100PreTrainedModel:()=>Qc,MBartForCausalLM:()=>_n,MBartForConditionalGeneration:()=>rs,MBartForSequenceClassification:()=>vr,MBartModel:()=>ur,MBartPreTrainedModel:()=>Ks,MPNetForMaskedLM:()=>ii,MPNetForQuestionAnswering:()=>z,MPNetForSequenceClassification:()=>oi,MPNetForTokenClassification:()=>Me,MPNetModel:()=>Sa,MPNetPreTrainedModel:()=>fs,MT5ForConditionalGeneration:()=>Cs,MT5Model:()=>Es,MT5PreTrainedModel:()=>Ds,MarianMTModel:()=>kf,MarianModel:()=>_u,MarianPreTrainedModel:()=>so,MaskFormerForInstanceSegmentation:()=>bf,MaskFormerModel:()=>yf,MaskFormerPreTrainedModel:()=>jc,MaskedLMOutput:()=>Bs,Metric3DForDepthEstimation:()=>fu,Metric3DPreTrainedModel:()=>_f,Metric3Dv2ForDepthEstimation:()=>gf,Metric3Dv2PreTrainedModel:()=>Ho,MgpstrForSceneTextRecognition:()=>Hr,MgpstrModelOutput:()=>dd,MgpstrPreTrainedModel:()=>fd,MimiDecoderModel:()=>Wn,MimiDecoderOutput:()=>ph,MimiEncoderModel:()=>$n,MimiEncoderOutput:()=>lp,MimiModel:()=>hh,MimiPreTrainedModel:()=>co,MistralForCausalLM:()=>nd,MistralModel:()=>Xf,MistralPreTrainedModel:()=>Tu,MobileBertForMaskedLM:()=>ea,MobileBertForQuestionAnswering:()=>Ca,MobileBertForSequenceClassification:()=>Mr,MobileBertModel:()=>Pn,MobileBertPreTrainedModel:()=>vt,MobileLLMForCausalLM:()=>gc,MobileLLMModel:()=>bi,MobileLLMPreTrainedModel:()=>$o,MobileNetV1ForImageClassification:()=>dh,MobileNetV1ForSemanticSegmentation:()=>tp,MobileNetV1Model:()=>Fs,MobileNetV1PreTrainedModel:()=>Ou,MobileNetV2ForImageClassification:()=>or,MobileNetV2ForSemanticSegmentation:()=>ha,MobileNetV2Model:()=>Jn,MobileNetV2PreTrainedModel:()=>$u,MobileNetV3ForImageClassification:()=>fh,MobileNetV3ForSemanticSegmentation:()=>cd,MobileNetV3Model:()=>np,MobileNetV3PreTrainedModel:()=>Du,MobileNetV4ForImageClassification:()=>sp,MobileNetV4ForSemanticSegmentation:()=>pr,MobileNetV4Model:()=>Dr,MobileNetV4PreTrainedModel:()=>tr,MobileViTForImageClassification:()=>Fa,MobileViTModel:()=>za,MobileViTPreTrainedModel:()=>tu,MobileViTV2ForImageClassification:()=>Ec,MobileViTV2Model:()=>Tc,MobileViTV2PreTrainedModel:()=>Yi,ModelOutput:()=>De,ModernBertDecoderForCausalLM:()=>Ts,ModernBertDecoderModel:()=>os,ModernBertDecoderPreTrainedModel:()=>It,ModernBertForMaskedLM:()=>bt,ModernBertForSequenceClassification:()=>nn,ModernBertForTokenClassification:()=>un,ModernBertModel:()=>lt,ModernBertPreTrainedModel:()=>ct,Moondream1ForConditionalGeneration:()=>ci,MoonshineForConditionalGeneration:()=>$l,MoonshineModel:()=>Ol,MoonshinePreTrainedModel:()=>Al,MptForCausalLM:()=>Ss,MptModel:()=>Jp,MptPreTrainedModel:()=>Vd,MultiModalityCausalLM:()=>Va,MultiModalityPreTrainedModel:()=>Pi,MusicgenForCausalLM:()=>bs,MusicgenForConditionalGeneration:()=>Au,MusicgenModel:()=>ja,MusicgenPreTrainedModel:()=>ud,NeoBertForMaskedLM:()=>Tt,NeoBertForQuestionAnswering:()=>mt,NeoBertForSequenceClassification:()=>ut,NeoBertForTokenClassification:()=>st,NeoBertModel:()=>Re,NeoBertPreTrainedModel:()=>ht,NomicBertModel:()=>Zs,NomicBertPreTrainedModel:()=>Os,OPTForCausalLM:()=>Bo,OPTModel:()=>Ro,OPTPreTrainedModel:()=>Xl,Olmo2ForCausalLM:()=>Tr,Olmo2Model:()=>Hl,Olmo2PreTrainedModel:()=>Do,OlmoForCausalLM:()=>Hi,OlmoModel:()=>Wi,OlmoPreTrainedModel:()=>Wl,OpenELMForCausalLM:()=>ko,OpenELMModel:()=>Nd,OpenELMPreTrainedModel:()=>Mc,OwlViTForObjectDetection:()=>Jd,OwlViTModel:()=>Uo,OwlViTPreTrainedModel:()=>Zi,Owlv2ForObjectDetection:()=>nu,Owlv2Model:()=>Ji,Owlv2PreTrainedModel:()=>Cc,PaliGemmaForConditionalGeneration:()=>zl,PaliGemmaPreTrainedModel:()=>Il,PatchTSMixerForPrediction:()=>ap,PatchTSMixerModel:()=>lo,PatchTSMixerPreTrainedModel:()=>oo,PatchTSTForPrediction:()=>tl,PatchTSTModel:()=>io,PatchTSTPreTrainedModel:()=>pd,Phi3ForCausalLM:()=>Qs,Phi3Model:()=>Ei,Phi3PreTrainedModel:()=>zo,Phi3VForCausalLM:()=>zi,Phi3VPreTrainedModel:()=>Ii,PhiForCausalLM:()=>Io,PhiModel:()=>vc,PhiPreTrainedModel:()=>Ql,PreTrainedModel:()=>te,PretrainedMixin:()=>cn,PvtForImageClassification:()=>qd,PvtModel:()=>Jl,PvtPreTrainedModel:()=>Zl,PyAnnoteForAudioFrameClassification:()=>gu,PyAnnoteModel:()=>Ps,PyAnnotePreTrainedModel:()=>Gr,QuestionAnsweringModelOutput:()=>Ns,Qwen2ForCausalLM:()=>Lo,Qwen2Model:()=>jd,Qwen2PreTrainedModel:()=>qi,Qwen2VLForConditionalGeneration:()=>la,Qwen2VLPreTrainedModel:()=>La,Qwen3ForCausalLM:()=>oa,Qwen3Model:()=>Ti,Qwen3PreTrainedModel:()=>Kl,RFDetrForObjectDetection:()=>th,RFDetrModel:()=>tf,RFDetrObjectDetectionOutput:()=>kc,RFDetrPreTrainedModel:()=>Dc,RTDetrForObjectDetection:()=>Go,RTDetrModel:()=>su,RTDetrObjectDetectionOutput:()=>ua,RTDetrPreTrainedModel:()=>Ra,RTDetrV2ForObjectDetection:()=>Oc,RTDetrV2Model:()=>hs,RTDetrV2ObjectDetectionOutput:()=>$c,RTDetrV2PreTrainedModel:()=>ef,ResNetForImageClassification:()=>rf,ResNetModel:()=>sf,ResNetPreTrainedModel:()=>Fc,RoFormerForMaskedLM:()=>xa,RoFormerForQuestionAnswering:()=>Ta,RoFormerForSequenceClassification:()=>Zr,RoFormerForTokenClassification:()=>br,RoFormerModel:()=>$s,RoFormerPreTrainedModel:()=>Rn,RobertaForMaskedLM:()=>wl,RobertaForQuestionAnswering:()=>rc,RobertaForSequenceClassification:()=>nc,RobertaForTokenClassification:()=>sc,RobertaModel:()=>ki,RobertaPreTrainedModel:()=>wr,SamImageSegmentationOutput:()=>mu,SamModel:()=>Qo,SamPreTrainedModel:()=>no,SapiensForDepthEstimation:()=>nh,SapiensForNormalEstimation:()=>mf,SapiensForSemanticSegmentation:()=>hf,SapiensPreTrainedModel:()=>cu,SegformerForImageClassification:()=>el,SegformerForSemanticSegmentation:()=>Wr,SegformerModel:()=>ch,SegformerPreTrainedModel:()=>Cu,Seq2SeqLMOutput:()=>Tm,SequenceClassifierOutput:()=>Vt,SiglipModel:()=>Fi,SiglipPreTrainedModel:()=>pi,SiglipTextModel:()=>hi,SiglipVisionModel:()=>Ot,SmolLM3ForCausalLM:()=>_c,SmolLM3Model:()=>Ul,SmolLM3PreTrainedModel:()=>Oo,SmolVLMForConditionalGeneration:()=>Li,SnacDecoderModel:()=>Wa,SnacEncoderModel:()=>ls,SnacModel:()=>ma,SnacPreTrainedModel:()=>nl,SpeechT5ForSpeechToText:()=>Jc,SpeechT5ForTextToSpeech:()=>ed,SpeechT5HifiGan:()=>Qf,SpeechT5Model:()=>Kf,SpeechT5PreTrainedModel:()=>wu,SqueezeBertForMaskedLM:()=>me,SqueezeBertForQuestionAnswering:()=>Ge,SqueezeBertForSequenceClassification:()=>Oe,SqueezeBertModel:()=>de,SqueezeBertPreTrainedModel:()=>ee,StableLmForCausalLM:()=>ep,StableLmModel:()=>od,StableLmPreTrainedModel:()=>id,Starcoder2ForCausalLM:()=>fa,Starcoder2Model:()=>Zf,Starcoder2PreTrainedModel:()=>Yf,StyleTextToSpeech2Model:()=>qf,StyleTextToSpeech2PreTrainedModel:()=>Hf,Swin2SRForImageSuperResolution:()=>cf,Swin2SRModel:()=>uf,Swin2SRPreTrainedModel:()=>lf,SwinForImageClassification:()=>Rc,SwinForSemanticSegmentation:()=>of,SwinModel:()=>af,SwinPreTrainedModel:()=>uu,T5ForConditionalGeneration:()=>Yn,T5Model:()=>An,T5PreTrainedModel:()=>jt,TableTransformerForObjectDetection:()=>Wo,TableTransformerModel:()=>Ic,TableTransformerObjectDetectionOutput:()=>au,TableTransformerPreTrainedModel:()=>ms,TokenClassifierOutput:()=>Ms,TrOCRForCausalLM:()=>xu,TrOCRPreTrainedModel:()=>td,UltravoxModel:()=>uo,UltravoxPreTrainedModel:()=>ip,UniSpeechForCTC:()=>Si,UniSpeechForSequenceClassification:()=>bu,UniSpeechModel:()=>zf,UniSpeechPreTrainedModel:()=>yu,UniSpeechSatForAudioFrameClassification:()=>Bf,UniSpeechSatForCTC:()=>Rf,UniSpeechSatForSequenceClassification:()=>Mu,UniSpeechSatModel:()=>Ff,UniSpeechSatPreTrainedModel:()=>Xo,ViTForImageClassification:()=>Qi,ViTMAEModel:()=>Kd,ViTMAEPreTrainedModel:()=>No,ViTMSNForImageClassification:()=>Qd,ViTMSNModel:()=>wc,ViTMSNPreTrainedModel:()=>jo,ViTModel:()=>Ki,ViTPreTrainedModel:()=>Yl,VisionEncoderDecoderModel:()=>Dl,VitMatteForImageMatting:()=>xc,VitMattePreTrainedModel:()=>Ia,VitPoseForPoseEstimation:()=>Ci,VitPosePreTrainedModel:()=>Hd,VitsModel:()=>pa,VitsModelOutput:()=>il,VitsPreTrainedModel:()=>Jo,VoxtralForConditionalGeneration:()=>op,Wav2Vec2BertForCTC:()=>jf,Wav2Vec2BertForSequenceClassification:()=>ih,Wav2Vec2BertModel:()=>Nf,Wav2Vec2BertPreTrainedModel:()=>Yo,Wav2Vec2ForAudioFrameClassification:()=>Na,Wav2Vec2ForCTC:()=>Ba,Wav2Vec2ForSequenceClassification:()=>If,Wav2Vec2Model:()=>Vr,Wav2Vec2PreTrainedModel:()=>Is,WavLMForAudioFrameClassification:()=>Zc,WavLMForCTC:()=>Gf,WavLMForSequenceClassification:()=>Wf,WavLMForXVector:()=>vu,WavLMModel:()=>Vf,WavLMPreTrainedModel:()=>ao,WeSpeakerResNetModel:()=>Yc,WeSpeakerResNetPreTrainedModel:()=>Xc,WhisperForConditionalGeneration:()=>Pl,WhisperModel:()=>Sl,WhisperPreTrainedModel:()=>To,XLMForQuestionAnswering:()=>uc,XLMForSequenceClassification:()=>oc,XLMForTokenClassification:()=>lc,XLMModel:()=>ac,XLMPreTrainedModel:()=>na,XLMRobertaForMaskedLM:()=>Tl,XLMRobertaForQuestionAnswering:()=>wo,XLMRobertaForSequenceClassification:()=>El,XLMRobertaForTokenClassification:()=>cc,XLMRobertaModel:()=>xl,XLMRobertaPreTrainedModel:()=>Pa,XLMWithLMHeadModel:()=>ic,XVectorOutput:()=>Mp,YolosForObjectDetection:()=>Df,YolosModel:()=>$f,YolosObjectDetectionOutput:()=>ah,YolosPreTrainedModel:()=>Ko});var a=n("./src/configs.js"),o=n("./src/backends/onnx.js"),u=n("./src/utils/dtypes.js"),d=n("./src/utils/generic.js"),c=n("./src/utils/core.js"),f=n("./src/utils/hub.js"),p=n("./src/utils/constants.js"),g=n("./src/generation/logits_process.js"),_=n("./src/generation/configuration_utils.js"),h=n("./src/utils/tensor.js"),w=n("./src/utils/image.js"),M=n("./src/utils/maths.js"),x=n("./src/generation/stopping_criteria.js"),F=n("./src/generation/logits_sampler.js"),E=n("./src/env.js"),T=n("./src/models/whisper/generation_whisper.js"),L=n("./src/models/whisper/common_whisper.js");const O={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12},S=new Map,$=new Map,C=new Map;async function k(P,A,Q){let _e=Q.config?.["transformers.js_config"]??{},xe=Q.device??_e.device;xe&&typeof xe!="string"&&(xe.hasOwnProperty(A)?xe=xe[A]:(console.warn(`device not specified for "${A}". Using the default device.`),xe=null));const Ae=xe??(E.apis.IS_NODE_ENV?"cpu":"wasm"),qe=(0,o.deviceToExecutionProviders)(Ae),tt=_e.device_config??{};tt.hasOwnProperty(Ae)&&(_e={..._e,...tt[Ae]});let it=Q.dtype??_e.dtype;if(typeof it!="string"&&(it&&it.hasOwnProperty(A)?it=it[A]:(it=u.DEFAULT_DEVICE_DTYPE_MAPPING[Ae]??u.DATA_TYPES.fp32,console.warn(`dtype not specified for "${A}". Using the default dtype (${it}) for this device (${Ae}).`))),it===u.DATA_TYPES.auto){let en=_e.dtype;typeof en!="string"&&(en=en?.[A]),en&&en!==u.DATA_TYPES.auto&&u.DATA_TYPES.hasOwnProperty(en)?it=en:it=u.DEFAULT_DEVICE_DTYPE_MAPPING[Ae]??u.DATA_TYPES.fp32}const wt=it;if(u.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(wt)){if(wt===u.DATA_TYPES.fp16&&Ae==="webgpu"&&!await(0,u.isWebGpuFp16Supported)())throw new Error(`The device (${Ae}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${wt}. Should be one of: ${Object.keys(u.DATA_TYPES).join(", ")}`);const Bt=_e.kv_cache_dtype,Qt=Bt?typeof Bt=="string"?Bt:Bt[wt]??"float32":void 0;if(Qt&&!["float32","float16"].includes(Qt))throw new Error(`Invalid kv_cache_dtype: ${Qt}. Should be one of: float32, float16`);const Jt={dtype:wt,kv_cache_dtype:Qt,device:Ae},zt=u.DEFAULT_DTYPE_SUFFIX_MAPPING[wt],bn=`${A}${zt}.onnx`,Rt=`${Q.subfolder??""}/${bn}`,kt={...Q.session_options};kt.executionProviders??=qe;const Pt=_e.free_dimension_overrides;Pt?kt.freeDimensionOverrides??=Pt:Ae.startsWith("webnn")&&!kt.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${Ae}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const kn=E.apis.IS_NODE_ENV&&E.env.useFSCache,on=(0,f.getModelFile)(P,Rt,!0,Q,kn),vs=Q.use_external_data_format??_e.use_external_data_format;let us=[];if(vs){let en;typeof vs=="object"?vs.hasOwnProperty(bn)?en=vs[bn]:vs.hasOwnProperty(A)?en=vs[A]:en=!1:en=vs;const es=+en;if(es>f.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${es}) exceeds the maximum allowed value (${f.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let As=0;As<es;++As){const Ka=`${bn}_data${As===0?"":"_"+As}`,Xs=`${Q.subfolder??""}/${Ka}`;us.push(new Promise(async(qr,go)=>{const ol=await(0,f.getModelFile)(P,Xs,!0,Q,kn);qr(ol instanceof Uint8Array?{path:Ka,data:ol}:Ka)}))}}else kt.externalData!==void 0&&(us=kt.externalData.map(async en=>{if(typeof en.data=="string"){const es=await(0,f.getModelFile)(P,en.data,!0,Q);return{...en,data:es}}return en}));if(us.length>0){const en=await Promise.all(us);E.apis.IS_NODE_ENV||(kt.externalData=en)}if(Ae==="webgpu"){const en=(0,a.getCacheShapes)(Q.config,{prefix:"present"});if(Object.keys(en).length>0&&!(0,o.isONNXProxy)()){const es={};for(const As in en)es[As]="gpu-buffer";kt.preferredOutputLocation=es}}return{buffer_or_path:await on,session_options:kt,session_config:Jt}}async function U(P,A,Q){return Object.fromEntries(await Promise.all(Object.keys(A).map(async _e=>{const{buffer_or_path:xe,session_options:Ae,session_config:qe}=await k(P,A[_e],Q),tt=await(0,o.createInferenceSession)(xe,Ae,qe);return[_e,tt]})))}async function V(P,A,Q){return Object.fromEntries(await Promise.all(Object.keys(A).map(async _e=>{const xe=await(0,f.getModelJSON)(P,A[_e],!1,Q);return[_e,xe]})))}function re(P,A){const Q=Object.create(null),_e=[];for(const qe of P.inputNames){const tt=A[qe];if(!(tt instanceof h.Tensor)){_e.push(qe);continue}Q[qe]=(0,o.isONNXProxy)()?tt.clone():tt}if(_e.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${_e.join(", ")}.`);const xe=Object.keys(A).length,Ae=P.inputNames.length;if(xe>Ae){let qe=Object.keys(A).filter(tt=>!P.inputNames.includes(tt));console.warn(`WARNING: Too many inputs were provided (${xe} > ${Ae}). The following inputs will be ignored: "${qe.join(", ")}".`)}return Q}let ne=Promise.resolve();async function W(P,A){const Q=re(P,A);try{const _e=Object.fromEntries(Object.entries(Q).map(([qe,tt])=>[qe,tt.ort_tensor])),xe=()=>P.run(_e),Ae=await(E.apis.IS_BROWSER_ENV||E.apis.IS_WEBWORKER_ENV?ne=ne.then(xe):xe());return ce(Ae)}catch(_e){const xe=Object.fromEntries(Object.entries(Q).map(([Ae,qe])=>{const tt={type:qe.type,dims:qe.dims,location:qe.location};return tt.location!=="gpu-buffer"&&(tt.data=qe.data),[Ae,tt]}));throw console.error(`An error occurred during model execution: "${_e}".`),console.error("Inputs given to model:",xe),_e}}function ce(P){for(let A in P)(0,o.isONNXTensor)(P[A])?P[A]=new h.Tensor(P[A]):typeof P[A]=="object"&&ce(P[A]);return P}function ae(P){if(P instanceof h.Tensor)return P;if(P.length===0)throw Error("items must be non-empty");if(Array.isArray(P[0])){if(P.some(A=>A.length!==P[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new h.Tensor("int64",BigInt64Array.from(P.flat().map(A=>BigInt(A))),[P.length,P[0].length])}else return new h.Tensor("int64",BigInt64Array.from(P.map(A=>BigInt(A))),[1,P.length])}function H(P){return new h.Tensor("bool",[P],[1])}async function se(P,A){let{encoder_outputs:Q,input_ids:_e,decoder_input_ids:xe,...Ae}=A;if(!Q){const tt=(0,c.pick)(A,P.sessions.model.inputNames);Q=(await ie(P,tt)).last_hidden_state}return Ae.input_ids=xe,Ae.encoder_hidden_states=Q,P.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(Ae.encoder_attention_mask=A.attention_mask),await q(P,Ae,!0)}async function ie(P,A){const Q=P.sessions.model,_e=(0,c.pick)(A,Q.inputNames);if(Q.inputNames.includes("inputs_embeds")&&!_e.inputs_embeds){if(!A.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");_e.inputs_embeds=await P.encode_text({input_ids:A.input_ids})}if(Q.inputNames.includes("token_type_ids")&&!_e.token_type_ids){if(!_e.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");_e.token_type_ids=(0,h.zeros_like)(_e.input_ids)}if(Q.inputNames.includes("pixel_mask")&&!_e.pixel_mask){if(!_e.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const xe=_e.pixel_values.dims;_e.pixel_mask=(0,h.ones)([xe[0],xe[2],xe[3]])}return await W(Q,_e)}async function ge(P,A){const Q=await P.encode(A);return await P.decode(Q)}async function q(P,A,Q=!1){const _e=P.sessions[Q?"decoder_model_merged":"model"],{past_key_values:xe,...Ae}=A;if(_e.inputNames.includes("use_cache_branch")&&(Ae.use_cache_branch=H(!!xe)),_e.inputNames.includes("position_ids")&&Ae.attention_mask&&!Ae.position_ids){const tt=["paligemma","gemma3_text","gemma3"].includes(P.config.model_type)?1:0;Ae.position_ids=Ne(Ae,xe,tt)}P.addPastKeyValues(Ae,xe);const qe=(0,c.pick)(Ae,_e.inputNames);return await W(_e,qe)}function j({modality_token_id:P,inputs_embeds:A,modality_features:Q,input_ids:_e,attention_mask:xe}){const Ae=_e.tolist().map(wt=>wt.reduce((Bt,Qt,Jt)=>(Qt==P&&Bt.push(Jt),Bt),[])),qe=Ae.reduce((wt,Bt)=>wt+Bt.length,0),tt=Q.dims[0];if(qe!==tt)throw new Error(`Number of tokens and features do not match: tokens: ${qe}, features ${tt}`);let it=0;for(let wt=0;wt<Ae.length;++wt){const Bt=Ae[wt],Qt=A[wt];for(let Jt=0;Jt<Bt.length;++Jt)Qt[Bt[Jt]].data.set(Q[it++].data)}return{inputs_embeds:A,attention_mask:xe}}function R({image_token_id:P,inputs_embeds:A,image_features:Q,input_ids:_e,attention_mask:xe}){return j({modality_token_id:P,inputs_embeds:A,modality_features:Q,input_ids:_e,attention_mask:xe})}function X({audio_token_id:P,inputs_embeds:A,audio_features:Q,input_ids:_e,attention_mask:xe}){return j({modality_token_id:P,inputs_embeds:A,modality_features:Q,input_ids:_e,attention_mask:xe})}async function G(P,{encode_function:A,merge_function:Q,modality_input_name:_e,modality_output_name:xe,input_ids:Ae=null,attention_mask:qe=null,position_ids:tt=null,inputs_embeds:it=null,past_key_values:wt=null,generation_config:Bt=null,logits_processor:Qt=null,...Jt}){const zt=Jt[_e];if(!it){if(it=await P.encode_text({input_ids:Ae,...Jt}),zt&&Ae.dims[1]!==1){const Rt=await A({[_e]:zt,...Jt});({inputs_embeds:it,attention_mask:qe}=Q({[xe]:Rt,inputs_embeds:it,input_ids:Ae,attention_mask:qe}))}else if(wt&&zt&&Ae.dims[1]===1){const Rt=Ae.dims[1],kt=Object.values(wt)[0].dims.at(-2);qe=(0,h.cat)([(0,h.ones)([Ae.dims[0],kt]),qe.slice(null,[qe.dims[1]-Rt,qe.dims[1]])],1)}}if(!tt&&P.config.model_type==="qwen2_vl"){const{image_grid_thw:Rt,video_grid_thw:kt}=Jt;[tt]=P.get_rope_index(Ae,Rt,kt,qe)}return await q(P,{inputs_embeds:it,past_key_values:wt,attention_mask:qe,position_ids:tt,generation_config:Bt,logits_processor:Qt},!0)}async function pe(P,A){return await G(P,{...A,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:P.encode_audio.bind(P),merge_function:P._merge_input_ids_with_audio_features.bind(P)})}async function Te(P,A){return await G(P,{...A,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:P.encode_image.bind(P),merge_function:P._merge_input_ids_with_image_features.bind(P)})}function Ie(P,A=0){const[Q,_e]=P.dims,xe=P.data,Ae=new BigInt64Array(xe.length);for(let qe=0;qe<Q;++qe){const tt=qe*_e;let it=BigInt(A);for(let wt=0;wt<_e;++wt){const Bt=tt+wt;xe[Bt]===0n?Ae[Bt]=BigInt(1):(Ae[Bt]=it,it+=xe[Bt])}}return{data:Ae,dims:P.dims}}function Ne(P,A=null,Q=0){const{input_ids:_e,inputs_embeds:xe,attention_mask:Ae}=P,{data:qe,dims:tt}=Ie(Ae,Q);let it=new h.Tensor("int64",qe,tt);if(A){const wt=-(_e??xe).dims.at(1);it=it.slice(null,[wt,null])}return it}function dt(P,A,Q,_e){const xe=Q.past_key_values?Object.values(Q.past_key_values)[0].dims.at(-2):0;if(!Q.attention_mask){let Ae;for(const qe of["input_ids","inputs_embeds","position_ids"])if(Q[qe]){Ae=Q[qe].dims;break}if(!Ae)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");Q.attention_mask=(0,h.ones)([Ae[0],xe+Ae[1]])}if(Q.past_key_values){const{input_ids:Ae,attention_mask:qe}=Q;qe&&qe.dims[1]>Ae.dims[1]||xe<Ae.dims[1]&&(Q.input_ids=Ae.slice(null,[xe,null]))}return Q}function je(P,A,Q,_e){return Q.past_key_values&&(A=A.map(xe=>[xe.at(-1)])),{...Q,decoder_input_ids:ae(A)}}function oe(P,...A){return P.config.is_encoder_decoder?je(P,...A):dt(P,...A)}function ve(P,A,Q,_e){const xe=!!Q.past_key_values;return _e.guidance_scale!==null&&_e.guidance_scale>1&&(xe?Q.input_ids=(0,h.cat)([Q.input_ids,Q.input_ids],0):(Q.input_ids=(0,h.cat)([Q.input_ids,(0,h.full_like)(Q.input_ids,BigInt(_e.pad_token_id))],0),Q.attention_mask=(0,h.cat)([Q.attention_mask,(0,h.full_like)(Q.attention_mask,0n)],0))),(xe||!Q.pixel_values)&&(Q.pixel_values=(0,h.full)([0,0,3,384,384],1)),xe&&(Q.images_seq_mask=new h.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),Q.images_emb_mask=new h.Tensor("bool",new Array(0).fill(!1),[1,1,0])),Q}class te extends d.Callable{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(A,Q,_e){super(),this.config=A,this.sessions=Q,this.configs=_e;const xe=C.get(this.constructor),Ae=S.get(xe);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Ae){case O.DecoderOnly:this.can_generate=!0,this._forward=q,this._prepare_inputs_for_generation=dt;break;case O.Seq2Seq:case O.Vision2Seq:case O.Musicgen:this.can_generate=!0,this._forward=se,this._prepare_inputs_for_generation=je;break;case O.EncoderDecoder:this._forward=se;break;case O.ImageTextToText:this.can_generate=!0,this._forward=Te,this._prepare_inputs_for_generation=oe;break;case O.AudioTextToText:this.can_generate=!0,this._forward=pe,this._prepare_inputs_for_generation=oe;break;case O.Phi3V:case O.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=oe;break;case O.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=ve;break;case O.AutoEncoder:this._forward=ge;break;default:this._forward=ie;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){const A=[];for(const Q of Object.values(this.sessions))Q?.handler?.dispose&&A.push(Q.handler.dispose());return await Promise.all(A)}static async from_pretrained(A,{progress_callback:Q=null,config:_e=null,cache_dir:xe=null,local_files_only:Ae=!1,revision:qe="main",model_file_name:tt=null,subfolder:it="onnx",device:wt=null,dtype:Bt=null,use_external_data_format:Qt=null,session_options:Jt={}}={}){let zt={progress_callback:Q,config:_e,cache_dir:xe,local_files_only:Ae,revision:qe,model_file_name:tt,subfolder:it,device:wt,dtype:Bt,use_external_data_format:Qt,session_options:Jt};const bn=C.get(this),Rt=S.get(bn);_e=zt.config=await a.AutoConfig.from_pretrained(A,zt);let kt;if(Rt===O.DecoderOnly)kt=await Promise.all([U(A,{model:zt.model_file_name??"model"},zt),V(A,{generation_config:"generation_config.json"},zt)]);else if(Rt===O.Seq2Seq||Rt===O.Vision2Seq)kt=await Promise.all([U(A,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},zt),V(A,{generation_config:"generation_config.json"},zt)]);else if(Rt===O.MaskGeneration)kt=await Promise.all([U(A,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},zt)]);else if(Rt===O.EncoderDecoder)kt=await Promise.all([U(A,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},zt)]);else if(Rt===O.ImageTextToText){const Pt={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};_e.is_encoder_decoder&&(Pt.model="encoder_model"),kt=await Promise.all([U(A,Pt,zt),V(A,{generation_config:"generation_config.json"},zt)])}else if(Rt===O.AudioTextToText){const Pt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};kt=await Promise.all([U(A,Pt,zt),V(A,{generation_config:"generation_config.json"},zt)])}else if(Rt===O.ImageAudioTextToText){const Pt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};kt=await Promise.all([U(A,Pt,zt),V(A,{generation_config:"generation_config.json"},zt)])}else if(Rt===O.Musicgen)kt=await Promise.all([U(A,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},zt),V(A,{generation_config:"generation_config.json"},zt)]);else if(Rt===O.MultiModality)kt=await Promise.all([U(A,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},zt),V(A,{generation_config:"generation_config.json"},zt)]);else if(Rt===O.Phi3V)kt=await Promise.all([U(A,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},zt),V(A,{generation_config:"generation_config.json"},zt)]);else if(Rt===O.AutoEncoder)kt=await Promise.all([U(A,{encoder_model:"encoder_model",decoder_model:"decoder_model"},zt)]);else{if(Rt!==O.EncoderOnly){const Pt=bn??_e?.model_type;Pt!=="custom"&&console.warn(`Model type for '${Pt}' not found, assuming encoder-only architecture. Please report this at ${p.GITHUB_ISSUE_URL}.`)}kt=await Promise.all([U(A,{model:zt.model_file_name??"model"},zt)])}return new this(_e,...kt)}async _call(A){return await this.forward(A)}async forward(A){return await this._forward(this,A)}get generation_config(){return this.configs?.generation_config??null}_get_logits_warper(A){const Q=new g.LogitsProcessorList;return A.temperature!==null&&A.temperature!==1&&Q.push(new g.TemperatureLogitsWarper(A.temperature)),A.top_k!==null&&A.top_k!==0&&Q.push(new g.TopKLogitsWarper(A.top_k)),A.top_p!==null&&A.top_p<1&&Q.push(new g.TopPLogitsWarper(A.top_p)),Q}_get_logits_processor(A,Q,_e=null){const xe=new g.LogitsProcessorList;if(A.repetition_penalty!==null&&A.repetition_penalty!==1&&xe.push(new g.RepetitionPenaltyLogitsProcessor(A.repetition_penalty)),A.no_repeat_ngram_size!==null&&A.no_repeat_ngram_size>0&&xe.push(new g.NoRepeatNGramLogitsProcessor(A.no_repeat_ngram_size)),A.bad_words_ids!==null&&xe.push(new g.NoBadWordsLogitsProcessor(A.bad_words_ids,A.eos_token_id)),A.min_length!==null&&A.eos_token_id!==null&&A.min_length>0&&xe.push(new g.MinLengthLogitsProcessor(A.min_length,A.eos_token_id)),A.min_new_tokens!==null&&A.eos_token_id!==null&&A.min_new_tokens>0&&xe.push(new g.MinNewTokensLengthLogitsProcessor(Q,A.min_new_tokens,A.eos_token_id)),A.forced_bos_token_id!==null&&xe.push(new g.ForcedBOSTokenLogitsProcessor(A.forced_bos_token_id)),A.forced_eos_token_id!==null&&xe.push(new g.ForcedEOSTokenLogitsProcessor(A.max_length,A.forced_eos_token_id)),A.begin_suppress_tokens!==null){const Ae=Q>1||A.forced_bos_token_id===null?Q:Q+1;xe.push(new g.SuppressTokensAtBeginLogitsProcessor(A.begin_suppress_tokens,Ae))}return A.guidance_scale!==null&&A.guidance_scale>1&&xe.push(new g.ClassifierFreeGuidanceLogitsProcessor(A.guidance_scale)),_e!==null&&xe.extend(_e),xe}_prepare_generation_config(A,Q,_e=_.GenerationConfig){const xe={...this.config};for(const qe of["decoder","generator","text_config"])qe in xe&&Object.assign(xe,xe[qe]);const Ae=new _e(xe);return Object.assign(Ae,this.generation_config??{}),A&&Object.assign(Ae,A),Q&&Object.assign(Ae,(0,c.pick)(Q,Object.getOwnPropertyNames(Ae))),Ae}_get_stopping_criteria(A,Q=null){const _e=new x.StoppingCriteriaList;return A.max_length!==null&&_e.push(new x.MaxLengthCriteria(A.max_length,this.config.max_position_embeddings??null)),A.eos_token_id!==null&&_e.push(new x.EosTokenCriteria(A.eos_token_id)),Q&&_e.extend(Q),_e}_validate_model_class(){if(!this.can_generate){const A=[Rs,zu,_a,nr],Q=C.get(this.constructor),_e=new Set,xe=this.config.model_type;for(const qe of A){const tt=qe.get(xe);tt&&_e.add(tt[0])}let Ae=`The current model class (${Q}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw _e.size>0&&(Ae+=` Please use the following class instead: ${[..._e].join(", ")}`),Error(Ae)}}prepare_inputs_for_generation(...A){return this._prepare_inputs_for_generation(this,...A)}_update_model_kwargs_for_generation({generated_input_ids:A,outputs:Q,model_inputs:_e,is_encoder_decoder:xe}){return _e.past_key_values=this.getPastKeyValues(Q,_e.past_key_values),_e.input_ids=new h.Tensor("int64",A.flat(),[A.length,1]),xe||(_e.attention_mask=(0,h.cat)([_e.attention_mask,(0,h.ones)([_e.attention_mask.dims[0],1])],1)),_e.position_ids=null,_e}_prepare_model_inputs({inputs:A,bos_token_id:Q,model_kwargs:_e}){const xe=(0,c.pick)(_e,this.forward_params),Ae=this.main_input_name;if(Ae in xe){if(A)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else xe[Ae]=A;return{inputs_tensor:xe[Ae],model_inputs:xe,model_input_name:Ae}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:A,model_inputs:Q,model_input_name:_e,generation_config:xe}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!Q.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:qe,pixel_values:tt,attention_mask:it,...wt}=Q,Bt=await this._prepare_inputs_embeds(Q);Q={...wt,...(0,c.pick)(Bt,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Ae}=await ie(this,Q);if(xe.guidance_scale!==null&&xe.guidance_scale>1)Ae=(0,h.cat)([Ae,(0,h.full_like)(Ae,0)],0),"attention_mask"in Q&&(Q.attention_mask=(0,h.cat)([Q.attention_mask,(0,h.zeros_like)(Q.attention_mask)],0));else if(Q.decoder_input_ids){const qe=ae(Q.decoder_input_ids).dims[0];if(qe!==Ae.dims[0]){if(Ae.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Ae.dims[0]}) than the decoder inputs (${qe}).`);Ae=(0,h.cat)(Array.from({length:qe},()=>Ae),0)}}return Q.encoder_outputs=Ae,Q}_prepare_decoder_input_ids_for_generation({batch_size:A,model_input_name:Q,model_kwargs:_e,decoder_start_token_id:xe,bos_token_id:Ae,generation_config:qe}){let{decoder_input_ids:tt,...it}=_e;if(!(tt instanceof h.Tensor)){if(tt)Array.isArray(tt[0])||(tt=Array.from({length:A},()=>tt));else if(xe??=Ae,this.config.model_type==="musicgen")tt=Array.from({length:A*this.config.decoder.num_codebooks},()=>[xe]);else if(Array.isArray(xe)){if(xe.length!==A)throw new Error(`\`decoder_start_token_id\` expcted to have length ${A} but got ${xe.length}`);tt=xe}else tt=Array.from({length:A},()=>[xe]);tt=ae(tt)}return _e.decoder_attention_mask=(0,h.ones_like)(tt),{input_ids:tt,model_inputs:it}}async generate({inputs:A=null,generation_config:Q=null,logits_processor:_e=null,stopping_criteria:xe=null,streamer:Ae=null,...qe}){this._validate_model_class(),Q=this._prepare_generation_config(Q,qe);let{inputs_tensor:tt,model_inputs:it,model_input_name:wt}=this._prepare_model_inputs({inputs:A,model_kwargs:qe});const Bt=this.config.is_encoder_decoder;Bt&&("encoder_outputs"in it||(it=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:tt,model_inputs:it,model_input_name:wt,generation_config:Q})));let Qt;Bt?{input_ids:Qt,model_inputs:it}=this._prepare_decoder_input_ids_for_generation({batch_size:it[wt].dims.at(0),model_input_name:wt,model_kwargs:it,decoder_start_token_id:Q.decoder_start_token_id,bos_token_id:Q.bos_token_id,generation_config:Q}):Qt=it[wt];let Jt=Qt.dims.at(-1);Q.max_new_tokens!==null&&(Q.max_length=Jt+Q.max_new_tokens);const zt=this._get_logits_processor(Q,Jt,_e),bn=this._get_stopping_criteria(Q,xe),Rt=it[wt].dims.at(0),kt=F.LogitsSampler.getSampler(Q),Pt=new Array(Rt).fill(0),kn=Qt.tolist();Ae&&Ae.put(kn);let on,vs={};for(;;){if(it=this.prepare_inputs_for_generation(kn,it,Q),on=await this.forward(it),Q.output_attentions&&Q.return_dict_in_generate){const Xs=this.getAttentions(on);for(const qr in Xs)qr in vs||(vs[qr]=[]),vs[qr].push(Xs[qr])}const en=on.logits.slice(null,-1,null),es=zt(kn,en),As=[];for(let Xs=0;Xs<es.dims.at(0);++Xs){const qr=es[Xs],go=await kt(qr);for(const[ol,Nu]of go){const ju=BigInt(ol);Pt[Xs]+=Nu,kn[Xs].push(ju),As.push([ju]);break}}if(Ae&&Ae.put(As),bn(kn).every(Xs=>Xs))break;it=this._update_model_kwargs_for_generation({generated_input_ids:As,outputs:on,model_inputs:it,is_encoder_decoder:Bt})}Ae&&Ae.end();const us=this.getPastKeyValues(on,it.past_key_values,!0),is=new h.Tensor("int64",kn.flat(),[kn.length,kn[0].length]);if(Q.return_dict_in_generate)return{sequences:is,past_key_values:us,...vs};for(const en of Object.values(on))en.location==="gpu-buffer"&&en.dispose();return is}getPastKeyValues(A,Q,_e=!1){const xe=Object.create(null);for(const Ae in A)if(Ae.startsWith("present")){const qe=Ae.replace("present_conv","past_conv").replace("present","past_key_values"),tt=Ae.includes("encoder");if(tt&&Q?xe[qe]=Q[qe]:xe[qe]=A[Ae],Q&&(!tt||_e)){const it=Q[qe];it.location==="gpu-buffer"&&it.dispose()}}return xe}getAttentions(A){const Q={};for(const _e of["cross_attentions","encoder_attentions","decoder_attentions"])for(const xe in A)xe.startsWith(_e)&&(_e in Q||(Q[_e]=[]),Q[_e].push(A[xe]));return Q}addPastKeyValues(A,Q){if(Q)Object.assign(A,Q);else{const _e=this.sessions.decoder_model_merged??this.sessions.model,xe=(A[this.main_input_name]??A.attention_mask)?.dims?.[0]??1,Ae=_e?.config?.kv_cache_dtype??"float32",qe=Ae==="float16"?h.DataTypeMap.float16:h.DataTypeMap.float32,tt=(0,a.getCacheShapes)(this.config,{batch_size:xe});for(const it in tt){const wt=tt[it].reduce((Bt,Qt)=>Bt*Qt,1);A[it]=new h.Tensor(Ae,new qe(wt),tt[it])}}}async encode_image({pixel_values:A}){return(await W(this.sessions.vision_encoder,{pixel_values:A})).image_features}async encode_text({input_ids:A}){return(await W(this.sessions.embed_tokens,{input_ids:A})).inputs_embeds}async encode_audio({audio_values:A}){return(await W(this.sessions.audio_encoder,{audio_values:A})).audio_features}}class De{}class Xe extends De{constructor({last_hidden_state:A,hidden_states:Q=null,attentions:_e=null}){super(),this.last_hidden_state=A,this.hidden_states=Q,this.attentions=_e}}class Be extends te{}class Ee extends Be{}class Ve extends Be{async _call(A){return new Bs(await super._call(A))}}class ke extends Be{async _call(A){return new Vt(await super._call(A))}}class Ke extends Be{async _call(A){return new Ms(await super._call(A))}}class et extends Be{async _call(A){return new Ns(await super._call(A))}}class ht extends te{}class Re extends ht{}class Tt extends ht{async _call(A){return new Bs(await super._call(A))}}class ut extends ht{async _call(A){return new Vt(await super._call(A))}}class st extends ht{async _call(A){return new Ms(await super._call(A))}}class mt extends ht{async _call(A){return new Ns(await super._call(A))}}class ct extends te{}class lt extends ct{}class bt extends ct{async _call(A){return new Bs(await super._call(A))}}class nn extends ct{async _call(A){return new Vt(await super._call(A))}}class un extends ct{async _call(A){return new Ms(await super._call(A))}}class It extends te{}class os extends It{}class Ts extends It{}class Os extends te{}class Zs extends Os{}class Rn extends te{}class $s extends Rn{}class xa extends Rn{async _call(A){return new Bs(await super._call(A))}}class Zr extends Rn{async _call(A){return new Vt(await super._call(A))}}class br extends Rn{async _call(A){return new Ms(await super._call(A))}}class Ta extends Rn{async _call(A){return new Ns(await super._call(A))}}class Dt extends te{}class zr extends Dt{}class xn extends Dt{async _call(A){return new Bs(await super._call(A))}}class qt extends Dt{async _call(A){return new Vt(await super._call(A))}}class Fr extends Dt{async _call(A){return new Ms(await super._call(A))}}class I extends Dt{async _call(A){return new Ns(await super._call(A))}}class ue extends te{}class Y extends ue{}class le extends ue{async _call(A){return new Bs(await super._call(A))}}class he extends ue{async _call(A){return new Vt(await super._call(A))}}class Se extends ue{async _call(A){return new Ms(await super._call(A))}}class He extends ue{async _call(A){return new Ns(await super._call(A))}}class Mt extends te{}class Ct extends Mt{}class ft extends Mt{async _call(A){return new Bs(await super._call(A))}}class Xt extends Mt{async _call(A){return new Vt(await super._call(A))}}class Kt extends Mt{async _call(A){return new Ms(await super._call(A))}}class qn extends Mt{async _call(A){return new Ns(await super._call(A))}}class dn extends te{}class Nn extends dn{}class Tn extends dn{async _call(A){return new Bs(await super._call(A))}}class Bn extends dn{async _call(A){return new Vt(await super._call(A))}}class cs extends dn{async _call(A){return new Ms(await super._call(A))}}class js extends dn{async _call(A){return new Ns(await super._call(A))}}class jn extends te{}class Rr extends jn{}class Pr extends jn{async _call(A){return new Bs(await super._call(A))}}class Gs extends jn{async _call(A){return new Vt(await super._call(A))}}class Jr extends jn{async _call(A){return new Ms(await super._call(A))}}class lr extends jn{async _call(A){return new Ns(await super._call(A))}}class Un extends te{}class ds extends Un{}class ns extends Un{async _call(A){return new Vt(await super._call(A))}}class gs extends Un{async _call(A){return new Ms(await super._call(A))}}class Ws extends Un{async _call(A){return new Ns(await super._call(A))}}class Ar extends Un{async _call(A){return new Bs(await super._call(A))}}class ar extends te{}class Ea extends ar{}class Hs extends ar{async _call(A){return new Bs(await super._call(A))}}class Ze extends ar{async _call(A){return new Vt(await super._call(A))}}class rt extends ar{async _call(A){return new Ms(await super._call(A))}}class vt extends te{}class Pn extends vt{}class ea extends vt{async _call(A){return new Bs(await super._call(A))}}class Mr extends vt{async _call(A){return new Vt(await super._call(A))}}class Ca extends vt{async _call(A){return new Ns(await super._call(A))}}class fs extends te{}class Sa extends fs{}class ii extends fs{async _call(A){return new Bs(await super._call(A))}}class oi extends fs{async _call(A){return new Vt(await super._call(A))}}class Me extends fs{async _call(A){return new Ms(await super._call(A))}}class z extends fs{async _call(A){return new Ns(await super._call(A))}}class ee extends te{}class de extends ee{}class me extends ee{async _call(A){return new Bs(await super._call(A))}}class Oe extends ee{async _call(A){return new Vt(await super._call(A))}}class Ge extends ee{async _call(A){return new Ns(await super._call(A))}}class pt extends te{}class gt extends pt{}class yt extends pt{async _call(A){return new Vt(await super._call(A))}}class ot extends pt{async _call(A){return new Ns(await super._call(A))}}class Yt extends pt{async _call(A){return new Bs(await super._call(A))}}class jt extends te{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"]}class An extends jt{}class Yn extends jt{}class In extends te{}class Vn extends In{}class On extends In{}class Ds extends te{}class Es extends Ds{}class Cs extends Ds{}class qs extends te{}class mn extends qs{}class ss extends qs{}class ks extends qs{async _call(A){return new Vt(await super._call(A))}}class Ks extends te{}class ur extends Ks{}class rs extends Ks{}class vr extends Ks{async _call(A){return new Vt(await super._call(A))}}class _n extends Ks{}class gn extends te{}class Zn extends gn{}class Gn extends gn{}class Js extends te{}class ta extends Js{}class li extends Js{}class wr extends te{}class ki extends wr{}class wl extends wr{async _call(A){return new Bs(await super._call(A))}}class nc extends wr{async _call(A){return new Vt(await super._call(A))}}class sc extends wr{async _call(A){return new Ms(await super._call(A))}}class rc extends wr{async _call(A){return new Ns(await super._call(A))}}class na extends te{}class ac extends na{}class ic extends na{async _call(A){return new Bs(await super._call(A))}}class oc extends na{async _call(A){return new Vt(await super._call(A))}}class lc extends na{async _call(A){return new Ms(await super._call(A))}}class uc extends na{async _call(A){return new Ns(await super._call(A))}}class Pa extends te{}class xl extends Pa{}class Tl extends Pa{async _call(A){return new Bs(await super._call(A))}}class El extends Pa{async _call(A){return new Vt(await super._call(A))}}class cc extends Pa{async _call(A){return new Ms(await super._call(A))}}class wo extends Pa{async _call(A){return new Ns(await super._call(A))}}class xo extends te{}class Cl extends xo{}class ui extends xo{}class To extends te{requires_attention_mask=!1;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"]}class Sl extends To{}class Pl extends To{_prepare_generation_config(A,Q){return super._prepare_generation_config(A,Q,T.WhisperGenerationConfig)}_retrieve_init_tokens(A){const Q=[A.decoder_start_token_id];let _e=A.language;const xe=A.task;if(A.is_multilingual){_e||(console.warn("No language specified - defaulting to English (en)."),_e="en");const qe=`<|${(0,L.whisper_language_to_code)(_e)}|>`;Q.push(A.lang_to_id[qe]),Q.push(A.task_to_id[xe??"transcribe"])}else if(_e||xe)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!A.return_timestamps&&A.no_timestamps_token_id&&Q.at(-1)!==A.no_timestamps_token_id?Q.push(A.no_timestamps_token_id):A.return_timestamps&&Q.at(-1)===A.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),Q.pop()),Q.filter(Ae=>Ae!=null)}async generate({inputs:A=null,generation_config:Q=null,logits_processor:_e=null,stopping_criteria:xe=null,...Ae}){Q=this._prepare_generation_config(Q,Ae);const qe=Ae.decoder_input_ids??this._retrieve_init_tokens(Q);if(Q.return_timestamps&&(_e??=new g.LogitsProcessorList,_e.push(new g.WhisperTimeStampLogitsProcessor(Q,qe))),Q.begin_suppress_tokens&&(_e??=new g.LogitsProcessorList,_e.push(new g.SuppressTokensAtBeginLogitsProcessor(Q.begin_suppress_tokens,qe.length))),Q.return_token_timestamps){if(!Q.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");Q.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),Q.output_attentions=!0,Q.return_dict_in_generate=!0}const tt=await super.generate({inputs:A,generation_config:Q,logits_processor:_e,decoder_input_ids:qe,...Ae});return Q.return_token_timestamps&&(tt.token_timestamps=this._extract_token_timestamps(tt,Q.alignment_heads,Q.num_frames)),tt}_extract_token_timestamps(A,Q,_e=null,xe=.02){if(!A.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");_e==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let Ae=this.config.median_filter_width;Ae===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Ae=7);const qe=A.cross_attentions,tt=Array.from({length:this.config.decoder_layers},(Rt,kt)=>(0,h.cat)(qe.map(Pt=>Pt[kt]),2)),it=(0,h.stack)(Q.map(([Rt,kt])=>{if(Rt>=tt.length)throw new Error(`Layer index ${Rt} is out of bounds for cross attentions (length ${tt.length}).`);return _e?tt[Rt].slice(null,kt,null,[0,_e]):tt[Rt].slice(null,kt)})).transpose(1,0,2,3),[wt,Bt]=(0,h.std_mean)(it,-2,0,!0),Qt=it.clone();for(let Rt=0;Rt<Qt.dims[0];++Rt){const kt=Qt[Rt];for(let Pt=0;Pt<kt.dims[0];++Pt){const kn=kt[Pt],on=wt[Rt][Pt][0].data,vs=Bt[Rt][Pt][0].data;for(let us=0;us<kn.dims[0];++us){let is=kn[us].data;for(let en=0;en<is.length;++en)is[en]=(is[en]-vs[en])/on[en];is.set((0,M.medianFilter)(is,Ae))}}}const Jt=[(0,h.mean)(Qt,1)],zt=A.sequences.dims,bn=new h.Tensor("float32",new Float32Array(zt[0]*zt[1]),zt);for(let Rt=0;Rt<zt[0];++Rt){const kt=Jt[Rt].neg().squeeze_(0),[Pt,kn]=(0,M.dynamic_time_warping)(kt.tolist()),on=Array.from({length:Pt.length-1},(is,en)=>Pt[en+1]-Pt[en]),vs=(0,c.mergeArrays)([1],on).map(is=>!!is),us=[];for(let is=0;is<vs.length;++is)vs[is]&&us.push(kn[is]*xe);bn[Rt].data.set(us,1)}return bn}}class dc extends Pl{}class Al extends te{requires_attention_mask=!1;main_input_name="input_values";forward_params=["input_values","decoder_input_ids","past_key_values"]}class Ol extends Al{}class $l extends Al{}class Dl extends te{main_input_name="pixel_values";forward_params=["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"]}class kl extends te{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class Eo extends kl{_merge_input_ids_with_image_features(A){const Q=A.image_features.dims.at(-1),_e=A.image_features.view(-1,Q);return R({image_token_id:this.config.image_token_index,...A,image_features:_e})}}class Co extends Eo{}class ci extends Eo{}class fc extends te{forward_params=["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"];main_input_name="inputs_embeds"}class Ll extends fc{_merge_input_ids_with_image_features({inputs_embeds:A,image_features:Q,input_ids:_e,attention_mask:xe}){return{inputs_embeds:(0,h.cat)([Q,A],1),attention_mask:(0,h.cat)([(0,h.ones)(Q.dims.slice(0,2)),xe],1)}}async _prepare_inputs_embeds({input_ids:A,pixel_values:Q,inputs_embeds:_e,attention_mask:xe}){if(!A&&!Q)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let Ae,qe;return A&&(Ae=await this.encode_text({input_ids:A})),Q&&(qe=await this.encode_image({pixel_values:Q})),Ae&&qe?{inputs_embeds:_e,attention_mask:xe}=this._merge_input_ids_with_image_features({inputs_embeds:Ae,image_features:qe,input_ids:A,attention_mask:xe}):_e=Ae||qe,{inputs_embeds:_e,attention_mask:xe}}async forward({input_ids:A,pixel_values:Q,attention_mask:_e,decoder_input_ids:xe,decoder_attention_mask:Ae,encoder_outputs:qe,past_key_values:tt,inputs_embeds:it,decoder_inputs_embeds:wt}){if(it||({inputs_embeds:it,attention_mask:_e}=await this._prepare_inputs_embeds({input_ids:A,pixel_values:Q,inputs_embeds:it,attention_mask:_e})),!qe){let{last_hidden_state:Jt}=await ie(this,{inputs_embeds:it,attention_mask:_e});qe=Jt}if(!wt){if(!xe)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");wt=await this.encode_text({input_ids:xe})}return await q(this,{inputs_embeds:wt,attention_mask:Ae,encoder_attention_mask:_e,encoder_hidden_states:qe,past_key_values:tt},!0)}}class Il extends te{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class zl extends Il{_merge_input_ids_with_image_features(A){const Q=A.image_features.dims.at(-1),_e=A.image_features.view(-1,Q);return R({image_token_id:this.config.image_token_index,...A,image_features:_e})}}class di extends kl{_merge_input_ids_with_image_features(A){const Q=A.image_features.dims.at(-1),_e=A.image_features.view(-1,Q);return R({image_token_id:this.config.image_token_index,...A,image_features:_e})}}class Aa extends te{forward_params=["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"]}class Br extends Aa{async forward({input_ids:A=null,attention_mask:Q=null,pixel_values:_e=null,input_features:xe=null,input_features_mask:Ae=null,position_ids:qe=null,inputs_embeds:tt=null,per_layer_inputs:it=null,past_key_values:wt=null,generation_config:Bt=null,logits_processor:Qt=null,...Jt}){if((!tt||!it)&&({inputs_embeds:tt,per_layer_inputs:it}=await W(this.sessions.embed_tokens,{input_ids:A}),A.dims[1]!==1)){if(_e){const{image_features:bn}=await W(this.sessions.vision_encoder,{pixel_values:_e});({inputs_embeds:tt,attention_mask:Q}=this._merge_input_ids_with_image_features({image_features:bn,inputs_embeds:tt,input_ids:A,attention_mask:Q}))}if(xe){const{audio_features:bn}=await W(this.sessions.audio_encoder,{input_features:xe,input_features_mask:Ae});({inputs_embeds:tt,attention_mask:Q}=this._merge_input_ids_with_audio_features({audio_features:bn,inputs_embeds:tt,input_ids:A,attention_mask:Q}))}}return await q(this,{inputs_embeds:tt,per_layer_inputs:it,past_key_values:wt,attention_mask:Q,position_ids:qe,generation_config:Bt,logits_processor:Qt},!0)}_merge_input_ids_with_image_features(A){const Q=A.image_features.dims.at(-1),_e=A.image_features.view(-1,Q);return R({image_token_id:this.config.image_token_id,...A,image_features:_e})}_merge_input_ids_with_audio_features(A){const Q=A.audio_features.dims.at(-1),_e=A.audio_features.view(-1,Q);return X({audio_token_id:this.config.audio_token_id,...A,audio_features:_e})}}class pc extends te{forward_params=["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"]}class So extends pc{async encode_image({pixel_values:A,pixel_attention_mask:Q}){return(await W(this.sessions.vision_encoder,{pixel_values:A,pixel_attention_mask:Q})).image_features}_merge_input_ids_with_image_features(A){const Q=A.image_features.dims.at(-1),_e=A.image_features.view(-1,Q);return R({image_token_id:this.config.image_token_id,...A,image_features:_e})}}class Li extends So{}class Ii extends te{forward_params=["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"]}class zi extends Ii{async forward({input_ids:A=null,attention_mask:Q=null,pixel_values:_e=null,image_sizes:xe=null,position_ids:Ae=null,inputs_embeds:qe=null,past_key_values:tt=null,generation_config:it=null,logits_processor:wt=null,...Bt}){if(!qe){let Jt;if(_e&&A.dims[1]!==1){if(!xe)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:Jt}=await W(this.sessions.vision_encoder,{pixel_values:_e,image_sizes:xe}))}else{const zt=this.config.normalized_config.hidden_size;Jt=new h.Tensor("float32",[],[0,zt])}({inputs_embeds:qe}=await W(this.sessions.prepare_inputs_embeds,{input_ids:A,image_features:Jt}))}return await q(this,{inputs_embeds:qe,past_key_values:tt,attention_mask:Q,position_ids:Ae,generation_config:it,logits_processor:wt},!1)}}class cr extends te{}class Oa extends cr{}class hc extends cr{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"text_model"})}}class fi extends cr{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"text_model"})}}class Fl extends cr{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"vision_model"})}}class Rl extends cr{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"vision_model"})}}class pi extends te{}class Fi extends pi{}class hi extends pi{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"text_model"})}}class Ot extends cr{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"vision_model"})}}class Bl extends te{}class Nl extends Bl{}class Ri extends te{}class Bi extends Ri{async forward(A){const Q=!A.input_ids,_e=!A.pixel_values;if(Q&&_e)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(Q&&(A.input_ids=(0,h.ones)([A.pixel_values.dims[0],1])),_e){const{image_size:wt}=this.config.vision_config;A.pixel_values=(0,h.full)([0,3,wt,wt],0)}const{text_embeddings:xe,image_embeddings:Ae,l2norm_text_embeddings:qe,l2norm_image_embeddings:tt}=await super.forward(A),it={};return Q||(it.text_embeddings=xe,it.l2norm_text_embeddings=qe),_e||(it.image_embeddings=Ae,it.l2norm_image_embeddings=tt),it}}class xr extends Ri{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"text_model"})}}class Ni extends Ri{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"vision_model"})}}class Ls extends te{}class $a extends Ls{}class Po extends Ls{}class ji extends te{}class Ui extends ji{}class Ao extends ji{}class mi extends te{}class jl extends mi{}class Or extends mi{}class Da extends te{}class sa extends Da{}class Vi extends Da{}class Gi extends te{}class Nr extends Gi{}class ra extends Gi{}class _i extends te{}class y extends _i{}class D extends _i{}class N extends te{}class K extends N{}class J extends N{}class ye extends te{}class Ue extends ye{}class nt extends ye{}class _t extends te{}class Et extends _t{}class Ut extends _t{}class Wt extends te{}class yn extends Wt{}class En extends Wt{}class ys extends te{}class ka extends ys{}class mc extends ys{}class Oo extends te{}class Ul extends Oo{}class _c extends Oo{}class gi extends te{}class Fd extends gi{}class Vl extends gi{}class yi extends te{}class Yp extends yi{}class dr extends yi{}class Gl extends te{}class aa extends Gl{}class Rd extends Gl{}class $o extends te{}class bi extends $o{}class gc extends $o{}class Wl extends te{}class Wi extends Wl{}class Hi extends Wl{}class Do extends te{}class Hl extends Do{}class Tr extends Do{}class fr extends te{}class Mi extends fr{}class ia extends fr{}class jr extends te{}class vi extends jr{}class Bd extends jr{}class ql extends te{}class yc extends ql{}class er extends ql{}class as extends te{}class vn extends as{}class wi extends as{}class $r extends te{}class bc extends $r{}class xi extends $r{}class Mc extends te{}class Nd extends Mc{}class ko extends Mc{}class qi extends te{}class jd extends qi{}class Lo extends qi{}class Kl extends te{}class Ti extends Kl{}class oa extends Kl{}class La extends te{forward_params=["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"]}class la extends La{get_rope_index(A,Q,_e,xe){const{vision_config:Ae,image_token_id:qe,video_token_id:tt,vision_start_token_id:it}=this.config,wt=Ae.spatial_merge_size??2,Bt=[];if(Q||_e){let Qt=A.tolist();xe||(xe=(0,h.ones_like)(A));const Jt=xe.tolist(),zt=Array.from({length:3},kn=>Array.from({length:A.dims[0]},on=>Array.from({length:A.dims[1]},vs=>1))),bn=Q?Q.tolist():[],Rt=_e?_e.tolist():[];let kt=0,Pt=0;for(let kn=0;kn<Qt.length;++kn){const on=Qt[kn].filter((Mn,ws)=>Jt[kn][ws]==1),us=on.reduce((Mn,ws,ya)=>(ws==it&&Mn.push(ya),Mn),[]).map(Mn=>on[Mn+1]),is=us.filter(Mn=>Mn==qe).length,en=us.filter(Mn=>Mn==tt).length;let es=[],As=0,Ka=is,Xs=en;for(let Mn=0;Mn<us.length;++Mn){const ws=on.findIndex(($i,Kr)=>Kr>As&&$i==qe),ya=on.findIndex(($i,Kr)=>Kr>As&&$i==tt),yo=Ka>0&&ws!==-1?ws:on.length+1,ll=Xs>0&&ya!==-1?ya:on.length+1;let ul,vp,Er,Uu;yo<ll?([vp,Er,Uu]=bn[kt],++kt,--Ka,ul=yo):([vp,Er,Uu]=Rt[Pt],++Pt,--Xs,ul=ll);const[Ih,Ed,Oi]=[Number(vp),Math.floor(Number(Er)/wt),Math.floor(Number(Uu)/wt)],_r=ul-As,wp=es.length>0?(0,M.max)(es.at(-1))[0]+1:0;es.push(Array.from({length:3*_r},($i,Kr)=>wp+Kr%_r));const cl=_r+wp,Lr=Ih*Ed*Oi,Sm=Array.from({length:Lr},($i,Kr)=>cl+Math.floor(Kr/(Ed*Oi))),Pm=Array.from({length:Lr},($i,Kr)=>cl+Math.floor(Kr/Oi)%Ed),dl=Array.from({length:Lr},($i,Kr)=>cl+Kr%Oi);es.push([Sm,Pm,dl].flat()),As=ul+Lr}if(As<on.length){const Mn=es.length>0?(0,M.max)(es.at(-1))[0]+1:0,ws=on.length-As;es.push(Array.from({length:3*ws},(ya,yo)=>Mn+yo%ws))}const qr=es.reduce((Mn,ws)=>Mn+ws.length,0),go=new Array(qr);let ol=0;for(let Mn=0;Mn<3;++Mn)for(let ws=0;ws<es.length;++ws){const ya=es[ws],yo=ya.length/3;for(let ll=Mn*yo;ll<(Mn+1)*yo;++ll)go[ol++]=ya[ll]}let Nu=0;const ju=Jt[kn];for(let Mn=0;Mn<ju.length;++Mn)if(ju[Mn]==1){for(let ws=0;ws<3;++ws)zt[ws][kn][Mn]=go[ws*qr/3+Nu];++Nu}const Cm=(0,M.max)(go)[0];Bt.push(Cm+1-Qt[kn].length)}return[new h.Tensor("int64",zt.flat(1/0),[3,A.dims[0],A.dims[1]]),new h.Tensor("int64",Bt,[Bt.length,1])]}else if(xe){const{data:Qt,dims:Jt}=Ie(xe),zt=BigInt64Array.from({length:3*Qt.length},(Rt,kt)=>Qt[kt%Qt.length]),bn=Array.from({length:Jt[0]},(Rt,kt)=>(0,M.max)(Qt.subarray(Jt[1]*kt,Jt[1]*(kt+1)))[0]+1n+BigInt(Jt[1]));return[new h.Tensor("int64",zt,[3,...Jt]),new h.Tensor("int64",bn,[bn.length,1])]}else{const[Qt,Jt]=A.dims,zt=BigInt64Array.from({length:3*Qt*Jt},(bn,Rt)=>BigInt(Math.floor(Rt%Jt/Qt)));return[new h.Tensor("int64",zt,[3,...A.dims]),(0,h.zeros)([Qt,1])]}}async encode_image({pixel_values:A,image_grid_thw:Q}){return(await W(this.sessions.vision_encoder,{pixel_values:A,grid_thw:Q})).image_features}_merge_input_ids_with_image_features(A){return R({image_token_id:this.config.image_token_id,...A})}prepare_inputs_for_generation(A,Q,_e){if(Q.attention_mask&&!Q.position_ids)if(!Q.past_key_values)[Q.position_ids,Q.rope_deltas]=this.get_rope_index(Q.input_ids,Q.image_grid_thw,Q.video_grid_thw,Q.attention_mask);else{Q.pixel_values=null;const xe=BigInt(Object.values(Q.past_key_values)[0].dims.at(-2)),Ae=Q.rope_deltas.map(qe=>xe+qe);Q.position_ids=(0,h.stack)([Ae,Ae,Ae],0)}return Q}}class Ql extends te{}class vc extends Ql{}class Io extends Ql{}class zo extends te{}class Ei extends zo{}class Qs extends zo{}class Fo extends te{}class Ud extends Fo{}class Zp extends Fo{}class Vd extends te{}class Jp extends Vd{}class Ss extends Vd{}class Xl extends te{}class Ro extends Xl{}class Bo extends Xl{}class Yl extends te{}class Ki extends Yl{}class Qi extends Yl{async _call(A){return new Vt(await super._call(A))}}class Gd extends te{}class Wd extends Gd{}class eh extends Gd{async _call(A){return new Vt(await super._call(A))}}class Hd extends te{}class Ci extends Hd{}class Zl extends te{}class Jl extends Zl{}class qd extends Zl{async _call(A){return new Vt(await super._call(A))}}class No extends te{}class Kd extends No{}class jo extends te{}class wc extends jo{}class Qd extends jo{async _call(A){return new Vt(await super._call(A))}}class eu extends te{}class Xd extends eu{}class Xi extends te{}class Yd extends Xi{}class Zd extends Xi{async _call(A){return new Vt(await super._call(A))}}class Ia extends te{}class xc extends Ia{async _call(A){return new Lh(await super._call(A))}}class tu extends te{}class za extends tu{}class Fa extends tu{async _call(A){return new Vt(await super._call(A))}}class Yi extends te{}class Tc extends Yi{}class Ec extends Yi{async _call(A){return new Vt(await super._call(A))}}class Zi extends te{}class Uo extends Zi{}class Jd extends Zi{}class Cc extends te{}class Ji extends Cc{}class nu extends Cc{}class Sc extends te{}class Pc extends Sc{}class Ac extends Sc{async _call(A){return new Vt(await super._call(A))}}class Ur extends te{}class rn extends Ur{}class zn extends Ur{async _call(A){return new Vo(await super._call(A))}}class ps extends Ur{async _call(A){return new eo(await super._call(A))}}class Vo extends De{constructor({logits:A,pred_boxes:Q}){super(),this.logits=A,this.pred_boxes=Q}}class eo extends De{constructor({logits:A,pred_boxes:Q,pred_masks:_e}){super(),this.logits=A,this.pred_boxes=Q,this.pred_masks=_e}}class Ra extends te{}class su extends Ra{}class Go extends Ra{async _call(A){return new ua(await super._call(A))}}class ua extends De{constructor({logits:A,pred_boxes:Q}){super(),this.logits=A,this.pred_boxes=Q}}class ef extends te{}class hs extends ef{}class Oc extends ef{async _call(A){return new $c(await super._call(A))}}class $c extends ua{}class Dc extends te{}class tf extends Dc{}class th extends Dc{async _call(A){return new kc(await super._call(A))}}class kc extends ua{}class ru extends te{}class Lc extends ru{}class ir extends ru{async _call(A){return new ua(await super._call(A))}}class ms extends te{}class Ic extends ms{}class Wo extends ms{async _call(A){return new au(await super._call(A))}}class au extends Vo{}class iu extends te{}class ca extends iu{}class ou extends iu{async _call(A){return new Vt(await super._call(A))}}class lu extends te{}class zc extends lu{}class nf extends lu{async _call(A){return new Vt(await super._call(A))}}class Fc extends te{}class sf extends Fc{}class rf extends Fc{async _call(A){return new Vt(await super._call(A))}}class uu extends te{}class af extends uu{}class Rc extends uu{async _call(A){return new Vt(await super._call(A))}}class of extends uu{}class lf extends te{}class uf extends lf{}class cf extends lf{}class Bc extends te{}class Nc extends Bc{}class df extends Bc{}class ff extends te{}class pf extends ff{}class cu extends te{}class hf extends cu{}class nh extends cu{}class mf extends cu{}class to extends te{}class du extends to{}class _f extends te{}class fu extends _f{}class Ho extends te{}class gf extends Ho{}class jc extends te{}class yf extends jc{}class bf extends jc{}class Uc extends te{}class Mf extends Uc{}class Vc extends Uc{}class vf extends te{}class wf extends vf{}class pu extends te{}class xf extends pu{}class Tf extends pu{async _call(A){return new Vt(await super._call(A))}}class Ef extends te{}class Gc extends Ef{}class Cf extends Ef{async _call(A){return new Vt(await super._call(A))}}class Wc extends te{}class Hc extends Wc{}class Sf extends Wc{async _call(A){return new Vt(await super._call(A))}}class qc extends te{}class sh extends qc{}class rh extends qc{async _call(A){return new Vt(await super._call(A))}}class Pf extends te{}class qo extends Pf{}class Kc extends te{}class hu extends Kc{}class Af extends te{}class Of extends Af{}class Ko extends te{}class $f extends Ko{}class Df extends Ko{async _call(A){return new ah(await super._call(A))}}class ah extends De{constructor({logits:A,pred_boxes:Q}){super(),this.logits=A,this.pred_boxes=Q}}class no extends te{}class Qo extends no{async get_image_embeddings({pixel_values:A}){return await ie(this,{pixel_values:A})}async forward(A){if((!A.image_embeddings||!A.image_positional_embeddings)&&(A={...A,...await this.get_image_embeddings(A)}),!A.input_labels&&A.input_points){const _e=A.input_points.dims.slice(0,-1),xe=_e.reduce((Ae,qe)=>Ae*qe,1);A.input_labels=new h.Tensor("int64",new BigInt64Array(xe).fill(1n),_e)}const Q={image_embeddings:A.image_embeddings,image_positional_embeddings:A.image_positional_embeddings};return A.input_points&&(Q.input_points=A.input_points),A.input_labels&&(Q.input_labels=A.input_labels),A.input_boxes&&(Q.input_boxes=A.input_boxes),await W(this.sessions.prompt_encoder_mask_decoder,Q)}async _call(A){return new mu(await super._call(A))}}class mu extends De{constructor({iou_scores:A,pred_masks:Q}){super(),this.iou_scores=A,this.pred_masks=Q}}class so extends te{}class _u extends so{}class kf extends so{}class Qc extends te{}class ro extends Qc{}class Lf extends Qc{}class Is extends te{}class Vr extends Is{}class Ba extends Is{async _call(A){return new qa(await super._call(A))}}class If extends Is{async _call(A){return new Vt(await super._call(A))}}class Na extends Is{async _call(A){return new Ms(await super._call(A))}}class Gr extends te{}class Ps extends Gr{}class gu extends Gr{async _call(A){return new Ms(await super._call(A))}}class Xc extends te{}class Yc extends Xc{}class yu extends te{}class zf extends yu{}class Si extends yu{async _call(A){return new qa(await super._call(A))}}class bu extends yu{async _call(A){return new Vt(await super._call(A))}}class Xo extends te{}class Ff extends Xo{}class Rf extends Xo{async _call(A){return new qa(await super._call(A))}}class Mu extends Xo{async _call(A){return new Vt(await super._call(A))}}class Bf extends Xo{async _call(A){return new Ms(await super._call(A))}}class Yo extends te{}class Nf extends Yo{}class jf extends Yo{async _call(A){return new qa(await super._call(A))}}class ih extends Yo{async _call(A){return new Vt(await super._call(A))}}class oh extends te{}class zs extends Is{}class Us extends Is{async _call(A){return new qa(await super._call(A))}}class Uf extends Is{async _call(A){return new Vt(await super._call(A))}}class ao extends te{}class Vf extends ao{}class Gf extends ao{async _call(A){return new qa(await super._call(A))}}class Wf extends ao{async _call(A){return new Vt(await super._call(A))}}class vu extends ao{async _call(A){return new Mp(await super._call(A))}}class Zc extends ao{async _call(A){return new Ms(await super._call(A))}}class Hf extends te{}class qf extends Hf{}class wu extends te{}class Kf extends wu{}class Jc extends wu{}class ed extends wu{async generate_speech(A,Q,{threshold:_e=.5,minlenratio:xe=0,maxlenratio:Ae=20,vocoder:qe=null}={}){const tt={input_ids:A},{encoder_outputs:it,encoder_attention_mask:wt}=await ie(this,tt),Bt=it.dims[1]/this.config.reduction_factor,Qt=Math.floor(Bt*Ae),Jt=Math.floor(Bt*xe),zt=this.config.num_mel_bins;let bn=[],Rt=null,kt=null,Pt=0;for(;;){++Pt;const vs=H(!!kt);let us;kt?us=kt.output_sequence_out:us=new h.Tensor("float32",new Float32Array(zt),[1,1,zt]);let is={use_cache_branch:vs,output_sequence:us,encoder_attention_mask:wt,speaker_embeddings:Q,encoder_hidden_states:it};this.addPastKeyValues(is,Rt),kt=await W(this.sessions.decoder_model_merged,is),Rt=this.getPastKeyValues(kt,Rt);const{prob:en,spectrum:es}=kt;if(bn.push(es),Pt>=Jt&&(Array.from(en.data).filter(As=>As>=_e).length>0||Pt>=Qt))break}const kn=(0,h.cat)(bn),{waveform:on}=await W(qe.sessions.model,{spectrogram:kn});return{spectrogram:kn,waveform:on}}}class Qf extends te{main_input_name="spectrogram"}class td extends te{}class xu extends td{}class Tu extends te{}class Xf extends Tu{}class nd extends Tu{}class sd extends te{}class da extends sd{}class rd extends sd{}class Yf extends te{}class Zf extends Yf{}class fa extends Yf{}class ad extends te{}class Eu extends ad{}class Zo extends ad{}class Kn extends te{}class lh extends Kn{}class uh extends Kn{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"text_model"})}}class Jf extends Kn{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"audio_model"})}}class Jo extends te{}class pa extends Jo{async _call(A){return new il(await super._call(A))}}class Cu extends te{}class ch extends Cu{}class el extends Cu{}class Wr extends Cu{}class id extends te{}class od extends id{}class ep extends id{}class Su extends te{}class ld extends Su{}class Pu extends Su{async _call(A){return new Vt(await super._call(A))}}class ud extends te{}class ja extends ud{}class bs extends ud{}class Au extends te{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];_apply_and_filter_by_delay_pattern_mask(A){const[Q,_e]=A.dims,xe=this.config.decoder.num_codebooks,Ae=_e-xe;let qe=0;for(let wt=0;wt<A.size;++wt){if(A.data[wt]===this.config.decoder.pad_token_id)continue;const Bt=wt%_e,Qt=Math.floor(wt/_e)%xe,Jt=Bt-Qt;Jt>0&&Jt<=Ae&&(A.data[qe++]=A.data[wt])}const tt=Math.floor(Q/xe),it=qe/(tt*xe);return new h.Tensor(A.type,A.data.slice(0,qe),[tt,xe,it])}prepare_inputs_for_generation(A,Q,_e){let xe=structuredClone(A);for(let qe=0;qe<xe.length;++qe)for(let tt=0;tt<xe[qe].length;++tt)qe%this.config.decoder.num_codebooks>=tt&&(xe[qe][tt]=BigInt(this.config.decoder.pad_token_id));return _e.guidance_scale!==null&&_e.guidance_scale>1&&(xe=xe.concat(xe)),super.prepare_inputs_for_generation(xe,Q,_e)}async generate(A){const Q=await super.generate(A),_e=this._apply_and_filter_by_delay_pattern_mask(Q).unsqueeze_(0),{audio_values:xe}=await W(this.sessions.encodec_decode,{audio_codes:_e});return xe}}class Ou extends te{}class Fs extends Ou{}class dh extends Ou{async _call(A){return new Vt(await super._call(A))}}class tp extends Ou{}class $u extends te{}class Jn extends $u{}class or extends $u{async _call(A){return new Vt(await super._call(A))}}class ha extends $u{}class Du extends te{}class np extends Du{}class fh extends Du{async _call(A){return new Vt(await super._call(A))}}class cd extends Du{}class tr extends te{}class Dr extends tr{}class sp extends tr{async _call(A){return new Vt(await super._call(A))}}class pr extends tr{}class rp extends te{}class Ua extends rp{}class Pi extends te{}class Va extends Pi{forward_params=["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"];constructor(...A){super(...A),this._generation_mode="text"}async forward(A){const Q=this._generation_mode??"text";let _e;if(Q==="text"||!A.past_key_values){const it=this.sessions.prepare_inputs_embeds,wt=(0,c.pick)(A,it.inputNames);_e=await W(it,wt)}else{const it=this.sessions.gen_img_embeds,wt=(0,c.pick)({image_ids:A.input_ids},it.inputNames);_e=await W(it,wt)}const xe={...A,..._e},Ae=await q(this,xe),qe=this.sessions[Q==="text"?"lm_head":"gen_head"];if(!qe)throw new Error(`Unable to find "${qe}" generation head`);const tt=await W(qe,(0,c.pick)(Ae,qe.inputNames));return{..._e,...Ae,...tt}}async generate(A){return this._generation_mode="text",super.generate(A)}async generate_images(A){this._generation_mode="image";const Q=(A.inputs??A[this.main_input_name]).dims[1],xe=(await super.generate(A)).slice(null,[Q,null]),Ae=this.sessions.image_decode,{decoded_image:qe}=await W(Ae,{generated_tokens:xe}),tt=qe.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),it=[];for(const wt of tt){const Bt=w.RawImage.fromTensor(wt);it.push(Bt)}return it}}class dd extends De{constructor({char_logits:A,bpe_logits:Q,wp_logits:_e}){super(),this.char_logits=A,this.bpe_logits=Q,this.wp_logits=_e}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class fd extends te{}class Hr extends fd{async _call(A){return new dd(await super._call(A))}}class pd extends te{}class io extends pd{}class tl extends pd{}class oo extends te{}class lo extends oo{}class ap extends oo{}class ip extends te{forward_params=["input_ids","attention_mask","position_ids","audio_values","past_key_values"]}class uo extends ip{_merge_input_ids_with_audio_features(A){const Q=A.audio_features.dims.at(-1),_e=A.audio_features.view(-1,Q);return X({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...A,audio_features:_e})}}class op extends uo{}class co extends te{main_input_name="input_values";forward_params=["input_values"]}class lp extends De{constructor({audio_codes:A}){super(),this.audio_codes=A}}class ph extends De{constructor({audio_values:A}){super(),this.audio_values=A}}class hh extends co{async encode(A){return new lp(await W(this.sessions.encoder_model,A))}async decode(A){return new ph(await W(this.sessions.decoder_model,A))}}class $n extends co{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"encoder_model"})}}class Wn extends co{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"decoder_model"})}}class an extends te{main_input_name="input_values";forward_params=["input_values"]}class pn extends De{constructor({audio_codes:A}){super(),this.audio_codes=A}}class Dn extends De{constructor({audio_values:A}){super(),this.audio_values=A}}class hr extends an{async encode(A){return new pn(await W(this.sessions.encoder_model,A))}async decode(A){return new Dn(await W(this.sessions.decoder_model,A))}}class Ga extends an{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"encoder_model"})}}class fo extends an{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"decoder_model"})}}class nl extends te{main_input_name="input_values";forward_params=["input_values"]}class ma extends nl{async encode(A){return await W(this.sessions.encoder_model,A)}async decode(A){return await W(this.sessions.decoder_model,A)}}class ls extends nl{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"encoder_model"})}}class Wa extends nl{static async from_pretrained(A,Q={}){return super.from_pretrained(A,{...Q,model_file_name:Q.model_file_name??"decoder_model"})}}class cn{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(A,{progress_callback:Q=null,config:_e=null,cache_dir:xe=null,local_files_only:Ae=!1,revision:qe="main",model_file_name:tt=null,subfolder:it="onnx",device:wt=null,dtype:Bt=null,use_external_data_format:Qt=null,session_options:Jt={}}={}){const zt={progress_callback:Q,config:_e,cache_dir:xe,local_files_only:Ae,revision:qe,model_file_name:tt,subfolder:it,device:wt,dtype:Bt,use_external_data_format:Qt,session_options:Jt};if(zt.config=await a.AutoConfig.from_pretrained(A,zt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const bn=zt.config.model_type;for(const Rt of this.MODEL_CLASS_MAPPINGS){let kt=Rt.get(bn);if(!kt){for(const Pt of Rt.values())if(Pt[0]===bn){kt=Pt;break}if(!kt)continue}return await kt[1].from_pretrained(A,zt)}if(this.BASE_IF_FAIL)return _p.has(bn)||console.warn(`Unknown model class "${bn}", attempting to construct from base class.`),await te.from_pretrained(A,zt);throw Error(`Unsupported model type: ${bn}`)}}const up=new Map([["bert",["BertModel",Ee]],["neobert",["NeoBertModel",Re]],["modernbert",["ModernBertModel",lt]],["nomic_bert",["NomicBertModel",Zs]],["roformer",["RoFormerModel",$s]],["electra",["ElectraModel",Y]],["esm",["EsmModel",Ea]],["convbert",["ConvBertModel",zr]],["camembert",["CamembertModel",Ct]],["deberta",["DebertaModel",Nn]],["deberta-v2",["DebertaV2Model",Rr]],["mpnet",["MPNetModel",Sa]],["albert",["AlbertModel",gt]],["distilbert",["DistilBertModel",ds]],["roberta",["RobertaModel",ki]],["xlm",["XLMModel",ac]],["xlm-roberta",["XLMRobertaModel",xl]],["clap",["ClapModel",lh]],["clip",["CLIPModel",Oa]],["clipseg",["CLIPSegModel",$a]],["chinese_clip",["ChineseCLIPModel",Nl]],["siglip",["SiglipModel",Fi]],["jina_clip",["JinaCLIPModel",Bi]],["mobilebert",["MobileBertModel",Pn]],["squeezebert",["SqueezeBertModel",de]],["wav2vec2",["Wav2Vec2Model",Vr]],["wav2vec2-bert",["Wav2Vec2BertModel",Nf]],["unispeech",["UniSpeechModel",zf]],["unispeech-sat",["UniSpeechSatModel",Ff]],["hubert",["HubertModel",zs]],["wavlm",["WavLMModel",Vf]],["audio-spectrogram-transformer",["ASTModel",Cl]],["vits",["VitsModel",pa]],["pyannote",["PyAnnoteModel",Ps]],["wespeaker-resnet",["WeSpeakerResNetModel",Yc]],["detr",["DetrModel",rn]],["rt_detr",["RTDetrModel",su]],["rt_detr_v2",["RTDetrV2Model",hs]],["rf_detr",["RFDetrModel",tf]],["d_fine",["DFineModel",Lc]],["table-transformer",["TableTransformerModel",Ic]],["vit",["ViTModel",Ki]],["ijepa",["IJepaModel",Wd]],["pvt",["PvtModel",Jl]],["vit_msn",["ViTMSNModel",wc]],["vit_mae",["ViTMAEModel",Kd]],["groupvit",["GroupViTModel",Xd]],["fastvit",["FastViTModel",Yd]],["mobilevit",["MobileViTModel",za]],["mobilevitv2",["MobileViTV2Model",Tc]],["owlvit",["OwlViTModel",Uo]],["owlv2",["Owlv2Model",Ji]],["beit",["BeitModel",Pc]],["deit",["DeiTModel",ca]],["hiera",["HieraModel",zc]],["convnext",["ConvNextModel",xf]],["convnextv2",["ConvNextV2Model",Gc]],["dinov2",["Dinov2Model",Hc]],["dinov2_with_registers",["Dinov2WithRegistersModel",sh]],["dinov3_vit",["DINOv3ViTModel",qo]],["dinov3_convnext",["DINOv3ConvNextModel",hu]],["resnet",["ResNetModel",sf]],["swin",["SwinModel",af]],["swin2sr",["Swin2SRModel",uf]],["donut-swin",["DonutSwinModel",wf]],["yolos",["YolosModel",$f]],["dpt",["DPTModel",Nc]],["glpn",["GLPNModel",Mf]],["hifigan",["SpeechT5HifiGan",Qf]],["efficientnet",["EfficientNetModel",ld]],["decision_transformer",["DecisionTransformerModel",Ua]],["patchtst",["PatchTSTForPrediction",io]],["patchtsmixer",["PatchTSMixerForPrediction",lo]],["mobilenet_v1",["MobileNetV1Model",Fs]],["mobilenet_v2",["MobileNetV2Model",Jn]],["mobilenet_v3",["MobileNetV3Model",np]],["mobilenet_v4",["MobileNetV4Model",Dr]],["maskformer",["MaskFormerModel",yf]],["mgp-str",["MgpstrForSceneTextRecognition",Hr]],["style_text_to_speech_2",["StyleTextToSpeech2Model",qf]]]),kr=new Map([["t5",["T5Model",An]],["longt5",["LongT5Model",Vn]],["mt5",["MT5Model",Es]],["bart",["BartModel",mn]],["mbart",["MBartModel",ur]],["marian",["MarianModel",_u]],["whisper",["WhisperModel",Sl]],["m2m_100",["M2M100Model",ro]],["blenderbot",["BlenderbotModel",Zn]],["blenderbot-small",["BlenderbotSmallModel",ta]]]),sl=new Map([["mimi",["MimiModel",hh]],["dac",["DacModel",hr]],["snac",["SnacModel",ma]]]),ku=new Map([["bloom",["BloomModel",Ud]],["jais",["JAISModel",jl]],["gpt2",["GPT2Model",Ui]],["gptj",["GPTJModel",y]],["gpt_bigcode",["GPTBigCodeModel",K]],["gpt_neo",["GPTNeoModel",sa]],["gpt_neox",["GPTNeoXModel",Nr]],["codegen",["CodeGenModel",Ue]],["llama",["LlamaModel",Et]],["arcee",["ArceeModel",yn]],["lfm2",["Lfm2Model",ka]],["smollm3",["SmolLM3Model",Ul]],["exaone",["ExaoneModel",aa]],["olmo",["OlmoModel",Wi]],["olmo2",["Olmo2Model",Hl]],["mobilellm",["MobileLLMModel",bi]],["granite",["GraniteModel",Mi]],["cohere",["CohereModel",vi]],["gemma",["GemmaModel",yc]],["gemma2",["Gemma2Model",vn]],["gemma3_text",["Gemma3Model",bc]],["helium",["HeliumModel",Fd]],["glm",["GlmModel",Yp]],["openelm",["OpenELMModel",Nd]],["qwen2",["Qwen2Model",jd]],["qwen3",["Qwen3Model",Ti]],["phi",["PhiModel",vc]],["phi3",["Phi3Model",Ei]],["mpt",["MptModel",Jp]],["opt",["OPTModel",Ro]],["mistral",["MistralModel",Xf]],["ernie4_5",["Ernie4_5_Model",da]],["starcoder2",["Starcoder2Model",Zf]],["falcon",["FalconModel",Eu]],["stablelm",["StableLmModel",od]],["modernbert-decoder",["ModernBertDecoderModel",os]]]),nr=new Map([["speecht5",["SpeechT5ForSpeechToText",Jc]],["whisper",["WhisperForConditionalGeneration",Pl]],["lite-whisper",["LiteWhisperForConditionalGeneration",dc]],["moonshine",["MoonshineForConditionalGeneration",$l]]]),hd=new Map([["speecht5",["SpeechT5ForTextToSpeech",ed]]]),md=new Map([["vits",["VitsModel",pa]],["musicgen",["MusicgenForConditionalGeneration",Au]]]),Lu=new Map([["bert",["BertForSequenceClassification",ke]],["neobert",["NeoBertForSequenceClassification",ut]],["modernbert",["ModernBertForSequenceClassification",nn]],["roformer",["RoFormerForSequenceClassification",Zr]],["electra",["ElectraForSequenceClassification",he]],["esm",["EsmForSequenceClassification",Ze]],["convbert",["ConvBertForSequenceClassification",qt]],["camembert",["CamembertForSequenceClassification",Xt]],["deberta",["DebertaForSequenceClassification",Bn]],["deberta-v2",["DebertaV2ForSequenceClassification",Gs]],["mpnet",["MPNetForSequenceClassification",oi]],["albert",["AlbertForSequenceClassification",yt]],["distilbert",["DistilBertForSequenceClassification",ns]],["roberta",["RobertaForSequenceClassification",nc]],["xlm",["XLMForSequenceClassification",oc]],["xlm-roberta",["XLMRobertaForSequenceClassification",El]],["bart",["BartForSequenceClassification",ks]],["mbart",["MBartForSequenceClassification",vr]],["mobilebert",["MobileBertForSequenceClassification",Mr]],["squeezebert",["SqueezeBertForSequenceClassification",Oe]]]),Iu=new Map([["bert",["BertForTokenClassification",Ke]],["neobert",["NeoBertForTokenClassification",st]],["modernbert",["ModernBertForTokenClassification",un]],["roformer",["RoFormerForTokenClassification",br]],["electra",["ElectraForTokenClassification",Se]],["esm",["EsmForTokenClassification",rt]],["convbert",["ConvBertForTokenClassification",Fr]],["camembert",["CamembertForTokenClassification",Kt]],["deberta",["DebertaForTokenClassification",cs]],["deberta-v2",["DebertaV2ForTokenClassification",Jr]],["mpnet",["MPNetForTokenClassification",Me]],["distilbert",["DistilBertForTokenClassification",gs]],["roberta",["RobertaForTokenClassification",sc]],["xlm",["XLMForTokenClassification",lc]],["xlm-roberta",["XLMRobertaForTokenClassification",cc]]]),_a=new Map([["t5",["T5ForConditionalGeneration",Yn]],["longt5",["LongT5ForConditionalGeneration",On]],["mt5",["MT5ForConditionalGeneration",Cs]],["bart",["BartForConditionalGeneration",ss]],["mbart",["MBartForConditionalGeneration",rs]],["marian",["MarianMTModel",kf]],["m2m_100",["M2M100ForConditionalGeneration",Lf]],["blenderbot",["BlenderbotForConditionalGeneration",Gn]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",li]]]),Rs=new Map([["bloom",["BloomForCausalLM",Zp]],["gpt2",["GPT2LMHeadModel",Ao]],["jais",["JAISLMHeadModel",Or]],["gptj",["GPTJForCausalLM",D]],["gpt_bigcode",["GPTBigCodeForCausalLM",J]],["gpt_neo",["GPTNeoForCausalLM",Vi]],["gpt_neox",["GPTNeoXForCausalLM",ra]],["codegen",["CodeGenForCausalLM",nt]],["llama",["LlamaForCausalLM",Ut]],["arcee",["ArceeForCausalLM",En]],["lfm2",["Lfm2ForCausalLM",mc]],["smollm3",["SmolLM3ForCausalLM",_c]],["exaone",["ExaoneForCausalLM",Rd]],["olmo",["OlmoForCausalLM",Hi]],["olmo2",["Olmo2ForCausalLM",Tr]],["mobilellm",["MobileLLMForCausalLM",gc]],["granite",["GraniteForCausalLM",ia]],["cohere",["CohereForCausalLM",Bd]],["gemma",["GemmaForCausalLM",er]],["gemma2",["Gemma2ForCausalLM",wi]],["gemma3_text",["Gemma3ForCausalLM",xi]],["helium",["HeliumForCausalLM",Vl]],["glm",["GlmForCausalLM",dr]],["openelm",["OpenELMForCausalLM",ko]],["qwen2",["Qwen2ForCausalLM",Lo]],["qwen3",["Qwen3ForCausalLM",oa]],["phi",["PhiForCausalLM",Io]],["phi3",["Phi3ForCausalLM",Qs]],["mpt",["MptForCausalLM",Ss]],["opt",["OPTForCausalLM",Bo]],["mbart",["MBartForCausalLM",_n]],["mistral",["MistralForCausalLM",nd]],["ernie4_5",["Ernie4_5_ForCausalLM",rd]],["starcoder2",["Starcoder2ForCausalLM",fa]],["falcon",["FalconForCausalLM",Zo]],["trocr",["TrOCRForCausalLM",xu]],["stablelm",["StableLmForCausalLM",ep]],["modernbert-decoder",["ModernBertDecoderForCausalLM",Ts]],["phi3_v",["Phi3VForCausalLM",zi]]]),Ai=new Map([["multi_modality",["MultiModalityCausalLM",Va]]]),po=new Map([["bert",["BertForMaskedLM",Ve]],["neobert",["NeoBertForMaskedLM",Tt]],["modernbert",["ModernBertForMaskedLM",bt]],["roformer",["RoFormerForMaskedLM",xa]],["electra",["ElectraForMaskedLM",le]],["esm",["EsmForMaskedLM",Hs]],["convbert",["ConvBertForMaskedLM",xn]],["camembert",["CamembertForMaskedLM",ft]],["deberta",["DebertaForMaskedLM",Tn]],["deberta-v2",["DebertaV2ForMaskedLM",Pr]],["mpnet",["MPNetForMaskedLM",ii]],["albert",["AlbertForMaskedLM",Yt]],["distilbert",["DistilBertForMaskedLM",Ar]],["roberta",["RobertaForMaskedLM",wl]],["xlm",["XLMWithLMHeadModel",ic]],["xlm-roberta",["XLMRobertaForMaskedLM",Tl]],["mobilebert",["MobileBertForMaskedLM",ea]],["squeezebert",["SqueezeBertForMaskedLM",me]]]),ho=new Map([["bert",["BertForQuestionAnswering",et]],["neobert",["NeoBertForQuestionAnswering",mt]],["roformer",["RoFormerForQuestionAnswering",Ta]],["electra",["ElectraForQuestionAnswering",He]],["convbert",["ConvBertForQuestionAnswering",I]],["camembert",["CamembertForQuestionAnswering",qn]],["deberta",["DebertaForQuestionAnswering",js]],["deberta-v2",["DebertaV2ForQuestionAnswering",lr]],["mpnet",["MPNetForQuestionAnswering",z]],["albert",["AlbertForQuestionAnswering",ot]],["distilbert",["DistilBertForQuestionAnswering",Ws]],["roberta",["RobertaForQuestionAnswering",rc]],["xlm",["XLMForQuestionAnswering",uc]],["xlm-roberta",["XLMRobertaForQuestionAnswering",wo]],["mobilebert",["MobileBertForQuestionAnswering",Ca]],["squeezebert",["SqueezeBertForQuestionAnswering",Ge]]]),zu=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Dl]],["idefics3",["Idefics3ForConditionalGeneration",So]],["smolvlm",["SmolVLMForConditionalGeneration",Li]]]),_d=new Map([["llava",["LlavaForConditionalGeneration",Eo]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",Co]],["moondream1",["Moondream1ForConditionalGeneration",ci]],["florence2",["Florence2ForConditionalGeneration",Ll]],["qwen2-vl",["Qwen2VLForConditionalGeneration",la]],["idefics3",["Idefics3ForConditionalGeneration",So]],["smolvlm",["SmolVLMForConditionalGeneration",Li]],["paligemma",["PaliGemmaForConditionalGeneration",zl]],["llava_qwen2",["LlavaQwen2ForCausalLM",di]],["gemma3n",["Gemma3nForConditionalGeneration",Br]]]),cp=new Map([["ultravox",["UltravoxModel",uo]],["voxtral",["VoxtralForConditionalGeneration",op]]]),Fu=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Dl]]]),gd=new Map([["vit",["ViTForImageClassification",Qi]],["ijepa",["IJepaForImageClassification",eh]],["pvt",["PvtForImageClassification",qd]],["vit_msn",["ViTMSNForImageClassification",Qd]],["fastvit",["FastViTForImageClassification",Zd]],["mobilevit",["MobileViTForImageClassification",Fa]],["mobilevitv2",["MobileViTV2ForImageClassification",Ec]],["beit",["BeitForImageClassification",Ac]],["deit",["DeiTForImageClassification",ou]],["hiera",["HieraForImageClassification",nf]],["convnext",["ConvNextForImageClassification",Tf]],["convnextv2",["ConvNextV2ForImageClassification",Cf]],["dinov2",["Dinov2ForImageClassification",Sf]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",rh]],["resnet",["ResNetForImageClassification",rf]],["swin",["SwinForImageClassification",Rc]],["segformer",["SegformerForImageClassification",el]],["efficientnet",["EfficientNetForImageClassification",Pu]],["mobilenet_v1",["MobileNetV1ForImageClassification",dh]],["mobilenet_v2",["MobileNetV2ForImageClassification",or]],["mobilenet_v3",["MobileNetV3ForImageClassification",fh]],["mobilenet_v4",["MobileNetV4ForImageClassification",sp]]]),mr=new Map([["detr",["DetrForObjectDetection",zn]],["rt_detr",["RTDetrForObjectDetection",Go]],["rt_detr_v2",["RTDetrV2ForObjectDetection",Oc]],["rf_detr",["RFDetrForObjectDetection",th]],["d_fine",["DFineForObjectDetection",ir]],["table-transformer",["TableTransformerForObjectDetection",Wo]],["yolos",["YolosForObjectDetection",Df]]]),dp=new Map([["owlvit",["OwlViTForObjectDetection",Jd]],["owlv2",["Owlv2ForObjectDetection",nu]],["grounding-dino",["GroundingDinoForObjectDetection",Of]]]),Vs=new Map([["detr",["DetrForSegmentation",ps]],["clipseg",["CLIPSegForImageSegmentation",Po]]]),fp=new Map([["segformer",["SegformerForSemanticSegmentation",Wr]],["sapiens",["SapiensForSemanticSegmentation",hf]],["swin",["SwinForSemanticSegmentation",of]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",tp]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",ha]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",cd]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",pr]]]),pp=new Map([["detr",["DetrForSegmentation",ps]],["maskformer",["MaskFormerForInstanceSegmentation",bf]]]),mh=new Map([["sam",["SamModel",Qo]]]),Ha=new Map([["wav2vec2",["Wav2Vec2ForCTC",Ba]],["wav2vec2-bert",["Wav2Vec2BertForCTC",jf]],["unispeech",["UniSpeechForCTC",Si]],["unispeech-sat",["UniSpeechSatForCTC",Rf]],["wavlm",["WavLMForCTC",Gf]],["hubert",["HubertForCTC",Us]]]),Ru=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",If]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",ih]],["unispeech",["UniSpeechForSequenceClassification",bu]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Mu]],["wavlm",["WavLMForSequenceClassification",Wf]],["hubert",["HubertForSequenceClassification",Uf]],["audio-spectrogram-transformer",["ASTForAudioClassification",ui]]]),yd=new Map([["wavlm",["WavLMForXVector",vu]]]),mo=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Bf]],["wavlm",["WavLMForAudioFrameClassification",Zc]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Na]],["pyannote",["PyAnnoteForAudioFrameClassification",gu]]]),hp=new Map([["vitmatte",["VitMatteForImageMatting",xc]]]),_h=new Map([["patchtst",["PatchTSTForPrediction",tl]],["patchtsmixer",["PatchTSMixerForPrediction",ap]]]),mp=new Map([["swin2sr",["Swin2SRForImageSuperResolution",cf]]]),bd=new Map([["dpt",["DPTForDepthEstimation",df]],["depth_anything",["DepthAnythingForDepthEstimation",pf]],["glpn",["GLPNForDepthEstimation",Vc]],["sapiens",["SapiensForDepthEstimation",nh]],["depth_pro",["DepthProForDepthEstimation",du]],["metric3d",["Metric3DForDepthEstimation",fu]],["metric3dv2",["Metric3Dv2ForDepthEstimation",gf]]]),Md=new Map([["sapiens",["SapiensForNormalEstimation",mf]]]),gh=new Map([["vitpose",["VitPoseForPoseEstimation",Ci]]]),yh=new Map([["clip",["CLIPVisionModelWithProjection",Rl]],["siglip",["SiglipVisionModel",Ot]],["jina_clip",["JinaCLIPVisionModel",Ni]]]),bh=[[up,O.EncoderOnly],[kr,O.EncoderDecoder],[ku,O.DecoderOnly],[sl,O.AutoEncoder],[Lu,O.EncoderOnly],[Iu,O.EncoderOnly],[_a,O.Seq2Seq],[nr,O.Seq2Seq],[Rs,O.DecoderOnly],[Ai,O.MultiModality],[po,O.EncoderOnly],[ho,O.EncoderOnly],[zu,O.Vision2Seq],[_d,O.ImageTextToText],[cp,O.AudioTextToText],[gd,O.EncoderOnly],[Vs,O.EncoderOnly],[pp,O.EncoderOnly],[fp,O.EncoderOnly],[hp,O.EncoderOnly],[_h,O.EncoderOnly],[mp,O.EncoderOnly],[bd,O.EncoderOnly],[Md,O.EncoderOnly],[gh,O.EncoderOnly],[mr,O.EncoderOnly],[dp,O.EncoderOnly],[mh,O.MaskGeneration],[Ha,O.EncoderOnly],[Ru,O.EncoderOnly],[hd,O.Seq2Seq],[md,O.EncoderOnly],[yd,O.EncoderOnly],[mo,O.EncoderOnly],[yh,O.EncoderOnly]];for(const[P,A]of bh)for(const[Q,_e]of P.values())S.set(Q,A),C.set(_e,Q),$.set(Q,_e);const Mh=[["MusicgenForConditionalGeneration",Au,O.Musicgen],["Phi3VForCausalLM",zi,O.Phi3V],["CLIPTextModelWithProjection",fi,O.EncoderOnly],["SiglipTextModel",hi,O.EncoderOnly],["JinaCLIPTextModel",xr,O.EncoderOnly],["ClapTextModelWithProjection",uh,O.EncoderOnly],["ClapAudioModelWithProjection",Jf,O.EncoderOnly],["DacEncoderModel",Ga,O.EncoderOnly],["DacDecoderModel",fo,O.EncoderOnly],["MimiEncoderModel",$n,O.EncoderOnly],["MimiDecoderModel",Wn,O.EncoderOnly],["SnacEncoderModel",ls,O.EncoderOnly],["SnacDecoderModel",Wa,O.EncoderOnly],["Gemma3nForConditionalGeneration",Br,O.ImageAudioTextToText]];for(const[P,A,Q]of Mh)S.set(P,Q),C.set(A,P),$.set(P,A);const _p=new Map([["modnet",Vs],["birefnet",Vs],["isnet",Vs],["ben",Vs]]);for(const[P,A]of _p.entries())A.set(P,["PreTrainedModel",te]),S.set(P,O.EncoderOnly),C.set(te,P),$.set(P,te);class rl extends cn{static MODEL_CLASS_MAPPINGS=bh.map(A=>A[0]);static BASE_IF_FAIL=!0}class vd extends cn{static MODEL_CLASS_MAPPINGS=[Lu]}class vh extends cn{static MODEL_CLASS_MAPPINGS=[Iu]}class wh extends cn{static MODEL_CLASS_MAPPINGS=[_a]}class xh extends cn{static MODEL_CLASS_MAPPINGS=[nr]}class Th extends cn{static MODEL_CLASS_MAPPINGS=[hd]}class Eh extends cn{static MODEL_CLASS_MAPPINGS=[md]}class Ch extends cn{static MODEL_CLASS_MAPPINGS=[Rs]}class wd extends cn{static MODEL_CLASS_MAPPINGS=[po]}class Sh extends cn{static MODEL_CLASS_MAPPINGS=[ho]}class Ph extends cn{static MODEL_CLASS_MAPPINGS=[zu]}class Hn extends cn{static MODEL_CLASS_MAPPINGS=[gd]}class gp extends cn{static MODEL_CLASS_MAPPINGS=[Vs]}class bm extends cn{static MODEL_CLASS_MAPPINGS=[fp]}class Ah extends cn{static MODEL_CLASS_MAPPINGS=[pp]}class Mm extends cn{static MODEL_CLASS_MAPPINGS=[mr]}class vm extends cn{static MODEL_CLASS_MAPPINGS=[dp]}class wm extends cn{static MODEL_CLASS_MAPPINGS=[mh]}class xd extends cn{static MODEL_CLASS_MAPPINGS=[Ha]}class al extends cn{static MODEL_CLASS_MAPPINGS=[Ru]}class yp extends cn{static MODEL_CLASS_MAPPINGS=[yd]}class Td extends cn{static MODEL_CLASS_MAPPINGS=[mo]}class bp extends cn{static MODEL_CLASS_MAPPINGS=[Fu]}class _o extends cn{static MODEL_CLASS_MAPPINGS=[hp]}class ga extends cn{static MODEL_CLASS_MAPPINGS=[mp]}class Bu extends cn{static MODEL_CLASS_MAPPINGS=[bd]}class xm extends cn{static MODEL_CLASS_MAPPINGS=[Md]}class Oh extends cn{static MODEL_CLASS_MAPPINGS=[gh]}class $h extends cn{static MODEL_CLASS_MAPPINGS=[yh]}class Dh extends cn{static MODEL_CLASS_MAPPINGS=[_d]}class kh extends cn{static MODEL_CLASS_MAPPINGS=[cp]}class Tm extends De{constructor({logits:A,past_key_values:Q,encoder_outputs:_e,decoder_attentions:xe=null,cross_attentions:Ae=null}){super(),this.logits=A,this.past_key_values=Q,this.encoder_outputs=_e,this.decoder_attentions=xe,this.cross_attentions=Ae}}class Vt extends De{constructor({logits:A,...Q}){super(),this.logits=A;const _e=Object.values(Q);_e.length>0&&(this.attentions=_e)}}class Mp extends De{constructor({logits:A,embeddings:Q}){super(),this.logits=A,this.embeddings=Q}}class Ms extends De{constructor({logits:A}){super(),this.logits=A}}class Bs extends De{constructor({logits:A}){super(),this.logits=A}}class Ns extends De{constructor({start_logits:A,end_logits:Q}){super(),this.start_logits=A,this.end_logits=Q}}class qa extends De{constructor({logits:A}){super(),this.logits=A}}class Em extends De{constructor({logits:A,past_key_values:Q}){super(),this.logits=A,this.past_key_values=Q}}class Lh extends De{constructor({alphas:A}){super(),this.alphas=A}}class il extends De{constructor({waveform:A,spectrogram:Q}){super(),this.waveform=A,this.spectrogram=Q}}}),"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":((t,r,n)=>{n.r(r),n.d(r,{ASTFeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var o=n("./src/utils/audio.js");class u extends a.FeatureExtractor{constructor(c){super(c);const f=this.config.sampling_rate,p=(0,o.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(f/2),f,null,"kaldi",!0);this.mel_filters=p,this.window=(0,o.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(c,f){return(0,o.spectrogram)(c,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:f,transpose:!0})}async _call(c){(0,a.validate_audio_inputs)(c,"ASTFeatureExtractor");const f=await this._extract_fbank_features(c,this.config.max_length);if(this.config.do_normalize){const p=this.std*2,g=f.data;for(let _=0;_<g.length;++_)g[_]=(g[_]-this.mean)/p}return{input_values:f.unsqueeze_(0)}}}}),"./src/models/auto/feature_extraction_auto.js":((t,r,n)=>{n.r(r),n.d(r,{AutoFeatureExtractor:()=>d});var a=n("./src/utils/constants.js"),o=n("./src/utils/hub.js");n("./src/base/feature_extraction_utils.js");var u=n("./src/models/feature_extractors.js");class d{static async from_pretrained(f,p={}){const g=await(0,o.getModelJSON)(f,a.FEATURE_EXTRACTOR_NAME,!0,p),_=g.feature_extractor_type,h=u[_];if(!h)throw new Error(`Unknown feature_extractor_type: '${_}'. Please report this at ${a.GITHUB_ISSUE_URL}.`);return new h(g)}}}),"./src/models/auto/image_processing_auto.js":((t,r,n)=>{n.r(r),n.d(r,{AutoImageProcessor:()=>c});var a=n("./src/utils/constants.js"),o=n("./src/utils/hub.js"),u=n("./src/base/image_processors_utils.js"),d=n("./src/models/image_processors.js");class c{static async from_pretrained(p,g={}){const _=await(0,o.getModelJSON)(p,a.IMAGE_PROCESSOR_NAME,!0,g),h=_.image_processor_type??_.feature_extractor_type;let w=d[h?.replace(/Fast$/,"")];return w||(h!==void 0&&console.warn(`Image processor type '${h}' not found, assuming base ImageProcessor. Please report this at ${a.GITHUB_ISSUE_URL}.`),w=u.ImageProcessor),new w(_)}}}),"./src/models/auto/processing_auto.js":((t,r,n)=>{n.r(r),n.d(r,{AutoProcessor:()=>p});var a=n("./src/utils/constants.js"),o=n("./src/utils/hub.js"),u=n("./src/base/processing_utils.js"),d=n("./src/models/processors.js"),c=n("./src/models/image_processors.js"),f=n("./src/models/feature_extractors.js");class p{static async from_pretrained(_,h={}){const w=await(0,o.getModelJSON)(_,a.IMAGE_PROCESSOR_NAME,!0,h),{image_processor_type:M,feature_extractor_type:x,processor_class:F}=w;if(F&&d[F])return d[F].from_pretrained(_,h);if(!M&&!x)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const E={};if(M){const L=c[M.replace(/Fast$/,"")];if(!L)throw new Error(`Unknown image_processor_type: '${M}'.`);E.image_processor=new L(w)}if(x){const L=c[x];if(L)E.image_processor=new L(w);else{const O=f[x];if(!O)throw new Error(`Unknown feature_extractor_type: '${x}'.`);E.feature_extractor=new O(w)}}const T={};return new u.Processor(T,E,null)}}}),"./src/models/beit/image_processing_beit.js":((t,r,n)=>{n.r(r),n.d(r,{BeitFeatureExtractor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/bit/image_processing_bit.js":((t,r,n)=>{n.r(r),n.d(r,{BitImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/chinese_clip/image_processing_chinese_clip.js":((t,r,n)=>{n.r(r),n.d(r,{ChineseCLIPFeatureExtractor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/clap/feature_extraction_clap.js":((t,r,n)=>{n.r(r),n.d(r,{ClapFeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var o=n("./src/utils/audio.js");class u extends a.FeatureExtractor{constructor(c){super(c),this.mel_filters=(0,o.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,o.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,o.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(c,f,p,g){let _;const h=c.length-f;if(h>0)if(p==="rand_trunc"){const w=Math.floor(Math.random()*(h+1));c=c.subarray(w,w+f),_=await this._extract_fbank_features(c,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${p}" not implemented`);else{if(h<0){let w=new Float64Array(f);if(w.set(c),g==="repeat")for(let M=c.length;M<f;M+=c.length)w.set(c.subarray(0,Math.min(c.length,f-M)),M);else if(g==="repeatpad")for(let M=c.length;M<-h;M+=c.length)w.set(c,M);c=w}if(p==="fusion")throw new Error(`Truncation strategy "${p}" not implemented`);_=await this._extract_fbank_features(c,this.mel_filters_slaney,this.config.nb_max_samples)}return _.unsqueeze_(0)}async _extract_fbank_features(c,f,p=null){return(0,o.spectrogram)(c,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:f,log_mel:"dB",max_num_frames:p,do_pad:!1,transpose:!0})}async _call(c,{max_length:f=null}={}){return(0,a.validate_audio_inputs)(c,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(c,f??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}}),"./src/models/clip/image_processing_clip.js":((t,r,n)=>{n.r(r),n.d(r,{CLIPFeatureExtractor:()=>u,CLIPImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/convnext/image_processing_convnext.js":((t,r,n)=>{n.r(r),n.d(r,{ConvNextFeatureExtractor:()=>u,ConvNextImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{constructor(c){super(c),this.crop_pct=this.config.crop_pct??224/256}async resize(c){const f=this.size?.shortest_edge;if(f===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(f<384){const p=Math.floor(f/this.crop_pct),[g,_]=this.get_resize_output_image_size(c,{shortest_edge:p});c=await c.resize(g,_,{resample:this.resample}),c=await c.center_crop(f,f)}else c=await c.resize(f,f,{resample:this.resample});return c}}class u extends o{}}),"./src/models/dac/feature_extraction_dac.js":((t,r,n)=>{n.r(r),n.d(r,{DacFeatureExtractor:()=>o});var a=n("./src/models/encodec/feature_extraction_encodec.js");class o extends a.EncodecFeatureExtractor{}}),"./src/models/deit/image_processing_deit.js":((t,r,n)=>{n.r(r),n.d(r,{DeiTFeatureExtractor:()=>u,DeiTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/detr/image_processing_detr.js":((t,r,n)=>{n.r(r),n.d(r,{DetrFeatureExtractor:()=>d,DetrImageProcessor:()=>u});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");class u extends a.ImageProcessor{async _call(f){const p=await super._call(f),g=[p.pixel_values.dims[0],64,64],_=(0,o.full)(g,1n);return{...p,pixel_mask:_}}post_process_object_detection(...f){return(0,a.post_process_object_detection)(...f)}post_process_panoptic_segmentation(...f){return(0,a.post_process_panoptic_segmentation)(...f)}post_process_instance_segmentation(...f){return(0,a.post_process_instance_segmentation)(...f)}}class d extends u{}}),"./src/models/dinov3_vit/image_processing_dinov3_vit.js":((t,r,n)=>{n.r(r),n.d(r,{DINOv3ViTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/donut/image_processing_donut.js":((t,r,n)=>{n.r(r),n.d(r,{DonutFeatureExtractor:()=>u,DonutImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{pad_image(c,f,p,g={}){const[_,h,w]=f;let M=this.image_mean;Array.isArray(this.image_mean)||(M=new Array(w).fill(M));let x=this.image_std;Array.isArray(x)||(x=new Array(w).fill(M));const F=M.map((E,T)=>-E/x[T]);return super.pad_image(c,f,p,{center:!0,constant_values:F,...g})}}class u extends o{}}),"./src/models/dpt/image_processing_dpt.js":((t,r,n)=>{n.r(r),n.d(r,{DPTFeatureExtractor:()=>u,DPTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/efficientnet/image_processing_efficientnet.js":((t,r,n)=>{n.r(r),n.d(r,{EfficientNetImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{constructor(d){super(d),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(c=>c*c))}}}),"./src/models/encodec/feature_extraction_encodec.js":((t,r,n)=>{n.r(r),n.d(r,{EncodecFeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js");class u extends a.FeatureExtractor{async _call(c){(0,a.validate_audio_inputs)(c,"EncodecFeatureExtractor"),c instanceof Float64Array&&(c=new Float32Array(c));const f=this.config.feature_size;if(c.length%f!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${f}).`);const p=[1,f,c.length/f];return{input_values:new o.Tensor("float32",c,p)}}}}),"./src/models/feature_extractors.js":((t,r,n)=>{n.r(r),n.d(r,{ASTFeatureExtractor:()=>a.ASTFeatureExtractor,ClapFeatureExtractor:()=>u.ClapFeatureExtractor,DacFeatureExtractor:()=>d.DacFeatureExtractor,EncodecFeatureExtractor:()=>o.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>c.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>F.ImageProcessor,MoonshineFeatureExtractor:()=>f.MoonshineFeatureExtractor,PyAnnoteFeatureExtractor:()=>p.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>g.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>_.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>h.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>w.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>M.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>x.WhisperFeatureExtractor});var a=n("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),o=n("./src/models/encodec/feature_extraction_encodec.js"),u=n("./src/models/clap/feature_extraction_clap.js"),d=n("./src/models/dac/feature_extraction_dac.js"),c=n("./src/models/gemma3n/feature_extraction_gemma3n.js"),f=n("./src/models/moonshine/feature_extraction_moonshine.js"),p=n("./src/models/pyannote/feature_extraction_pyannote.js"),g=n("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),_=n("./src/models/snac/feature_extraction_snac.js"),h=n("./src/models/speecht5/feature_extraction_speecht5.js"),w=n("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),M=n("./src/models/wespeaker/feature_extraction_wespeaker.js"),x=n("./src/models/whisper/feature_extraction_whisper.js"),F=n("./src/base/image_processors_utils.js")}),"./src/models/florence2/processing_florence2.js":((t,r,n)=>{n.r(r),n.d(r,{Florence2Processor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");class d extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;constructor(f,p,g){super(f,p,g);const{tasks_answer_post_processing_type:_,task_prompts_without_inputs:h,task_prompts_with_input:w}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(_??{})),this.task_prompts_without_inputs=new Map(Object.entries(h??{})),this.task_prompts_with_input=new Map(Object.entries(w??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(f){typeof f=="string"&&(f=[f]);const p=[];for(const g of f)if(this.task_prompts_without_inputs.has(g))p.push(this.task_prompts_without_inputs.get(g));else{for(const[_,h]of this.task_prompts_with_input)if(g.includes(_)){p.push(h.replaceAll("{input}",g).replaceAll(_,""));break}p.length!==f.length&&p.push(g)}return p}post_process_generation(f,p,g){const _=this.tasks_answer_post_processing_type.get(p)??"pure_text";f=f.replaceAll("<s>","").replaceAll("</s>","");let h;switch(_){case"pure_text":h=f;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const w=_==="ocr"?"quad_boxes":"bboxes",M=f.matchAll(this.regexes[w]),x=[],F=[];for(const[E,T,...L]of M)x.push(T?T.trim():x.at(-1)??""),F.push(L.map((O,S)=>(Number(O)+.5)/this.size_per_bin*g[S%2]));h={labels:x,[w]:F};break;default:throw new Error(`Task "${p}" (of type "${_}") not yet implemented.`)}return{[p]:h}}async _call(f,p=null,g={}){if(!f&&!p)throw new Error("Either text or images must be provided");const _=await this.image_processor(f,g),h=p?this.tokenizer(this.construct_prompts(p),g):{};return{..._,...h}}}}),"./src/models/gemma3n/feature_extraction_gemma3n.js":((t,r,n)=>{n.r(r),n.d(r,{Gemma3nAudioFeatureExtractor:()=>d});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js"),u=n("./src/utils/audio.js");class d extends a.FeatureExtractor{constructor(f){super(f);const{fft_length:p,feature_size:g,min_frequency:_,max_frequency:h,sampling_rate:w,frame_length:M}=this.config,x=(0,u.mel_filter_bank)(Math.floor(1+p/2),g,_,h,w,null,"htk",!1);this.mel_filters=x,this.window=(0,u.window_function)(M,"hann")}async _extract_fbank_features(f,p){return(0,u.spectrogram)(f,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(f,{max_length:p=48e4,truncation:g=!0,padding:_=!0,pad_to_multiple_of:h=128}={}){if((0,a.validate_audio_inputs)(f,"Gemma3nAudioFeatureExtractor"),g&&f.length>p&&(f=f.slice(0,p)),_&&f.length%h!==0){const x=h-f.length%h,F=new Float64Array(f.length+x);F.set(f),this.config.padding_value!==0&&F.fill(this.config.padding_value,f.length),f=F}const w=await this._extract_fbank_features(f,this.config.max_length),M=(0,o.full)([1,w.dims[0]],!0);return{input_features:w.unsqueeze_(0),input_features_mask:M}}}}),"./src/models/gemma3n/processing_gemma3n.js":((t,r,n)=>{n.r(r),n.d(r,{Gemma3nProcessor:()=>c});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/models/auto/feature_extraction_auto.js"),d=n("./src/tokenizers.js");n("./src/utils/image.js"),n("./src/utils/audio.js");class c extends a.Processor{static image_processor_class=o.AutoImageProcessor;static feature_extractor_class=u.AutoFeatureExtractor;static tokenizer_class=d.AutoTokenizer;static uses_processor_config=!0;static uses_chat_template_file=!0;constructor(p,g,_){super(p,g,_),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:h,boa_token:w,audio_token:M,eoa_token:x,image_token_id:F,boi_token:E,image_token:T,eoi_token:L}=this.tokenizer.config;this.audio_token_id=h,this.boa_token=w,this.audio_token=M;const O=M.repeat(this.audio_seq_length);this.full_audio_sequence=`

${w}${O}${x}

`,this.image_token_id=F,this.boi_token=E,this.image_token=T;const S=T.repeat(this.image_seq_length);this.full_image_sequence=`

${E}${S}${L}

`}async _call(p,g=null,_=null,h={}){typeof p=="string"&&(p=[p]);let w;_&&(w=await this.feature_extractor(_,h),p=p.map(F=>F.replaceAll(this.audio_token,this.full_audio_sequence)));let M;return g&&(M=await this.image_processor(g,h),p=p.map(F=>F.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(p,h),...M,...w}}}}),"./src/models/glpn/image_processing_glpn.js":((t,r,n)=>{n.r(r),n.d(r,{GLPNFeatureExtractor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/grounding_dino/image_processing_grounding_dino.js":((t,r,n)=>{n.r(r),n.d(r,{GroundingDinoImageProcessor:()=>u});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");class u extends a.ImageProcessor{async _call(c){const f=await super._call(c),p=f.pixel_values.dims,g=(0,o.ones)([p[0],p[2],p[3]]);return{...f,pixel_mask:g}}}}),"./src/models/grounding_dino/processing_grounding_dino.js":((t,r,n)=>{n.r(r),n.d(r,{GroundingDinoProcessor:()=>f});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js"),d=n("./src/base/image_processors_utils.js");function c(p,g){const h=p.dims.at(-1)-1,w=p.tolist();w.fill(!1,0,1),w.fill(!1,h);const M=g.tolist();return w.map((x,F)=>x?F:null).filter(x=>x!==null).map(x=>M[x])}class f extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;async _call(g,_,h={}){const w=g?await this.image_processor(g,h):{};return{..._?this.tokenizer(_,h):{},...w}}post_process_grounded_object_detection(g,_,{box_threshold:h=.25,text_threshold:w=.25,target_sizes:M=null}={}){const{logits:x,pred_boxes:F}=g,E=x.dims[0];if(M!==null&&M.length!==E)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const T=x.dims.at(1),L=x.sigmoid(),O=L.max(-1).tolist(),S=F.tolist().map(C=>C.map(k=>(0,d.center_to_corners_format)(k))),$=[];for(let C=0;C<E;++C){const k=M!==null?M[C]:null;k!==null&&(S[C]=S[C].map(W=>W.map((ce,ae)=>ce*k[(ae+1)%2])));const U=O[C],V=[],re=[],ne=[];for(let W=0;W<T;++W){const ce=U[W];if(ce<=h)continue;const ae=S[C][W],H=L[C][W];V.push(ce),ne.push(ae);const se=c(H.gt(w),_[C]);re.push(se)}$.push({scores:V,boxes:ne,labels:this.batch_decode(re)})}return $}}}),"./src/models/idefics3/image_processing_idefics3.js":((t,r,n)=>{n.r(r),n.d(r,{Idefics3ImageProcessor:()=>u});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");class u extends a.ImageProcessor{constructor(c){super(c),this.do_image_splitting=c.do_image_splitting??!0,this.max_image_size=c.max_image_size}get_resize_for_vision_encoder(c,f){let[p,g]=c.dims.slice(-2);const _=g/p;return g>=p?(g=Math.ceil(g/f)*f,p=Math.floor(g/_),p=Math.ceil(p/f)*f):(p=Math.ceil(p/f)*f,g=Math.floor(p*_),g=Math.ceil(g/f)*f),{height:p,width:g}}async _call(c,{do_image_splitting:f=null,return_row_col_info:p=!1}={}){let g;if(!Array.isArray(c))g=[[c]];else{if(c.length===0||!c[0])throw new Error("No images provided.");Array.isArray(c[0])?g=c:g=[c]}let _=[],h=[],w=[];const M=[],x=[];for(const C of g){let k=await Promise.all(C.map(re=>this.preprocess(re)));M.push(...k.map(re=>re.original_size)),x.push(...k.map(re=>re.reshaped_input_size)),k.forEach(re=>re.pixel_values.unsqueeze_(0));const{longest_edge:U}=this.max_image_size;let V;if(f??this.do_image_splitting){let re=new Array(k.length),ne=new Array(k.length);V=await Promise.all(k.map(async(W,ce)=>{const ae=this.get_resize_for_vision_encoder(W.pixel_values,U),H=await(0,o.interpolate_4d)(W.pixel_values,{size:[ae.height,ae.width]}),{frames:se,num_splits_h:ie,num_splits_w:ge}=await this.split_image(H,this.max_image_size);return re[ce]=ie,ne[ce]=ge,(0,o.cat)(se,0)})),h.push(re),w.push(ne)}else{const re=[U,U];V=await Promise.all(k.map(ne=>(0,o.interpolate_4d)(ne.pixel_values,{size:re}))),h.push(new Array(k.length).fill(0)),w.push(new Array(k.length).fill(0))}_.push((0,o.cat)(V,0))}const F=_.length,[E,T,L,O]=_[0].dims;let S,$;if(F===1)S=_[0].unsqueeze_(0),$=(0,o.full)([F,E,L,O],!0);else{const C=Math.max(..._.map(V=>V.dims.at(0)));$=(0,o.full)([F,C,L,O],!0);const k=$.data,U=C*L*O;for(let V=0;V<F;++V){const re=_[V].dims[0];if(re<C){_[V]=(0,o.cat)([_[V],(0,o.full)([C-re,T,L,O],0)],0);const ne=V*U+re*L*O,W=(V+1)*U;k.fill(!1,ne,W)}}S=(0,o.stack)(_,0)}return{pixel_values:S,pixel_attention_mask:$,original_sizes:M,reshaped_input_sizes:x,...p?{rows:h,cols:w}:{}}}async split_image(c,{longest_edge:f}){const p=f,g=f,_=[],[h,w]=c.dims.slice(-2);let M=0,x=0;if(h>p||w>g){M=Math.ceil(h/p),x=Math.ceil(w/g);const F=Math.ceil(h/M),E=Math.ceil(w/x);for(let O=0;O<M;++O)for(let S=0;S<x;++S){let $,C,k,U;O===M-1?(C=h-F,U=h):(C=O*F,U=(O+1)*F),S===x-1?($=w-E,k=w):($=S*E,k=(S+1)*E);const V=[C,$],re=[U,k],ne=await(0,o.slice)(c,V,re,[2,3]);_.push(ne)}const T=p,L=g;(h!==T||w!==L)&&(c=await(0,o.interpolate_4d)(c,{size:[T,L]}))}return _.push(c),{frames:_,num_splits_h:M,num_splits_w:x}}}}),"./src/models/idefics3/processing_idefics3.js":((t,r,n)=>{n.r(r),n.d(r,{Idefics3Processor:()=>g});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");n("./src/utils/image.js");var d=n("./src/utils/core.js");function c(_,h,w,M,x,F){let E="";for(let T=0;T<h;++T){for(let L=0;L<w;++L)E+=M+`<row_${T+1}_col_${L+1}>`+x.repeat(_);E+=`
`}return E+=`
${M}${F}`+x.repeat(_)+`${M}`,E}function f(_,h,w,M){return`${h}${M}`+w.repeat(_)+`${h}`}function p(_,h,w,M,x,F){return _===0&&h===0?f(w,M,x,F):c(w,_,h,M,x,F)}class g extends a.Processor{static image_processor_class=o.AutoImageProcessor;static tokenizer_class=u.AutoTokenizer;static uses_processor_config=!0;fake_image_token="<fake_token_around_image>";image_token="<image>";global_img_token="<global-img>";async _call(h,w=null,M={}){M.return_row_col_info??=!0;let x;w&&(x=await this.image_processor(w,M)),Array.isArray(h)||(h=[h]);const F=x.rows??[new Array(h.length).fill(0)],E=x.cols??[new Array(h.length).fill(0)],T=this.config.image_seq_len,L=[],O=[];for(let $=0;$<h.length;++$){const C=h[$],k=F[$],U=E[$];L.push((0,d.count)(C,this.image_token));const V=k.map((W,ce)=>p(W,U[ce],T,this.fake_image_token,this.image_token,this.global_img_token)),re=C.split(this.image_token);if(re.length===0)throw new Error("The image token should be present in the text.");let ne=re[0];for(let W=0;W<V.length;++W)ne+=V[W]+re[W+1];O.push(ne)}return{...this.tokenizer(O),...x}}}}),"./src/models/image_processors.js":((t,r,n)=>{n.r(r),n.d(r,{BeitFeatureExtractor:()=>a.BeitFeatureExtractor,BitImageProcessor:()=>o.BitImageProcessor,CLIPFeatureExtractor:()=>d.CLIPFeatureExtractor,CLIPImageProcessor:()=>d.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>u.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>c.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>c.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>g.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>h.DPTFeatureExtractor,DPTImageProcessor:()=>h.DPTImageProcessor,DeiTFeatureExtractor:()=>f.DeiTFeatureExtractor,DeiTImageProcessor:()=>f.DeiTImageProcessor,DetrFeatureExtractor:()=>p.DetrFeatureExtractor,DetrImageProcessor:()=>p.DetrImageProcessor,DonutFeatureExtractor:()=>_.DonutFeatureExtractor,DonutImageProcessor:()=>_.DonutImageProcessor,EfficientNetImageProcessor:()=>w.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>M.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>x.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>F.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>T.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>L.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>O.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>S.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>S.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>$.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>$.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>C.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>C.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>k.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>k.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>U.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>U.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>V.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>V.MobileViTImageProcessor,NougatImageProcessor:()=>re.NougatImageProcessor,OwlViTFeatureExtractor:()=>W.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>W.OwlViTImageProcessor,Owlv2ImageProcessor:()=>ne.Owlv2ImageProcessor,Phi3VImageProcessor:()=>ce.Phi3VImageProcessor,PvtImageProcessor:()=>ae.PvtImageProcessor,Qwen2VLImageProcessor:()=>H.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>se.RTDetrImageProcessor,SamImageProcessor:()=>ie.SamImageProcessor,SegformerFeatureExtractor:()=>ge.SegformerFeatureExtractor,SegformerImageProcessor:()=>ge.SegformerImageProcessor,SiglipImageProcessor:()=>q.SiglipImageProcessor,SmolVLMImageProcessor:()=>j.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>R.Swin2SRImageProcessor,VLMImageProcessor:()=>E.VLMImageProcessor,ViTFeatureExtractor:()=>X.ViTFeatureExtractor,ViTImageProcessor:()=>X.ViTImageProcessor,VitMatteImageProcessor:()=>G.VitMatteImageProcessor,VitPoseImageProcessor:()=>pe.VitPoseImageProcessor,YolosFeatureExtractor:()=>Te.YolosFeatureExtractor,YolosImageProcessor:()=>Te.YolosImageProcessor});var a=n("./src/models/beit/image_processing_beit.js"),o=n("./src/models/bit/image_processing_bit.js"),u=n("./src/models/chinese_clip/image_processing_chinese_clip.js"),d=n("./src/models/clip/image_processing_clip.js"),c=n("./src/models/convnext/image_processing_convnext.js"),f=n("./src/models/deit/image_processing_deit.js"),p=n("./src/models/detr/image_processing_detr.js"),g=n("./src/models/dinov3_vit/image_processing_dinov3_vit.js"),_=n("./src/models/donut/image_processing_donut.js"),h=n("./src/models/dpt/image_processing_dpt.js"),w=n("./src/models/efficientnet/image_processing_efficientnet.js"),M=n("./src/models/glpn/image_processing_glpn.js"),x=n("./src/models/grounding_dino/image_processing_grounding_dino.js"),F=n("./src/models/idefics3/image_processing_idefics3.js"),E=n("./src/models/janus/image_processing_janus.js"),T=n("./src/models/jina_clip/image_processing_jina_clip.js"),L=n("./src/models/llava_onevision/image_processing_llava_onevision.js"),O=n("./src/models/mask2former/image_processing_mask2former.js"),S=n("./src/models/maskformer/image_processing_maskformer.js"),$=n("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),C=n("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),k=n("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),U=n("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),V=n("./src/models/mobilevit/image_processing_mobilevit.js"),re=n("./src/models/nougat/image_processing_nougat.js"),ne=n("./src/models/owlv2/image_processing_owlv2.js"),W=n("./src/models/owlvit/image_processing_owlvit.js"),ce=n("./src/models/phi3_v/image_processing_phi3_v.js"),ae=n("./src/models/pvt/image_processing_pvt.js"),H=n("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),se=n("./src/models/rt_detr/image_processing_rt_detr.js"),ie=n("./src/models/sam/image_processing_sam.js"),ge=n("./src/models/segformer/image_processing_segformer.js"),q=n("./src/models/siglip/image_processing_siglip.js"),j=n("./src/models/smolvlm/image_processing_smolvlm.js"),R=n("./src/models/swin2sr/image_processing_swin2sr.js"),X=n("./src/models/vit/image_processing_vit.js"),G=n("./src/models/vitmatte/image_processing_vitmatte.js"),pe=n("./src/models/vitpose/image_processing_vitpose.js"),Te=n("./src/models/yolos/image_processing_yolos.js")}),"./src/models/janus/image_processing_janus.js":((t,r,n)=>{n.r(r),n.d(r,{VLMImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{constructor(d){super({do_pad:!0,pad_size:{width:d.image_size,height:d.image_size},...d}),this.constant_values=this.config.background_color.map(c=>c*this.rescale_factor)}pad_image(d,c,f,p){return super.pad_image(d,c,f,{constant_values:this.constant_values,center:!0,...p})}}}),"./src/models/janus/processing_janus.js":((t,r,n)=>{n.r(r),n.d(r,{VLChatProcessor:()=>p});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js"),d=n("./src/utils/core.js"),c=n("./src/utils/tensor.js"),f=n("./src/utils/image.js");class p extends a.Processor{static image_processor_class=o.AutoImageProcessor;static tokenizer_class=u.AutoTokenizer;static uses_processor_config=!0;constructor(_,h,w){super(_,h,w),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(_,{images:h=null,chat_template:w="default"}={}){h?Array.isArray(h)||(h=[h]):h=await Promise.all(_.filter(V=>V.images).flatMap(V=>V.images).map(V=>f.RawImage.read(V)));const M=this.tokenizer,x=M.apply_chat_template(_,{tokenize:!1,add_generation_prompt:!0,chat_template:w}),F=V=>M.encode(V,{add_special_tokens:!1}),E=x.split(this.image_tag),T=E.length-1;if(h.length!==T)throw new Error(`Number of images provided (${h.length}) does not match number of "${this.image_tag}" image tags (${T})`);const[L,O,S]=M.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let $=F(E[0]),C=new Array($.length).fill(!1);for(let V=1;V<E.length;++V){const re=new Array(this.num_image_tokens).fill(L),ne=F(E[V]);$=(0,d.mergeArrays)($,[O],re,[S],ne);const W=new Array(this.num_image_tokens).fill(!0);C=(0,d.mergeArrays)(C,[!1],W,[!1],new Array(ne.length).fill(!1))}const k=[1,$.length],U={input_ids:new c.Tensor("int64",$,k),attention_mask:new c.Tensor("int64",new Array($.length).fill(1),k),images_seq_mask:new c.Tensor("bool",C,k),images_emb_mask:new c.Tensor("bool",new Array(T*this.num_image_tokens).fill(!0),[1,T,this.num_image_tokens])};if(h&&h.length>0){const V=await this.image_processor(h);return V.pixel_values.unsqueeze_(0),{...U,...V}}return U}}}),"./src/models/jina_clip/image_processing_jina_clip.js":((t,r,n)=>{n.r(r),n.d(r,{JinaCLIPImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{constructor(d){const{resize_mode:c,fill_color:f,interpolation:p,size:g,..._}=d,h=c==="squash"?{width:g,height:g}:c==="shortest"?{shortest_edge:g}:{longest_edge:g},w=p==="bicubic"?3:2;super({..._,size:h,resample:w,do_center_crop:!0,crop_size:g,do_normalize:!0})}}}),"./src/models/jina_clip/processing_jina_clip.js":((t,r,n)=>{n.r(r),n.d(r,{JinaCLIPProcessor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");class d extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;async _call(f=null,p=null,g={}){if(!f&&!p)throw new Error("Either text or images must be provided");const _=f?this.tokenizer(f,g):{},h=p?await this.image_processor(p,g):{};return{..._,...h}}}}),"./src/models/llava/processing_llava.js":((t,r,n)=>{n.r(r),n.d(r,{LlavaProcessor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");class d extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;static uses_processor_config=!0;async _call(f,p=null,g={}){const _=await this.image_processor(f,g);if(p){const[w,M]=_.pixel_values.dims.slice(-2),{image_token:x,patch_size:F,num_additional_image_tokens:E}=this.config,T=Math.floor(w/F)*Math.floor(M/F)+E;p=structuredClone(p),Array.isArray(p)||(p=[p]);for(let L=0;L<p.length;++L)p[L]=p[L].replace(x,x.repeat(T))}const h=p?this.tokenizer(p,g):{};return{..._,...h}}}}),"./src/models/llava_onevision/image_processing_llava_onevision.js":((t,r,n)=>{n.r(r),n.d(r,{LlavaOnevisionImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/mask2former/image_processing_mask2former.js":((t,r,n)=>{n.r(r),n.d(r,{Mask2FormerImageProcessor:()=>o});var a=n("./src/models/maskformer/image_processing_maskformer.js");class o extends a.MaskFormerImageProcessor{}}),"./src/models/maskformer/image_processing_maskformer.js":((t,r,n)=>{n.r(r),n.d(r,{MaskFormerFeatureExtractor:()=>u,MaskFormerImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_panoptic_segmentation(...c){return(0,a.post_process_panoptic_segmentation)(...c)}post_process_instance_segmentation(...c){return(0,a.post_process_instance_segmentation)(...c)}}class u extends o{}}),"./src/models/mgp_str/processing_mgp_str.js":((t,r,n)=>{n.r(r),n.d(r,{MgpstrProcessor:()=>f});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js"),d=n("./src/utils/maths.js");const c={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class f extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(g,_){if(!c.hasOwnProperty(_))throw new Error(`Format ${_} is not supported.`);const[h,w]=c[_],M=this[h].bind(this),[x,F]=g.dims,E=[],T=[],L=g.tolist();for(let S=0;S<x;++S){const $=L[S],C=[],k=[];for(let V=1;V<F;++V){const[re,ne]=(0,d.max)((0,d.softmax)($[V]));if(k.push(re),ne==w)break;C.push(ne)}const U=k.length>0?k.reduce((V,re)=>V*re,1):0;T.push(C),E.push(U)}return[M(T),E]}char_decode(g){return this.char_tokenizer.batch_decode(g).map(_=>_.replaceAll(" ",""))}bpe_decode(g){return this.bpe_tokenizer.batch_decode(g)}wp_decode(g){return this.wp_tokenizer.batch_decode(g).map(_=>_.replaceAll(" ",""))}batch_decode([g,_,h]){const[w,M]=this._decode_helper(g,"char"),[x,F]=this._decode_helper(_,"bpe"),[E,T]=this._decode_helper(h,"wp"),L=[],O=[];for(let S=0;S<w.length;++S){const[$,C]=(0,d.max)([M[S],F[S],T[S]]);L.push([w[S],x[S],E[S]][C]),O.push($)}return{generated_text:L,scores:O,char_preds:w,bpe_preds:x,wp_preds:E}}static async from_pretrained(...g){const _=await super.from_pretrained(...g),h=await u.AutoTokenizer.from_pretrained("Xenova/gpt2"),w=await u.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return _.components={image_processor:_.image_processor,char_tokenizer:_.tokenizer,bpe_tokenizer:h,wp_tokenizer:w},_}async _call(g,_=null){const h=await this.image_processor(g);return _&&(h.labels=this.tokenizer(_).input_ids),h}}}),"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":((t,r,n)=>{n.r(r),n.d(r,{MobileNetV1FeatureExtractor:()=>u,MobileNetV1ImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":((t,r,n)=>{n.r(r),n.d(r,{MobileNetV2FeatureExtractor:()=>u,MobileNetV2ImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":((t,r,n)=>{n.r(r),n.d(r,{MobileNetV3FeatureExtractor:()=>u,MobileNetV3ImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":((t,r,n)=>{n.r(r),n.d(r,{MobileNetV4FeatureExtractor:()=>u,MobileNetV4ImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/mobilevit/image_processing_mobilevit.js":((t,r,n)=>{n.r(r),n.d(r,{MobileViTFeatureExtractor:()=>u,MobileViTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/moonshine/feature_extraction_moonshine.js":((t,r,n)=>{n.r(r),n.d(r,{MoonshineFeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js");class u extends a.FeatureExtractor{async _call(c){(0,a.validate_audio_inputs)(c,"MoonshineFeatureExtractor"),c instanceof Float64Array&&(c=new Float32Array(c));const f=[1,c.length];return{input_values:new o.Tensor("float32",c,f)}}}}),"./src/models/moonshine/processing_moonshine.js":((t,r,n)=>{n.r(r),n.d(r,{MoonshineProcessor:()=>d});var a=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/tokenizers.js"),u=n("./src/base/processing_utils.js");class d extends u.Processor{static tokenizer_class=o.AutoTokenizer;static feature_extractor_class=a.AutoFeatureExtractor;async _call(f){return await this.feature_extractor(f)}}}),"./src/models/nougat/image_processing_nougat.js":((t,r,n)=>{n.r(r),n.d(r,{NougatImageProcessor:()=>o});var a=n("./src/models/donut/image_processing_donut.js");class o extends a.DonutImageProcessor{}}),"./src/models/owlv2/image_processing_owlv2.js":((t,r,n)=>{n.r(r),n.d(r,{Owlv2ImageProcessor:()=>o});var a=n("./src/models/owlvit/image_processing_owlvit.js");class o extends a.OwlViTImageProcessor{}}),"./src/models/owlvit/image_processing_owlvit.js":((t,r,n)=>{n.r(r),n.d(r,{OwlViTFeatureExtractor:()=>u,OwlViTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_object_detection(...c){return(0,a.post_process_object_detection)(...c)}}class u extends o{}}),"./src/models/owlvit/processing_owlvit.js":((t,r,n)=>{n.r(r),n.d(r,{OwlViTProcessor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");class d extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor}}),"./src/models/paligemma/processing_paligemma.js":((t,r,n)=>{n.r(r),n.d(r,{PaliGemmaProcessor:()=>f});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");const d="<image>";function c(p,g,_,h,w){return`${h.repeat(_*w)}${g}${p}
`}class f extends a.Processor{static tokenizer_class=u.AutoTokenizer;static image_processor_class=o.AutoImageProcessor;static uses_processor_config=!1;async _call(g,_=null,h={}){_||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),_=""),Array.isArray(g)||(g=[g]),Array.isArray(_)||(_=[_]);const w=this.tokenizer.bos_token,M=this.image_processor.config.image_seq_length;let x;_.some(T=>T.includes(d))?x=_.map(T=>{const L=T.replaceAll(d,d.repeat(M)),O=L.lastIndexOf(d),S=O===-1?0:O+d.length;return L.slice(0,S)+w+L.slice(S)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),x=_.map(T=>c(T,w,M,d,g.length)));const F=this.tokenizer(x,h);return{...await this.image_processor(g,h),...F}}}}),"./src/models/phi3_v/image_processing_phi3_v.js":((t,r,n)=>{n.r(r),n.d(r,{Phi3VImageProcessor:()=>g});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");const u=336,d=[2,3],{ceil:c,floor:f,sqrt:p}=Math;class g extends a.ImageProcessor{constructor(h){super({...h,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=h.num_crops}calc_num_image_tokens_from_image_size(h,w){const{num_img_tokens:M}=this.config;return f((f(w/u)*f(h/u)+1)*M+1+(f(w/u)+1)*p(M))}get_resize_output_image_size(h,w){const M=this._num_crops,[x,F]=h.size;let E=x/F,T=1;for(;T*Math.ceil(T/E)<=M;)T+=1;T-=1;const L=Math.floor(T*336),O=Math.floor(L/E);return[L,O]}pad_image(h,w,M,x={}){const[F,E]=w,T=u*c(F/u),L=u*c(E/u),O=[1,1,1].map((S,$)=>(S-this.image_mean[$])/this.image_std[$]);return super.pad_image(h,w,{width:L,height:T},{center:!0,constant_values:O,...x})}async _call(h,{num_crops:w=null}={}){if(this._num_crops=w??=this.config.num_crops,w<4||p(w)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(h)||(h=[h]);const M=h.length,x=await Promise.all(h.map(C=>this.preprocess(C))),F=x.map(C=>C.original_size),E=x.map(C=>C.reshaped_input_size),T=[];for(const{pixel_values:C}of x){C.unsqueeze_(0);const[k,U]=C.dims.slice(-2),V=await(0,o.interpolate_4d)(C,{size:[u,u],mode:"bicubic"});if(w>0){const re=[],ne=p(w),W=f(U/ne),ce=f(k/ne);for(let H=0;H<ne;++H)for(let se=0;se<ne;++se){let ie,ge,q,j;H===ne-1?(ge=k-ce,j=k):(ge=H*ce,j=(H+1)*ce),se===ne-1?(ie=U-W,q=U):(ie=se*W,q=(se+1)*W);const R=[ge,ie],X=[j,q],G=await(0,o.slice)(C,R,X,d);re.push(G)}const ae=await(0,o.interpolate_4d)((0,o.cat)(re,0),{size:[u,u],mode:"bicubic"});T.push((0,o.cat)([V,ae],0))}else T.push(V)}const L=(0,o.stack)(T,0),O=E.map(C=>C.map(k=>u*c(k/u))),S=new o.Tensor("int64",O.flat(),[M,2]),$=O.map(([C,k])=>this.calc_num_image_tokens_from_image_size(k,C));return{pixel_values:L,original_sizes:F,reshaped_input_sizes:E,image_sizes:S,num_img_tokens:$}}}}),"./src/models/phi3_v/processing_phi3_v.js":((t,r,n)=>{n.r(r),n.d(r,{Phi3VProcessor:()=>f});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");n("./src/utils/image.js");const d="<|image|>",c=/<\|image_\d+\|>/g;class f extends a.Processor{static image_processor_class=o.AutoImageProcessor;static tokenizer_class=u.AutoTokenizer;async _call(g,_=null,{padding:h=!0,truncation:w=!0,num_crops:M=null}={}){Array.isArray(g)||(g=[g]);let x,F;if(_){F=await this.image_processor(_,{num_crops:M});const{num_img_tokens:E}=F,T=g.map((O,S)=>O.split(c).join(d.repeat(E[S])));x=this.tokenizer(T,{padding:h,truncation:w});const L=this.tokenizer.model.convert_tokens_to_ids([d])[0];x.input_ids.map_(O=>O==L?-O:O)}else x=this.tokenizer(g);return{...x,...F}}}}),"./src/models/processors.js":((t,r,n)=>{n.r(r),n.d(r,{Florence2Processor:()=>a.Florence2Processor,Gemma3nProcessor:()=>o.Gemma3nProcessor,GroundingDinoProcessor:()=>u.GroundingDinoProcessor,Idefics3Processor:()=>d.Idefics3Processor,JinaCLIPProcessor:()=>f.JinaCLIPProcessor,LlavaProcessor:()=>p.LlavaProcessor,MgpstrProcessor:()=>g.MgpstrProcessor,MoonshineProcessor:()=>_.MoonshineProcessor,OwlViTProcessor:()=>h.OwlViTProcessor,PaliGemmaProcessor:()=>M.PaliGemmaProcessor,Phi3VProcessor:()=>w.Phi3VProcessor,PyAnnoteProcessor:()=>x.PyAnnoteProcessor,Qwen2VLProcessor:()=>F.Qwen2VLProcessor,SamProcessor:()=>E.SamProcessor,SmolVLMProcessor:()=>T.SmolVLMProcessor,SpeechT5Processor:()=>L.SpeechT5Processor,UltravoxProcessor:()=>O.UltravoxProcessor,VLChatProcessor:()=>c.VLChatProcessor,VoxtralProcessor:()=>S.VoxtralProcessor,Wav2Vec2Processor:()=>$.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>C.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>k.WhisperProcessor});var a=n("./src/models/florence2/processing_florence2.js"),o=n("./src/models/gemma3n/processing_gemma3n.js"),u=n("./src/models/grounding_dino/processing_grounding_dino.js"),d=n("./src/models/idefics3/processing_idefics3.js"),c=n("./src/models/janus/processing_janus.js"),f=n("./src/models/jina_clip/processing_jina_clip.js"),p=n("./src/models/llava/processing_llava.js"),g=n("./src/models/mgp_str/processing_mgp_str.js"),_=n("./src/models/moonshine/processing_moonshine.js"),h=n("./src/models/owlvit/processing_owlvit.js"),w=n("./src/models/phi3_v/processing_phi3_v.js"),M=n("./src/models/paligemma/processing_paligemma.js"),x=n("./src/models/pyannote/processing_pyannote.js"),F=n("./src/models/qwen2_vl/processing_qwen2_vl.js"),E=n("./src/models/sam/processing_sam.js"),T=n("./src/models/smolvlm/processing_smolvlm.js"),L=n("./src/models/speecht5/processing_speecht5.js"),O=n("./src/models/ultravox/processing_ultravox.js"),S=n("./src/models/voxtral/processing_voxtral.js"),$=n("./src/models/wav2vec2/processing_wav2vec2.js"),C=n("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),k=n("./src/models/whisper/processing_whisper.js")}),"./src/models/pvt/image_processing_pvt.js":((t,r,n)=>{n.r(r),n.d(r,{PvtImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/pyannote/feature_extraction_pyannote.js":((t,r,n)=>{n.r(r),n.d(r,{PyAnnoteFeatureExtractor:()=>d});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js"),u=n("./src/utils/maths.js");class d extends a.FeatureExtractor{async _call(f){(0,a.validate_audio_inputs)(f,"PyAnnoteFeatureExtractor"),f instanceof Float64Array&&(f=new Float32Array(f));const p=[1,1,f.length];return{input_values:new o.Tensor("float32",f,p)}}samples_to_frames(f){return(f-this.config.offset)/this.config.step}post_process_speaker_diarization(f,p){const g=p/this.samples_to_frames(p)/this.config.sampling_rate,_=[];for(const h of f.tolist()){const w=[];let M=-1;for(let x=0;x<h.length;++x){const F=(0,u.softmax)(h[x]),[E,T]=(0,u.max)(F),[L,O]=[x,x+1];T!==M?(M=T,w.push({id:T,start:L,end:O,score:E})):(w.at(-1).end=O,w.at(-1).score+=E)}_.push(w.map(({id:x,start:F,end:E,score:T})=>({id:x,start:F*g,end:E*g,confidence:T/(E-F)})))}return _}}}),"./src/models/pyannote/processing_pyannote.js":((t,r,n)=>{n.r(r),n.d(r,{PyAnnoteProcessor:()=>u});var a=n("./src/base/processing_utils.js"),o=n("./src/models/pyannote/feature_extraction_pyannote.js");class u extends a.Processor{static feature_extractor_class=o.PyAnnoteFeatureExtractor;async _call(c){return await this.feature_extractor(c)}post_process_speaker_diarization(...c){return this.feature_extractor.post_process_speaker_diarization(...c)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}}),"./src/models/qwen2_vl/image_processing_qwen2_vl.js":((t,r,n)=>{n.r(r),n.d(r,{Qwen2VLImageProcessor:()=>u});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");class u extends a.ImageProcessor{async _call(c,...f){const{pixel_values:p,original_sizes:g,reshaped_input_sizes:_}=await super._call(c,...f);let h=p;const{temporal_patch_size:w,merge_size:M,patch_size:x}=this.config;h.dims[0]===1&&(h=(0,o.cat)(Array.from({length:w},()=>h),0));const F=h.dims[0]/w,E=h.dims[1],T=Math.floor(h.dims[2]/x),L=Math.floor(h.dims[3]/x),O=h.view(F,w,E,Math.floor(T/M),M,x,Math.floor(L/M),M,x).permute(0,3,6,4,7,2,1,5,8).view(F*T*L,E*w*x*x),S=new o.Tensor("int64",[F,T,L],[1,3]);return{pixel_values:O,image_grid_thw:S,original_sizes:g,reshaped_input_sizes:_}}}}),"./src/models/qwen2_vl/processing_qwen2_vl.js":((t,r,n)=>{n.r(r),n.d(r,{Qwen2VLProcessor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js"),u=n("./src/tokenizers.js");n("./src/utils/image.js");class d extends a.Processor{static image_processor_class=o.AutoImageProcessor;static tokenizer_class=u.AutoTokenizer;async _call(f,p=null,...g){Array.isArray(f)||(f=[f]);let _,h;if(p&&(_=await this.image_processor(p),h=_.image_grid_thw),h){let M=this.image_processor.config.merge_size**2,x=0;const F=h.tolist();f=f.map(E=>{for(;E.includes("<|image_pad|>");){const T=Number(F[x++].reduce((L,O)=>L*O,1n));E=E.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(T/M)))}return E.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(f),..._}}}}),"./src/models/rt_detr/image_processing_rt_detr.js":((t,r,n)=>{n.r(r),n.d(r,{RTDetrImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_object_detection(...d){return(0,a.post_process_object_detection)(...d)}}}),"./src/models/sam/image_processing_sam.js":((t,r,n)=>{n.r(r),n.d(r,{SamImageProcessor:()=>d});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/core.js"),u=n("./src/utils/tensor.js");class d extends a.ImageProcessor{reshape_input_points(f,p,g,_=!1){f=structuredClone(f);let h=(0,o.calculateDimensions)(f);if(h.length===3)_||(h=[1,...h]),f=[f];else if(h.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let w=0;w<f.length;++w){let M=p[w],x=g[w],F=[x[0]/M[0],x[1]/M[1]];for(let E=0;E<f[w].length;++E)for(let T=0;T<f[w][E].length;++T)for(let L=0;L<f[w][E][T].length;++L)f[w][E][T][L]*=F[L%2]}return new u.Tensor("float32",Float32Array.from(f.flat(1/0)),h)}add_input_labels(f,p){let g=(0,o.calculateDimensions)(f);if(g.length===2)g=[1,...g],f=[f];else if(g.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(g.some((_,h)=>_!==p.dims[h]))throw Error(`The first ${g.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new u.Tensor("int64",f.flat(1/0).map(BigInt),g)}async _call(f,{input_points:p=null,input_labels:g=null,input_boxes:_=null}={}){const h=await super._call(f);if(p&&(h.input_points=this.reshape_input_points(p,h.original_sizes,h.reshaped_input_sizes)),g){if(!h.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");h.input_labels=this.add_input_labels(g,h.input_points)}return _&&(h.input_boxes=this.reshape_input_points(_,h.original_sizes,h.reshaped_input_sizes,!0)),h}async post_process_masks(f,p,g,{mask_threshold:_=0,binarize:h=!0,pad_size:w=null}={}){const M=[];w=w??this.pad_size;const x=[w.height,w.width];for(let F=0;F<p.length;++F){const E=p[F],T=g[F];let L=await(0,u.interpolate_4d)(f[F],{mode:"bilinear",size:x});if(L=L.slice(null,null,[0,T[0]],[0,T[1]]),L=await(0,u.interpolate_4d)(L,{mode:"bilinear",size:E}),h){const O=L.data,S=new Uint8Array(O.length);for(let $=0;$<O.length;++$)O[$]>_&&(S[$]=1);L=new u.Tensor("bool",S,L.dims)}M.push(L)}return M}generate_crop_boxes(f,p,{crop_n_layers:g=0,overlap_ratio:_=512/1500,points_per_crop:h=32,crop_n_points_downscale_factor:w=1}={}){}}}),"./src/models/sam/processing_sam.js":((t,r,n)=>{n.r(r),n.d(r,{SamProcessor:()=>u});var a=n("./src/base/processing_utils.js"),o=n("./src/models/auto/image_processing_auto.js");class u extends a.Processor{static image_processor_class=o.AutoImageProcessor;async _call(...c){return await this.image_processor(...c)}post_process_masks(...c){return this.image_processor.post_process_masks(...c)}reshape_input_points(...c){return this.image_processor.reshape_input_points(...c)}}}),"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":((t,r,n)=>{n.r(r),n.d(r,{SeamlessM4TFeatureExtractor:()=>d});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js"),u=n("./src/utils/audio.js");class d extends a.FeatureExtractor{constructor(f){super(f);const p=this.config.sampling_rate,g=(0,u.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(p/2),p,null,"kaldi",!0);this.mel_filters=g,this.window=(0,u.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(f,p){return f=f.map(g=>g*32768),(0,u.spectrogram)(f,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:p,transpose:!0})}async _call(f,{padding:p=!0,pad_to_multiple_of:g=2,do_normalize_per_mel_bins:_=!0,return_attention_mask:h=!0}={}){(0,a.validate_audio_inputs)(f,"SeamlessM4TFeatureExtractor");let w=await this._extract_fbank_features(f,this.config.max_length);if(_){const[S,$]=w.dims,C=w.data;for(let k=0;k<$;++k){let U=0;for(let W=0;W<S;++W)U+=C[W*$+k];const V=U/S;let re=0;for(let W=0;W<S;++W)re+=(C[W*$+k]-V)**2;re/=S-1;const ne=Math.sqrt(re+1e-7);for(let W=0;W<S;++W){const ce=W*$+k;C[ce]=(C[ce]-V)/ne}}}let M;if(p){const[S,$]=w.dims,C=w.data,k=S%g;if(k>0){const U=new Float32Array($*(S+k));U.set(C),U.fill(this.config.padding_value,C.length);const V=S+k;w=new o.Tensor(w.type,U,[V,$]),h&&(M=new o.Tensor("int64",new BigInt64Array(V),[1,V]),M.data.fill(1n,0,S))}}const[x,F]=w.dims,E=this.config.stride;if(x%E!==0)throw new Error(`The number of frames (${x}) must be a multiple of the stride (${E}).`);const L=w.view(1,Math.floor(x/E),F*E),O={input_features:L};if(h){const S=L.dims[1],$=new BigInt64Array(S);if(M){const C=M.data;for(let k=1,U=0;k<x;k+=E,++U)$[U]=C[k]}else $.fill(1n);O.attention_mask=new o.Tensor("int64",$,[1,S])}return O}}}),"./src/models/segformer/image_processing_segformer.js":((t,r,n)=>{n.r(r),n.d(r,{SegformerFeatureExtractor:()=>u,SegformerImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_semantic_segmentation(...c){return(0,a.post_process_semantic_segmentation)(...c)}}class u extends o{}}),"./src/models/siglip/image_processing_siglip.js":((t,r,n)=>{n.r(r),n.d(r,{SiglipImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}}),"./src/models/smolvlm/image_processing_smolvlm.js":((t,r,n)=>{n.r(r),n.d(r,{SmolVLMImageProcessor:()=>a.Idefics3ImageProcessor});var a=n("./src/models/idefics3/image_processing_idefics3.js")}),"./src/models/smolvlm/processing_smolvlm.js":((t,r,n)=>{n.r(r),n.d(r,{SmolVLMProcessor:()=>a.Idefics3Processor});var a=n("./src/models/idefics3/processing_idefics3.js")}),"./src/models/snac/feature_extraction_snac.js":((t,r,n)=>{n.r(r),n.d(r,{SnacFeatureExtractor:()=>o});var a=n("./src/models/dac/feature_extraction_dac.js");class o extends a.DacFeatureExtractor{}}),"./src/models/speecht5/feature_extraction_speecht5.js":((t,r,n)=>{n.r(r),n.d(r,{SpeechT5FeatureExtractor:()=>o});var a=n("./src/base/feature_extraction_utils.js");class o extends a.FeatureExtractor{}}),"./src/models/speecht5/processing_speecht5.js":((t,r,n)=>{n.r(r),n.d(r,{SpeechT5Processor:()=>d});var a=n("./src/base/processing_utils.js"),o=n("./src/tokenizers.js"),u=n("./src/models/auto/feature_extraction_auto.js");class d extends a.Processor{static tokenizer_class=o.AutoTokenizer;static feature_extractor_class=u.AutoFeatureExtractor;async _call(f){return await this.feature_extractor(f)}}}),"./src/models/swin2sr/image_processing_swin2sr.js":((t,r,n)=>{n.r(r),n.d(r,{Swin2SRImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{pad_image(d,c,f,p={}){const[g,_,h]=c;return super.pad_image(d,c,{width:_+(f-_%f)%f,height:g+(f-g%f)%f},{mode:"symmetric",center:!1,constant_values:-1,...p})}}}),"./src/models/ultravox/processing_ultravox.js":((t,r,n)=>{n.r(r),n.d(r,{UltravoxProcessor:()=>d});var a=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/tokenizers.js"),u=n("./src/base/processing_utils.js");class d extends u.Processor{static tokenizer_class=o.AutoTokenizer;static feature_extractor_class=a.AutoFeatureExtractor;static uses_processor_config=!0;async _call(f,p=null,g={}){if(Array.isArray(f))throw new Error("Batched inputs are not supported yet.");let _={};if(p){const w=p.length,{input_features:M}=await this.feature_extractor(p,{...g,max_length:w}),x=Math.round(w/this.config.encoder_ds_factor+1e-4),F=1+Math.ceil(x/this.config.stack_factor);_.audio_token_len=[F],_.audio_values=M;const E=this.config.audio_placeholder;if(!f.includes(E))throw new Error(`The input text does not contain the image token ${E}.`);f=f.replaceAll(E,E.repeat(F))}return{...this.tokenizer(f,{add_special_tokens:!1,...g}),..._}}}}),"./src/models/vit/image_processing_vit.js":((t,r,n)=>{n.r(r),n.d(r,{ViTFeatureExtractor:()=>u,ViTImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{}class u extends o{}}),"./src/models/vitmatte/image_processing_vitmatte.js":((t,r,n)=>{n.r(r),n.d(r,{VitMatteImageProcessor:()=>u});var a=n("./src/base/image_processors_utils.js"),o=n("./src/utils/tensor.js");class u extends a.ImageProcessor{async _call(c,f){Array.isArray(c)||(c=[c]),Array.isArray(f)||(f=[f]);const p=await Promise.all(c.map(h=>this.preprocess(h))),g=await Promise.all(f.map(h=>this.preprocess(h,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,o.stack)(p.map((h,w)=>(0,o.cat)([h.pixel_values,g[w].pixel_values],0)),0),original_sizes:p.map(h=>h.original_size),reshaped_input_sizes:p.map(h=>h.reshaped_input_size)}}}}),"./src/models/vitpose/image_processing_vitpose.js":((t,r,n)=>{n.r(r),n.d(r,{VitPoseImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_pose_estimation(d,c,{threshold:f=null}={}){const p=d.tolist(),[g,_,h,w]=d.dims,M=[];for(let x=0;x<g;++x){const F=p[x],E=c[x],T=[];for(let L=0;L<E.length;++L){const O=E[L],S=[],$=[],C=[],k=O.at(-2)/w,U=O.at(-1)/h;for(let V=0;V<F.length;++V){let[re,ne]=[0,0],W=0,ce=-1/0;const ae=F[V];for(let se=0;se<ae.length;++se){const ie=ae[se];for(let ge=0;ge<ie.length;++ge){const q=ie[ge];W+=q,ce=Math.max(ce,q),re+=(ge+.5)*q,ne+=se*q}}if(f!=null&&ce<f)continue;const H=[k*re/W,U*ne/W];S.push(H),C.push(V),$.push(ce)}T.push({bbox:O,scores:$,labels:C,keypoints:S})}M.push(T)}return M}}}),"./src/models/voxtral/processing_voxtral.js":((t,r,n)=>{n.r(r),n.d(r,{VoxtralProcessor:()=>_});var a=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/tokenizers.js"),u=n("./src/base/processing_utils.js"),d=n("./src/utils/tensor.js");const c="[AUDIO]",f="[BEGIN_AUDIO]",p=375;function g(h,w){const M=[];for(let x=0;x<h.length;x+=w)M.push(h.subarray(x,Math.min(x+w,h.length)));return M}class _ extends u.Processor{static tokenizer_class=o.AutoTokenizer;static feature_extractor_class=a.AutoFeatureExtractor;static uses_processor_config=!1;async _call(w,M=null,x={}){if(Array.isArray(w))throw new Error("Batched inputs are not supported yet.");const F={};if(M){if(!w.includes(c))throw new Error(`The input text does not contain the audio token ${c}.`);Array.isArray(M)||(M=[M]);const T=w.split(c),L=T.length-1;if(L!==M.length)throw new Error(`The number of audio inputs (${M.length}) does not match the number of audio tokens in the text (${L}).`);const O=this.feature_extractor.config.n_samples,S=M.map(V=>g(V,O)),$=S.map(V=>V.length),C=S.flat(),k=(await Promise.all(C.map(V=>this.feature_extractor(V,x)))).map(V=>V.input_features);F.audio_values=k.length>1?(0,d.cat)(k,0):k[0];let U=T[0];for(let V=0;V<$.length;++V){U+=f;for(let re=0;re<$[V];++re)U+=c.repeat(p);U+=T[V+1]}w=U}return{...this.tokenizer(w,{add_special_tokens:!1,...x}),...F}}}}),"./src/models/wav2vec2/feature_extraction_wav2vec2.js":((t,r,n)=>{n.r(r),n.d(r,{Wav2Vec2FeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js"),o=n("./src/utils/tensor.js");class u extends a.FeatureExtractor{_zero_mean_unit_var_norm(c){const p=c.reduce((_,h)=>_+h,0)/c.length,g=c.reduce((_,h)=>_+(h-p)**2,0)/c.length;return c.map(_=>(_-p)/Math.sqrt(g+1e-7))}async _call(c){(0,a.validate_audio_inputs)(c,"Wav2Vec2FeatureExtractor"),c instanceof Float64Array&&(c=new Float32Array(c));let f=c;this.config.do_normalize&&(f=this._zero_mean_unit_var_norm(f));const p=[1,f.length];return{input_values:new o.Tensor("float32",f,p),attention_mask:new o.Tensor("int64",new BigInt64Array(f.length).fill(1n),p)}}}}),"./src/models/wav2vec2/processing_wav2vec2.js":((t,r,n)=>{n.r(r),n.d(r,{Wav2Vec2Processor:()=>d});var a=n("./src/tokenizers.js"),o=n("./src/models/auto/feature_extraction_auto.js"),u=n("./src/base/processing_utils.js");class d extends u.Processor{static tokenizer_class=a.AutoTokenizer;static feature_extractor_class=o.AutoFeatureExtractor;async _call(f){return await this.feature_extractor(f)}}}),"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":((t,r,n)=>{n.r(r),n.d(r,{Wav2Vec2ProcessorWithLM:()=>d});var a=n("./src/tokenizers.js"),o=n("./src/models/auto/feature_extraction_auto.js"),u=n("./src/base/processing_utils.js");class d extends u.Processor{static tokenizer_class=a.AutoTokenizer;static feature_extractor_class=o.AutoFeatureExtractor;async _call(f){return await this.feature_extractor(f)}}}),"./src/models/wespeaker/feature_extraction_wespeaker.js":((t,r,n)=>{n.r(r),n.d(r,{WeSpeakerFeatureExtractor:()=>u});var a=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var o=n("./src/utils/audio.js");class u extends a.FeatureExtractor{constructor(c){super(c);const f=this.config.sampling_rate,p=(0,o.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(f/2),f,null,"kaldi",!0);this.mel_filters=p,this.window=(0,o.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(c){return c=c.map(f=>f*32768),(0,o.spectrogram)(c,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(c){(0,a.validate_audio_inputs)(c,"WeSpeakerFeatureExtractor");const f=(await this._extract_fbank_features(c)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const p=f.mean(1).data,g=f.data,[_,h,w]=f.dims;for(let M=0;M<_;++M){const x=M*h*w,F=M*w;for(let E=0;E<h;++E){const T=x+E*w;for(let L=0;L<w;++L)g[T+L]-=p[F+L]}}}return{input_features:f}}}}),"./src/models/whisper/common_whisper.js":((t,r,n)=>{n.r(r),n.d(r,{WHISPER_LANGUAGE_MAPPING:()=>o,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>u,whisper_language_to_code:()=>d});const a=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],o=new Map(a),u=new Map([...a.map(([c,f])=>[f,c]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function d(c){c=c.toLowerCase();let f=u.get(c);if(f===void 0){const p=c.match(/^<\|([a-z]{2})\|>$/);if(p&&(c=p[1]),o.has(c))f=c;else{const _=c.length===2?o.keys():o.values();throw new Error(`Language "${c}" is not supported. Must be one of: ${JSON.stringify(Array.from(_))}`)}}return f}}),"./src/models/whisper/feature_extraction_whisper.js":((t,r,n)=>{n.r(r),n.d(r,{WhisperFeatureExtractor:()=>d});var a=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var o=n("./src/utils/audio.js"),u=n("./src/utils/maths.js");class d extends a.FeatureExtractor{constructor(f){super(f),this.config.mel_filters??=(0,o.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=(0,o.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(f){const p=await(0,o.spectrogram)(f,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(f.length/this.config.hop_length),this.config.nb_max_frames)}),g=p.data,_=(0,u.max)(g)[0];for(let h=0;h<g.length;++h)g[h]=(Math.max(g[h],_-8)+4)/4;return p}async _call(f,{max_length:p=null}={}){(0,a.validate_audio_inputs)(f,"WhisperFeatureExtractor");let g;const _=p??this.config.n_samples;return f.length>_?(f.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),g=f.slice(0,_)):(g=new Float32Array(_),g.set(f)),{input_features:(await this._extract_fbank_features(g)).unsqueeze_(0)}}}}),"./src/models/whisper/generation_whisper.js":((t,r,n)=>{n.r(r),n.d(r,{WhisperGenerationConfig:()=>o});var a=n("./src/generation/configuration_utils.js");class o extends a.GenerationConfig{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}}),"./src/models/whisper/processing_whisper.js":((t,r,n)=>{n.r(r),n.d(r,{WhisperProcessor:()=>d});var a=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/tokenizers.js"),u=n("./src/base/processing_utils.js");class d extends u.Processor{static tokenizer_class=o.AutoTokenizer;static feature_extractor_class=a.AutoFeatureExtractor;async _call(f){return await this.feature_extractor(f)}}}),"./src/models/yolos/image_processing_yolos.js":((t,r,n)=>{n.r(r),n.d(r,{YolosFeatureExtractor:()=>u,YolosImageProcessor:()=>o});var a=n("./src/base/image_processors_utils.js");class o extends a.ImageProcessor{post_process_object_detection(...c){return(0,a.post_process_object_detection)(...c)}}class u extends o{}}),"./src/ops/registry.js":((t,r,n)=>{n.r(r),n.d(r,{TensorOpRegistry:()=>f});var a=n("./src/backends/onnx.js"),o=n("./src/utils/tensor.js"),u=n("./src/env.js");const d=u.apis.IS_BROWSER_ENV||u.apis.IS_WEBWORKER_ENV,c=async(p,g,_)=>{const h=await(0,a.createInferenceSession)(new Uint8Array(p),g);let w=Promise.resolve();return(async M=>{const x=(0,a.isONNXProxy)(),F=Object.fromEntries(Object.entries(M).map(([T,L])=>[T,(x?L.clone():L).ort_tensor])),E=await(w=d?w.then(()=>h.run(F)):h.run(F));return Array.isArray(_)?_.map(T=>new o.Tensor(E[T])):new o.Tensor(E[_])})};class f{static session_options={};static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=c([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=c([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=c([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=c([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=c([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=c([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=c([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=c([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}}),"./src/pipelines.js":((t,r,n)=>{n.r(r),n.d(r,{AudioClassificationPipeline:()=>ne,AutomaticSpeechRecognitionPipeline:()=>ce,BackgroundRemovalPipeline:()=>ie,DepthEstimationPipeline:()=>pe,DocumentQuestionAnsweringPipeline:()=>R,FeatureExtractionPipeline:()=>V,FillMaskPipeline:()=>L,ImageClassificationPipeline:()=>H,ImageFeatureExtractionPipeline:()=>re,ImageSegmentationPipeline:()=>se,ImageToImagePipeline:()=>G,ImageToTextPipeline:()=>ae,ObjectDetectionPipeline:()=>q,Pipeline:()=>x,QuestionAnsweringPipeline:()=>T,SummarizationPipeline:()=>S,Text2TextGenerationPipeline:()=>O,TextClassificationPipeline:()=>F,TextGenerationPipeline:()=>k,TextToAudioPipeline:()=>X,TokenClassificationPipeline:()=>E,TranslationPipeline:()=>$,ZeroShotAudioClassificationPipeline:()=>W,ZeroShotClassificationPipeline:()=>U,ZeroShotImageClassificationPipeline:()=>ge,ZeroShotObjectDetectionPipeline:()=>j,pipeline:()=>Ne});var a=n("./src/tokenizers.js"),o=n("./src/models.js"),u=n("./src/models/auto/processing_auto.js");n("./src/base/processing_utils.js");var d=n("./src/utils/generic.js"),c=n("./src/utils/core.js"),f=n("./src/utils/maths.js"),p=n("./src/utils/audio.js"),g=n("./src/utils/tensor.js"),_=n("./src/utils/image.js");async function h(je){return Array.isArray(je)||(je=[je]),await Promise.all(je.map(oe=>_.RawImage.read(oe)))}async function w(je,oe){return Array.isArray(je)||(je=[je]),await Promise.all(je.map(ve=>typeof ve=="string"||ve instanceof URL?(0,p.read_audio)(ve,oe):ve instanceof Float64Array?new Float32Array(ve):ve))}function M(je,oe){oe&&(je=je.map(Be=>Be|0));const[ve,te,De,Xe]=je;return{xmin:ve,ymin:te,xmax:De,ymax:Xe}}class x extends d.Callable{constructor({task:oe,model:ve,tokenizer:te=null,processor:De=null}){super(),this.task=oe,this.model=ve,this.tokenizer=te,this.processor=De}async dispose(){await this.model.dispose()}}class F extends x{constructor(oe){super(oe)}async _call(oe,{top_k:ve=1}={}){const te=this.tokenizer(oe,{padding:!0,truncation:!0}),De=await this.model(te),Xe=this.model.config.problem_type==="multi_label_classification"?Ve=>Ve.sigmoid():Ve=>new g.Tensor("float32",(0,f.softmax)(Ve.data),Ve.dims),Be=this.model.config.id2label,Ee=[];for(const Ve of De.logits){const ke=Xe(Ve),Ke=await(0,g.topk)(ke,ve),et=Ke[0].tolist(),Re=Ke[1].tolist().map((Tt,ut)=>({label:Be?Be[Tt]:`LABEL_${Tt}`,score:et[ut]}));ve===1?Ee.push(...Re):Ee.push(Re)}return Array.isArray(oe)||ve===1?Ee:Ee[0]}}class E extends x{constructor(oe){super(oe)}async _call(oe,{ignore_labels:ve=["O"]}={}){const te=Array.isArray(oe),De=this.tokenizer(te?oe:[oe],{padding:!0,truncation:!0}),Be=(await this.model(De)).logits,Ee=this.model.config.id2label,Ve=[];for(let ke=0;ke<Be.dims[0];++ke){const Ke=De.input_ids[ke],et=Be[ke],ht=[];for(let Re=0;Re<et.dims[0];++Re){const Tt=et[Re],ut=(0,f.max)(Tt.data)[1],st=Ee?Ee[ut]:`LABEL_${ut}`;if(ve.includes(st))continue;const mt=this.tokenizer.decode([Ke[Re].item()],{skip_special_tokens:!0});if(mt==="")continue;const ct=(0,f.softmax)(Tt.data);ht.push({entity:st,score:ct[ut],index:Re,word:mt})}Ve.push(ht)}return te?Ve:Ve[0]}}class T extends x{constructor(oe){super(oe)}async _call(oe,ve,{top_k:te=1}={}){const De=this.tokenizer(oe,{text_pair:ve,padding:!0,truncation:!0}),{start_logits:Xe,end_logits:Be}=await this.model(De),Ee=De.input_ids.tolist(),Ve=De.attention_mask.tolist(),ke=this.tokenizer.all_special_ids,Ke=[];for(let et=0;et<Xe.dims[0];++et){const ht=Ee[et],Re=ht.findIndex(lt=>lt==this.tokenizer.sep_token_id);Ve[et].map((lt,bt)=>lt==1&&(bt===0||bt>Re&&ke.findIndex(nn=>nn==ht[bt])===-1));const Tt=Xe[et].tolist(),ut=Be[et].tolist();for(let lt=1;lt<Tt.length;++lt)(Ve[et]==0||lt<=Re||ke.findIndex(bt=>bt==ht[lt])!==-1)&&(Tt[lt]=-1/0,ut[lt]=-1/0);const st=(0,f.softmax)(Tt).map((lt,bt)=>[lt,bt]),mt=(0,f.softmax)(ut).map((lt,bt)=>[lt,bt]);st[0][0]=0,mt[0][0]=0;const ct=(0,c.product)(st,mt).filter(lt=>lt[0][1]<=lt[1][1]).map(lt=>[lt[0][1],lt[1][1],lt[0][0]*lt[1][0]]).sort((lt,bt)=>bt[2]-lt[2]);for(let lt=0;lt<Math.min(ct.length,te);++lt){const[bt,nn,un]=ct[lt],It=ht.slice(bt,nn+1),os=this.tokenizer.decode(It,{skip_special_tokens:!0});Ke.push({answer:os,score:un})}}return te===1?Ke[0]:Ke}}class L extends x{constructor(oe){super(oe)}async _call(oe,{top_k:ve=5}={}){const te=this.tokenizer(oe,{padding:!0,truncation:!0}),{logits:De}=await this.model(te),Xe=[],Be=te.input_ids.tolist();for(let Ee=0;Ee<Be.length;++Ee){const Ve=Be[Ee],ke=Ve.findIndex(Tt=>Tt==this.tokenizer.mask_token_id);if(ke===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const Ke=De[Ee][ke],et=await(0,g.topk)(new g.Tensor("float32",(0,f.softmax)(Ke.data),Ke.dims),ve),ht=et[0].tolist(),Re=et[1].tolist();Xe.push(Re.map((Tt,ut)=>{const st=Ve.slice();return st[ke]=Tt,{score:ht[ut],token:Number(Tt),token_str:this.tokenizer.decode([Tt]),sequence:this.tokenizer.decode(st,{skip_special_tokens:!0})}}))}return Array.isArray(oe)?Xe:Xe[0]}}class O extends x{_key="generated_text";constructor(oe){super(oe)}async _call(oe,ve={}){Array.isArray(oe)||(oe=[oe]),this.model.config.prefix&&(oe=oe.map(Ve=>this.model.config.prefix+Ve));const te=this.model.config.task_specific_params;te&&te[this.task]&&te[this.task].prefix&&(oe=oe.map(Ve=>te[this.task].prefix+Ve));const De=this.tokenizer,Xe={padding:!0,truncation:!0};let Be;this instanceof $&&"_build_translation_inputs"in De?Be=De._build_translation_inputs(oe,Xe,ve):Be=De(oe,Xe);const Ee=await this.model.generate({...Be,...ve});return De.batch_decode(Ee,{skip_special_tokens:!0}).map(Ve=>({[this._key]:Ve}))}}class S extends O{_key="summary_text";constructor(oe){super(oe)}}class $ extends O{_key="translation_text";constructor(oe){super(oe)}}function C(je){return Array.isArray(je)&&je.every(oe=>"role"in oe&&"content"in oe)}class k extends x{constructor(oe){super(oe)}async _call(oe,ve={}){let te=!1,De=!1,Xe=ve.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,Be;if(typeof oe=="string")Be=oe=[oe];else if(Array.isArray(oe)&&oe.every(Re=>typeof Re=="string"))te=!0,Be=oe;else{if(C(oe))oe=[oe];else if(Array.isArray(oe)&&oe.every(C))te=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");De=!0,Be=oe.map(Re=>this.tokenizer.apply_chat_template(Re,{tokenize:!1,add_generation_prompt:!0})),Xe=!1}const Ee=De?!1:ve.return_full_text??!0;this.tokenizer.padding_side="left";const Ve=this.tokenizer(Be,{add_special_tokens:Xe,padding:!0,truncation:!0}),ke=await this.model.generate({...Ve,...ve}),Ke=this.tokenizer.batch_decode(ke,{skip_special_tokens:!0});let et;!Ee&&Ve.input_ids.dims.at(-1)>0&&(et=this.tokenizer.batch_decode(Ve.input_ids,{skip_special_tokens:!0}).map(Re=>Re.length));const ht=Array.from({length:oe.length},Re=>[]);for(let Re=0;Re<Ke.length;++Re){const Tt=Math.floor(Re/ke.dims[0]*oe.length);et&&(Ke[Re]=Ke[Re].slice(et[Tt])),ht[Tt].push({generated_text:De?[...oe[Tt],{role:"assistant",content:Ke[Re]}]:Ke[Re]})}return!te&&ht.length===1?ht[0]:ht}}class U extends x{constructor(oe){super(oe),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([ve,te])=>[ve.toLowerCase(),te])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(oe,ve,{hypothesis_template:te="This example is {}.",multi_label:De=!1}={}){const Xe=Array.isArray(oe);Xe||(oe=[oe]),Array.isArray(ve)||(ve=[ve]);const Be=ve.map(ke=>te.replace("{}",ke)),Ee=De||ve.length===1,Ve=[];for(const ke of oe){const Ke=[];for(const Re of Be){const Tt=this.tokenizer(ke,{text_pair:Re,padding:!0,truncation:!0}),ut=await this.model(Tt);Ee?Ke.push([ut.logits.data[this.contradiction_id],ut.logits.data[this.entailment_id]]):Ke.push(ut.logits.data[this.entailment_id])}const ht=(Ee?Ke.map(Re=>(0,f.softmax)(Re)[1]):(0,f.softmax)(Ke)).map((Re,Tt)=>[Re,Tt]).sort((Re,Tt)=>Tt[0]-Re[0]);Ve.push({sequence:ke,labels:ht.map(Re=>ve[Re[1]]),scores:ht.map(Re=>Re[0])})}return Xe?Ve:Ve[0]}}class V extends x{constructor(oe){super(oe)}async _call(oe,{pooling:ve="none",normalize:te=!1,quantize:De=!1,precision:Xe="binary"}={}){const Be=this.tokenizer(oe,{padding:!0,truncation:!0}),Ee=await this.model(Be);let Ve=Ee.last_hidden_state??Ee.logits??Ee.token_embeddings;switch(ve){case"none":break;case"mean":Ve=(0,g.mean_pooling)(Ve,Be.attention_mask);break;case"first_token":case"cls":Ve=Ve.slice(null,0);break;case"last_token":case"eos":Ve=Ve.slice(null,-1);break;default:throw Error(`Pooling method '${ve}' not supported.`)}return te&&(Ve=Ve.normalize(2,-1)),De&&(Ve=(0,g.quantize_embeddings)(Ve,Xe)),Ve}}class re extends x{constructor(oe){super(oe)}async _call(oe,{pool:ve=null}={}){const te=await h(oe),{pixel_values:De}=await this.processor(te),Xe=await this.model({pixel_values:De});let Be;if(ve){if(!("pooler_output"in Xe))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");Be=Xe.pooler_output}else Be=Xe.last_hidden_state??Xe.logits??Xe.image_embeds;return Be}}class ne extends x{constructor(oe){super(oe)}async _call(oe,{top_k:ve=5}={}){const te=this.processor.feature_extractor.config.sampling_rate,De=await w(oe,te),Xe=this.model.config.id2label,Be=[];for(const Ee of De){const Ve=await this.processor(Ee),Ke=(await this.model(Ve)).logits[0],et=await(0,g.topk)(new g.Tensor("float32",(0,f.softmax)(Ke.data),Ke.dims),ve),ht=et[0].tolist(),Tt=et[1].tolist().map((ut,st)=>({label:Xe?Xe[ut]:`LABEL_${ut}`,score:ht[st]}));Be.push(Tt)}return Array.isArray(oe)?Be:Be[0]}}class W extends x{constructor(oe){super(oe)}async _call(oe,ve,{hypothesis_template:te="This is a sound of {}."}={}){const De=!Array.isArray(oe);De&&(oe=[oe]);const Xe=ve.map(Ke=>te.replace("{}",Ke)),Be=this.tokenizer(Xe,{padding:!0,truncation:!0}),Ee=this.processor.feature_extractor.config.sampling_rate,Ve=await w(oe,Ee),ke=[];for(const Ke of Ve){const et=await this.processor(Ke),ht=await this.model({...Be,...et}),Re=(0,f.softmax)(ht.logits_per_audio.data);ke.push([...Re].map((Tt,ut)=>({score:Tt,label:ve[ut]})))}return De?ke[0]:ke}}class ce extends x{constructor(oe){super(oe)}async _call(oe,ve={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(oe,ve);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(oe,ve);case"moonshine":return this._call_moonshine(oe,ve);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(oe,ve){ve.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),ve.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const te=!Array.isArray(oe);te&&(oe=[oe]);const De=this.processor.feature_extractor.config.sampling_rate,Xe=await w(oe,De),Be=[];for(const Ee of Xe){const Ve=await this.processor(Ee),Ke=(await this.model(Ve)).logits[0],et=[];for(const Re of Ke)et.push((0,f.max)(Re.data)[1]);const ht=this.tokenizer.decode(et);Be.push({text:ht})}return te?Be[0]:Be}async _call_whisper(oe,ve){const te=ve.return_timestamps??!1,De=ve.chunk_length_s??0,Xe=ve.force_full_sequences??!1;let Be=ve.stride_length_s??null;const Ee={...ve};te==="word"&&(Ee.return_token_timestamps=!0,Ee.return_timestamps=!1);const Ve=!Array.isArray(oe);Ve&&(oe=[oe]);const ke=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,Ke=this.processor.feature_extractor.config.hop_length,et=this.processor.feature_extractor.config.sampling_rate,ht=await w(oe,et),Re=[];for(const Tt of ht){let ut=[];if(De>0){if(Be===null)Be=De/6;else if(De<=Be)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const ct=et*De,lt=et*Be,bt=ct-2*lt;let nn=0;for(;;){const un=nn+ct,It=Tt.subarray(nn,un),os=await this.processor(It),Ts=nn===0,Os=un>=Tt.length;if(ut.push({stride:[It.length,Ts?0:lt,Os?0:lt],input_features:os.input_features,is_last:Os}),Os)break;nn+=bt}}else ut=[{stride:[Tt.length,0,0],input_features:(await this.processor(Tt)).input_features,is_last:!0}];for(const ct of ut){Ee.num_frames=Math.floor(ct.stride[0]/Ke);const lt=await this.model.generate({inputs:ct.input_features,...Ee});te==="word"?(ct.tokens=lt.sequences.tolist()[0],ct.token_timestamps=lt.token_timestamps.tolist()[0].map(bt=>(0,f.round)(bt,2))):ct.tokens=lt[0].tolist(),ct.stride=ct.stride.map(bt=>bt/et)}const[st,mt]=this.tokenizer._decode_asr(ut,{time_precision:ke,return_timestamps:te,force_full_sequences:Xe});Re.push({text:st,...mt})}return Ve?Re[0]:Re}async _call_moonshine(oe,ve){const te=!Array.isArray(oe);te&&(oe=[oe]);const De=this.processor.feature_extractor.config.sampling_rate,Xe=await w(oe,De),Be=[];for(const Ee of Xe){const Ve=await this.processor(Ee),ke=Math.floor(Ee.length/De)*6,Ke=await this.model.generate({max_new_tokens:ke,...ve,...Ve}),et=this.processor.batch_decode(Ke,{skip_special_tokens:!0})[0];Be.push({text:et})}return te?Be[0]:Be}}class ae extends x{constructor(oe){super(oe)}async _call(oe,ve={}){const te=Array.isArray(oe),De=await h(oe),{pixel_values:Xe}=await this.processor(De),Be=[];for(const Ee of Xe){Ee.dims=[1,...Ee.dims];const Ve=await this.model.generate({inputs:Ee,...ve}),ke=this.tokenizer.batch_decode(Ve,{skip_special_tokens:!0}).map(Ke=>({generated_text:Ke.trim()}));Be.push(ke)}return te?Be:Be[0]}}class H extends x{constructor(oe){super(oe)}async _call(oe,{top_k:ve=5}={}){const te=await h(oe),{pixel_values:De}=await this.processor(te),Xe=await this.model({pixel_values:De}),Be=this.model.config.id2label,Ee=[];for(const Ve of Xe.logits){const ke=await(0,g.topk)(new g.Tensor("float32",(0,f.softmax)(Ve.data),Ve.dims),ve),Ke=ke[0].tolist(),ht=ke[1].tolist().map((Re,Tt)=>({label:Be?Be[Re]:`LABEL_${Re}`,score:Ke[Tt]}));Ee.push(ht)}return Array.isArray(oe)?Ee:Ee[0]}}class se extends x{constructor(oe){super(oe),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(oe,{threshold:ve=.5,mask_threshold:te=.5,overlap_mask_area_threshold:De=.8,label_ids_to_fuse:Xe=null,target_sizes:Be=null,subtask:Ee=null}={}){if(Array.isArray(oe)&&oe.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const ke=await h(oe),Ke=ke.map(ct=>[ct.height,ct.width]),et=await this.processor(ke),{inputNames:ht,outputNames:Re}=this.model.sessions.model;if(!ht.includes("pixel_values")){if(ht.length!==1)throw Error(`Expected a single input name, but got ${ht.length} inputs: ${ht}.`);const ct=ht[0];if(ct in et)throw Error(`Input name ${ct} already exists in the inputs.`);et[ct]=et.pixel_values}const Tt=await this.model(et);let ut=null;if(Ee!==null)ut=this.subtasks_mapping[Ee];else if(this.processor.image_processor){for(const[ct,lt]of Object.entries(this.subtasks_mapping))if(lt in this.processor.image_processor){ut=this.processor.image_processor[lt].bind(this.processor.image_processor),Ee=ct;break}}const st=this.model.config.id2label,mt=[];if(Ee)if(Ee==="panoptic"||Ee==="instance"){const ct=ut(Tt,ve,te,De,Xe,Be??Ke)[0],lt=ct.segmentation;for(const bt of ct.segments_info){const nn=new Uint8ClampedArray(lt.data.length);for(let It=0;It<lt.data.length;++It)lt.data[It]===bt.id&&(nn[It]=255);const un=new _.RawImage(nn,lt.dims[1],lt.dims[0],1);mt.push({score:bt.score,label:st[bt.label_id],mask:un})}}else if(Ee==="semantic"){const{segmentation:ct,labels:lt}=ut(Tt,Be??Ke)[0];for(const bt of lt){const nn=new Uint8ClampedArray(ct.data.length);for(let It=0;It<ct.data.length;++It)ct.data[It]===bt&&(nn[It]=255);const un=new _.RawImage(nn,ct.dims[1],ct.dims[0],1);mt.push({score:null,label:st[bt],mask:un})}}else throw Error(`Subtask ${Ee} not supported.`);else{const lt=Tt[Re[0]];for(let bt=0;bt<Ke.length;++bt){const nn=Ke[bt],un=lt[bt];un.data.some(os=>os<-1e-5||os>1+1e-5)&&un.sigmoid_();const It=await _.RawImage.fromTensor(un.mul_(255).to("uint8")).resize(nn[1],nn[0]);mt.push({label:null,score:null,mask:It})}}return mt}}class ie extends se{constructor(oe){super(oe)}async _call(oe,ve={}){if(Array.isArray(oe)&&oe.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const De=await h(oe),Xe=await super._call(oe,ve);return De.map((Ee,Ve)=>{const ke=Ee.clone();return ke.putAlpha(Xe[Ve].mask),ke})}}class ge extends x{constructor(oe){super(oe)}async _call(oe,ve,{hypothesis_template:te="This is a photo of {}"}={}){const De=Array.isArray(oe),Xe=await h(oe),Be=ve.map(ht=>te.replace("{}",ht)),Ee=this.tokenizer(Be,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:Ve}=await this.processor(Xe),ke=await this.model({...Ee,pixel_values:Ve}),Ke=this.model.config.model_type==="siglip"?ht=>ht.sigmoid().data:ht=>(0,f.softmax)(ht.data),et=[];for(const ht of ke.logits_per_image){const Tt=[...Ke(ht)].map((ut,st)=>({score:ut,label:ve[st]}));Tt.sort((ut,st)=>st.score-ut.score),et.push(Tt)}return De?et:et[0]}}class q extends x{constructor(oe){super(oe)}async _call(oe,{threshold:ve=.9,percentage:te=!1}={}){const De=Array.isArray(oe);if(De&&oe.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Xe=await h(oe),Be=te?null:Xe.map(Re=>[Re.height,Re.width]),{pixel_values:Ee,pixel_mask:Ve}=await this.processor(Xe),ke=await this.model({pixel_values:Ee,pixel_mask:Ve}),Ke=this.processor.image_processor.post_process_object_detection(ke,ve,Be),et=this.model.config.id2label,ht=Ke.map(Re=>Re.boxes.map((Tt,ut)=>({score:Re.scores[ut],label:et[Re.classes[ut]],box:M(Tt,!te)})));return De?ht:ht[0]}}class j extends x{constructor(oe){super(oe)}async _call(oe,ve,{threshold:te=.1,top_k:De=null,percentage:Xe=!1}={}){const Be=Array.isArray(oe),Ee=await h(oe),Ve=this.tokenizer(ve,{padding:!0,truncation:!0}),ke=await this.processor(Ee),Ke=[];for(let et=0;et<Ee.length;++et){const ht=Ee[et],Re=Xe?null:[[ht.height,ht.width]],Tt=ke.pixel_values[et].unsqueeze_(0),ut=await this.model({...Ve,pixel_values:Tt});let st;if("post_process_grounded_object_detection"in this.processor){const mt=this.processor.post_process_grounded_object_detection(ut,Ve.input_ids,{box_threshold:te,text_threshold:te,target_sizes:Re})[0];st=mt.boxes.map((ct,lt)=>({score:mt.scores[lt],label:mt.labels[lt],box:M(ct,!Xe)}))}else{const mt=this.processor.image_processor.post_process_object_detection(ut,te,Re,!0)[0];st=mt.boxes.map((ct,lt)=>({score:mt.scores[lt],label:ve[mt.classes[lt]],box:M(ct,!Xe)}))}st.sort((mt,ct)=>ct.score-mt.score),De!==null&&(st=st.slice(0,De)),Ke.push(st)}return Be?Ke:Ke[0]}}class R extends x{constructor(oe){super(oe)}async _call(oe,ve,te={}){const De=(await h(oe))[0],{pixel_values:Xe}=await this.processor(De),Be=`<s_docvqa><s_question>${ve}</s_question><s_answer>`,Ee=this.tokenizer(Be,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,Ve=await this.model.generate({inputs:Xe,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Ee,...te}),Ke=this.tokenizer.batch_decode(Ve)[0].match(/<s_answer>(.*?)<\/s_answer>/);let et=null;return Ke&&Ke.length>=2&&(et=Ke[1].trim()),[{answer:et}]}}class X extends x{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(oe){super(oe),this.vocoder=oe.vocoder??null}async _call(oe,{speaker_embeddings:ve=null}={}){return this.processor?this._call_text_to_spectrogram(oe,{speaker_embeddings:ve}):this._call_text_to_waveform(oe)}async _call_text_to_waveform(oe){const ve=this.tokenizer(oe,{padding:!0,truncation:!0}),{waveform:te}=await this.model(ve),De=this.model.config.sampling_rate;return new p.RawAudio(te.data,De)}async _call_text_to_spectrogram(oe,{speaker_embeddings:ve}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await o.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"})),(typeof ve=="string"||ve instanceof URL)&&(ve=new Float32Array(await(await fetch(ve)).arrayBuffer())),ve instanceof Float32Array)ve=new g.Tensor("float32",ve,[1,ve.length]);else if(!(ve instanceof g.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:te}=this.tokenizer(oe,{padding:!0,truncation:!0}),{waveform:De}=await this.model.generate_speech(te,ve,{vocoder:this.vocoder}),Xe=this.processor.feature_extractor.config.sampling_rate;return new p.RawAudio(De.data,Xe)}}class G extends x{constructor(oe){super(oe)}async _call(oe){const ve=await h(oe),te=await this.processor(ve),De=await this.model(te),Xe=[];for(const Be of De.reconstruction){const Ee=Be.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Xe.push(_.RawImage.fromTensor(Ee))}return Xe.length>1?Xe:Xe[0]}}class pe extends x{constructor(oe){super(oe)}async _call(oe){const ve=await h(oe),te=await this.processor(ve),{predicted_depth:De}=await this.model(te),Xe=[];for(let Be=0;Be<ve.length;++Be){const Ee=De[Be],[Ve,ke]=Ee.dims.slice(-2),[Ke,et]=ve[Be].size,ht=(await(0,g.interpolate_4d)(Ee.view(1,1,Ve,ke),{size:[et,Ke],mode:"bilinear"})).view(et,Ke),Re=ht.min().item(),Tt=ht.max().item(),ut=ht.sub(Re).div_(Tt-Re).mul_(255).to("uint8").unsqueeze(0),st=_.RawImage.fromTensor(ut);Xe.push({predicted_depth:ht,depth:st})}return Xe.length>1?Xe:Xe[0]}}const Te=Object.freeze({"text-classification":{tokenizer:a.AutoTokenizer,pipeline:F,model:o.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:a.AutoTokenizer,pipeline:E,model:o.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:a.AutoTokenizer,pipeline:T,model:o.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:a.AutoTokenizer,pipeline:L,model:o.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:a.AutoTokenizer,pipeline:S,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:a.AutoTokenizer,pipeline:$,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:a.AutoTokenizer,pipeline:O,model:o.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:a.AutoTokenizer,pipeline:k,model:o.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:a.AutoTokenizer,pipeline:U,model:o.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:ne,model:o.AutoModelForAudioClassification,processor:u.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:a.AutoTokenizer,pipeline:W,model:o.AutoModel,processor:u.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:a.AutoTokenizer,pipeline:ce,model:[o.AutoModelForSpeechSeq2Seq,o.AutoModelForCTC],processor:u.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:a.AutoTokenizer,pipeline:X,model:[o.AutoModelForTextToWaveform,o.AutoModelForTextToSpectrogram],processor:[u.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:a.AutoTokenizer,pipeline:ae,model:o.AutoModelForVision2Seq,processor:u.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:H,model:o.AutoModelForImageClassification,processor:u.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:se,model:[o.AutoModelForImageSegmentation,o.AutoModelForSemanticSegmentation,o.AutoModelForUniversalSegmentation],processor:u.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:ie,model:[o.AutoModelForImageSegmentation,o.AutoModelForSemanticSegmentation,o.AutoModelForUniversalSegmentation],processor:u.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:a.AutoTokenizer,pipeline:ge,model:o.AutoModel,processor:u.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:q,model:o.AutoModelForObjectDetection,processor:u.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:a.AutoTokenizer,pipeline:j,model:o.AutoModelForZeroShotObjectDetection,processor:u.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:a.AutoTokenizer,pipeline:R,model:o.AutoModelForDocumentQuestionAnswering,processor:u.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:G,model:o.AutoModelForImageToImage,processor:u.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:pe,model:o.AutoModelForDepthEstimation,processor:u.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:a.AutoTokenizer,pipeline:V,model:o.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:u.AutoProcessor,pipeline:re,model:[o.AutoModelForImageFeatureExtraction,o.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),Ie=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function Ne(je,oe=null,{progress_callback:ve=null,config:te=null,cache_dir:De=null,local_files_only:Xe=!1,revision:Be="main",device:Ee=null,dtype:Ve=null,subfolder:ke="onnx",use_external_data_format:Ke=null,model_file_name:et=null,session_options:ht={}}={}){je=Ie[je]??je;const Re=Te[je.split("_",1)[0]];if(!Re)throw Error(`Unsupported pipeline: ${je}. Must be one of [${Object.keys(Te)}]`);oe||(oe=Re.default.model,console.log(`No model specified. Using default model: "${oe}".`));const Tt={progress_callback:ve,config:te,cache_dir:De,local_files_only:Xe,revision:Be,device:Ee,dtype:Ve,subfolder:ke,use_external_data_format:Ke,model_file_name:et,session_options:ht},ut=new Map([["tokenizer",Re.tokenizer],["model",Re.model],["processor",Re.processor]]),st=await dt(ut,oe,Tt);st.task=je,(0,c.dispatchCallback)(ve,{status:"ready",task:je,model:oe});const mt=Re.pipeline;return new mt(st)}async function dt(je,oe,ve){const te=Object.create(null),De=[];for(const[Xe,Be]of je.entries()){if(!Be)continue;let Ee;Array.isArray(Be)?Ee=new Promise(async(Ve,ke)=>{let Ke;for(const et of Be){if(et===null){Ve(null);return}try{Ve(await et.from_pretrained(oe,ve));return}catch(ht){if(ht.message?.includes("Unsupported model type"))Ke=ht;else if(ht.message?.includes("Could not locate file"))Ke=ht;else{ke(ht);return}}}ke(Ke)}):Ee=Be.from_pretrained(oe,ve),te[Xe]=Ee,De.push(Ee)}await Promise.all(De);for(const[Xe,Be]of Object.entries(te))te[Xe]=await Be;return te}}),"./src/tokenizers.js":((t,r,n)=>{n.r(r),n.d(r,{AlbertTokenizer:()=>xn,AutoTokenizer:()=>oi,BartTokenizer:()=>Kt,BertTokenizer:()=>zr,BlenderbotSmallTokenizer:()=>Pn,BlenderbotTokenizer:()=>vt,BloomTokenizer:()=>Tn,CLIPTokenizer:()=>Ea,CamembertTokenizer:()=>He,CodeGenTokenizer:()=>ar,CodeLlamaTokenizer:()=>js,CohereTokenizer:()=>fs,ConvBertTokenizer:()=>le,DebertaTokenizer:()=>I,DebertaV2Tokenizer:()=>ue,DistilBertTokenizer:()=>Se,ElectraTokenizer:()=>Ct,Ernie4_5_Tokenizer:()=>ii,EsmTokenizer:()=>Jr,FalconTokenizer:()=>Pr,GPT2Tokenizer:()=>Xt,GPTNeoXTokenizer:()=>Gs,GemmaTokenizer:()=>Un,Grok1Tokenizer:()=>ds,HerbertTokenizer:()=>Y,LlamaTokenizer:()=>cs,M2M100Tokenizer:()=>Ws,MBart50Tokenizer:()=>dn,MBartTokenizer:()=>qn,MPNetTokenizer:()=>Rr,MarianTokenizer:()=>Ze,MgpstrTokenizer:()=>Sa,MobileBertTokenizer:()=>qt,NllbTokenizer:()=>gs,NougatTokenizer:()=>Mr,PreTrainedTokenizer:()=>Dt,Qwen2Tokenizer:()=>lr,RoFormerTokenizer:()=>he,RobertaTokenizer:()=>Nn,SiglipTokenizer:()=>Hs,SpeechT5Tokenizer:()=>ea,SqueezeBertTokenizer:()=>Fr,T5Tokenizer:()=>ft,TokenizerModel:()=>re,VitsTokenizer:()=>Ca,Wav2Vec2CTCTokenizer:()=>rt,WhisperTokenizer:()=>Ar,XLMRobertaTokenizer:()=>jn,XLMTokenizer:()=>Mt,is_chinese_char:()=>L});var a=n("./src/utils/generic.js"),o=n("./src/utils/core.js"),u=n("./src/utils/hub.js"),d=n("./src/utils/maths.js"),c=n("./src/utils/tensor.js"),f=n("./src/utils/data-structures.js"),p=n("./node_modules/@huggingface/jinja/dist/index.js"),g=n("./src/models/whisper/common_whisper.js");async function _(Me,z){const ee=await Promise.all([(0,u.getModelJSON)(Me,"tokenizer.json",!0,z),(0,u.getModelJSON)(Me,"tokenizer_config.json",!0,z)]);return z.legacy!==null&&(ee[1].legacy=z.legacy),ee}function h(Me,z){const ee=[];let de=0;for(const me of Me.matchAll(z)){const Oe=me[0];de<me.index&&ee.push(Me.slice(de,me.index)),Oe.length>0&&ee.push(Oe),de=me.index+Oe.length}return de<Me.length&&ee.push(Me.slice(de)),ee}function w(Me,z=!0){if(Me.Regex!==void 0){let ee=Me.Regex.replace(/\\([#&~])/g,"$1");for(const[de,me]of U)ee=ee.replaceAll(de,me);return new RegExp(ee,"gu")}else if(Me.String!==void 0){const ee=(0,o.escapeRegExp)(Me.String);return new RegExp(z?ee:`(${ee})`,"gu")}else return console.warn("Unknown pattern type:",Me),null}function M(Me){return new Map(Object.entries(Me))}function x(Me){const z=Me.dims;switch(z.length){case 1:return Me.tolist();case 2:if(z[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return Me.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${z.length}.`)}}function F(Me){return Me.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function E(Me){return Me.replace(new RegExp("\\p{M}","gu"),"")}function T(Me){return E(Me.toLowerCase())}function L(Me){return Me>=19968&&Me<=40959||Me>=13312&&Me<=19903||Me>=131072&&Me<=173791||Me>=173824&&Me<=177983||Me>=177984&&Me<=178207||Me>=178208&&Me<=183983||Me>=63744&&Me<=64255||Me>=194560&&Me<=195103}function O(Me,z,ee){const de=[];let me=0;for(;me<Me.length;){if(de.push(Me[me]),(z.get(Me[me])??ee)!==ee){++me;continue}for(;++me<Me.length&&(z.get(Me[me])??ee)===ee;)z.get(de.at(-1))!==ee&&(de[de.length-1]+=Me[me])}return de}function S(Me){return Me.match(/\S+/g)||[]}const $="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",C=new RegExp(`^[${$}]+$`,"gu"),k=".,!?…。，、।۔،",U=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],[` ?[^(\\s|[${k}])]+`,` ?[^\\s${k}]+`]]);class V{constructor(z){this.content=z.content,this.id=z.id,this.single_word=z.single_word??!1,this.lstrip=z.lstrip??!1,this.rstrip=z.rstrip??!1,this.special=z.special??!1,this.normalized=z.normalized??null}}class re extends a.Callable{constructor(z){super(),this.config=z,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(z,...ee){switch(z.type){case"WordPiece":return new ne(z);case"Unigram":return new W(z,...ee);case"BPE":return new H(z);default:if(z.vocab)return Array.isArray(z.vocab)?new W(z,...ee):Object.hasOwn(z,"continuing_subword_prefix")&&Object.hasOwn(z,"unk_token")?Object.hasOwn(z,"merges")?new H(z):new ne(z):new se(z,...ee);throw new Error(`Unknown TokenizerModel type: ${z.type}`)}}_call(z){return z=this.encode(z),this.fuse_unk&&(z=O(z,this.tokens_to_ids,this.unk_token_id)),z}encode(z){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(z){return z.map(ee=>this.tokens_to_ids.get(ee)??this.unk_token_id)}convert_ids_to_tokens(z){return z.map(ee=>this.vocab[ee]??this.unk_token)}}class ne extends re{constructor(z){super(z),this.tokens_to_ids=M(z.vocab),this.unk_token_id=this.tokens_to_ids.get(z.unk_token),this.unk_token=z.unk_token,this.max_input_chars_per_word=z.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[ee,de]of this.tokens_to_ids)this.vocab[de]=ee}encode(z){const ee=[];for(const de of z){const me=[...de];if(me.length>this.max_input_chars_per_word){ee.push(this.unk_token);continue}let Oe=!1,Ge=0;const pt=[];for(;Ge<me.length;){let gt=me.length,yt=null;for(;Ge<gt;){let ot=me.slice(Ge,gt).join("");if(Ge>0&&(ot=this.config.continuing_subword_prefix+ot),this.tokens_to_ids.has(ot)){yt=ot;break}--gt}if(yt===null){Oe=!0;break}pt.push(yt),Ge=gt}Oe?ee.push(this.unk_token):ee.push(...pt)}return ee}}class W extends re{constructor(z,ee){super(z);const de=z.vocab.length;this.vocab=new Array(de),this.scores=new Array(de);for(let me=0;me<de;++me)[this.vocab[me],this.scores[me]]=z.vocab[me];this.unk_token_id=z.unk_id,this.unk_token=this.vocab[z.unk_id],this.tokens_to_ids=new Map(this.vocab.map((me,Oe)=>[me,Oe])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=ee.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,d.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new f.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(z){const ee=z.chars,de=1;let me=0;for(;me<ee.length;){let Oe=!1;const Ge=ee.slice(me).join(""),pt=this.trie.commonPrefixSearch(Ge);for(const gt of pt){const yt=this.tokens_to_ids.get(gt),ot=this.scores[yt],Yt=(0,o.len)(gt);z.insert(me,Yt,ot,yt),!Oe&&Yt===de&&(Oe=!0)}Oe||z.insert(me,de,this.unk_score,this.unk_token_id),me+=de}}tokenize(z){const ee=new f.TokenLattice(z,this.bos_token_id,this.eos_token_id);return this.populateNodes(ee),ee.tokens()}encode(z){const ee=[];for(const de of z){const me=this.tokenize(de);ee.push(...me)}return ee}}const ce=(()=>{const Me=[...Array.from({length:94},(me,Oe)=>Oe+33),...Array.from({length:12},(me,Oe)=>Oe+161),...Array.from({length:82},(me,Oe)=>Oe+174)],z=Me.slice();let ee=0;for(let me=0;me<256;++me)Me.includes(me)||(Me.push(me),z.push(256+ee),ee+=1);const de=z.map(me=>String.fromCharCode(me));return Object.fromEntries(Me.map((me,Oe)=>[me,de[Oe]]))})(),ae=(0,o.reverseDictionary)(ce);class H extends re{constructor(z){super(z),this.tokens_to_ids=M(z.vocab),this.unk_token_id=this.tokens_to_ids.get(z.unk_token),this.unk_token=z.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[de,me]of this.tokens_to_ids)this.vocab[me]=de;const ee=Array.isArray(z.merges[0]);this.merges=ee?z.merges:z.merges.map(de=>de.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((de,me)=>[JSON.stringify(de),me])),this.end_of_word_suffix=z.end_of_word_suffix,this.continuing_subword_suffix=z.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new f.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(z){if(z.length===0)return[];const ee=this.cache.get(z);if(ee!==void 0)return ee;const de=Array.from(z);this.end_of_word_suffix&&(de[de.length-1]+=this.end_of_word_suffix);let me=[];if(de.length>1){const Oe=new f.PriorityQueue((gt,yt)=>gt.score<yt.score);let Ge={token:de[0],bias:0,prev:null,next:null},pt=Ge;for(let gt=1;gt<de.length;++gt){const yt={bias:gt/de.length,token:de[gt],prev:pt,next:null};pt.next=yt,this._add_node(Oe,pt),pt=yt}for(;!Oe.isEmpty();){const gt=Oe.pop();if(gt.deleted||!gt.next||gt.next.deleted)continue;if(gt.deleted=!0,gt.next.deleted=!0,gt.prev){const ot={...gt.prev};gt.prev.deleted=!0,gt.prev=ot,ot.prev?ot.prev.next=ot:Ge=ot}const yt={token:gt.token+gt.next.token,bias:gt.bias,prev:gt.prev,next:gt.next.next};yt.prev?(yt.prev.next=yt,this._add_node(Oe,yt.prev)):Ge=yt,yt.next&&(yt.next.prev=yt,this._add_node(Oe,yt))}for(let gt=Ge;gt!==null;gt=gt.next)me.push(gt.token)}else me=de;if(this.continuing_subword_suffix)for(let Oe=0;Oe<me.length-1;++Oe)me[Oe]+=this.continuing_subword_suffix;return z.length<this.max_length_to_cache&&this.cache.put(z,me),me}_add_node(z,ee){const de=this.bpe_ranks.get(JSON.stringify([ee.token,ee.next.token]));de!==void 0&&(ee.score=de+ee.bias,z.push(ee))}encode(z){const ee=[];for(const de of z){if(this.ignore_merges&&this.tokens_to_ids.has(de)){ee.push(de);continue}const me=this.bpe(de);for(const Oe of me)if(this.tokens_to_ids.has(Oe))ee.push(Oe);else if(this.byte_fallback){const Ge=Array.from(this.text_encoder.encode(Oe)).map(pt=>`<0x${pt.toString(16).toUpperCase().padStart(2,"0")}>`);Ge.every(pt=>this.tokens_to_ids.has(pt))?ee.push(...Ge):ee.push(this.unk_token)}else ee.push(this.unk_token)}return ee}}class se extends re{constructor(z,ee){super(z),this.tokens_to_ids=M(ee.target_lang?z.vocab[ee.target_lang]:z.vocab),this.bos_token=ee.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=ee.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=ee.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=ee.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[de,me]of this.tokens_to_ids)this.vocab[me]=de}encode(z){return z}}class ie extends a.Callable{constructor(z){super(),this.config=z}static fromConfig(z){if(z===null)return null;switch(z.type){case"BertNormalizer":return new je(z);case"Precompiled":return new Os(z);case"Sequence":return new dt(z);case"Replace":return new ge(z);case"NFC":return new j(z);case"NFD":return new R(z);case"NFKC":return new X(z);case"NFKD":return new G(z);case"Strip":return new pe(z);case"StripAccents":return new Te(z);case"Lowercase":return new Ie(z);case"Prepend":return new Ne(z);default:throw new Error(`Unknown Normalizer type: ${z.type}`)}}normalize(z){throw Error("normalize should be implemented in subclass.")}_call(z){return this.normalize(z)}}class ge extends ie{normalize(z){const ee=w(this.config.pattern);return ee===null?z:z.replaceAll(ee,this.config.content)}}class q extends ie{form=void 0;normalize(z){return z=z.normalize(this.form),z}}class j extends q{form="NFC"}class R extends q{form="NFD"}class X extends q{form="NFKC"}class G extends q{form="NFKD"}class pe extends ie{normalize(z){return this.config.strip_left&&this.config.strip_right?z=z.trim():(this.config.strip_left&&(z=z.trimStart()),this.config.strip_right&&(z=z.trimEnd())),z}}class Te extends ie{normalize(z){return z=E(z),z}}class Ie extends ie{normalize(z){return z=z.toLowerCase(),z}}class Ne extends ie{normalize(z){return z=this.config.prepend+z,z}}class dt extends ie{constructor(z){super(z),this.normalizers=z.normalizers.map(ee=>ie.fromConfig(ee))}normalize(z){return this.normalizers.reduce((ee,de)=>de.normalize(ee),z)}}class je extends ie{_tokenize_chinese_chars(z){const ee=[];for(let de=0;de<z.length;++de){const me=z[de],Oe=me.charCodeAt(0);L(Oe)?(ee.push(" "),ee.push(me),ee.push(" ")):ee.push(me)}return ee.join("")}stripAccents(z){return z.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(z){switch(z){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(z)}}_clean_text(z){const ee=[];for(const de of z){const me=de.charCodeAt(0);me===0||me===65533||this._is_control(de)||(/^\s$/.test(de)?ee.push(" "):ee.push(de))}return ee.join("")}normalize(z){return this.config.clean_text&&(z=this._clean_text(z)),this.config.handle_chinese_chars&&(z=this._tokenize_chinese_chars(z)),this.config.lowercase?(z=z.toLowerCase(),this.config.strip_accents!==!1&&(z=this.stripAccents(z))):this.config.strip_accents&&(z=this.stripAccents(z)),z}}class oe extends a.Callable{static fromConfig(z){if(z===null)return null;switch(z.type){case"BertPreTokenizer":return new ve(z);case"Sequence":return new Zs(z);case"Whitespace":return new Rn(z);case"WhitespaceSplit":return new $s(z);case"Metaspace":return new os(z);case"ByteLevel":return new te(z);case"Split":return new De(z);case"Punctuation":return new Xe(z);case"Digits":return new Be(z);case"Replace":return new xa(z);default:throw new Error(`Unknown PreTokenizer type: ${z.type}`)}}pre_tokenize_text(z,ee){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(z,ee){return(Array.isArray(z)?z.map(de=>this.pre_tokenize_text(de,ee)):this.pre_tokenize_text(z,ee)).flat()}_call(z,ee){return this.pre_tokenize(z,ee)}}class ve extends oe{constructor(z){super(),this.pattern=new RegExp(`[^\\s${$}]+|[${$}]`,"gu")}pre_tokenize_text(z,ee){return z.trim().match(this.pattern)||[]}}class te extends oe{constructor(z){super(),this.config=z,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=ce,this.text_encoder=new TextEncoder}pre_tokenize_text(z,ee){return this.add_prefix_space&&!z.startsWith(" ")&&(z=" "+z),(this.use_regex?z.match(this.pattern)||[]:[z]).map(me=>Array.from(this.text_encoder.encode(me),Oe=>this.byte_encoder[Oe]).join(""))}}class De extends oe{constructor(z){super(),this.config=z,this.pattern=w(this.config.pattern,this.config.invert)}pre_tokenize_text(z,ee){return this.pattern===null?[]:this.config.invert?z.match(this.pattern)||[]:this.config.behavior?.toLowerCase()==="removed"?z.split(this.pattern).filter(de=>de):h(z,this.pattern)}}class Xe extends oe{constructor(z){super(),this.config=z,this.pattern=new RegExp(`[^${$}]+|[${$}]+`,"gu")}pre_tokenize_text(z,ee){return z.match(this.pattern)||[]}}class Be extends oe{constructor(z){super(),this.config=z;const ee=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(ee,"gu")}pre_tokenize_text(z,ee){return z.match(this.pattern)||[]}}class Ee extends a.Callable{constructor(z){super(),this.config=z}static fromConfig(z){if(z===null)return null;switch(z.type){case"TemplateProcessing":return new Ke(z);case"ByteLevel":return new et(z);case"RobertaProcessing":return new ke(z);case"BertProcessing":return new Ve(z);case"Sequence":return new ht(z);default:throw new Error(`Unknown PostProcessor type: ${z.type}`)}}post_process(z,...ee){throw Error("post_process should be implemented in subclass.")}_call(z,...ee){return this.post_process(z,...ee)}}class Ve extends Ee{constructor(z){super(z),this.cls=z.cls[0],this.sep=z.sep[0]}post_process(z,ee=null,{add_special_tokens:de=!0}={}){de&&(z=(0,o.mergeArrays)([this.cls],z,[this.sep]));let me=new Array(z.length).fill(0);if(ee!==null){const Oe=de&&this instanceof ke?[this.sep]:[],Ge=de?[this.sep]:[];z=(0,o.mergeArrays)(z,Oe,ee,Ge),me=(0,o.mergeArrays)(me,new Array(ee.length+Oe.length+Ge.length).fill(1))}return{tokens:z,token_type_ids:me}}}class ke extends Ve{}class Ke extends Ee{constructor(z){super(z),this.single=z.single,this.pair=z.pair}post_process(z,ee=null,{add_special_tokens:de=!0}={}){const me=ee===null?this.single:this.pair;let Oe=[],Ge=[];for(const pt of me)"SpecialToken"in pt?de&&(Oe.push(pt.SpecialToken.id),Ge.push(pt.SpecialToken.type_id)):"Sequence"in pt&&(pt.Sequence.id==="A"?(Oe=(0,o.mergeArrays)(Oe,z),Ge=(0,o.mergeArrays)(Ge,new Array(z.length).fill(pt.Sequence.type_id))):pt.Sequence.id==="B"&&(Oe=(0,o.mergeArrays)(Oe,ee),Ge=(0,o.mergeArrays)(Ge,new Array(ee.length).fill(pt.Sequence.type_id))));return{tokens:Oe,token_type_ids:Ge}}}class et extends Ee{post_process(z,ee=null){return ee&&(z=(0,o.mergeArrays)(z,ee)),{tokens:z}}}class ht extends Ee{constructor(z){super(z),this.processors=z.processors.map(ee=>Ee.fromConfig(ee))}post_process(z,ee=null,de={}){let me;for(const Oe of this.processors)if(Oe instanceof et)z=Oe.post_process(z).tokens,ee&&(ee=Oe.post_process(ee).tokens);else{const Ge=Oe.post_process(z,ee,de);z=Ge.tokens,me=Ge.token_type_ids}return{tokens:z,token_type_ids:me}}}class Re extends a.Callable{constructor(z){super(),this.config=z,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=z.trim_offsets}static fromConfig(z){if(z===null)return null;switch(z.type){case"WordPiece":return new ct(z);case"Metaspace":return new Ts(z);case"ByteLevel":return new lt(z);case"Replace":return new Tt(z);case"ByteFallback":return new ut(z);case"Fuse":return new st(z);case"Strip":return new mt(z);case"Sequence":return new nn(z);case"CTC":return new bt(z);case"BPEDecoder":return new un(z);default:throw new Error(`Unknown Decoder type: ${z.type}`)}}_call(z){return this.decode(z)}decode(z){return this.decode_chain(z).join("")}decode_chain(z){throw Error("`decode_chain` should be implemented in subclass.")}}class Tt extends Re{decode_chain(z){const ee=w(this.config.pattern);return ee===null?z:z.map(de=>de.replaceAll(ee,this.config.content))}}class ut extends Re{constructor(z){super(z),this.text_decoder=new TextDecoder}decode_chain(z){const ee=[];let de=[];for(const me of z){let Oe=null;if(me.length===6&&me.startsWith("<0x")&&me.endsWith(">")){const Ge=parseInt(me.slice(3,5),16);isNaN(Ge)||(Oe=Ge)}if(Oe!==null)de.push(Oe);else{if(de.length>0){const Ge=this.text_decoder.decode(Uint8Array.from(de));ee.push(Ge),de=[]}ee.push(me)}}if(de.length>0){const me=this.text_decoder.decode(Uint8Array.from(de));ee.push(me),de=[]}return ee}}class st extends Re{decode_chain(z){return[z.join("")]}}class mt extends Re{constructor(z){super(z),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(z){return z.map(ee=>{let de=0;for(let Oe=0;Oe<this.start&&ee[Oe]===this.content;++Oe){de=Oe+1;continue}let me=ee.length;for(let Oe=0;Oe<this.stop;++Oe){const Ge=ee.length-Oe-1;if(ee[Ge]===this.content){me=Ge;continue}else break}return ee.slice(de,me)})}}class ct extends Re{constructor(z){super(z),this.cleanup=z.cleanup}decode_chain(z){return z.map((ee,de)=>(de!==0&&(ee.startsWith(this.config.prefix)?ee=ee.replace(this.config.prefix,""):ee=" "+ee),this.cleanup&&(ee=F(ee)),ee))}}class lt extends Re{constructor(z){super(z),this.byte_decoder=ae,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(z){const ee=z.join(""),de=new Uint8Array([...ee].map(Oe=>this.byte_decoder[Oe]));return this.text_decoder.decode(de)}decode_chain(z){const ee=[];let de=[];for(const me of z)this.added_tokens.find(Oe=>Oe.content===me)!==void 0?(de.length>0&&(ee.push(this.convert_tokens_to_string(de)),de=[]),ee.push(me)):de.push(me);return de.length>0&&ee.push(this.convert_tokens_to_string(de)),ee}}class bt extends Re{constructor(z){super(z),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(z){if(z.length===0)return"";const ee=[z[0]];for(let Oe=1;Oe<z.length;++Oe)z[Oe]!==ee.at(-1)&&ee.push(z[Oe]);let me=ee.filter(Oe=>Oe!==this.pad_token).join("");return this.cleanup&&(me=F(me).replaceAll(this.word_delimiter_token," ").trim()),me}decode_chain(z){return[this.convert_tokens_to_string(z)]}}class nn extends Re{constructor(z){super(z),this.decoders=z.decoders.map(ee=>Re.fromConfig(ee))}decode_chain(z){return this.decoders.reduce((ee,de)=>de.decode_chain(ee),z)}}class un extends Re{constructor(z){super(z),this.suffix=this.config.suffix}decode_chain(z){return z.map((ee,de)=>ee.replaceAll(this.suffix,de===z.length-1?"":" "))}}class It extends Re{decode_chain(z){let ee="";for(let de=1;de<z.length;de+=2)ee+=z[de];return[ee]}}class os extends oe{constructor(z){super(),this.addPrefixSpace=z.add_prefix_space,this.replacement=z.replacement,this.strRep=z.str_rep||this.replacement,this.prepend_scheme=z.prepend_scheme??"always"}pre_tokenize_text(z,{section_index:ee=void 0}={}){let de=z.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!de.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&ee===0)&&(de=this.strRep+de),[de]}}class Ts extends Re{constructor(z){super(z),this.addPrefixSpace=z.add_prefix_space,this.replacement=z.replacement}decode_chain(z){const ee=[];for(let de=0;de<z.length;++de){let me=z[de].replaceAll(this.replacement," ");this.addPrefixSpace&&de==0&&me.startsWith(" ")&&(me=me.substring(1)),ee.push(me)}return ee}}class Os extends ie{constructor(z){super(z),this.charsmap=z.precompiled_charsmap}normalize(z){return z=z.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),z=z.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),z.includes("～")?z=z.split("～").map(de=>de.normalize("NFKC")).join("～"):z=z.normalize("NFKC"),z}}class Zs extends oe{constructor(z){super(),this.tokenizers=z.pretokenizers.map(ee=>oe.fromConfig(ee))}pre_tokenize_text(z,ee){return this.tokenizers.reduce((de,me)=>me.pre_tokenize(de,ee),[z])}}class Rn extends oe{constructor(z){super()}pre_tokenize_text(z,ee){return z.match(/\w+|[^\w\s]+/g)||[]}}class $s extends oe{constructor(z){super()}pre_tokenize_text(z,ee){return S(z)}}class xa extends oe{constructor(z){super(),this.config=z,this.pattern=w(this.config.pattern),this.content=this.config.content}pre_tokenize_text(z,ee){return this.pattern===null?[z]:[z.replaceAll(this.pattern,this.config.content)]}}const Zr=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function br(Me,z,ee,de){for(const me of Object.keys(Me)){const Oe=z-Me[me].length,Ge=ee(me),pt=new Array(Oe).fill(Ge);Me[me]=de==="right"?(0,o.mergeArrays)(Me[me],pt):(0,o.mergeArrays)(pt,Me[me])}}function Ta(Me,z){for(const ee of Object.keys(Me))Me[ee].length=z}class Dt extends a.Callable{return_token_type_ids=!1;padding_side="right";constructor(z,ee){super(),this.config=ee,this.normalizer=ie.fromConfig(z.normalizer),this.pre_tokenizer=oe.fromConfig(z.pre_tokenizer),this.model=re.fromConfig(z.model,ee),this.post_processor=Ee.fromConfig(z.post_processor),this.decoder=Re.fromConfig(z.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const de of z.added_tokens){const me=new V(de);this.added_tokens.push(me),this.model.tokens_to_ids.set(me.content,me.id),this.model.vocab[me.id]=me.content,me.special&&(this.special_tokens.push(me.content),this.all_special_ids.push(me.id))}if(this.additional_special_tokens=ee.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new f.DictionarySplitter(this.added_tokens.map(de=>de.content)),this.added_tokens_map=new Map(this.added_tokens.map(de=>[de.content,de])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=ee.model_max_length,this.remove_space=ee.remove_space,this.clean_up_tokenization_spaces=ee.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=ee.do_lowercase_and_remove_accent??!1,ee.padding_side&&(this.padding_side=ee.padding_side),this.add_bos_token=ee.add_bos_token,this.add_eos_token=ee.add_eos_token,this.legacy=!1,this.chat_template=ee.chat_template??null,Array.isArray(this.chat_template)){const de=Object.create(null);for(const{name:me,template:Oe}of this.chat_template){if(typeof me!="string"||typeof Oe!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');de[me]=Oe}this.chat_template=de}this._compiled_template_cache=new Map}getToken(...z){for(const ee of z){const de=this.config[ee];if(de)if(typeof de=="object"){if(de.__type==="AddedToken")return de.content;throw Error(`Unknown token: ${de}`)}else return de}return null}static async from_pretrained(z,{progress_callback:ee=null,config:de=null,cache_dir:me=null,local_files_only:Oe=!1,revision:Ge="main",legacy:pt=null}={}){const gt=await _(z,{progress_callback:ee,config:de,cache_dir:me,local_files_only:Oe,revision:Ge,legacy:pt});return new this(...gt)}_call(z,{text_pair:ee=null,add_special_tokens:de=!0,padding:me=!1,truncation:Oe=null,max_length:Ge=null,return_tensor:pt=!0,return_token_type_ids:gt=null}={}){const yt=Array.isArray(z);let ot;if(yt){if(z.length===0)throw Error("text array must be non-empty");if(ee!==null){if(Array.isArray(ee)){if(z.length!==ee.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");ot=z.map((jt,An)=>this._encode_plus(jt,{text_pair:ee[An],add_special_tokens:de,return_token_type_ids:gt}))}else ot=z.map(jt=>this._encode_plus(jt,{add_special_tokens:de,return_token_type_ids:gt}))}else{if(z==null)throw Error("text may not be null or undefined");if(Array.isArray(ee))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");ot=[this._encode_plus(z,{text_pair:ee,add_special_tokens:de,return_token_type_ids:gt})]}if(Ge===null?Ge=this.model_max_length:Oe===null&&(me===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),Ge=this.model_max_length):me===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),Oe=!0)),me===!0&&(Ge=Math.min((0,d.max)(ot.map(jt=>jt.input_ids.length))[0],Ge??1/0)),Ge=Math.min(Ge,this.model_max_length??1/0),me||Oe)for(let jt=0;jt<ot.length;++jt)ot[jt].input_ids.length!==Ge&&(ot[jt].input_ids.length>Ge?Oe&&Ta(ot[jt],Ge):me&&br(ot[jt],Ge,An=>An==="input_ids"?this.pad_token_id:0,this.padding_side));const Yt={};if(pt){if(!(me&&Oe)&&ot.some(An=>{for(const Yn of Object.keys(An))if(An[Yn].length!==ot[0][Yn]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const jt=[ot.length,ot[0].input_ids.length];for(const An of Object.keys(ot[0]))Yt[An]=new c.Tensor("int64",BigInt64Array.from(ot.flatMap(Yn=>Yn[An]).map(BigInt)),jt)}else{for(const jt of Object.keys(ot[0]))Yt[jt]=ot.map(An=>An[jt]);if(!yt)for(const jt of Object.keys(Yt))Yt[jt]=Yt[jt][0]}return Yt}_encode_text(z){if(z===null)return null;const ee=this.added_tokens_splitter.split(z);for(let me=0;me<ee.length;++me){const Oe=this.added_tokens_map.get(ee[me]);Oe&&(Oe.lstrip&&me>0&&(ee[me-1]=ee[me-1].trimEnd()),Oe.rstrip&&me<ee.length-1&&(ee[me+1]=ee[me+1].trimStart()))}return ee.flatMap((me,Oe)=>{if(me.length===0)return[];if(this.added_tokens_map.has(me))return[me];if(this.remove_space===!0&&(me=me.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(me=T(me)),this.normalizer!==null&&(me=this.normalizer(me)),me.length===0)return[];const Ge=this.pre_tokenizer!==null?this.pre_tokenizer(me,{section_index:Oe}):[me];return this.model(Ge)})}_encode_plus(z,{text_pair:ee=null,add_special_tokens:de=!0,return_token_type_ids:me=null}={}){const{tokens:Oe,token_type_ids:Ge}=this._tokenize_helper(z,{pair:ee,add_special_tokens:de}),pt=this.model.convert_tokens_to_ids(Oe),gt={input_ids:pt,attention_mask:new Array(pt.length).fill(1)};return(me??this.return_token_type_ids)&&Ge&&(gt.token_type_ids=Ge),gt}_tokenize_helper(z,{pair:ee=null,add_special_tokens:de=!1}={}){const me=this._encode_text(z),Oe=this._encode_text(ee);return this.post_processor?this.post_processor(me,Oe,{add_special_tokens:de}):{tokens:(0,o.mergeArrays)(me??[],Oe??[])}}tokenize(z,{pair:ee=null,add_special_tokens:de=!1}={}){return this._tokenize_helper(z,{pair:ee,add_special_tokens:de}).tokens}encode(z,{text_pair:ee=null,add_special_tokens:de=!0,return_token_type_ids:me=null}={}){return this._encode_plus(z,{text_pair:ee,add_special_tokens:de,return_token_type_ids:me}).input_ids}batch_decode(z,ee={}){return z instanceof c.Tensor&&(z=z.tolist()),z.map(de=>this.decode(de,ee))}decode(z,ee={}){if(z instanceof c.Tensor&&(z=x(z)),!Array.isArray(z)||z.length===0||!(0,o.isIntegralNumber)(z[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(z,ee)}decode_single(z,{skip_special_tokens:ee=!1,clean_up_tokenization_spaces:de=null}){let me=this.model.convert_ids_to_tokens(z);ee&&(me=me.filter(Ge=>!this.special_tokens.includes(Ge)));let Oe=this.decoder?this.decoder(me):me.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(Oe=Oe.replaceAll(this.decoder.end_of_word_suffix," "),ee&&(Oe=Oe.trim())),(de??this.clean_up_tokenization_spaces)&&(Oe=F(Oe)),Oe}get_chat_template({chat_template:z=null,tools:ee=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const de=this.chat_template;if(z!==null&&Object.hasOwn(de,z))z=de[z];else if(z===null)if(ee!==null&&"tool_use"in de)z=de.tool_use;else if("default"in de)z=de.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(de).sort()}.`)}else if(z===null)if(this.chat_template)z=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return z}apply_chat_template(z,{tools:ee=null,documents:de=null,chat_template:me=null,add_generation_prompt:Oe=!1,tokenize:Ge=!0,padding:pt=!1,truncation:gt=!1,max_length:yt=null,return_tensor:ot=!0,return_dict:Yt=!1,tokenizer_kwargs:jt={},...An}={}){if(me=this.get_chat_template({chat_template:me,tools:ee}),typeof me!="string")throw Error(`chat_template must be a string, but got ${typeof me}`);let Yn=this._compiled_template_cache.get(me);Yn===void 0&&(Yn=new p.Template(me),this._compiled_template_cache.set(me,Yn));const In=Object.create(null);for(const On of Zr){const Ds=this.getToken(On);Ds&&(In[On]=Ds)}const Vn=Yn.render({messages:z,add_generation_prompt:Oe,tools:ee,documents:de,...In,...An});if(Ge){const On=this._call(Vn,{add_special_tokens:!1,padding:pt,truncation:gt,max_length:yt,return_tensor:ot,...jt});return Yt?On:On.input_ids}return Vn}}class zr extends Dt{return_token_type_ids=!0}class xn extends Dt{return_token_type_ids=!0}class qt extends Dt{return_token_type_ids=!0}class Fr extends Dt{return_token_type_ids=!0}class I extends Dt{return_token_type_ids=!0}class ue extends Dt{return_token_type_ids=!0}class Y extends Dt{return_token_type_ids=!0}class le extends Dt{return_token_type_ids=!0}class he extends Dt{return_token_type_ids=!0}class Se extends Dt{}class He extends Dt{}class Mt extends Dt{return_token_type_ids=!0;constructor(z,ee){super(z,ee),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Ct extends Dt{return_token_type_ids=!0}class ft extends Dt{}class Xt extends Dt{}class Kt extends Dt{}class qn extends Dt{constructor(z,ee){super(z,ee),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(de=>this.languageRegex.test(de)),this.lang_to_token=de=>de}_build_translation_inputs(z,ee,de){return ns(this,z,ee,de)}}class dn extends qn{}class Nn extends Dt{}class Tn extends Dt{}const Bn="▁";class cs extends Dt{padding_side="left";constructor(z,ee){super(z,ee),this.legacy=ee.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new os({replacement:Bn,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(z){if(z===null)return null;if(this.legacy||z.length===0)return super._encode_text(z);let ee=super._encode_text(Bn+z.replaceAll(Bn," "));return ee.length>1&&ee[0]===Bn&&this.special_tokens.includes(ee[1])&&(ee=ee.slice(1)),ee}}class js extends Dt{}class jn extends Dt{}class Rr extends Dt{}class Pr extends Dt{}class Gs extends Dt{}class Jr extends Dt{}class lr extends Dt{}class Un extends Dt{}class ds extends Dt{}function ns(Me,z,ee,de){if(!("language_codes"in Me)||!Array.isArray(Me.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in Me)||!(Me.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in Me)||typeof Me.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const me=de.src_lang,Oe=de.tgt_lang;if(!Me.language_codes.includes(Oe))throw new Error(`Target language code "${Oe}" is not valid. Must be one of: {${Me.language_codes.join(", ")}}`);if(me!==void 0){if(!Me.language_codes.includes(me))throw new Error(`Source language code "${me}" is not valid. Must be one of: {${Me.language_codes.join(", ")}}`);for(const Ge of Me.post_processor.config.single)if("SpecialToken"in Ge&&Me.languageRegex.test(Ge.SpecialToken.id)){Ge.SpecialToken.id=Me.lang_to_token(me);break}}return de.forced_bos_token_id=Me.model.convert_tokens_to_ids([Me.lang_to_token(Oe)])[0],Me._call(z,ee)}class gs extends Dt{constructor(z,ee){super(z,ee),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(de=>this.languageRegex.test(de)),this.lang_to_token=de=>de}_build_translation_inputs(z,ee,de){return ns(this,z,ee,de)}}class Ws extends Dt{constructor(z,ee){super(z,ee),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(de=>this.languageRegex.test(de)).map(de=>de.slice(2,-2)),this.lang_to_token=de=>`__${de}__`}_build_translation_inputs(z,ee,de){return ns(this,z,ee,de)}}class Ar extends Dt{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(z,{return_timestamps:ee=!1,return_language:de=!1,time_precision:me=null,force_full_sequences:Oe=!0}={}){if(me===null)throw Error("Must specify time_precision");let Ge=null;const pt=ee==="word";function gt(){return{language:Ge,timestamp:[null,null],text:""}}const yt=[];let ot=gt(),Yt=0;const jt=this.timestamp_begin,Yn=jt+1500;let In=[],Vn=[],On=!1,Ds=null;const Es=new Set(this.all_special_ids);for(const mn of z){const ss=mn.tokens,ks=pt?mn.token_timestamps:null;let Ks=null,ur=jt;if("stride"in mn){const[_n,gn,Zn]=mn.stride;if(Yt-=gn,Ds=_n-Zn,gn&&(ur=gn/me+jt),Zn)for(let Gn=ss.length-1;Gn>=0;--Gn){const Js=Number(ss[Gn]);if(Js>=jt){if(Ks!==null&&(Js-jt)*me<Ds)break;Ks=Js}}}let rs=[],vr=[];for(let _n=0;_n<ss.length;++_n){const gn=Number(ss[_n]);if(Es.has(gn)){const Zn=this.decode([gn]),Gn=g.WHISPER_LANGUAGE_MAPPING.get(Zn.slice(2,-2));if(Gn!==void 0){if(Ge!==null&&Gn!==Ge&&!ee){In.push(rs);const Js=this.findLongestCommonSequence(In)[0],ta=this.decode(Js);ot.text=ta,yt.push(ot),In=[],rs=[],ot=gt()}Ge=ot.language=Gn}}else if(gn>=jt&&gn<=Yn){const Zn=(gn-jt)*me+Yt,Gn=(0,d.round)(Zn,2);if(Ks!==null&&gn>=Ks)On=!0;else if(On||In.length>0&&gn<ur)On=!1;else if(ot.timestamp[0]===null)ot.timestamp[0]=Gn;else if(Gn!==ot.timestamp[0]){ot.timestamp[1]=Gn,In.push(rs),pt&&Vn.push(vr);const[Js,ta]=this.findLongestCommonSequence(In,Vn),li=this.decode(Js);ot.text=li,pt&&(ot.words=this.collateWordTimestamps(Js,ta,Ge)),yt.push(ot),In=[],rs=[],Vn=[],vr=[],ot=gt()}}else if(rs.push(gn),pt){let Zn=(0,d.round)(ks[_n]+Yt,2),Gn;if(_n+1<ks.length){Gn=(0,d.round)(ks[_n+1]+Yt,2);const Js=this.decode([gn]);C.test(Js)&&(Gn=(0,d.round)(Math.min(Zn+me,Gn),2))}else Gn=null;vr.push([Zn,Gn])}}if("stride"in mn){const[_n,gn,Zn]=mn.stride;Yt+=_n-Zn}rs.length>0?(In.push(rs),pt&&Vn.push(vr)):In.every(_n=>_n.length===0)&&(ot=gt(),In=[],rs=[],Vn=[],vr=[])}if(In.length>0){if(Oe&&ee)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[mn,ss]=this.findLongestCommonSequence(In,Vn),ks=this.decode(mn);ot.text=ks,pt&&(ot.words=this.collateWordTimestamps(mn,ss,Ge)),yt.push(ot)}let Cs=Object.create(null);const qs=yt.map(mn=>mn.text).join("");if(ee||de){for(let mn=0;mn<yt.length;++mn){const ss=yt[mn];ee||delete ss.timestamp,de||delete ss.language}if(pt){const mn=[];for(const ss of yt)for(const ks of ss.words)mn.push(ks);Cs={chunks:mn}}else Cs={chunks:yt}}return[qs,Cs]}findLongestCommonSequence(z,ee=null){let de=z[0],me=de.length,Oe=[];const Ge=Array.isArray(ee)&&ee.length>0;let pt=Ge?[]:null,gt=Ge?ee[0]:null;for(let yt=1;yt<z.length;++yt){const ot=z[yt];let Yt=0,jt=[me,me,0,0];const An=ot.length;for(let Cs=1;Cs<me+An;++Cs){const qs=Math.max(0,me-Cs),mn=Math.min(me,me+An-Cs),ss=de.slice(qs,mn),ks=Math.max(0,Cs-me),Ks=Math.min(An,Cs),ur=ot.slice(ks,Ks);if(ss.length!==ur.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let rs;Ge?rs=ss.filter((gn,Zn)=>gn===ur[Zn]&&gt[qs+Zn]<=ee[yt][ks+Zn]).length:rs=ss.filter((gn,Zn)=>gn===ur[Zn]).length;const vr=Cs/1e4,_n=rs/Cs+vr;rs>1&&_n>Yt&&(Yt=_n,jt=[qs,mn,ks,Ks])}const[Yn,In,Vn,On]=jt,Ds=Math.floor((In+Yn)/2),Es=Math.floor((On+Vn)/2);Oe.push(...de.slice(0,Ds)),de=ot.slice(Es),me=de.length,Ge&&(pt.push(...gt.slice(0,Ds)),gt=ee[yt].slice(Es))}return Oe.push(...de),Ge?(pt.push(...gt),[Oe,pt]):[Oe,[]]}collateWordTimestamps(z,ee,de){const[me,Oe,Ge]=this.combineTokensIntoWords(z,de),pt=[];for(let gt=0;gt<me.length;++gt){const yt=Ge[gt];pt.push({text:me[gt],timestamp:[ee[yt.at(0)][0],ee[yt.at(-1)][1]]})}return pt}combineTokensIntoWords(z,ee,de=`"'“¡¿([{-`,me=`"'.。,，!！?？:：”)]}、`){ee=ee??"english";let Oe,Ge,pt;return["chinese","japanese","thai","lao","myanmar"].includes(ee)?[Oe,Ge,pt]=this.splitTokensOnUnicode(z):[Oe,Ge,pt]=this.splitTokensOnSpaces(z),this.mergePunctuations(Oe,Ge,pt,de,me)}decode(z,ee){let de;return ee?.decode_with_timestamps?(z instanceof c.Tensor&&(z=x(z)),de=this.decodeWithTimestamps(z,ee)):de=super.decode(z,ee),de}decodeWithTimestamps(z,ee){const de=ee?.time_precision??.02,me=Array.from(this.all_special_ids).at(-1)+1;let Oe=[[]];for(let Ge of z)if(Ge=Number(Ge),Ge>=me){const pt=((Ge-me)*de).toFixed(2);Oe.push(`<|${pt}|>`),Oe.push([])}else Oe[Oe.length-1].push(Ge);return Oe=Oe.map(Ge=>typeof Ge=="string"?Ge:super.decode(Ge,ee)),Oe.join("")}splitTokensOnUnicode(z){const ee=this.decode(z,{decode_with_timestamps:!0}),de="�",me=[],Oe=[],Ge=[];let pt=[],gt=[],yt=0;for(let ot=0;ot<z.length;++ot){const Yt=z[ot];pt.push(Yt),gt.push(ot);const jt=this.decode(pt,{decode_with_timestamps:!0});(!jt.includes(de)||ee[yt+jt.indexOf(de)]===de)&&(me.push(jt),Oe.push(pt),Ge.push(gt),pt=[],gt=[],yt+=jt.length)}return[me,Oe,Ge]}splitTokensOnSpaces(z){const[ee,de,me]=this.splitTokensOnUnicode(z),Oe=[],Ge=[],pt=[],gt=new RegExp(`^[${$}]$`,"gu");for(let yt=0;yt<ee.length;++yt){const ot=ee[yt],Yt=de[yt],jt=me[yt],An=Yt[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Yn=ot.startsWith(" "),In=ot.trim(),Vn=gt.test(In);if(An||Yn||Vn||Oe.length===0)Oe.push(ot),Ge.push(Yt),pt.push(jt);else{const On=Oe.length-1;Oe[On]+=ot,Ge[On].push(...Yt),pt[On].push(...jt)}}return[Oe,Ge,pt]}mergePunctuations(z,ee,de,me,Oe){const Ge=structuredClone(z),pt=structuredClone(ee),gt=structuredClone(de);let yt=Ge.length-2,ot=Ge.length-1;for(;yt>=0;)Ge[yt].startsWith(" ")&&me.includes(Ge[yt].trim())?(Ge[ot]=Ge[yt]+Ge[ot],pt[ot]=(0,o.mergeArrays)(pt[yt],pt[ot]),gt[ot]=(0,o.mergeArrays)(gt[yt],gt[ot]),Ge[yt]="",pt[yt]=[],gt[yt]=[]):ot=yt,--yt;for(yt=0,ot=1;ot<Ge.length;)!Ge[yt].endsWith(" ")&&Oe.includes(Ge[ot])?(Ge[yt]+=Ge[ot],pt[yt]=(0,o.mergeArrays)(pt[yt],pt[ot]),gt[yt]=(0,o.mergeArrays)(gt[yt],gt[ot]),Ge[ot]="",pt[ot]=[],gt[ot]=[]):yt=ot,++ot;return[Ge.filter(Yt=>Yt),pt.filter(Yt=>Yt.length>0),gt.filter(Yt=>Yt.length>0)]}}class ar extends Dt{}class Ea extends Dt{}class Hs extends Dt{}class Ze extends Dt{constructor(z,ee){super(z,ee),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(de=>this.languageRegex.test(de)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(z){if(z===null)return null;const[ee,...de]=z.trim().split(this.languageRegex);if(de.length===0)return super._encode_text(ee);if(de.length===2){const[me,Oe]=de;return this.supported_language_codes.includes(me)||console.warn(`Unsupported language code "${me}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,o.mergeArrays)([me],super._encode_text(Oe))}}}class rt extends Dt{}class vt extends Dt{}class Pn extends Dt{}class ea extends Dt{}class Mr extends Dt{}class Ca extends Dt{constructor(z,ee){super(z,ee),this.decoder=new It({})}}class fs extends Dt{}class Sa extends Dt{}class ii extends Dt{}class oi{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:ft,DistilBertTokenizer:Se,CamembertTokenizer:He,DebertaTokenizer:I,DebertaV2Tokenizer:ue,BertTokenizer:zr,HerbertTokenizer:Y,ConvBertTokenizer:le,RoFormerTokenizer:he,XLMTokenizer:Mt,ElectraTokenizer:Ct,MobileBertTokenizer:qt,SqueezeBertTokenizer:Fr,AlbertTokenizer:xn,GPT2Tokenizer:Xt,BartTokenizer:Kt,MBartTokenizer:qn,MBart50Tokenizer:dn,RobertaTokenizer:Nn,WhisperTokenizer:Ar,CodeGenTokenizer:ar,CLIPTokenizer:Ea,SiglipTokenizer:Hs,MarianTokenizer:Ze,BloomTokenizer:Tn,NllbTokenizer:gs,M2M100Tokenizer:Ws,LlamaTokenizer:cs,CodeLlamaTokenizer:js,XLMRobertaTokenizer:jn,MPNetTokenizer:Rr,FalconTokenizer:Pr,GPTNeoXTokenizer:Gs,EsmTokenizer:Jr,Wav2Vec2CTCTokenizer:rt,BlenderbotTokenizer:vt,BlenderbotSmallTokenizer:Pn,SpeechT5Tokenizer:ea,NougatTokenizer:Mr,VitsTokenizer:Ca,Qwen2Tokenizer:lr,GemmaTokenizer:Un,Grok1Tokenizer:ds,CohereTokenizer:fs,MgpstrTokenizer:Sa,Ernie4_5_Tokenizer:ii,PreTrainedTokenizer:Dt};static async from_pretrained(z,{progress_callback:ee=null,config:de=null,cache_dir:me=null,local_files_only:Oe=!1,revision:Ge="main",legacy:pt=null}={}){const[gt,yt]=await _(z,{progress_callback:ee,config:de,cache_dir:me,local_files_only:Oe,revision:Ge,legacy:pt}),ot=yt.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer";let Yt=this.TOKENIZER_CLASS_MAPPING[ot];return Yt||(console.warn(`Unknown tokenizer class "${ot}", attempting to construct from base class.`),Yt=Dt),new Yt(gt,yt)}}}),"./src/utils/audio.js":((t,r,n)=>{n.r(r),n.d(r,{RawAudio:()=>ne,hamming:()=>h,hanning:()=>_,mel_filter_bank:()=>L,read_audio:()=>p,spectrogram:()=>k,window_function:()=>U});var a=n("./src/utils/hub.js"),o=n("./src/utils/maths.js"),u=n("./src/utils/core.js"),d=n("./src/env.js"),c=n("./src/utils/tensor.js"),f=n("?7992");async function p(W,ce){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const ae=await(await(0,a.getFile)(W)).arrayBuffer(),H=new AudioContext({sampleRate:ce});typeof ce>"u"&&console.warn(`No sampling rate provided, using default of ${H.sampleRate}Hz.`);const se=await H.decodeAudioData(ae);let ie;if(se.numberOfChannels===2){const ge=Math.sqrt(2),q=se.getChannelData(0),j=se.getChannelData(1);ie=new Float32Array(q.length);for(let R=0;R<se.length;++R)ie[R]=ge*(q[R]+j[R])/2}else ie=se.getChannelData(0);return ie}function g(W,ce){if(W<1)return new Float64Array;if(W===1)return new Float64Array([1]);const ae=1-ce,H=2*Math.PI/(W-1),se=new Float64Array(W);for(let ie=0;ie<W;++ie)se[ie]=ce-ae*Math.cos(ie*H);return se}function _(W){return g(W,.5)}function h(W){return g(W,.54)}const w={htk:W=>2595*Math.log10(1+W/700),kaldi:W=>1127*Math.log(1+W/700),slaney:(W,ce=1e3,ae=15,H=27/Math.log(6.4))=>W>=ce?ae+Math.log(W/ce)*H:3*W/200};function M(W,ce="htk"){const ae=w[ce];if(!ae)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof W=="number"?ae(W):W.map(H=>ae(H))}const x={htk:W=>700*(10**(W/2595)-1),kaldi:W=>700*(Math.exp(W/1127)-1),slaney:(W,ce=1e3,ae=15,H=Math.log(6.4)/27)=>W>=ae?ce*Math.exp(H*(W-ae)):200*W/3};function F(W,ce="htk"){const ae=x[ce];if(!ae)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof W=="number"?ae(W):W.map(H=>ae(H))}function E(W,ce){const ae=Float64Array.from({length:ce.length-1},(ge,q)=>ce[q+1]-ce[q]),H=Array.from({length:W.length},()=>new Array(ce.length));for(let ge=0;ge<W.length;++ge){const q=H[ge];for(let j=0;j<ce.length;++j)q[j]=ce[j]-W[ge]}const se=ce.length-2,ie=Array.from({length:se},()=>new Array(W.length));for(let ge=0;ge<W.length;++ge){const q=H[ge];for(let j=0;j<se;++j){const R=-q[j]/ae[j],X=q[j+2]/ae[j+1];ie[j][ge]=Math.max(0,Math.min(R,X))}}return ie}function T(W,ce,ae){const H=(ce-W)/(ae-1);return Float64Array.from({length:ae},(se,ie)=>W+H*ie)}function L(W,ce,ae,H,se,ie=null,ge="htk",q=!1){if(ie!==null&&ie!=="slaney")throw new Error('norm must be one of null or "slaney"');if(W<2)throw new Error(`Require num_frequency_bins: ${W} >= 2`);if(ae>H)throw new Error(`Require min_frequency: ${ae} <= max_frequency: ${H}`);const j=M(ae,ge),R=M(H,ge),X=T(j,R,ce+2);let G=F(X,ge),pe;if(q){const Ie=se/((W-1)*2);pe=M(Float64Array.from({length:W},(Ne,dt)=>dt*Ie),ge),G=X}else pe=T(0,Math.floor(se/2),W);const Te=E(pe,G);if(ie!==null&&ie==="slaney")for(let Ie=0;Ie<ce;++Ie){const Ne=Te[Ie],dt=2/(G[Ie+2]-G[Ie]);for(let je=0;je<W;++je)Ne[je]*=dt}return Te}function O(W,ce,ae){const H=new W.constructor(W.length+ce+ae),se=W.length-1;for(let ie=0;ie<W.length;++ie)H[ce+ie]=W[ie];for(let ie=1;ie<=ce;++ie)H[ce-ie]=W[(0,u.calculateReflectOffset)(ie,se)];for(let ie=1;ie<=ae;++ie)H[se+ce+ie]=W[(0,u.calculateReflectOffset)(se-ie,se)];return H}function S(W,ce,ae,H,se){if(ae<=0)throw new Error("reference must be greater than zero");if(H<=0)throw new Error("min_value must be greater than zero");ae=Math.max(H,ae);const ie=Math.log10(ae);for(let ge=0;ge<W.length;++ge)W[ge]=ce*Math.log10(Math.max(H,W[ge])-ie);if(se!==null){if(se<=0)throw new Error("db_range must be greater than zero");const ge=(0,o.max)(W)[0]-se;for(let q=0;q<W.length;++q)W[q]=Math.max(W[q],ge)}return W}function $(W,ce=1,ae=1e-5,H=null){return S(W,20,ce,ae,H)}function C(W,ce=1,ae=1e-10,H=null){return S(W,10,ce,ae,H)}async function k(W,ce,ae,H,{fft_length:se=null,power:ie=1,center:ge=!0,pad_mode:q="reflect",onesided:j=!0,preemphasis:R=null,preemphasis_htk_flavor:X=!0,mel_filters:G=null,mel_floor:pe=1e-10,log_mel:Te=null,reference:Ie=1,min_value:Ne=1e-10,db_range:dt=null,remove_dc_offset:je=null,min_num_frames:oe=null,max_num_frames:ve=null,do_pad:te=!0,transpose:De=!1}={}){const Xe=ce.length;if(se===null&&(se=ae),ae>se)throw Error(`frame_length (${ae}) may not be larger than fft_length (${se})`);if(Xe!==ae)throw new Error(`Length of the window (${Xe}) must equal frame_length (${ae})`);if(H<=0)throw new Error("hop_length must be greater than zero");if(ie===null&&G!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!X)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(ge){if(q!=="reflect")throw new Error(`pad_mode="${q}" not implemented yet.`);const mt=Math.floor((se-1)/2)+1;W=O(W,mt,mt)}let Be=Math.floor(1+Math.floor((W.length-ae)/H));oe!==null&&Be<oe&&(Be=oe);const Ee=j?Math.floor(se/2)+1:se;let Ve=Be,ke=Be;ve!==null&&(ve>Be?te&&(ke=ve):ke=Ve=ve);const Ke=new o.FFT(se),et=new Float64Array(se),ht=new Float64Array(Ke.outputBufferSize),Re=new Float32Array(Ee*ke);for(let mt=0;mt<Ve;++mt){const ct=mt*H,lt=Math.min(W.length-ct,ae);lt!==ae&&et.fill(0,0,ae);for(let bt=0;bt<lt;++bt)et[bt]=W[ct+bt];if(je){let bt=0;for(let un=0;un<lt;++un)bt+=et[un];const nn=bt/lt;for(let un=0;un<lt;++un)et[un]-=nn}if(R!==null){for(let bt=lt-1;bt>=1;--bt)et[bt]-=R*et[bt-1];et[0]*=1-R}for(let bt=0;bt<ce.length;++bt)et[bt]*=ce[bt];Ke.realTransform(ht,et);for(let bt=0;bt<Ee;++bt){const nn=bt<<1;Re[bt*ke+mt]=ht[nn]**2+ht[nn+1]**2}}if(ie!==null&&ie!==2){const mt=ie/2;for(let ct=0;ct<Re.length;++ct)Re[ct]**=mt}const Tt=G.length;let ut=await(0,c.matmul)(new c.Tensor("float32",G.flat(),[Tt,Ee]),new c.Tensor("float32",Re,[Ee,ke]));De&&(ut=ut.transpose(1,0));const st=ut.data;for(let mt=0;mt<st.length;++mt)st[mt]=Math.max(pe,st[mt]);if(ie!==null&&Te!==null){const mt=Math.min(st.length,Ve*Tt);switch(Te){case"log":for(let ct=0;ct<mt;++ct)st[ct]=Math.log(st[ct]);break;case"log10":for(let ct=0;ct<mt;++ct)st[ct]=Math.log10(st[ct]);break;case"dB":if(ie===1)$(st,Ie,Ne,dt);else if(ie===2)C(st,Ie,Ne,dt);else throw new Error(`Cannot use log_mel option '${Te}' with power ${ie}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${Te}'`)}}return ut}function U(W,ce,{periodic:ae=!0,frame_length:H=null,center:se=!0}={}){const ie=ae?W+1:W;let ge;switch(ce){case"boxcar":ge=new Float64Array(ie).fill(1);break;case"hann":case"hann_window":ge=_(ie);break;case"hamming":ge=h(ie);break;case"povey":ge=_(ie).map(q=>Math.pow(q,.85));break;default:throw new Error(`Unknown window type ${ce}.`)}if(ae&&(ge=ge.subarray(0,W)),H===null)return ge;if(W>H)throw new Error(`Length of the window (${W}) may not be larger than frame_length (${H})`);return ge}function V(W,ce){let ae=44;const H=new ArrayBuffer(ae+W.length*4),se=new DataView(H);re(se,0,"RIFF"),se.setUint32(4,36+W.length*4,!0),re(se,8,"WAVE"),re(se,12,"fmt "),se.setUint32(16,16,!0),se.setUint16(20,3,!0),se.setUint16(22,1,!0),se.setUint32(24,ce,!0),se.setUint32(28,ce*4,!0),se.setUint16(32,4,!0),se.setUint16(34,32,!0),re(se,36,"data"),se.setUint32(40,W.length*4,!0);for(let ie=0;ie<W.length;++ie,ae+=4)se.setFloat32(ae,W[ie],!0);return H}function re(W,ce,ae){for(let H=0;H<ae.length;++H)W.setUint8(ce+H,ae.charCodeAt(H))}class ne{constructor(ce,ae){this.audio=ce,this.sampling_rate=ae}toWav(){return V(this.audio,this.sampling_rate)}toBlob(){const ce=this.toWav();return new Blob([ce],{type:"audio/wav"})}async save(ce){let ae;if(d.apis.IS_BROWSER_ENV){if(d.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");ae=u.saveBlob}else if(d.apis.IS_FS_AVAILABLE)ae=async(H,se)=>{let ie=await se.arrayBuffer();f.writeFileSync(H,Buffer.from(ie))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await ae(ce,this.toBlob())}}}),"./src/utils/constants.js":((t,r,n)=>{n.r(r),n.d(r,{CHAT_TEMPLATE_NAME:()=>f,CONFIG_NAME:()=>o,FEATURE_EXTRACTOR_NAME:()=>u,GENERATION_CONFIG_NAME:()=>p,GITHUB_ISSUE_URL:()=>a,IMAGE_PROCESSOR_NAME:()=>d,PROCESSOR_NAME:()=>c});const a="https://github.com/huggingface/transformers.js/issues/new/choose",o="config.json",u="preprocessor_config.json",d=u,c="processor_config.json",f="chat_template.jinja",p="generation_config.json"}),"./src/utils/core.js":((t,r,n)=>{n.r(r),n.d(r,{calculateDimensions:()=>p,calculateReflectOffset:()=>w,count:()=>E,dispatchCallback:()=>a,escapeRegExp:()=>u,isIntegralNumber:()=>c,isNullishDimension:()=>f,isTypedArray:()=>d,len:()=>F,mergeArrays:()=>_,pick:()=>x,pop:()=>g,product:()=>h,reverseDictionary:()=>o,saveBlob:()=>M});function a(T,L){T&&T(L)}function o(T){return Object.fromEntries(Object.entries(T).map(([L,O])=>[O,L]))}function u(T){return T.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function d(T){return T?.prototype?.__proto__?.constructor?.name==="TypedArray"}function c(T){return Number.isInteger(T)||typeof T=="bigint"}function f(T){return T==null||T===-1}function p(T){const L=[];let O=T;for(;Array.isArray(O);)L.push(O.length),O=O[0];return L}function g(T,L,O=void 0){const S=T[L];if(S!==void 0)return delete T[L],S;if(O===void 0)throw Error(`Key ${L} does not exist in object.`);return O}function _(...T){return Array.prototype.concat.apply([],T)}function h(...T){return T.reduce((L,O)=>L.flatMap(S=>O.map($=>[S,$])))}function w(T,L){return Math.abs((T+L)%(2*L)-L)}function M(T,L){const O=URL.createObjectURL(L),S=document.createElement("a");S.href=O,S.download=T,S.click(),S.remove(),URL.revokeObjectURL(O)}function x(T,L){return Object.assign({},...L.map(O=>{if(T[O]!==void 0)return{[O]:T[O]}}))}function F(T){let L=0;for(const O of T)++L;return L}function E(T,L){let O=0;for(const S of T)S===L&&++O;return O}}),"./src/utils/data-structures.js":((t,r,n)=>{n.r(r),n.d(r,{CharTrie:()=>o,DictionarySplitter:()=>f,LRUCache:()=>p,PriorityQueue:()=>a,TokenLattice:()=>d});class a{constructor(_=(w,M)=>w>M,h=1/0){this._heap=[],this._comparator=_,this._maxSize=h}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(..._){return this.extend(_)}extend(_){for(const h of _)if(this.size<this._maxSize)this._heap.push(h),this._siftUp();else{const w=this._smallest();this._comparator(h,this._heap[w])&&(this._heap[w]=h,this._siftUpFrom(w))}return this.size}pop(){const _=this.peek(),h=this.size-1;return h>0&&this._swap(0,h),this._heap.pop(),this._siftDown(),_}replace(_){const h=this.peek();return this._heap[0]=_,this._siftDown(),h}_parent(_){return(_+1>>>1)-1}_left(_){return(_<<1)+1}_right(_){return _+1<<1}_greater(_,h){return this._comparator(this._heap[_],this._heap[h])}_swap(_,h){const w=this._heap[_];this._heap[_]=this._heap[h],this._heap[h]=w}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(_){for(;_>0&&this._greater(_,this._parent(_));)this._swap(_,this._parent(_)),_=this._parent(_)}_siftDown(){let _=0;for(;this._left(_)<this.size&&this._greater(this._left(_),_)||this._right(_)<this.size&&this._greater(this._right(_),_);){const h=this._right(_)<this.size&&this._greater(this._right(_),this._left(_))?this._right(_):this._left(_);this._swap(_,h),_=h}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class o{constructor(){this.root=u.default()}extend(_){for(const h of _)this.push(h)}push(_){let h=this.root;for(const w of _){let M=h.children.get(w);M===void 0&&(M=u.default(),h.children.set(w,M)),h=M}h.isLeaf=!0}*commonPrefixSearch(_){let h=this.root;if(h===void 0)return;let w="";for(const M of _){if(w+=M,h=h.children.get(M),h===void 0)return;h.isLeaf&&(yield w)}}}class u{constructor(_,h){this.isLeaf=_,this.children=h}static default(){return new u(!1,new Map)}}class d{constructor(_,h,w){this.chars=Array.from(_),this.len=this.chars.length,this.bosTokenId=h,this.eosTokenId=w,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const M=new c(this.bosTokenId,0,0,0,0),x=new c(this.eosTokenId,1,this.len,0,0);this.nodes.push(M.clone()),this.nodes.push(x.clone()),this.beginNodes[this.len].push(x),this.endNodes[0].push(M)}insert(_,h,w,M){const x=this.nodes.length,F=new c(M,x,_,h,w);this.beginNodes[_].push(F),this.endNodes[_+h].push(F),this.nodes.push(F)}viterbi(){const _=this.len;let h=0;for(;h<=_;){if(this.beginNodes[h].length==0)return[];for(let E of this.beginNodes[h]){E.prev=null;let T=0,L=null;for(let O of this.endNodes[h]){const S=O.backtraceScore+E.score;(L===null||S>T)&&(L=O.clone(),T=S)}if(L!==null)E.prev=L,E.backtraceScore=T;else return[]}++h}const w=[],x=this.beginNodes[_][0].prev;if(x===null)return[];let F=x.clone();for(;F.prev!==null;)w.push(F.clone()),F=F.clone().prev.clone();return w.reverse(),w}piece(_){return this.chars.slice(_.pos,_.pos+_.length).join("")}tokens(){return this.viterbi().map(h=>this.piece(h))}tokenIds(){return this.viterbi().map(h=>h.tokenId)}}class c{constructor(_,h,w,M,x){this.tokenId=_,this.nodeId=h,this.pos=w,this.length=M,this.score=x,this.prev=null,this.backtraceScore=0}clone(){const _=new c(this.tokenId,this.nodeId,this.pos,this.length,this.score);return _.prev=this.prev,_.backtraceScore=this.backtraceScore,_}}class f{constructor(_){this.trie=this._buildTrie(_)}_buildTrie(_){const h=Object.create(null);for(const w of _){let M=h;for(let x=0;x<w.length;++x)M=M[w[x]]??=Object.create(null);M.end=w}return h}split(_){const h=[],w=_.length;let M=0,x=0;for(;x<w;){let F=this.trie,E=null,T=x;for(;T<w&&(F=F[_[T]]);)F.end&&(E=F.end),++T;E?(x>M&&h.push(_.slice(M,x)),h.push(E),x+=E.length,M=x):++x}return M<w&&h.push(_.slice(M)),h}}class p{constructor(_){this.capacity=_,this.cache=new Map}get(_){if(!this.cache.has(_))return;const h=this.cache.get(_);return this.cache.delete(_),this.cache.set(_,h),h}put(_,h){this.cache.has(_)&&this.cache.delete(_),this.cache.set(_,h),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}}),"./src/utils/devices.js":((t,r,n)=>{n.r(r),n.d(r,{DEVICE_TYPES:()=>a});const a=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})}),"./src/utils/dtypes.js":((t,r,n)=>{n.r(r),n.d(r,{DATA_TYPES:()=>d,DEFAULT_DEVICE_DTYPE_MAPPING:()=>c,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>f,isWebGpuFp16Supported:()=>u});var a=n("./src/env.js"),o=n("./src/utils/devices.js");const u=(function(){let p;return async function(){if(p===void 0)if(!a.apis.IS_WEBGPU_AVAILABLE)p=!1;else try{p=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{p=!1}return p}})(),d=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),c=Object.freeze({[o.DEVICE_TYPES.wasm]:d.q8}),f=Object.freeze({[d.fp32]:"",[d.fp16]:"_fp16",[d.int8]:"_int8",[d.uint8]:"_uint8",[d.q8]:"_quantized",[d.q4]:"_q4",[d.q4f16]:"_q4f16",[d.bnb4]:"_bnb4"})}),"./src/utils/generic.js":((t,r,n)=>{n.r(r),n.d(r,{Callable:()=>a});const a=class{constructor(){let o=function(...u){return o._call(...u)};return Object.setPrototypeOf(o,new.target.prototype)}_call(...o){throw Error("Must implement _call method in subclass")}}}),"./src/utils/hub.js":((t,r,n)=>{n.r(r),n.d(r,{MAX_EXTERNAL_DATA_CHUNKS:()=>c,getFile:()=>w,getModelFile:()=>T,getModelJSON:()=>O,getModelText:()=>L});var a=n("?7992"),o=n("?5af5"),u=n("./src/env.js"),d=n("./src/utils/core.js");const c=100,f={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class p{constructor(k){if(this.filePath=k,this.headers=new Headers,this.exists=a.existsSync(k),this.exists){this.status=200,this.statusText="OK";let U=a.statSync(k);this.headers.set("content-length",U.size.toString()),this.updateContentType();const V=a.createReadStream(k);this.body=new ReadableStream({start(re){V.on("data",ne=>re.enqueue(ne)),V.on("end",()=>re.close()),V.on("error",ne=>re.error(ne))},cancel(){V.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const k=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",f[k]??"application/octet-stream")}clone(){let k=new p(this.filePath);return k.exists=this.exists,k.status=this.status,k.statusText=this.statusText,k.headers=new Headers(this.headers),k}async arrayBuffer(){return(await a.promises.readFile(this.filePath)).buffer}async blob(){const k=await a.promises.readFile(this.filePath);return new Blob([k],{type:this.headers.get("content-type")})}async text(){return await a.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function g(C,k=null,U=null){let V;try{V=new URL(C)}catch{return!1}return!(k&&!k.includes(V.protocol)||U&&!U.includes(V.hostname))}const _=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function h(C){return!(!_.test(C)||C.includes("..")||C.includes("--")||C.endsWith(".git")||C.endsWith(".ipynb"))}async function w(C){if(u.env.useFS&&!g(C,["http:","https:","blob:"]))return new p(C instanceof URL?C.protocol==="file:"?C.pathname:C.toString():C);if(typeof process<"u"&&process?.release?.name==="node"){const k=!!G_?.TESTING_REMOTELY,U=u.env.version,V=new Headers;if(V.set("User-Agent",`transformers.js/${U}; is_ci/${k};`),g(C,["http:","https:"],["huggingface.co","hf.co"])){const ne=G_?.HF_TOKEN??G_?.HF_ACCESS_TOKEN;ne&&V.set("Authorization",`Bearer ${ne}`)}return fetch(C,{headers:V})}else return fetch(C)}const M={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function x(C,k,U){if(!U)return null;const V=M[C]??`Error (${C}) occurred while trying to load file`;throw Error(`${V}: "${k}".`)}class F{constructor(k){this.path=k}async match(k){let U=o.join(this.path,k),V=new p(U);if(V.exists)return V}async put(k,U,V=void 0){let re=o.join(this.path,k);try{const ne=U.headers.get("Content-Length"),W=parseInt(ne??"0");let ce=0;await a.promises.mkdir(o.dirname(re),{recursive:!0});const ae=a.createWriteStream(re),H=U.body.getReader();for(;;){const{done:se,value:ie}=await H.read();if(se)break;await new Promise((q,j)=>{ae.write(ie,R=>{if(R){j(R);return}q()})}),ce+=ie.length;const ge=W?ce/W*100:0;V?.({progress:ge,loaded:ce,total:W})}ae.close()}catch(ne){try{await a.promises.unlink(re)}catch{}throw ne}}}async function E(C,...k){for(let U of k)try{let V=await C.match(U);if(V)return V}catch{continue}}async function T(C,k,U=!0,V={},re=!1){if(!u.env.allowLocalModels){if(V.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!u.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,d.dispatchCallback)(V.progress_callback,{status:"initiate",name:C,file:k});let ne;if(!ne&&u.env.useCustomCache){if(!u.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!u.env.customCache.match||!u.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");ne=u.env.customCache}if(!ne&&u.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{ne=await caches.open("transformers-cache")}catch(pe){console.warn("An error occurred while opening the browser cache:",pe)}}if(!ne&&u.env.useFSCache){if(!u.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");ne=new F(V.cache_dir??u.env.cacheDir)}const W=V.revision??"main",ce=$(C,k),ae=h(C),H=ae?$(u.env.localModelPath,ce):ce,se=$(u.env.remoteHost,u.env.remotePathTemplate.replaceAll("{model}",C).replaceAll("{revision}",encodeURIComponent(W)),k);let ie;const ge=ne instanceof F?W==="main"?ce:$(C,W,k):se;let q=!1,j;ne&&(j=await E(ne,H,ge));const R=j!==void 0;if(j===void 0){if(u.env.allowLocalModels)if(g(ce,["http:","https:"])){if(V.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${ce}.`);if(!u.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${ce}.`)}else try{j=await w(H),ie=H}catch(Te){console.warn(`Unable to load from local path "${H}": "${Te}"`)}if(j===void 0||j.status===404){if(V.local_files_only||!u.env.allowRemoteModels){if(U)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${H}".`);return null}if(!ae)throw Error(`Local file missing at "${H}" and download aborted due to invalid model ID "${C}".`);if(j=await w(se),j.status!==200)return x(j.status,se,U);ie=ge}q=ne&&typeof Response<"u"&&j instanceof Response&&j.status===200}(0,d.dispatchCallback)(V.progress_callback,{status:"download",name:C,file:k});let X;if(!(u.apis.IS_NODE_ENV&&re)){let pe;V.progress_callback?R&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(pe=new Uint8Array(await j.arrayBuffer()),(0,d.dispatchCallback)(V.progress_callback,{status:"progress",name:C,file:k,progress:100,loaded:pe.length,total:pe.length})):pe=await S(j,Te=>{(0,d.dispatchCallback)(V.progress_callback,{status:"progress",name:C,file:k,...Te})}):pe=new Uint8Array(await j.arrayBuffer()),X=pe}if(q&&ie&&await ne.match(ie)===void 0&&(X?await ne.put(ie,new Response(X,{headers:j.headers})).catch(pe=>{console.warn(`Unable to add response to browser cache: ${pe}.`)}):await ne.put(ie,j,V.progress_callback)),(0,d.dispatchCallback)(V.progress_callback,{status:"done",name:C,file:k}),X){if(!u.apis.IS_NODE_ENV&&re)throw new Error("Cannot return path in a browser environment.");return X}if(j instanceof p)return j.filePath;const G=await ne?.match(ie);if(G instanceof p)return G.filePath;if(G instanceof Response)return new Uint8Array(await G.arrayBuffer());if(typeof G=="string")return G;throw new Error("Unable to get model file path or buffer.")}async function L(C,k,U=!0,V={}){const re=await T(C,k,U,V,!1);return re===null?null:new TextDecoder("utf-8").decode(re)}async function O(C,k,U=!0,V={}){const re=await L(C,k,U,V);return re===null?{}:JSON.parse(re)}async function S(C,k){const U=C.headers.get("Content-Length");U===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let V=parseInt(U??"0"),re=new Uint8Array(V),ne=0;const W=C.body.getReader();async function ce(){const{done:ae,value:H}=await W.read();if(ae)return;const se=ne+H.length;if(se>V){V=se;const ge=new Uint8Array(V);ge.set(re),re=ge}re.set(H,ne),ne=se;const ie=ne/V*100;return k({progress:ie,loaded:ne,total:V}),ce()}return await ce(),re}function $(...C){return C=C.map((k,U)=>(U&&(k=k.replace(new RegExp("^/"),"")),U!==C.length-1&&(k=k.replace(new RegExp("/$"),"")),k)),C.join("/")}}),"./src/utils/image.js":((t,r,n)=>{n.r(r),n.d(r,{RawImage:()=>M,load_image:()=>x});var a=n("./src/utils/core.js"),o=n("./src/utils/hub.js"),u=n("./src/env.js"),d=n("./src/utils/tensor.js"),c=n("?2b25");let f,p,g;const _=u.apis.IS_BROWSER_ENV||u.apis.IS_WEBWORKER_ENV;if(_)f=(F,E)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(F,E)},g=self.createImageBitmap,p=self.ImageData;else if(c)g=async F=>{const T=(await F.metadata()).channels,{data:L,info:O}=await F.rotate().raw().toBuffer({resolveWithObject:!0}),S=new M(new Uint8ClampedArray(L),O.width,O.height,O.channels);return T!==void 0&&T!==O.channels&&S.convert(T),S};else throw new Error("Unable to load image processing library.");const h={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},w=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class M{constructor(E,T,L,O){this.data=E,this.width=T,this.height=L,this.channels=O}get size(){return[this.width,this.height]}static async read(E){if(E instanceof M)return E;if(typeof E=="string"||E instanceof URL)return await this.fromURL(E);if(E instanceof Blob)return await this.fromBlob(E);if(typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&E instanceof OffscreenCanvas)return this.fromCanvas(E);throw new Error(`Unsupported input type: ${typeof E}`)}static fromCanvas(E){if(!_)throw new Error("fromCanvas() is only supported in browser environments.");const L=E.getContext("2d").getImageData(0,0,E.width,E.height).data;return new M(L,E.width,E.height,4)}static async fromURL(E){const T=await(0,o.getFile)(E);if(T.status!==200)throw new Error(`Unable to read image from "${E}" (${T.status} ${T.statusText})`);const L=await T.blob();return this.fromBlob(L)}static async fromBlob(E){if(_){const T=await g(E),L=f(T.width,T.height).getContext("2d");return L.drawImage(T,0,0),new this(L.getImageData(0,0,T.width,T.height).data,T.width,T.height,4)}else{const T=c(await E.arrayBuffer());return await g(T)}}static fromTensor(E,T="CHW"){if(E.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${E.dims.length} dimensions.`);if(T==="CHW")E=E.transpose(1,2,0);else if(T!=="HWC")throw new Error(`Unsupported channel format: ${T}`);if(!(E.data instanceof Uint8ClampedArray||E.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${E.type}`);switch(E.dims[2]){case 1:case 2:case 3:case 4:return new M(E.data,E.dims[1],E.dims[0],E.dims[2]);default:throw new Error(`Unsupported number of channels: ${E.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const E=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let T=0,L=0;T<this.data.length;T+=this.channels){const O=this.data[T],S=this.data[T+1],$=this.data[T+2];E[L++]=Math.round(.2989*O+.587*S+.114*$)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const E=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let T=0,L=0;T<this.data.length;++T)E[L++]=this.data[T],E[L++]=this.data[T],E[L++]=this.data[T];break;case 4:for(let T=0,L=0;T<this.data.length;T+=4)E[L++]=this.data[T],E[L++]=this.data[T+1],E[L++]=this.data[T+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const E=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let T=0,L=0;T<this.data.length;++T)E[L++]=this.data[T],E[L++]=this.data[T],E[L++]=this.data[T],E[L++]=255;break;case 3:for(let T=0,L=0;T<this.data.length;T+=3)E[L++]=this.data[T],E[L++]=this.data[T+1],E[L++]=this.data[T+2],E[L++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,4)}putAlpha(E){if(E.width!==this.width||E.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${E.width}x${E.height}`);if(E.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${E.channels}`);const T=this.data,L=E.data,O=this.width*this.height;if(this.channels===3){const S=new Uint8ClampedArray(O*4);for(let $=0,C=0,k=0;$<O;++$)S[k++]=T[C++],S[k++]=T[C++],S[k++]=T[C++],S[k++]=L[$];return this._update(S,this.width,this.height,4)}else if(this.channels===4){for(let S=0;S<O;++S)T[4*S+3]=L[S];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(E,T,{resample:L=2}={}){if(this.width===E&&this.height===T)return this;let O=h[L]??L;const S=(0,a.isNullishDimension)(E),$=(0,a.isNullishDimension)(T);if(S&&$)return this;if(S?E=T/this.height*this.width:$&&(T=E/this.width*this.height),_){const C=this.channels,k=this.toCanvas(),U=f(E,T).getContext("2d");return U.drawImage(k,0,0,E,T),new M(U.getImageData(0,0,E,T).data,E,T,4).convert(C)}else{let C=this.toSharp();switch(O){case"box":case"hamming":(O==="box"||O==="hamming")&&(console.warn(`Resampling method ${O} is not yet supported. Using bilinear instead.`),O="bilinear");case"nearest":case"bilinear":case"bicubic":C=C.affine([E/this.width,0,0,T/this.height],{interpolator:O});break;case"lanczos":C=C.resize({width:E,height:T,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${O} is not supported.`)}return await g(C)}}async pad([E,T,L,O]){if(E=Math.max(E,0),T=Math.max(T,0),L=Math.max(L,0),O=Math.max(O,0),E===0&&T===0&&L===0&&O===0)return this;if(_){const S=this.channels,$=this.toCanvas(),C=this.width+E+T,k=this.height+L+O,U=f(C,k).getContext("2d");return U.drawImage($,0,0,this.width,this.height,E,L,this.width,this.height),new M(U.getImageData(0,0,C,k).data,C,k,4).convert(S)}else{const S=this.toSharp().extend({left:E,right:T,top:L,bottom:O});return await g(S)}}async crop([E,T,L,O]){if(E=Math.max(E,0),T=Math.max(T,0),L=Math.min(L,this.width-1),O=Math.min(O,this.height-1),E===0&&T===0&&L===this.width-1&&O===this.height-1)return this;const S=L-E+1,$=O-T+1;if(_){const C=this.channels,k=this.toCanvas(),U=f(S,$).getContext("2d");return U.drawImage(k,E,T,S,$,0,0,S,$),new M(U.getImageData(0,0,S,$).data,S,$,4).convert(C)}else{const C=this.toSharp().extract({left:E,top:T,width:S,height:$});return await g(C)}}async center_crop(E,T){if(this.width===E&&this.height===T)return this;const L=(this.width-E)/2,O=(this.height-T)/2;if(_){const S=this.channels,$=this.toCanvas(),C=f(E,T).getContext("2d");let k=0,U=0,V=0,re=0;return L>=0?k=L:V=-L,O>=0?U=O:re=-O,C.drawImage($,k,U,E,T,V,re,E,T),new M(C.getImageData(0,0,E,T).data,E,T,4).convert(S)}else{let S=this.toSharp();if(L>=0&&O>=0)S=S.extract({left:Math.floor(L),top:Math.floor(O),width:E,height:T});else if(L<=0&&O<=0){const $=Math.floor(-O),C=Math.floor(-L);S=S.extend({top:$,left:C,right:E-this.width-C,bottom:T-this.height-$})}else{let $=[0,0],C=0;O<0?($[0]=Math.floor(-O),$[1]=T-this.height-$[0]):C=Math.floor(O);let k=[0,0],U=0;L<0?(k[0]=Math.floor(-L),k[1]=E-this.width-k[0]):U=Math.floor(L),S=S.extend({top:$[0],bottom:$[1],left:k[0],right:k[1]}).extract({left:U,top:C,width:E,height:T})}return await g(S)}}async toBlob(E="image/png",T=1){if(!_)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:E,quality:T})}toTensor(E="CHW"){let T=new d.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(E!=="HWC")if(E==="CHW")T=T.permute(2,0,1);else throw new Error(`Unsupported channel format: ${E}`);return T}toCanvas(){if(!_)throw new Error("toCanvas() is only supported in browser environments.");const E=this.clone().rgba(),T=f(E.width,E.height),L=new p(E.data,E.width,E.height);return T.getContext("2d").putImageData(L,0,0),T}split(){const{data:E,width:T,height:L,channels:O}=this,S=E.constructor,$=E.length/O,C=Array.from({length:O},()=>new S($));for(let k=0;k<$;++k){const U=O*k;for(let V=0;V<O;++V)C[V][k]=E[U+V]}return C.map(k=>new M(k,T,L,1))}_update(E,T,L,O=null){return this.data=E,this.width=T,this.height=L,O!==null&&(this.channels=O),this}clone(){return new M(this.data.slice(),this.width,this.height,this.channels)}convert(E){if(this.channels===E)return this;switch(E){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(E){if(_){if(u.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const T=E.split(".").pop().toLowerCase(),L=w.get(T)??"image/png",O=await this.toBlob(L);(0,a.saveBlob)(E,O)}else{if(u.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(E);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(_)throw new Error("toSharp() is only supported in server-side environments.");return c(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const x=M.read.bind(M)}),"./src/utils/maths.js":((t,r,n)=>{n.r(r),n.d(r,{FFT:()=>x,bankers_round:()=>T,cos_sim:()=>f,dot:()=>c,dynamic_time_warping:()=>L,interpolate_data:()=>a,log_softmax:()=>d,magnitude:()=>p,max:()=>_,medianFilter:()=>F,min:()=>g,permute_data:()=>o,round:()=>E,softmax:()=>u});function a(O,[S,$,C],[k,U],V="bilinear",re=!1){const ne=U/C,W=k/$,ce=new O.constructor(k*U*S),ae=$*C,H=k*U;for(let se=0;se<k;++se)for(let ie=0;ie<U;++ie){const ge=se*U+ie,q=(ie+.5)/ne-.5,j=(se+.5)/W-.5;let R=Math.floor(q),X=Math.floor(j);const G=Math.min(R+1,C-1),pe=Math.min(X+1,$-1);R=Math.max(R,0),X=Math.max(X,0);const Te=q-R,Ie=j-X,Ne=(1-Te)*(1-Ie),dt=Te*(1-Ie),je=(1-Te)*Ie,oe=Te*Ie,ve=X*C,te=pe*C,De=ve+R,Xe=ve+G,Be=te+R,Ee=te+G;for(let Ve=0;Ve<S;++Ve){const ke=Ve*ae;ce[Ve*H+ge]=Ne*O[ke+De]+dt*O[ke+Xe]+je*O[ke+Be]+oe*O[ke+Ee]}}return ce}function o(O,S,$){const C=new Array($.length),k=new Array($.length);for(let re=$.length-1,ne=1;re>=0;--re)k[re]=ne,C[re]=S[$[re]],ne*=C[re];const U=$.map((re,ne)=>k[$.indexOf(ne)]),V=new O.constructor(O.length);for(let re=0;re<O.length;++re){let ne=0;for(let W=S.length-1,ce=re;W>=0;--W)ne+=ce%S[W]*U[W],ce=Math.floor(ce/S[W]);V[ne]=O[re]}return[V,C]}function u(O){const S=_(O)[0],$=O.map(U=>Math.exp(U-S)),C=$.reduce((U,V)=>U+V,0);return $.map(U=>U/C)}function d(O){const S=_(O)[0];let $=0;for(let U=0;U<O.length;++U)$+=Math.exp(O[U]-S);const C=Math.log($);return O.map(U=>U-S-C)}function c(O,S){let $=0;for(let C=0;C<O.length;++C)$+=O[C]*S[C];return $}function f(O,S){const $=c(O,S),C=p(O),k=p(S);return $/(C*k)}function p(O){return Math.sqrt(O.reduce((S,$)=>S+$*$,0))}function g(O){if(O.length===0)throw Error("Array must not be empty");let S=O[0],$=0;for(let C=1;C<O.length;++C)O[C]<S&&(S=O[C],$=C);return[S,$]}function _(O){if(O.length===0)throw Error("Array must not be empty");let S=O[0],$=0;for(let C=1;C<O.length;++C)O[C]>S&&(S=O[C],$=C);return[S,$]}function h(O){return O>0&&(O&O-1)===0}class w{constructor(S){if(this.size=S|0,this.size<=1||!h(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=S<<1,this.table=new Float64Array(this.size*2);for(let C=0;C<this.table.length;C+=2){const k=Math.PI*C/this.size;this.table[C]=Math.cos(k),this.table[C+1]=-Math.sin(k)}let $=0;for(let C=1;this.size>C;C<<=1)++$;this._width=$%2===0?$-1:$,this._bitrev=new Int32Array(1<<this._width);for(let C=0;C<this._bitrev.length;++C){this._bitrev[C]=0;for(let k=0;k<this._width;k+=2){const U=this._width-k-2;this._bitrev[C]|=(C>>>k&3)<<U}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(S,$){const C=$||new Array(S.length>>>1);for(let k=0;k<S.length;k+=2)C[k>>>1]=S[k];return C}toComplexArray(S,$){const C=$||this.createComplexArray();for(let k=0;k<C.length;k+=2)C[k]=S[k>>>1],C[k+1]=0;return C}transform(S,$){if(S===$)throw new Error("Input and output buffers must be different");this._transform4(S,$,1)}realTransform(S,$){if(S===$)throw new Error("Input and output buffers must be different");this._realTransform4(S,$,1)}inverseTransform(S,$){if(S===$)throw new Error("Input and output buffers must be different");this._transform4(S,$,-1);for(let C=0;C<S.length;++C)S[C]/=this.size}_transform4(S,$,C){const k=this._csize;let V=1<<this._width,re=k/V<<1,ne,W;const ce=this._bitrev;if(re===4)for(ne=0,W=0;ne<k;ne+=re,++W){const H=ce[W];this._singleTransform2($,S,ne,H,V)}else for(ne=0,W=0;ne<k;ne+=re,++W){const H=ce[W];this._singleTransform4($,S,ne,H,V,C)}const ae=this.table;for(V>>=2;V>=2;V>>=2){re=k/V<<1;const H=re>>>2;for(ne=0;ne<k;ne+=re){const se=ne+H-1;for(let ie=ne,ge=0;ie<se;ie+=2,ge+=V){const q=ie,j=q+H,R=j+H,X=R+H,G=S[q],pe=S[q+1],Te=S[j],Ie=S[j+1],Ne=S[R],dt=S[R+1],je=S[X],oe=S[X+1],ve=ae[ge],te=C*ae[ge+1],De=Te*ve-Ie*te,Xe=Te*te+Ie*ve,Be=ae[2*ge],Ee=C*ae[2*ge+1],Ve=Ne*Be-dt*Ee,ke=Ne*Ee+dt*Be,Ke=ae[3*ge],et=C*ae[3*ge+1],ht=je*Ke-oe*et,Re=je*et+oe*Ke,Tt=G+Ve,ut=pe+ke,st=G-Ve,mt=pe-ke,ct=De+ht,lt=Xe+Re,bt=C*(De-ht),nn=C*(Xe-Re);S[q]=Tt+ct,S[q+1]=ut+lt,S[j]=st+nn,S[j+1]=mt-bt,S[R]=Tt-ct,S[R+1]=ut-lt,S[X]=st-nn,S[X+1]=mt+bt}}}}_singleTransform2(S,$,C,k,U){const V=S[k],re=S[k+1],ne=S[k+U],W=S[k+U+1];$[C]=V+ne,$[C+1]=re+W,$[C+2]=V-ne,$[C+3]=re-W}_singleTransform4(S,$,C,k,U,V){const re=U*2,ne=U*3,W=S[k],ce=S[k+1],ae=S[k+U],H=S[k+U+1],se=S[k+re],ie=S[k+re+1],ge=S[k+ne],q=S[k+ne+1],j=W+se,R=ce+ie,X=W-se,G=ce-ie,pe=ae+ge,Te=H+q,Ie=V*(ae-ge),Ne=V*(H-q);$[C]=j+pe,$[C+1]=R+Te,$[C+2]=X+Ne,$[C+3]=G-Ie,$[C+4]=j-pe,$[C+5]=R-Te,$[C+6]=X-Ne,$[C+7]=G+Ie}_realTransform4(S,$,C){const k=this._csize;let V=1<<this._width,re=k/V<<1,ne,W;const ce=this._bitrev;if(re===4)for(ne=0,W=0;ne<k;ne+=re,++W){const se=ce[W];this._singleRealTransform2($,S,ne,se>>>1,V>>>1)}else for(ne=0,W=0;ne<k;ne+=re,++W){const se=ce[W];this._singleRealTransform4($,S,ne,se>>>1,V>>>1,C)}const ae=this.table;for(V>>=2;V>=2;V>>=2){re=k/V<<1;const se=re>>>1,ie=se>>>1,ge=ie>>>1;for(ne=0;ne<k;ne+=re)for(let q=0,j=0;q<=ge;q+=2,j+=V){const R=ne+q,X=R+ie,G=X+ie,pe=G+ie,Te=S[R],Ie=S[R+1],Ne=S[X],dt=S[X+1],je=S[G],oe=S[G+1],ve=S[pe],te=S[pe+1],De=Te,Xe=Ie,Be=ae[j],Ee=C*ae[j+1],Ve=Ne*Be-dt*Ee,ke=Ne*Ee+dt*Be,Ke=ae[2*j],et=C*ae[2*j+1],ht=je*Ke-oe*et,Re=je*et+oe*Ke,Tt=ae[3*j],ut=C*ae[3*j+1],st=ve*Tt-te*ut,mt=ve*ut+te*Tt,ct=De+ht,lt=Xe+Re,bt=De-ht,nn=Xe-Re,un=Ve+st,It=ke+mt,os=C*(Ve-st),Ts=C*(ke-mt);if(S[R]=ct+un,S[R+1]=lt+It,S[X]=bt+Ts,S[X+1]=nn-os,q===0){S[G]=ct-un,S[G+1]=lt-It;continue}if(q===ge)continue;const Os=ne+ie-q,Zs=ne+se-q;S[Os]=bt-C*Ts,S[Os+1]=-nn-C*os,S[Zs]=ct-C*un,S[Zs+1]=-lt+C*It}}const H=k>>>1;for(let se=2;se<H;se+=2)S[k-se]=S[se],S[k-se+1]=-S[se+1]}_singleRealTransform2(S,$,C,k,U){const V=S[k],re=S[k+U];$[C]=V+re,$[C+1]=0,$[C+2]=V-re,$[C+3]=0}_singleRealTransform4(S,$,C,k,U,V){const re=U*2,ne=U*3,W=S[k],ce=S[k+U],ae=S[k+re],H=S[k+ne],se=W+ae,ie=W-ae,ge=ce+H,q=V*(ce-H);$[C]=se+ge,$[C+1]=0,$[C+2]=ie,$[C+3]=-q,$[C+4]=se-ge,$[C+5]=0,$[C+6]=ie,$[C+7]=q}}class M{constructor(S){const $=2*(S-1),C=2*(2*S-1),k=2**Math.ceil(Math.log2(C));this.bufferSize=k,this._a=$;const U=new Float64Array(C),V=new Float64Array(k);this._chirpBuffer=new Float64Array(k),this._buffer1=new Float64Array(k),this._buffer2=new Float64Array(k),this._outBuffer1=new Float64Array(k),this._outBuffer2=new Float64Array(k);const re=-2*Math.PI/S,ne=Math.cos(re),W=Math.sin(re);for(let ce=0;ce<C>>1;++ce){const ae=(ce+1-S)**2/2,H=Math.sqrt(ne**2+W**2)**ae,se=ae*Math.atan2(W,ne),ie=2*ce;U[ie]=H*Math.cos(se),U[ie+1]=H*Math.sin(se),V[ie]=U[ie],V[ie+1]=-U[ie+1]}this._slicedChirpBuffer=U.subarray($,C),this._f=new w(k>>1),this._f.transform(this._chirpBuffer,V)}_transform(S,$,C){const k=this._buffer1,U=this._buffer2,V=this._outBuffer1,re=this._outBuffer2,ne=this._chirpBuffer,W=this._slicedChirpBuffer,ce=this._a;if(C)for(let ae=0;ae<W.length;ae+=2){const H=ae+1,se=ae>>1,ie=$[se];k[ae]=ie*W[ae],k[H]=ie*W[H]}else for(let ae=0;ae<W.length;ae+=2){const H=ae+1;k[ae]=$[ae]*W[ae]-$[H]*W[H],k[H]=$[ae]*W[H]+$[H]*W[ae]}this._f.transform(V,k);for(let ae=0;ae<ne.length;ae+=2){const H=ae+1;U[ae]=V[ae]*ne[ae]-V[H]*ne[H],U[H]=V[ae]*ne[H]+V[H]*ne[ae]}this._f.inverseTransform(re,U);for(let ae=0;ae<re.length;ae+=2){const H=re[ae+ce],se=re[ae+ce+1],ie=W[ae],ge=W[ae+1];S[ae]=H*ie-se*ge,S[ae+1]=H*ge+se*ie}}transform(S,$){this._transform(S,$,!1)}realTransform(S,$){this._transform(S,$,!0)}}class x{constructor(S){this.fft_length=S,this.isPowerOfTwo=h(S),this.isPowerOfTwo?(this.fft=new w(S),this.outputBufferSize=2*S):(this.fft=new M(S),this.outputBufferSize=this.fft.bufferSize)}realTransform(S,$){this.fft.realTransform(S,$)}transform(S,$){this.fft.transform(S,$)}}function F(O,S){if(S%2===0||S<=0)throw new Error("Window size must be a positive odd number");const $=new O.constructor(O.length),C=new O.constructor(S),k=Math.floor(S/2);for(let U=0;U<O.length;++U){let V=0;for(let re=-k;re<=k;++re){let ne=U+re;ne<0?ne=Math.abs(ne):ne>=O.length&&(ne=2*(O.length-1)-ne),C[V++]=O[ne]}C.sort(),$[U]=C[k]}return $}function E(O,S){const $=Math.pow(10,S);return Math.round(O*$)/$}function T(O){const S=Math.round(O);return Math.abs(O)%1===.5?S%2===0?S:S-1:S}function L(O){const S=O.length,$=O[0].length,C=[S+1,$+1],k=Array.from({length:C[0]},()=>Array(C[1]).fill(1/0));k[0][0]=0;const U=Array.from({length:C[0]},()=>Array(C[1]).fill(-1));for(let ce=1;ce<C[1];++ce)for(let ae=1;ae<C[0];++ae){const H=k[ae-1][ce-1],se=k[ae-1][ce],ie=k[ae][ce-1];let ge,q;H<se&&H<ie?(ge=H,q=0):se<H&&se<ie?(ge=se,q=1):(ge=ie,q=2),k[ae][ce]=O[ae-1][ce-1]+ge,U[ae][ce]=q}for(let ce=0;ce<C[1];++ce)U[0][ce]=2;for(let ce=0;ce<C[0];++ce)U[ce][0]=1;let V=S,re=$,ne=[],W=[];for(;V>0||re>0;)switch(ne.push(V-1),W.push(re-1),U[V][re]){case 0:--V,--re;break;case 1:--V;break;case 2:--re;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${V}, ${re}]. Please file a bug report.`)}return ne.reverse(),W.reverse(),[ne,W]}}),"./src/utils/tensor.js":((t,r,n)=>{n.r(r),n.d(r,{DataTypeMap:()=>d,Tensor:()=>c,cat:()=>$,full:()=>W,full_like:()=>ce,interpolate:()=>g,interpolate_4d:()=>_,layer_norm:()=>T,matmul:()=>h,mean:()=>V,mean_pooling:()=>E,ones:()=>ae,ones_like:()=>H,permute:()=>p,quantize_embeddings:()=>q,rand:()=>ge,rfft:()=>w,slice:()=>F,stack:()=>C,std_mean:()=>U,topk:()=>M,zeros:()=>se,zeros_like:()=>ie});var a=n("./src/utils/maths.js"),o=n("./src/backends/onnx.js"),u=n("./src/ops/registry.js");const d=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class c{get dims(){return this.ort_tensor.dims}set dims(R){this.ort_tensor.dims=R}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...R){return(0,o.isONNXTensor)(R[0])?this.ort_tensor=R[0]:this.ort_tensor=new o.Tensor(R[0],R[1],R[2]),new Proxy(this,{get:(X,G)=>{if(typeof G=="string"){let pe=Number(G);if(Number.isInteger(pe))return X._getitem(pe)}return X[G]},set:(X,G,pe)=>X[G]=pe})}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[R,...X]=this.dims;if(X.length>0){const G=X.reduce((pe,Te)=>pe*Te);for(let pe=0;pe<R;++pe)yield this._subarray(pe,G,X)}else yield*this.data}_getitem(R){const[X,...G]=this.dims;if(R=S(R,X),G.length>0){const pe=G.reduce((Te,Ie)=>Te*Ie);return this._subarray(R,pe,G)}else return new c(this.type,[this.data[R]],G)}indexOf(R){const X=this.data;for(let G=0;G<X.length;++G)if(X[G]==R)return G;return-1}_subarray(R,X,G){const pe=R*X,Te=(R+1)*X,Ie="subarray"in this.data?this.data.subarray(pe,Te):this.data.slice(pe,Te);return new c(this.type,Ie,G)}item(){const R=this.data;if(R.length!==1)throw new Error(`a Tensor with ${R.length} elements cannot be converted to Scalar`);return R[0]}tolist(){return f(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=1/(1+Math.exp(-R[X]));return this}map(R){return this.clone().map_(R)}map_(R){const X=this.data;for(let G=0;G<X.length;++G)X[G]=R(X[G],G,X);return this}mul(R){return this.clone().mul_(R)}mul_(R){const X=this.data;for(let G=0;G<X.length;++G)X[G]*=R;return this}div(R){return this.clone().div_(R)}div_(R){const X=this.data;for(let G=0;G<X.length;++G)X[G]/=R;return this}add(R){return this.clone().add_(R)}add_(R){const X=this.data;for(let G=0;G<X.length;++G)X[G]+=R;return this}sub(R){return this.clone().sub_(R)}sub_(R){const X=this.data;for(let G=0;G<X.length;++G)X[G]-=R;return this}clone(){return new c(this.type,this.data.slice(),this.dims.slice())}slice(...R){const X=[],G=[];for(let oe=0;oe<this.dims.length;++oe){let ve=R[oe];if(ve==null)G.push([0,this.dims[oe]]),X.push(this.dims[oe]);else if(typeof ve=="number")ve=S(ve,this.dims[oe],oe),G.push([ve,ve+1]);else if(Array.isArray(ve)&&ve.length===2){let[te,De]=ve;if(te=te===null?0:S(te,this.dims[oe],oe,!1),De=De===null?this.dims[oe]:S(De,this.dims[oe],oe,!1),te>De)throw new Error(`Invalid slice: ${ve}`);const Xe=[Math.max(te,0),Math.min(De,this.dims[oe])];G.push(Xe),X.push(Xe[1]-Xe[0])}else throw new Error(`Invalid slice: ${ve}`)}const pe=G.map(([oe,ve])=>ve-oe),Te=pe.reduce((oe,ve)=>oe*ve),Ie=this.data,Ne=new Ie.constructor(Te),dt=this.stride();let je=!0;for(let oe=1;oe<pe.length;++oe)if(G[oe][0]!==0||G[oe][1]!==this.dims[oe]){je=!1;break}if(je){const oe=G[0][0]*dt[0],ve=G[0][1]*dt[0];if(ArrayBuffer.isView(Ie))Ne.set(Ie.subarray(oe,ve));else if(Array.isArray(Ie)){const te=Ie.slice(oe,ve);for(let De=0;De<te.length;++De)Ne[De]=te[De]}else throw new Error("Unsupported data type for slicing")}else for(let oe=0;oe<Te;++oe){let ve=0;for(let te=pe.length-1,De=oe;te>=0;--te){const Xe=pe[te];ve+=(De%Xe+G[te][0])*dt[te],De=Math.floor(De/Xe)}Ne[oe]=Ie[ve]}return new c(this.type,Ne,X)}permute(...R){return p(this,R)}transpose(...R){return this.permute(...R)}sum(R=null,X=!1){return this.norm(1,R,X)}norm(R="fro",X=null,G=!1){if(R==="fro")R=2;else if(typeof R=="string")throw Error(`Unsupported norm: ${R}`);const pe=this.data,Te=(je,oe)=>je+oe**R;if(X===null){const je=pe.reduce(Te,0)**(1/R);return new c(this.type,[je],[])}const[Ie,Ne,dt]=k(Te,this,X,G);if(R!==1)for(let je=0;je<Ne.length;++je)Ne[je]=Ne[je]**(1/R);return new c(Ie,Ne,dt)}normalize_(R=2,X=1){X=S(X,this.dims.length);const G=this.norm(R,X,!0),pe=this.data,Te=G.data;for(let Ie=0;Ie<pe.length;++Ie){let Ne=0;for(let dt=this.dims.length-1,je=Ie,oe=1;dt>=0;--dt){const ve=this.dims[dt];if(dt!==X){const te=je%ve;Ne+=te*oe,oe*=this.dims[dt]}je=Math.floor(je/ve)}pe[Ie]/=Te[Ne]}return this}normalize(R=2,X=1){return this.clone().normalize_(R,X)}stride(){return re(this.dims)}squeeze(R=null){return new c(this.type,this.data,L(this.dims,R))}squeeze_(R=null){return this.dims=L(this.dims,R),this}unsqueeze(R=null){return new c(this.type,this.data,O(this.dims,R))}unsqueeze_(R=null){return this.dims=O(this.dims,R),this}flatten_(R=0,X=-1){X=(X+this.dims.length)%this.dims.length;let G=this.dims.slice(0,R),pe=this.dims.slice(R,X+1),Te=this.dims.slice(X+1);return this.dims=[...G,pe.reduce((Ie,Ne)=>Ie*Ne,1),...Te],this}flatten(R=0,X=-1){return this.clone().flatten_(R,X)}view(...R){let X=-1;for(let pe=0;pe<R.length;++pe)if(R[pe]===-1){if(X!==-1)throw new Error("Only one dimension can be inferred");X=pe}const G=this.data;if(X!==-1){const pe=R.reduce((Te,Ie,Ne)=>Ne!==X?Te*Ie:Te,1);R[X]=G.length/pe}return new c(this.type,G,R)}neg_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=-R[X];return this}neg(){return this.clone().neg_()}gt(R){const X=new Uint8Array(this.data.length),G=this.data;for(let pe=0;pe<G.length;++pe)X[pe]=G[pe]>R?1:0;return new c("bool",X,this.dims)}lt(R){const X=new Uint8Array(this.data.length),G=this.data;for(let pe=0;pe<G.length;++pe)X[pe]=G[pe]<R?1:0;return new c("bool",X,this.dims)}clamp_(R,X){const G=this.data;for(let pe=0;pe<G.length;++pe)G[pe]=Math.min(Math.max(G[pe],R),X);return this}clamp(R,X){return this.clone().clamp_(R,X)}round_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=Math.round(R[X]);return this}round(){return this.clone().round_()}mean(R=null,X=!1){return V(this,R,X)}min(R=null,X=!1){if(R===null){const Ie=(0,a.min)(this.data)[0];return new c(this.type,[Ie],[])}const[G,pe,Te]=k((Ie,Ne)=>Math.min(Ie,Ne),this,R,X,1/0);return new c(G,pe,Te)}max(R=null,X=!1){if(R===null){const Ie=(0,a.max)(this.data)[0];return new c(this.type,[Ie],[])}const[G,pe,Te]=k((Ie,Ne)=>Math.max(Ie,Ne),this,R,X,-1/0);return new c(G,pe,Te)}argmin(R=null,X=!1){if(R!==null)throw new Error("`dim !== null` not yet implemented.");const G=(0,a.min)(this.data)[1];return new c("int64",[BigInt(G)],[])}argmax(R=null,X=!1){if(R!==null)throw new Error("`dim !== null` not yet implemented.");const G=(0,a.max)(this.data)[1];return new c("int64",[BigInt(G)],[])}to(R){if(this.type===R)return this;if(!d.hasOwnProperty(R))throw new Error(`Unsupported type: ${R}`);let X;const G=["int64","uint64"].includes(this.type),pe=["int64","uint64"].includes(R);return G&&!pe?X=Number:!G&&pe&&(X=BigInt),new c(R,d[R].from(this.data,X),this.dims)}}function f(j,R){const X=j.length,G=R.reduce((Te,Ie)=>Te*Ie);if(X!==G)throw Error(`cannot reshape array of size ${X} into shape (${R})`);let pe=j;for(let Te=R.length-1;Te>=0;Te--)pe=pe.reduce((Ie,Ne)=>{let dt=Ie[Ie.length-1];return dt.length<R[Te]?dt.push(Ne):Ie.push([Ne]),Ie},[[]]);return pe[0]}function p(j,R){const[X,G]=(0,a.permute_data)(j.data,j.dims,R);return new c(j.type,X,G)}function g(j,[R,X],G="bilinear",pe=!1){const Te=j.dims.at(-3)??1,Ie=j.dims.at(-2),Ne=j.dims.at(-1);let dt=(0,a.interpolate_data)(j.data,[Te,Ie,Ne],[R,X],G,pe);return new c(j.type,dt,[Te,R,X])}async function _(j,{size:R=null,mode:X="bilinear"}={}){if(j.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!R)throw new Error("`interpolate_4d` requires a `size` argument.");let G;if(R.length===2)G=[...j.dims.slice(0,2),...R];else if(R.length===3)G=[j.dims[0],...R];else if(R.length===4)G=R;else throw new Error("`size` must be of length 2, 3, or 4.");let pe;if(X==="nearest")pe=await u.TensorOpRegistry.nearest_interpolate_4d;else if(X==="bilinear")pe=await u.TensorOpRegistry.bilinear_interpolate_4d;else if(X==="bicubic")pe=await u.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${X}`);const Te=new c("int64",new BigInt64Array(G.map(BigInt)),[G.length]);return await pe({x:j,s:Te})}async function h(j,R){return await(await u.TensorOpRegistry.matmul)({a:j,b:R})}async function w(j,R){return await(await u.TensorOpRegistry.rfft)({x:j,a:R})}async function M(j,R){const X=await u.TensorOpRegistry.top_k;return R==null?R=j.dims.at(-1):R=Math.min(R,j.dims.at(-1)),await X({x:j,k:new c("int64",[BigInt(R)],[1])})}const x=j=>new c("int64",j,[j.length]);async function F(j,R,X,G,pe){return await(await u.TensorOpRegistry.slice)({x:j,s:x(R),e:x(X),a:x(G),t:x(pe??new Array(G.length).fill(1))})}function E(j,R){const X=j.data,G=R.data,pe=[j.dims[0],j.dims[2]],Te=new X.constructor(pe[0]*pe[1]),[Ie,Ne,dt]=j.dims;let je=0;for(let oe=0;oe<Ie;++oe){const ve=oe*dt*Ne;for(let te=0;te<dt;++te){let De=0,Xe=0;const Be=oe*Ne,Ee=ve+te;for(let ke=0;ke<Ne;++ke){const Ke=Number(G[Be+ke]);Xe+=Ke,De+=X[Ee+ke*dt]*Ke}const Ve=De/Xe;Te[je++]=Ve}}return new c(j.type,Te,pe)}function T(j,R,{eps:X=1e-5}={}){if(j.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[G,pe]=j.dims;if(R.length!==1&&R[0]!==pe)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[Te,Ie]=U(j,1,0,!0),Ne=Te.data,dt=Ie.data,je=j.data,oe=new je.constructor(je.length);for(let ve=0;ve<G;++ve){const te=ve*pe;for(let De=0;De<pe;++De){const Xe=te+De;oe[Xe]=(je[Xe]-dt[ve])/(Ne[ve]+X)}}return new c(j.type,oe,j.dims)}function L(j,R){return j=j.slice(),R===null?j=j.filter(X=>X!==1):typeof R=="number"?j[R]===1&&j.splice(R,1):Array.isArray(R)&&(j=j.filter((X,G)=>X!==1||!R.includes(G))),j}function O(j,R){return R=S(R,j.length+1),j=j.slice(),j.splice(R,0,1),j}function S(j,R,X=null,G=!0){if(j<-R||j>=R){if(G)throw new Error(`IndexError: index ${j} is out of bounds for dimension${X===null?"":" "+X} with size ${R}`);return j<-R?0:R}return j<0&&(j=(j%R+R)%R),j}function $(j,R=0){R=S(R,j[0].dims.length);const X=j[0].dims.slice();X[R]=j.reduce((Ie,Ne)=>Ie+Ne.dims[R],0);const G=X.reduce((Ie,Ne)=>Ie*Ne,1),pe=new j[0].data.constructor(G),Te=j[0].type;if(R===0){let Ie=0;for(const Ne of j){const dt=Ne.data;pe.set(dt,Ie),Ie+=dt.length}}else{let Ie=0;for(let Ne=0;Ne<j.length;++Ne){const{data:dt,dims:je}=j[Ne];for(let oe=0;oe<dt.length;++oe){let ve=0;for(let te=je.length-1,De=oe,Xe=1;te>=0;--te){const Be=je[te];let Ee=De%Be;te===R&&(Ee+=Ie),ve+=Ee*Xe,Xe*=X[te],De=Math.floor(De/Be)}pe[ve]=dt[oe]}Ie+=je[R]}}return new c(Te,pe,X)}function C(j,R=0){return $(j.map(X=>X.unsqueeze(R)),R)}function k(j,R,X=null,G=!1,pe=null){const Te=R.data,Ie=R.dims;X=S(X,Ie.length);const Ne=Ie.slice();Ne[X]=1;const dt=new Te.constructor(Te.length/Ie[X]);pe!==null&&dt.fill(pe);for(let je=0;je<Te.length;++je){let oe=0;for(let ve=Ie.length-1,te=je,De=1;ve>=0;--ve){const Xe=Ie[ve];if(ve!==X){const Be=te%Xe;oe+=Be*De,De*=Ne[ve]}te=Math.floor(te/Xe)}dt[oe]=j(dt[oe],Te[je],je,oe)}return G||Ne.splice(X,1),[R.type,dt,Ne]}function U(j,R=null,X=1,G=!1){const pe=j.data,Te=j.dims;if(R===null){const De=pe.reduce((Ve,ke)=>Ve+ke,0)/pe.length,Xe=Math.sqrt(pe.reduce((Ve,ke)=>Ve+(ke-De)**2,0)/(pe.length-X)),Be=new c(j.type,[De],[]);return[new c(j.type,[Xe],[]),Be]}R=S(R,Te.length);const Ie=V(j,R,G),Ne=Ie.data,[dt,je,oe]=k((te,De,Xe,Be)=>te+(De-Ne[Be])**2,j,R,G);for(let te=0;te<je.length;++te)je[te]=Math.sqrt(je[te]/(Te[R]-X));return[new c(dt,je,oe),Ie]}function V(j,R=null,X=!1){const G=j.dims,pe=j.data;if(R===null){const dt=pe.reduce((je,oe)=>je+oe,0);return new c(j.type,[dt/pe.length],[])}R=S(R,G.length);const[Te,Ie,Ne]=k((dt,je)=>dt+je,j,R,X);if(G[R]!==1)for(let dt=0;dt<Ie.length;++dt)Ie[dt]/=G[R];return new c(Te,Ie,Ne)}function re(j){const R=new Array(j.length);for(let X=j.length-1,G=1;X>=0;--X)R[X]=G,G*=j[X];return R}function ne(j,R,X,G){const pe=j.reduce((Te,Ie)=>Te*Ie,1);return new c(X,new G(pe).fill(R),j)}function W(j,R){let X,G;if(typeof R=="number")X="float32",G=Float32Array;else if(typeof R=="bigint")X="int64",G=BigInt64Array;else if(typeof R=="boolean")X="bool",G=Uint8Array;else throw new Error(`Unsupported data type: ${typeof R}`);return ne(j,R,X,G)}function ce(j,R){return W(j.dims,R)}function ae(j){return ne(j,1n,"int64",BigInt64Array)}function H(j){return ae(j.dims)}function se(j){return ne(j,0n,"int64",BigInt64Array)}function ie(j){return se(j.dims)}function ge(j){const R=j.reduce((X,G)=>X*G,1);return new c("float32",Float32Array.from({length:R},()=>Math.random()),j)}function q(j,R){if(j.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(j.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(R))throw new Error("The precision must be either 'binary' or 'ubinary'");const X=R==="binary",G=X?"int8":"uint8",pe=X?Int8Array:Uint8Array,Te=j.data,Ie=new pe(Te.length/8);for(let Ne=0;Ne<Te.length;++Ne){const dt=Te[Ne]>0?1:0,je=Math.floor(Ne/8),oe=Ne%8;Ie[je]|=dt<<7-oe,X&&oe===0&&(Ie[je]-=128)}return new c(G,Ie,[j.dims[0],j.dims[1]/8])}}),"./src/utils/video.js":((t,r,n)=>{n.r(r),n.d(r,{RawVideo:()=>d,RawVideoFrame:()=>u,load_video:()=>c});var a=n("./src/utils/image.js"),o=n("./src/env.js");class u{constructor(p,g){this.image=p,this.timestamp=g}}class d{constructor(p,g){p.length>0&&p[0]instanceof a.RawImage&&(p=p.map((_,h)=>new u(_,(h+1)/(p.length+1)*g))),this.frames=p,this.duration=g}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function c(f,{num_frames:p=null,fps:g=null}={}){if(!o.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(p==null&&g==null)throw new Error("Either num_frames or fps must be provided.");const _=[],h=document.createElement("video");if(h.crossOrigin="anonymous",h.muted=!0,typeof f=="string")h.src=f;else if(f instanceof Blob)h.src=URL.createObjectURL(f);else if(f instanceof HTMLVideoElement)h.src=f.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(L=>h.onloadedmetadata=L),h.seekable.start(0)===h.seekable.end(0)){const O=await(await fetch(h.src)).blob();h.src=URL.createObjectURL(O),await new Promise(S=>h.onloadedmetadata=S)}const w=h.duration;let M,x;p!=null?(M=p,x=p===1?0:w/(p-1)):(x=1/g,M=Math.floor(w/x));let F=[];for(let L=0;L<M;++L)F.push(p===1?w/2:L*x);const E=document.createElement("canvas");E.width=h.videoWidth,E.height=h.videoHeight;const T=E.getContext("2d",{willReadFrequently:!0});for(const L of F){h.currentTime=L,await new Promise(C=>{h.onseeked=C}),T.drawImage(h,0,0,E.width,E.height);const O=T.getImageData(0,0,E.width,E.height),S=new a.RawImage(O.data,E.width,E.height,4),$=new u(S,L);_.push($)}return h.remove(),new d(_,w)}})},Qy={};function Cn(t){var r=Qy[t];if(r!==void 0)return r.exports;var n=Qy[t]={exports:{}};return aT[t](n,n.exports,Cn),n.exports}(()=>{var t=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__,r;Cn.t=function(n,a){if(a&1&&(n=this(n)),a&8||typeof n=="object"&&n&&(a&4&&n.__esModule||a&16&&typeof n.then=="function"))return n;var o=Object.create(null);Cn.r(o);var u={};r=r||[null,t({}),t([]),t(t)];for(var d=a&2&&n;typeof d=="object"&&!~r.indexOf(d);d=t(d))Object.getOwnPropertyNames(d).forEach(c=>u[c]=()=>n[c]);return u.default=()=>n,Cn.d(o,u),o}})();Cn.d=(t,r)=>{for(var n in r)Cn.o(r,n)&&!Cn.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})};Cn.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);Cn.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var b={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/Cn.r(b),Cn.d(b,{ASTFeatureExtractor:()=>_.ASTFeatureExtractor,ASTForAudioClassification:()=>n.ASTForAudioClassification,ASTModel:()=>n.ASTModel,ASTPreTrainedModel:()=>n.ASTPreTrainedModel,AlbertForMaskedLM:()=>n.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>n.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>n.AlbertForSequenceClassification,AlbertModel:()=>n.AlbertModel,AlbertPreTrainedModel:()=>n.AlbertPreTrainedModel,AlbertTokenizer:()=>a.AlbertTokenizer,ArceeForCausalLM:()=>n.ArceeForCausalLM,ArceeModel:()=>n.ArceeModel,ArceePreTrainedModel:()=>n.ArceePreTrainedModel,AudioClassificationPipeline:()=>r.AudioClassificationPipeline,AutoConfig:()=>o.AutoConfig,AutoFeatureExtractor:()=>h.AutoFeatureExtractor,AutoImageProcessor:()=>x.AutoImageProcessor,AutoModel:()=>n.AutoModel,AutoModelForAudioClassification:()=>n.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>n.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>n.AutoModelForAudioTextToText,AutoModelForCTC:()=>n.AutoModelForCTC,AutoModelForCausalLM:()=>n.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>n.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>n.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>n.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>n.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>n.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>n.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>n.AutoModelForImageTextToText,AutoModelForImageToImage:()=>n.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>n.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>n.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>n.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>n.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>n.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>n.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>n.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>n.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>n.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>n.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>n.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>n.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>n.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>n.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>n.AutoModelForVision2Seq,AutoModelForXVector:()=>n.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>n.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>T.AutoProcessor,AutoTokenizer:()=>a.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>r.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>r.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>n.BartForConditionalGeneration,BartForSequenceClassification:()=>n.BartForSequenceClassification,BartModel:()=>n.BartModel,BartPretrainedModel:()=>n.BartPretrainedModel,BartTokenizer:()=>a.BartTokenizer,BaseModelOutput:()=>n.BaseModelOutput,BaseStreamer:()=>L.BaseStreamer,BeitFeatureExtractor:()=>M.BeitFeatureExtractor,BeitForImageClassification:()=>n.BeitForImageClassification,BeitModel:()=>n.BeitModel,BeitPreTrainedModel:()=>n.BeitPreTrainedModel,BertForMaskedLM:()=>n.BertForMaskedLM,BertForQuestionAnswering:()=>n.BertForQuestionAnswering,BertForSequenceClassification:()=>n.BertForSequenceClassification,BertForTokenClassification:()=>n.BertForTokenClassification,BertModel:()=>n.BertModel,BertPreTrainedModel:()=>n.BertPreTrainedModel,BertTokenizer:()=>a.BertTokenizer,BitImageProcessor:()=>M.BitImageProcessor,BlenderbotForConditionalGeneration:()=>n.BlenderbotForConditionalGeneration,BlenderbotModel:()=>n.BlenderbotModel,BlenderbotPreTrainedModel:()=>n.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>n.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>n.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>n.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>a.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>a.BlenderbotTokenizer,BloomForCausalLM:()=>n.BloomForCausalLM,BloomModel:()=>n.BloomModel,BloomPreTrainedModel:()=>n.BloomPreTrainedModel,BloomTokenizer:()=>a.BloomTokenizer,CLIPFeatureExtractor:()=>M.CLIPFeatureExtractor,CLIPImageProcessor:()=>M.CLIPImageProcessor,CLIPModel:()=>n.CLIPModel,CLIPPreTrainedModel:()=>n.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>n.CLIPSegForImageSegmentation,CLIPSegModel:()=>n.CLIPSegModel,CLIPSegPreTrainedModel:()=>n.CLIPSegPreTrainedModel,CLIPTextModel:()=>n.CLIPTextModel,CLIPTextModelWithProjection:()=>n.CLIPTextModelWithProjection,CLIPTokenizer:()=>a.CLIPTokenizer,CLIPVisionModel:()=>n.CLIPVisionModel,CLIPVisionModelWithProjection:()=>n.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>n.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>n.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>n.CamembertForSequenceClassification,CamembertForTokenClassification:()=>n.CamembertForTokenClassification,CamembertModel:()=>n.CamembertModel,CamembertPreTrainedModel:()=>n.CamembertPreTrainedModel,CamembertTokenizer:()=>a.CamembertTokenizer,CausalLMOutput:()=>n.CausalLMOutput,CausalLMOutputWithPast:()=>n.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>M.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>n.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>n.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>n.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>_.ClapFeatureExtractor,ClapModel:()=>n.ClapModel,ClapPreTrainedModel:()=>n.ClapPreTrainedModel,ClapTextModelWithProjection:()=>n.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>S.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>n.CodeGenForCausalLM,CodeGenModel:()=>n.CodeGenModel,CodeGenPreTrainedModel:()=>n.CodeGenPreTrainedModel,CodeGenTokenizer:()=>a.CodeGenTokenizer,CodeLlamaTokenizer:()=>a.CodeLlamaTokenizer,CohereForCausalLM:()=>n.CohereForCausalLM,CohereModel:()=>n.CohereModel,CoherePreTrainedModel:()=>n.CoherePreTrainedModel,CohereTokenizer:()=>a.CohereTokenizer,ConvBertForMaskedLM:()=>n.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>n.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>n.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>n.ConvBertForTokenClassification,ConvBertModel:()=>n.ConvBertModel,ConvBertPreTrainedModel:()=>n.ConvBertPreTrainedModel,ConvBertTokenizer:()=>a.ConvBertTokenizer,ConvNextFeatureExtractor:()=>M.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>n.ConvNextForImageClassification,ConvNextImageProcessor:()=>M.ConvNextImageProcessor,ConvNextModel:()=>n.ConvNextModel,ConvNextPreTrainedModel:()=>n.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>n.ConvNextV2ForImageClassification,ConvNextV2Model:()=>n.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>n.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>n.DFineForObjectDetection,DFineModel:()=>n.DFineModel,DFinePreTrainedModel:()=>n.DFinePreTrainedModel,DINOv3ConvNextModel:()=>n.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>n.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>M.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>n.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>n.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>M.DPTFeatureExtractor,DPTForDepthEstimation:()=>n.DPTForDepthEstimation,DPTImageProcessor:()=>M.DPTImageProcessor,DPTModel:()=>n.DPTModel,DPTPreTrainedModel:()=>n.DPTPreTrainedModel,DacDecoderModel:()=>n.DacDecoderModel,DacDecoderOutput:()=>n.DacDecoderOutput,DacEncoderModel:()=>n.DacEncoderModel,DacEncoderOutput:()=>n.DacEncoderOutput,DacFeatureExtractor:()=>_.DacFeatureExtractor,DacModel:()=>n.DacModel,DacPreTrainedModel:()=>n.DacPreTrainedModel,DataTypeMap:()=>f.DataTypeMap,DebertaForMaskedLM:()=>n.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>n.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>n.DebertaForSequenceClassification,DebertaForTokenClassification:()=>n.DebertaForTokenClassification,DebertaModel:()=>n.DebertaModel,DebertaPreTrainedModel:()=>n.DebertaPreTrainedModel,DebertaTokenizer:()=>a.DebertaTokenizer,DebertaV2ForMaskedLM:()=>n.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>n.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>n.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>n.DebertaV2ForTokenClassification,DebertaV2Model:()=>n.DebertaV2Model,DebertaV2PreTrainedModel:()=>n.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>a.DebertaV2Tokenizer,DecisionTransformerModel:()=>n.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>n.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>M.DeiTFeatureExtractor,DeiTForImageClassification:()=>n.DeiTForImageClassification,DeiTImageProcessor:()=>M.DeiTImageProcessor,DeiTModel:()=>n.DeiTModel,DeiTPreTrainedModel:()=>n.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>n.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>n.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>r.DepthEstimationPipeline,DepthProForDepthEstimation:()=>n.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>n.DepthProPreTrainedModel,DetrFeatureExtractor:()=>M.DetrFeatureExtractor,DetrForObjectDetection:()=>n.DetrForObjectDetection,DetrForSegmentation:()=>n.DetrForSegmentation,DetrImageProcessor:()=>M.DetrImageProcessor,DetrModel:()=>n.DetrModel,DetrObjectDetectionOutput:()=>n.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>n.DetrPreTrainedModel,DetrSegmentationOutput:()=>n.DetrSegmentationOutput,Dinov2ForImageClassification:()=>n.Dinov2ForImageClassification,Dinov2Model:()=>n.Dinov2Model,Dinov2PreTrainedModel:()=>n.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>n.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>n.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>n.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>n.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>n.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>n.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>n.DistilBertForTokenClassification,DistilBertModel:()=>n.DistilBertModel,DistilBertPreTrainedModel:()=>n.DistilBertPreTrainedModel,DistilBertTokenizer:()=>a.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>r.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>M.DonutFeatureExtractor,DonutImageProcessor:()=>M.DonutImageProcessor,DonutSwinModel:()=>n.DonutSwinModel,DonutSwinPreTrainedModel:()=>n.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>n.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>M.EfficientNetImageProcessor,EfficientNetModel:()=>n.EfficientNetModel,EfficientNetPreTrainedModel:()=>n.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>n.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>n.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>n.ElectraForSequenceClassification,ElectraForTokenClassification:()=>n.ElectraForTokenClassification,ElectraModel:()=>n.ElectraModel,ElectraPreTrainedModel:()=>n.ElectraPreTrainedModel,ElectraTokenizer:()=>a.ElectraTokenizer,EncodecFeatureExtractor:()=>_.EncodecFeatureExtractor,EosTokenCriteria:()=>O.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>n.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>n.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>n.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>a.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>n.EsmForMaskedLM,EsmForSequenceClassification:()=>n.EsmForSequenceClassification,EsmForTokenClassification:()=>n.EsmForTokenClassification,EsmModel:()=>n.EsmModel,EsmPreTrainedModel:()=>n.EsmPreTrainedModel,EsmTokenizer:()=>a.EsmTokenizer,ExaoneForCausalLM:()=>n.ExaoneForCausalLM,ExaoneModel:()=>n.ExaoneModel,ExaonePreTrainedModel:()=>n.ExaonePreTrainedModel,FFT:()=>p.FFT,FalconForCausalLM:()=>n.FalconForCausalLM,FalconModel:()=>n.FalconModel,FalconPreTrainedModel:()=>n.FalconPreTrainedModel,FalconTokenizer:()=>a.FalconTokenizer,FastViTForImageClassification:()=>n.FastViTForImageClassification,FastViTModel:()=>n.FastViTModel,FastViTPreTrainedModel:()=>n.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>r.FeatureExtractionPipeline,FeatureExtractor:()=>g.FeatureExtractor,FillMaskPipeline:()=>r.FillMaskPipeline,Florence2ForConditionalGeneration:()=>n.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>n.Florence2PreTrainedModel,Florence2Processor:()=>E.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>S.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>S.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>M.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>n.GLPNForDepthEstimation,GLPNModel:()=>n.GLPNModel,GLPNPreTrainedModel:()=>n.GLPNPreTrainedModel,GPT2LMHeadModel:()=>n.GPT2LMHeadModel,GPT2Model:()=>n.GPT2Model,GPT2PreTrainedModel:()=>n.GPT2PreTrainedModel,GPT2Tokenizer:()=>a.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>n.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>n.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>n.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>n.GPTJForCausalLM,GPTJModel:()=>n.GPTJModel,GPTJPreTrainedModel:()=>n.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>n.GPTNeoForCausalLM,GPTNeoModel:()=>n.GPTNeoModel,GPTNeoPreTrainedModel:()=>n.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>n.GPTNeoXForCausalLM,GPTNeoXModel:()=>n.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>n.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>a.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>n.Gemma2ForCausalLM,Gemma2Model:()=>n.Gemma2Model,Gemma2PreTrainedModel:()=>n.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>n.Gemma3ForCausalLM,Gemma3Model:()=>n.Gemma3Model,Gemma3PreTrainedModel:()=>n.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>_.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>n.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>n.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>E.Gemma3nProcessor,GemmaForCausalLM:()=>n.GemmaForCausalLM,GemmaModel:()=>n.GemmaModel,GemmaPreTrainedModel:()=>n.GemmaPreTrainedModel,GemmaTokenizer:()=>a.GemmaTokenizer,GlmForCausalLM:()=>n.GlmForCausalLM,GlmModel:()=>n.GlmModel,GlmPreTrainedModel:()=>n.GlmPreTrainedModel,GraniteForCausalLM:()=>n.GraniteForCausalLM,GraniteModel:()=>n.GraniteModel,GranitePreTrainedModel:()=>n.GranitePreTrainedModel,Grok1Tokenizer:()=>a.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>n.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>M.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>n.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>E.GroundingDinoProcessor,GroupViTModel:()=>n.GroupViTModel,GroupViTPreTrainedModel:()=>n.GroupViTPreTrainedModel,HeliumForCausalLM:()=>n.HeliumForCausalLM,HeliumModel:()=>n.HeliumModel,HeliumPreTrainedModel:()=>n.HeliumPreTrainedModel,HerbertTokenizer:()=>a.HerbertTokenizer,HieraForImageClassification:()=>n.HieraForImageClassification,HieraModel:()=>n.HieraModel,HieraPreTrainedModel:()=>n.HieraPreTrainedModel,HubertForCTC:()=>n.HubertForCTC,HubertForSequenceClassification:()=>n.HubertForSequenceClassification,HubertModel:()=>n.HubertModel,HubertPreTrainedModel:()=>n.HubertPreTrainedModel,IJepaForImageClassification:()=>n.IJepaForImageClassification,IJepaModel:()=>n.IJepaModel,IJepaPreTrainedModel:()=>n.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>n.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>M.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>n.Idefics3PreTrainedModel,Idefics3Processor:()=>E.Idefics3Processor,ImageClassificationPipeline:()=>r.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>r.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>_.ImageFeatureExtractor,ImageMattingOutput:()=>n.ImageMattingOutput,ImageProcessor:()=>w.ImageProcessor,ImageSegmentationPipeline:()=>r.ImageSegmentationPipeline,ImageToImagePipeline:()=>r.ImageToImagePipeline,ImageToTextPipeline:()=>r.ImageToTextPipeline,InterruptableStoppingCriteria:()=>O.InterruptableStoppingCriteria,JAISLMHeadModel:()=>n.JAISLMHeadModel,JAISModel:()=>n.JAISModel,JAISPreTrainedModel:()=>n.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>M.JinaCLIPImageProcessor,JinaCLIPModel:()=>n.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>n.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>E.JinaCLIPProcessor,JinaCLIPTextModel:()=>n.JinaCLIPTextModel,JinaCLIPVisionModel:()=>n.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>n.Lfm2ForCausalLM,Lfm2Model:()=>n.Lfm2Model,Lfm2PreTrainedModel:()=>n.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>n.LiteWhisperForConditionalGeneration,LlamaForCausalLM:()=>n.LlamaForCausalLM,LlamaModel:()=>n.LlamaModel,LlamaPreTrainedModel:()=>n.LlamaPreTrainedModel,LlamaTokenizer:()=>a.LlamaTokenizer,LlavaForConditionalGeneration:()=>n.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>n.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>M.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>n.LlavaPreTrainedModel,LlavaProcessor:()=>E.LlavaProcessor,LlavaQwen2ForCausalLM:()=>n.LlavaQwen2ForCausalLM,LogitsProcessor:()=>S.LogitsProcessor,LogitsProcessorList:()=>S.LogitsProcessorList,LogitsWarper:()=>S.LogitsWarper,LongT5ForConditionalGeneration:()=>n.LongT5ForConditionalGeneration,LongT5Model:()=>n.LongT5Model,LongT5PreTrainedModel:()=>n.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>n.M2M100ForConditionalGeneration,M2M100Model:()=>n.M2M100Model,M2M100PreTrainedModel:()=>n.M2M100PreTrainedModel,M2M100Tokenizer:()=>a.M2M100Tokenizer,MBart50Tokenizer:()=>a.MBart50Tokenizer,MBartForCausalLM:()=>n.MBartForCausalLM,MBartForConditionalGeneration:()=>n.MBartForConditionalGeneration,MBartForSequenceClassification:()=>n.MBartForSequenceClassification,MBartModel:()=>n.MBartModel,MBartPreTrainedModel:()=>n.MBartPreTrainedModel,MBartTokenizer:()=>a.MBartTokenizer,MPNetForMaskedLM:()=>n.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>n.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>n.MPNetForSequenceClassification,MPNetForTokenClassification:()=>n.MPNetForTokenClassification,MPNetModel:()=>n.MPNetModel,MPNetPreTrainedModel:()=>n.MPNetPreTrainedModel,MPNetTokenizer:()=>a.MPNetTokenizer,MT5ForConditionalGeneration:()=>n.MT5ForConditionalGeneration,MT5Model:()=>n.MT5Model,MT5PreTrainedModel:()=>n.MT5PreTrainedModel,MarianMTModel:()=>n.MarianMTModel,MarianModel:()=>n.MarianModel,MarianPreTrainedModel:()=>n.MarianPreTrainedModel,MarianTokenizer:()=>a.MarianTokenizer,Mask2FormerImageProcessor:()=>M.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>M.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>n.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>M.MaskFormerImageProcessor,MaskFormerModel:()=>n.MaskFormerModel,MaskFormerPreTrainedModel:()=>n.MaskFormerPreTrainedModel,MaskedLMOutput:()=>n.MaskedLMOutput,MaxLengthCriteria:()=>O.MaxLengthCriteria,Metric3DForDepthEstimation:()=>n.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>n.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>n.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>n.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>n.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>n.MgpstrModelOutput,MgpstrPreTrainedModel:()=>n.MgpstrPreTrainedModel,MgpstrProcessor:()=>E.MgpstrProcessor,MgpstrTokenizer:()=>a.MgpstrTokenizer,MimiDecoderModel:()=>n.MimiDecoderModel,MimiDecoderOutput:()=>n.MimiDecoderOutput,MimiEncoderModel:()=>n.MimiEncoderModel,MimiEncoderOutput:()=>n.MimiEncoderOutput,MimiModel:()=>n.MimiModel,MimiPreTrainedModel:()=>n.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>S.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>S.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>n.MistralForCausalLM,MistralModel:()=>n.MistralModel,MistralPreTrainedModel:()=>n.MistralPreTrainedModel,MobileBertForMaskedLM:()=>n.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>n.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>n.MobileBertForSequenceClassification,MobileBertModel:()=>n.MobileBertModel,MobileBertPreTrainedModel:()=>n.MobileBertPreTrainedModel,MobileBertTokenizer:()=>a.MobileBertTokenizer,MobileLLMForCausalLM:()=>n.MobileLLMForCausalLM,MobileLLMModel:()=>n.MobileLLMModel,MobileLLMPreTrainedModel:()=>n.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>M.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>n.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>n.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>M.MobileNetV1ImageProcessor,MobileNetV1Model:()=>n.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>n.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>M.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>n.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>n.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>M.MobileNetV2ImageProcessor,MobileNetV2Model:()=>n.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>n.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>M.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>n.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>n.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>M.MobileNetV3ImageProcessor,MobileNetV3Model:()=>n.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>n.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>M.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>n.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>n.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>M.MobileNetV4ImageProcessor,MobileNetV4Model:()=>n.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>n.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>M.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>n.MobileViTForImageClassification,MobileViTImageProcessor:()=>M.MobileViTImageProcessor,MobileViTModel:()=>n.MobileViTModel,MobileViTPreTrainedModel:()=>n.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>n.MobileViTV2ForImageClassification,MobileViTV2Model:()=>n.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>n.MobileViTV2PreTrainedModel,ModelOutput:()=>n.ModelOutput,ModernBertDecoderForCausalLM:()=>n.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>n.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>n.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>n.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>n.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>n.ModernBertForTokenClassification,ModernBertModel:()=>n.ModernBertModel,ModernBertPreTrainedModel:()=>n.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>n.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>_.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>n.MoonshineForConditionalGeneration,MoonshineModel:()=>n.MoonshineModel,MoonshinePreTrainedModel:()=>n.MoonshinePreTrainedModel,MoonshineProcessor:()=>E.MoonshineProcessor,MptForCausalLM:()=>n.MptForCausalLM,MptModel:()=>n.MptModel,MptPreTrainedModel:()=>n.MptPreTrainedModel,MultiModalityCausalLM:()=>n.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>n.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>n.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>n.MusicgenForConditionalGeneration,MusicgenModel:()=>n.MusicgenModel,MusicgenPreTrainedModel:()=>n.MusicgenPreTrainedModel,NeoBertForMaskedLM:()=>n.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>n.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>n.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>n.NeoBertForTokenClassification,NeoBertModel:()=>n.NeoBertModel,NeoBertPreTrainedModel:()=>n.NeoBertPreTrainedModel,NllbTokenizer:()=>a.NllbTokenizer,NoBadWordsLogitsProcessor:()=>S.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>S.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>n.NomicBertModel,NomicBertPreTrainedModel:()=>n.NomicBertPreTrainedModel,NougatImageProcessor:()=>M.NougatImageProcessor,NougatTokenizer:()=>a.NougatTokenizer,OPTForCausalLM:()=>n.OPTForCausalLM,OPTModel:()=>n.OPTModel,OPTPreTrainedModel:()=>n.OPTPreTrainedModel,ObjectDetectionPipeline:()=>r.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>n.Olmo2ForCausalLM,Olmo2Model:()=>n.Olmo2Model,Olmo2PreTrainedModel:()=>n.Olmo2PreTrainedModel,OlmoForCausalLM:()=>n.OlmoForCausalLM,OlmoModel:()=>n.OlmoModel,OlmoPreTrainedModel:()=>n.OlmoPreTrainedModel,OpenELMForCausalLM:()=>n.OpenELMForCausalLM,OpenELMModel:()=>n.OpenELMModel,OpenELMPreTrainedModel:()=>n.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>M.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>n.OwlViTForObjectDetection,OwlViTImageProcessor:()=>M.OwlViTImageProcessor,OwlViTModel:()=>n.OwlViTModel,OwlViTPreTrainedModel:()=>n.OwlViTPreTrainedModel,OwlViTProcessor:()=>E.OwlViTProcessor,Owlv2ForObjectDetection:()=>n.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>M.Owlv2ImageProcessor,Owlv2Model:()=>n.Owlv2Model,Owlv2PreTrainedModel:()=>n.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>n.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>n.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>E.PaliGemmaProcessor,PatchTSMixerForPrediction:()=>n.PatchTSMixerForPrediction,PatchTSMixerModel:()=>n.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>n.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>n.PatchTSTForPrediction,PatchTSTModel:()=>n.PatchTSTModel,PatchTSTPreTrainedModel:()=>n.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>n.Phi3ForCausalLM,Phi3Model:()=>n.Phi3Model,Phi3PreTrainedModel:()=>n.Phi3PreTrainedModel,Phi3VForCausalLM:()=>n.Phi3VForCausalLM,Phi3VImageProcessor:()=>M.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>n.Phi3VPreTrainedModel,Phi3VProcessor:()=>E.Phi3VProcessor,PhiForCausalLM:()=>n.PhiForCausalLM,PhiModel:()=>n.PhiModel,PhiPreTrainedModel:()=>n.PhiPreTrainedModel,Pipeline:()=>r.Pipeline,PreTrainedModel:()=>n.PreTrainedModel,PreTrainedTokenizer:()=>a.PreTrainedTokenizer,PretrainedConfig:()=>o.PretrainedConfig,PretrainedMixin:()=>n.PretrainedMixin,Processor:()=>F.Processor,PvtForImageClassification:()=>n.PvtForImageClassification,PvtImageProcessor:()=>M.PvtImageProcessor,PvtModel:()=>n.PvtModel,PvtPreTrainedModel:()=>n.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>_.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>n.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>n.PyAnnoteModel,PyAnnotePreTrainedModel:()=>n.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>E.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>n.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>r.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>n.Qwen2ForCausalLM,Qwen2Model:()=>n.Qwen2Model,Qwen2PreTrainedModel:()=>n.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>a.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>n.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>M.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>n.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>E.Qwen2VLProcessor,Qwen3ForCausalLM:()=>n.Qwen3ForCausalLM,Qwen3Model:()=>n.Qwen3Model,Qwen3PreTrainedModel:()=>n.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>n.RFDetrForObjectDetection,RFDetrModel:()=>n.RFDetrModel,RFDetrObjectDetectionOutput:()=>n.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>n.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>n.RTDetrForObjectDetection,RTDetrImageProcessor:()=>M.RTDetrImageProcessor,RTDetrModel:()=>n.RTDetrModel,RTDetrObjectDetectionOutput:()=>n.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>n.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>n.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>n.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>n.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>n.RTDetrV2PreTrainedModel,RawAudio:()=>u.RawAudio,RawImage:()=>d.RawImage,RawVideo:()=>c.RawVideo,RawVideoFrame:()=>c.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>S.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>n.ResNetForImageClassification,ResNetModel:()=>n.ResNetModel,ResNetPreTrainedModel:()=>n.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>n.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>n.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>n.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>n.RoFormerForTokenClassification,RoFormerModel:()=>n.RoFormerModel,RoFormerPreTrainedModel:()=>n.RoFormerPreTrainedModel,RoFormerTokenizer:()=>a.RoFormerTokenizer,RobertaForMaskedLM:()=>n.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>n.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>n.RobertaForSequenceClassification,RobertaForTokenClassification:()=>n.RobertaForTokenClassification,RobertaModel:()=>n.RobertaModel,RobertaPreTrainedModel:()=>n.RobertaPreTrainedModel,RobertaTokenizer:()=>a.RobertaTokenizer,SamImageProcessor:()=>M.SamImageProcessor,SamImageSegmentationOutput:()=>n.SamImageSegmentationOutput,SamModel:()=>n.SamModel,SamPreTrainedModel:()=>n.SamPreTrainedModel,SamProcessor:()=>E.SamProcessor,SapiensForDepthEstimation:()=>n.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>n.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>n.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>n.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>_.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>M.SegformerFeatureExtractor,SegformerForImageClassification:()=>n.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>n.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>M.SegformerImageProcessor,SegformerModel:()=>n.SegformerModel,SegformerPreTrainedModel:()=>n.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>n.Seq2SeqLMOutput,SequenceClassifierOutput:()=>n.SequenceClassifierOutput,SiglipImageProcessor:()=>M.SiglipImageProcessor,SiglipModel:()=>n.SiglipModel,SiglipPreTrainedModel:()=>n.SiglipPreTrainedModel,SiglipTextModel:()=>n.SiglipTextModel,SiglipTokenizer:()=>a.SiglipTokenizer,SiglipVisionModel:()=>n.SiglipVisionModel,SmolLM3ForCausalLM:()=>n.SmolLM3ForCausalLM,SmolLM3Model:()=>n.SmolLM3Model,SmolLM3PreTrainedModel:()=>n.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>n.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>M.SmolVLMImageProcessor,SmolVLMProcessor:()=>E.SmolVLMProcessor,SnacDecoderModel:()=>n.SnacDecoderModel,SnacEncoderModel:()=>n.SnacEncoderModel,SnacFeatureExtractor:()=>_.SnacFeatureExtractor,SnacModel:()=>n.SnacModel,SnacPreTrainedModel:()=>n.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>_.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>n.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>n.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>n.SpeechT5HifiGan,SpeechT5Model:()=>n.SpeechT5Model,SpeechT5PreTrainedModel:()=>n.SpeechT5PreTrainedModel,SpeechT5Processor:()=>E.SpeechT5Processor,SpeechT5Tokenizer:()=>a.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>n.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>n.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>n.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>n.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>n.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>a.SqueezeBertTokenizer,StableLmForCausalLM:()=>n.StableLmForCausalLM,StableLmModel:()=>n.StableLmModel,StableLmPreTrainedModel:()=>n.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>n.Starcoder2ForCausalLM,Starcoder2Model:()=>n.Starcoder2Model,Starcoder2PreTrainedModel:()=>n.Starcoder2PreTrainedModel,StoppingCriteria:()=>O.StoppingCriteria,StoppingCriteriaList:()=>O.StoppingCriteriaList,StyleTextToSpeech2Model:()=>n.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>n.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>r.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>S.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>n.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>M.Swin2SRImageProcessor,Swin2SRModel:()=>n.Swin2SRModel,Swin2SRPreTrainedModel:()=>n.Swin2SRPreTrainedModel,SwinForImageClassification:()=>n.SwinForImageClassification,SwinForSemanticSegmentation:()=>n.SwinForSemanticSegmentation,SwinModel:()=>n.SwinModel,SwinPreTrainedModel:()=>n.SwinPreTrainedModel,T5ForConditionalGeneration:()=>n.T5ForConditionalGeneration,T5Model:()=>n.T5Model,T5PreTrainedModel:()=>n.T5PreTrainedModel,T5Tokenizer:()=>a.T5Tokenizer,TableTransformerForObjectDetection:()=>n.TableTransformerForObjectDetection,TableTransformerModel:()=>n.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>n.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>n.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>S.TemperatureLogitsWarper,Tensor:()=>f.Tensor,Text2TextGenerationPipeline:()=>r.Text2TextGenerationPipeline,TextClassificationPipeline:()=>r.TextClassificationPipeline,TextGenerationPipeline:()=>r.TextGenerationPipeline,TextStreamer:()=>L.TextStreamer,TextToAudioPipeline:()=>r.TextToAudioPipeline,TokenClassificationPipeline:()=>r.TokenClassificationPipeline,TokenClassifierOutput:()=>n.TokenClassifierOutput,TokenizerModel:()=>a.TokenizerModel,TopKLogitsWarper:()=>S.TopKLogitsWarper,TopPLogitsWarper:()=>S.TopPLogitsWarper,TrOCRForCausalLM:()=>n.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>n.TrOCRPreTrainedModel,TranslationPipeline:()=>r.TranslationPipeline,UltravoxModel:()=>n.UltravoxModel,UltravoxPreTrainedModel:()=>n.UltravoxPreTrainedModel,UltravoxProcessor:()=>E.UltravoxProcessor,UniSpeechForCTC:()=>n.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>n.UniSpeechForSequenceClassification,UniSpeechModel:()=>n.UniSpeechModel,UniSpeechPreTrainedModel:()=>n.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>n.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>n.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>n.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>n.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>n.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>E.VLChatProcessor,VLMImageProcessor:()=>M.VLMImageProcessor,ViTFeatureExtractor:()=>M.ViTFeatureExtractor,ViTForImageClassification:()=>n.ViTForImageClassification,ViTImageProcessor:()=>M.ViTImageProcessor,ViTMAEModel:()=>n.ViTMAEModel,ViTMAEPreTrainedModel:()=>n.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>n.ViTMSNForImageClassification,ViTMSNModel:()=>n.ViTMSNModel,ViTMSNPreTrainedModel:()=>n.ViTMSNPreTrainedModel,ViTModel:()=>n.ViTModel,ViTPreTrainedModel:()=>n.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>n.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>n.VitMatteForImageMatting,VitMatteImageProcessor:()=>M.VitMatteImageProcessor,VitMattePreTrainedModel:()=>n.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>n.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>M.VitPoseImageProcessor,VitPosePreTrainedModel:()=>n.VitPosePreTrainedModel,VitsModel:()=>n.VitsModel,VitsModelOutput:()=>n.VitsModelOutput,VitsPreTrainedModel:()=>n.VitsPreTrainedModel,VitsTokenizer:()=>a.VitsTokenizer,VoxtralForConditionalGeneration:()=>n.VoxtralForConditionalGeneration,VoxtralProcessor:()=>E.VoxtralProcessor,Wav2Vec2BertForCTC:()=>n.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>n.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>n.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>n.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>a.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>_.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>n.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>n.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>n.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>n.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>n.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>E.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>E.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>n.WavLMForAudioFrameClassification,WavLMForCTC:()=>n.WavLMForCTC,WavLMForSequenceClassification:()=>n.WavLMForSequenceClassification,WavLMForXVector:()=>n.WavLMForXVector,WavLMModel:()=>n.WavLMModel,WavLMPreTrainedModel:()=>n.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>_.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>n.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>n.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>_.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>n.WhisperForConditionalGeneration,WhisperModel:()=>n.WhisperModel,WhisperPreTrainedModel:()=>n.WhisperPreTrainedModel,WhisperProcessor:()=>E.WhisperProcessor,WhisperTextStreamer:()=>L.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>S.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>a.WhisperTokenizer,XLMForQuestionAnswering:()=>n.XLMForQuestionAnswering,XLMForSequenceClassification:()=>n.XLMForSequenceClassification,XLMForTokenClassification:()=>n.XLMForTokenClassification,XLMModel:()=>n.XLMModel,XLMPreTrainedModel:()=>n.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>n.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>n.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>n.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>n.XLMRobertaForTokenClassification,XLMRobertaModel:()=>n.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>n.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>a.XLMRobertaTokenizer,XLMTokenizer:()=>a.XLMTokenizer,XLMWithLMHeadModel:()=>n.XLMWithLMHeadModel,XVectorOutput:()=>n.XVectorOutput,YolosFeatureExtractor:()=>M.YolosFeatureExtractor,YolosForObjectDetection:()=>n.YolosForObjectDetection,YolosImageProcessor:()=>M.YolosImageProcessor,YolosModel:()=>n.YolosModel,YolosObjectDetectionOutput:()=>n.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>n.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>r.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>r.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>r.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>r.ZeroShotObjectDetectionPipeline,bankers_round:()=>p.bankers_round,cat:()=>f.cat,cos_sim:()=>p.cos_sim,dot:()=>p.dot,dynamic_time_warping:()=>p.dynamic_time_warping,env:()=>t.env,full:()=>f.full,full_like:()=>f.full_like,getCacheShapes:()=>o.getCacheShapes,hamming:()=>u.hamming,hanning:()=>u.hanning,interpolate:()=>f.interpolate,interpolate_4d:()=>f.interpolate_4d,interpolate_data:()=>p.interpolate_data,is_chinese_char:()=>a.is_chinese_char,layer_norm:()=>f.layer_norm,load_image:()=>d.load_image,load_video:()=>c.load_video,log_softmax:()=>p.log_softmax,magnitude:()=>p.magnitude,matmul:()=>f.matmul,max:()=>p.max,mean:()=>f.mean,mean_pooling:()=>f.mean_pooling,medianFilter:()=>p.medianFilter,mel_filter_bank:()=>u.mel_filter_bank,min:()=>p.min,ones:()=>f.ones,ones_like:()=>f.ones_like,permute:()=>f.permute,permute_data:()=>p.permute_data,pipeline:()=>r.pipeline,quantize_embeddings:()=>f.quantize_embeddings,rand:()=>f.rand,read_audio:()=>u.read_audio,rfft:()=>f.rfft,round:()=>p.round,slice:()=>f.slice,softmax:()=>p.softmax,spectrogram:()=>u.spectrogram,stack:()=>f.stack,std_mean:()=>f.std_mean,topk:()=>f.topk,window_function:()=>u.window_function,zeros:()=>f.zeros,zeros_like:()=>f.zeros_like});var t=Cn("./src/env.js"),r=Cn("./src/pipelines.js"),n=Cn("./src/models.js"),a=Cn("./src/tokenizers.js"),o=Cn("./src/configs.js"),u=Cn("./src/utils/audio.js"),d=Cn("./src/utils/image.js"),c=Cn("./src/utils/video.js"),f=Cn("./src/utils/tensor.js"),p=Cn("./src/utils/maths.js"),g=Cn("./src/base/feature_extraction_utils.js"),_=Cn("./src/models/feature_extractors.js"),h=Cn("./src/models/auto/feature_extraction_auto.js"),w=Cn("./src/base/image_processors_utils.js"),M=Cn("./src/models/image_processors.js"),x=Cn("./src/models/auto/image_processing_auto.js"),F=Cn("./src/base/processing_utils.js"),E=Cn("./src/models/processors.js"),T=Cn("./src/models/auto/processing_auto.js"),L=Cn("./src/generation/streamers.js"),O=Cn("./src/generation/stopping_criteria.js"),S=Cn("./src/generation/logits_process.js")})();b.ASTFeatureExtractor;b.ASTForAudioClassification;b.ASTModel;b.ASTPreTrainedModel;b.AlbertForMaskedLM;b.AlbertForQuestionAnswering;b.AlbertForSequenceClassification;b.AlbertModel;b.AlbertPreTrainedModel;b.AlbertTokenizer;b.ArceeForCausalLM;b.ArceeModel;b.ArceePreTrainedModel;b.AudioClassificationPipeline;b.AutoConfig;b.AutoFeatureExtractor;b.AutoImageProcessor;b.AutoModel;b.AutoModelForAudioClassification;b.AutoModelForAudioFrameClassification;b.AutoModelForAudioTextToText;b.AutoModelForCTC;b.AutoModelForCausalLM;b.AutoModelForDepthEstimation;b.AutoModelForDocumentQuestionAnswering;b.AutoModelForImageClassification;b.AutoModelForImageFeatureExtraction;b.AutoModelForImageMatting;b.AutoModelForImageSegmentation;var iT=b.AutoModelForImageTextToText;b.AutoModelForImageToImage;b.AutoModelForMaskGeneration;b.AutoModelForMaskedLM;b.AutoModelForNormalEstimation;b.AutoModelForObjectDetection;b.AutoModelForPoseEstimation;b.AutoModelForQuestionAnswering;b.AutoModelForSemanticSegmentation;b.AutoModelForSeq2SeqLM;b.AutoModelForSequenceClassification;b.AutoModelForSpeechSeq2Seq;b.AutoModelForTextToSpectrogram;b.AutoModelForTextToWaveform;b.AutoModelForTokenClassification;b.AutoModelForUniversalSegmentation;b.AutoModelForVision2Seq;b.AutoModelForXVector;b.AutoModelForZeroShotObjectDetection;var oT=b.AutoProcessor;b.AutoTokenizer;b.AutomaticSpeechRecognitionPipeline;b.BackgroundRemovalPipeline;b.BartForConditionalGeneration;b.BartForSequenceClassification;b.BartModel;b.BartPretrainedModel;b.BartTokenizer;b.BaseModelOutput;b.BaseStreamer;b.BeitFeatureExtractor;b.BeitForImageClassification;b.BeitModel;b.BeitPreTrainedModel;b.BertForMaskedLM;b.BertForQuestionAnswering;b.BertForSequenceClassification;b.BertForTokenClassification;b.BertModel;b.BertPreTrainedModel;b.BertTokenizer;b.BitImageProcessor;b.BlenderbotForConditionalGeneration;b.BlenderbotModel;b.BlenderbotPreTrainedModel;b.BlenderbotSmallForConditionalGeneration;b.BlenderbotSmallModel;b.BlenderbotSmallPreTrainedModel;b.BlenderbotSmallTokenizer;b.BlenderbotTokenizer;b.BloomForCausalLM;b.BloomModel;b.BloomPreTrainedModel;b.BloomTokenizer;b.CLIPFeatureExtractor;b.CLIPImageProcessor;b.CLIPModel;b.CLIPPreTrainedModel;b.CLIPSegForImageSegmentation;b.CLIPSegModel;b.CLIPSegPreTrainedModel;b.CLIPTextModel;b.CLIPTextModelWithProjection;b.CLIPTokenizer;b.CLIPVisionModel;b.CLIPVisionModelWithProjection;b.CamembertForMaskedLM;b.CamembertForQuestionAnswering;b.CamembertForSequenceClassification;b.CamembertForTokenClassification;b.CamembertModel;b.CamembertPreTrainedModel;b.CamembertTokenizer;b.CausalLMOutput;b.CausalLMOutputWithPast;b.ChineseCLIPFeatureExtractor;b.ChineseCLIPModel;b.ChineseCLIPPreTrainedModel;b.ClapAudioModelWithProjection;b.ClapFeatureExtractor;b.ClapModel;b.ClapPreTrainedModel;b.ClapTextModelWithProjection;b.ClassifierFreeGuidanceLogitsProcessor;b.CodeGenForCausalLM;b.CodeGenModel;b.CodeGenPreTrainedModel;b.CodeGenTokenizer;b.CodeLlamaTokenizer;b.CohereForCausalLM;b.CohereModel;b.CoherePreTrainedModel;b.CohereTokenizer;b.ConvBertForMaskedLM;b.ConvBertForQuestionAnswering;b.ConvBertForSequenceClassification;b.ConvBertForTokenClassification;b.ConvBertModel;b.ConvBertPreTrainedModel;b.ConvBertTokenizer;b.ConvNextFeatureExtractor;b.ConvNextForImageClassification;b.ConvNextImageProcessor;b.ConvNextModel;b.ConvNextPreTrainedModel;b.ConvNextV2ForImageClassification;b.ConvNextV2Model;b.ConvNextV2PreTrainedModel;b.DFineForObjectDetection;b.DFineModel;b.DFinePreTrainedModel;b.DINOv3ConvNextModel;b.DINOv3ConvNextPreTrainedModel;b.DINOv3ViTImageProcessor;b.DINOv3ViTModel;b.DINOv3ViTPreTrainedModel;b.DPTFeatureExtractor;b.DPTForDepthEstimation;b.DPTImageProcessor;b.DPTModel;b.DPTPreTrainedModel;b.DacDecoderModel;b.DacDecoderOutput;b.DacEncoderModel;b.DacEncoderOutput;b.DacFeatureExtractor;b.DacModel;b.DacPreTrainedModel;b.DataTypeMap;b.DebertaForMaskedLM;b.DebertaForQuestionAnswering;b.DebertaForSequenceClassification;b.DebertaForTokenClassification;b.DebertaModel;b.DebertaPreTrainedModel;b.DebertaTokenizer;b.DebertaV2ForMaskedLM;b.DebertaV2ForQuestionAnswering;b.DebertaV2ForSequenceClassification;b.DebertaV2ForTokenClassification;b.DebertaV2Model;b.DebertaV2PreTrainedModel;b.DebertaV2Tokenizer;b.DecisionTransformerModel;b.DecisionTransformerPreTrainedModel;b.DeiTFeatureExtractor;b.DeiTForImageClassification;b.DeiTImageProcessor;b.DeiTModel;b.DeiTPreTrainedModel;b.DepthAnythingForDepthEstimation;b.DepthAnythingPreTrainedModel;b.DepthEstimationPipeline;b.DepthProForDepthEstimation;b.DepthProPreTrainedModel;b.DetrFeatureExtractor;b.DetrForObjectDetection;b.DetrForSegmentation;b.DetrImageProcessor;b.DetrModel;b.DetrObjectDetectionOutput;b.DetrPreTrainedModel;b.DetrSegmentationOutput;b.Dinov2ForImageClassification;b.Dinov2Model;b.Dinov2PreTrainedModel;b.Dinov2WithRegistersForImageClassification;b.Dinov2WithRegistersModel;b.Dinov2WithRegistersPreTrainedModel;b.DistilBertForMaskedLM;b.DistilBertForQuestionAnswering;b.DistilBertForSequenceClassification;b.DistilBertForTokenClassification;b.DistilBertModel;b.DistilBertPreTrainedModel;b.DistilBertTokenizer;b.DocumentQuestionAnsweringPipeline;b.DonutFeatureExtractor;b.DonutImageProcessor;b.DonutSwinModel;b.DonutSwinPreTrainedModel;b.EfficientNetForImageClassification;b.EfficientNetImageProcessor;b.EfficientNetModel;b.EfficientNetPreTrainedModel;b.ElectraForMaskedLM;b.ElectraForQuestionAnswering;b.ElectraForSequenceClassification;b.ElectraForTokenClassification;b.ElectraModel;b.ElectraPreTrainedModel;b.ElectraTokenizer;b.EncodecFeatureExtractor;b.EosTokenCriteria;b.Ernie4_5_ForCausalLM;b.Ernie4_5_Model;b.Ernie4_5_PretrainedModel;b.Ernie4_5_Tokenizer;b.EsmForMaskedLM;b.EsmForSequenceClassification;b.EsmForTokenClassification;b.EsmModel;b.EsmPreTrainedModel;b.EsmTokenizer;b.ExaoneForCausalLM;b.ExaoneModel;b.ExaonePreTrainedModel;b.FFT;b.FalconForCausalLM;b.FalconModel;b.FalconPreTrainedModel;b.FalconTokenizer;b.FastViTForImageClassification;b.FastViTModel;b.FastViTPreTrainedModel;b.FeatureExtractionPipeline;b.FeatureExtractor;b.FillMaskPipeline;b.Florence2ForConditionalGeneration;b.Florence2PreTrainedModel;b.Florence2Processor;b.ForcedBOSTokenLogitsProcessor;b.ForcedEOSTokenLogitsProcessor;b.GLPNFeatureExtractor;b.GLPNForDepthEstimation;b.GLPNModel;b.GLPNPreTrainedModel;b.GPT2LMHeadModel;b.GPT2Model;b.GPT2PreTrainedModel;b.GPT2Tokenizer;b.GPTBigCodeForCausalLM;b.GPTBigCodeModel;b.GPTBigCodePreTrainedModel;b.GPTJForCausalLM;b.GPTJModel;b.GPTJPreTrainedModel;b.GPTNeoForCausalLM;b.GPTNeoModel;b.GPTNeoPreTrainedModel;b.GPTNeoXForCausalLM;b.GPTNeoXModel;b.GPTNeoXPreTrainedModel;b.GPTNeoXTokenizer;b.Gemma2ForCausalLM;b.Gemma2Model;b.Gemma2PreTrainedModel;b.Gemma3ForCausalLM;b.Gemma3Model;b.Gemma3PreTrainedModel;b.Gemma3nAudioFeatureExtractor;b.Gemma3nForConditionalGeneration;b.Gemma3nPreTrainedModel;b.Gemma3nProcessor;b.GemmaForCausalLM;b.GemmaModel;b.GemmaPreTrainedModel;b.GemmaTokenizer;b.GlmForCausalLM;b.GlmModel;b.GlmPreTrainedModel;b.GraniteForCausalLM;b.GraniteModel;b.GranitePreTrainedModel;b.Grok1Tokenizer;b.GroundingDinoForObjectDetection;b.GroundingDinoImageProcessor;b.GroundingDinoPreTrainedModel;b.GroundingDinoProcessor;b.GroupViTModel;b.GroupViTPreTrainedModel;b.HeliumForCausalLM;b.HeliumModel;b.HeliumPreTrainedModel;b.HerbertTokenizer;b.HieraForImageClassification;b.HieraModel;b.HieraPreTrainedModel;b.HubertForCTC;b.HubertForSequenceClassification;b.HubertModel;b.HubertPreTrainedModel;b.IJepaForImageClassification;b.IJepaModel;b.IJepaPreTrainedModel;b.Idefics3ForConditionalGeneration;b.Idefics3ImageProcessor;b.Idefics3PreTrainedModel;b.Idefics3Processor;b.ImageClassificationPipeline;b.ImageFeatureExtractionPipeline;b.ImageFeatureExtractor;b.ImageMattingOutput;b.ImageProcessor;b.ImageSegmentationPipeline;b.ImageToImagePipeline;b.ImageToTextPipeline;b.InterruptableStoppingCriteria;b.JAISLMHeadModel;b.JAISModel;b.JAISPreTrainedModel;b.JinaCLIPImageProcessor;b.JinaCLIPModel;b.JinaCLIPPreTrainedModel;b.JinaCLIPProcessor;b.JinaCLIPTextModel;b.JinaCLIPVisionModel;b.Lfm2ForCausalLM;b.Lfm2Model;b.Lfm2PreTrainedModel;b.LiteWhisperForConditionalGeneration;b.LlamaForCausalLM;b.LlamaModel;b.LlamaPreTrainedModel;b.LlamaTokenizer;b.LlavaForConditionalGeneration;b.LlavaOnevisionForConditionalGeneration;b.LlavaOnevisionImageProcessor;b.LlavaPreTrainedModel;b.LlavaProcessor;b.LlavaQwen2ForCausalLM;b.LogitsProcessor;b.LogitsProcessorList;b.LogitsWarper;b.LongT5ForConditionalGeneration;b.LongT5Model;b.LongT5PreTrainedModel;b.M2M100ForConditionalGeneration;b.M2M100Model;b.M2M100PreTrainedModel;b.M2M100Tokenizer;b.MBart50Tokenizer;b.MBartForCausalLM;b.MBartForConditionalGeneration;b.MBartForSequenceClassification;b.MBartModel;b.MBartPreTrainedModel;b.MBartTokenizer;b.MPNetForMaskedLM;b.MPNetForQuestionAnswering;b.MPNetForSequenceClassification;b.MPNetForTokenClassification;b.MPNetModel;b.MPNetPreTrainedModel;b.MPNetTokenizer;b.MT5ForConditionalGeneration;b.MT5Model;b.MT5PreTrainedModel;b.MarianMTModel;b.MarianModel;b.MarianPreTrainedModel;b.MarianTokenizer;b.Mask2FormerImageProcessor;b.MaskFormerFeatureExtractor;b.MaskFormerForInstanceSegmentation;b.MaskFormerImageProcessor;b.MaskFormerModel;b.MaskFormerPreTrainedModel;b.MaskedLMOutput;b.MaxLengthCriteria;b.Metric3DForDepthEstimation;b.Metric3DPreTrainedModel;b.Metric3Dv2ForDepthEstimation;b.Metric3Dv2PreTrainedModel;b.MgpstrForSceneTextRecognition;b.MgpstrModelOutput;b.MgpstrPreTrainedModel;b.MgpstrProcessor;b.MgpstrTokenizer;b.MimiDecoderModel;b.MimiDecoderOutput;b.MimiEncoderModel;b.MimiEncoderOutput;b.MimiModel;b.MimiPreTrainedModel;b.MinLengthLogitsProcessor;b.MinNewTokensLengthLogitsProcessor;b.MistralForCausalLM;b.MistralModel;b.MistralPreTrainedModel;b.MobileBertForMaskedLM;b.MobileBertForQuestionAnswering;b.MobileBertForSequenceClassification;b.MobileBertModel;b.MobileBertPreTrainedModel;b.MobileBertTokenizer;b.MobileLLMForCausalLM;b.MobileLLMModel;b.MobileLLMPreTrainedModel;b.MobileNetV1FeatureExtractor;b.MobileNetV1ForImageClassification;b.MobileNetV1ForSemanticSegmentation;b.MobileNetV1ImageProcessor;b.MobileNetV1Model;b.MobileNetV1PreTrainedModel;b.MobileNetV2FeatureExtractor;b.MobileNetV2ForImageClassification;b.MobileNetV2ForSemanticSegmentation;b.MobileNetV2ImageProcessor;b.MobileNetV2Model;b.MobileNetV2PreTrainedModel;b.MobileNetV3FeatureExtractor;b.MobileNetV3ForImageClassification;b.MobileNetV3ForSemanticSegmentation;b.MobileNetV3ImageProcessor;b.MobileNetV3Model;b.MobileNetV3PreTrainedModel;b.MobileNetV4FeatureExtractor;b.MobileNetV4ForImageClassification;b.MobileNetV4ForSemanticSegmentation;b.MobileNetV4ImageProcessor;b.MobileNetV4Model;b.MobileNetV4PreTrainedModel;b.MobileViTFeatureExtractor;b.MobileViTForImageClassification;b.MobileViTImageProcessor;b.MobileViTModel;b.MobileViTPreTrainedModel;b.MobileViTV2ForImageClassification;b.MobileViTV2Model;b.MobileViTV2PreTrainedModel;b.ModelOutput;b.ModernBertDecoderForCausalLM;b.ModernBertDecoderModel;b.ModernBertDecoderPreTrainedModel;b.ModernBertForMaskedLM;b.ModernBertForSequenceClassification;b.ModernBertForTokenClassification;b.ModernBertModel;b.ModernBertPreTrainedModel;b.Moondream1ForConditionalGeneration;b.MoonshineFeatureExtractor;b.MoonshineForConditionalGeneration;b.MoonshineModel;b.MoonshinePreTrainedModel;b.MoonshineProcessor;b.MptForCausalLM;b.MptModel;b.MptPreTrainedModel;b.MultiModalityCausalLM;b.MultiModalityPreTrainedModel;b.MusicgenForCausalLM;b.MusicgenForConditionalGeneration;b.MusicgenModel;b.MusicgenPreTrainedModel;b.NeoBertForMaskedLM;b.NeoBertForQuestionAnswering;b.NeoBertForSequenceClassification;b.NeoBertForTokenClassification;b.NeoBertModel;b.NeoBertPreTrainedModel;b.NllbTokenizer;b.NoBadWordsLogitsProcessor;b.NoRepeatNGramLogitsProcessor;b.NomicBertModel;b.NomicBertPreTrainedModel;b.NougatImageProcessor;b.NougatTokenizer;b.OPTForCausalLM;b.OPTModel;b.OPTPreTrainedModel;b.ObjectDetectionPipeline;b.Olmo2ForCausalLM;b.Olmo2Model;b.Olmo2PreTrainedModel;b.OlmoForCausalLM;b.OlmoModel;b.OlmoPreTrainedModel;b.OpenELMForCausalLM;b.OpenELMModel;b.OpenELMPreTrainedModel;b.OwlViTFeatureExtractor;b.OwlViTForObjectDetection;b.OwlViTImageProcessor;b.OwlViTModel;b.OwlViTPreTrainedModel;b.OwlViTProcessor;b.Owlv2ForObjectDetection;b.Owlv2ImageProcessor;b.Owlv2Model;b.Owlv2PreTrainedModel;b.PaliGemmaForConditionalGeneration;b.PaliGemmaPreTrainedModel;b.PaliGemmaProcessor;b.PatchTSMixerForPrediction;b.PatchTSMixerModel;b.PatchTSMixerPreTrainedModel;b.PatchTSTForPrediction;b.PatchTSTModel;b.PatchTSTPreTrainedModel;b.Phi3ForCausalLM;b.Phi3Model;b.Phi3PreTrainedModel;b.Phi3VForCausalLM;b.Phi3VImageProcessor;b.Phi3VPreTrainedModel;b.Phi3VProcessor;b.PhiForCausalLM;b.PhiModel;b.PhiPreTrainedModel;b.Pipeline;b.PreTrainedModel;b.PreTrainedTokenizer;b.PretrainedConfig;b.PretrainedMixin;b.Processor;b.PvtForImageClassification;b.PvtImageProcessor;b.PvtModel;b.PvtPreTrainedModel;b.PyAnnoteFeatureExtractor;b.PyAnnoteForAudioFrameClassification;b.PyAnnoteModel;b.PyAnnotePreTrainedModel;b.PyAnnoteProcessor;b.QuestionAnsweringModelOutput;b.QuestionAnsweringPipeline;b.Qwen2ForCausalLM;b.Qwen2Model;b.Qwen2PreTrainedModel;b.Qwen2Tokenizer;b.Qwen2VLForConditionalGeneration;b.Qwen2VLImageProcessor;b.Qwen2VLPreTrainedModel;b.Qwen2VLProcessor;b.Qwen3ForCausalLM;b.Qwen3Model;b.Qwen3PreTrainedModel;b.RFDetrForObjectDetection;b.RFDetrModel;b.RFDetrObjectDetectionOutput;b.RFDetrPreTrainedModel;b.RTDetrForObjectDetection;b.RTDetrImageProcessor;b.RTDetrModel;b.RTDetrObjectDetectionOutput;b.RTDetrPreTrainedModel;b.RTDetrV2ForObjectDetection;b.RTDetrV2Model;b.RTDetrV2ObjectDetectionOutput;b.RTDetrV2PreTrainedModel;b.RawAudio;var lT=b.RawImage;b.RawVideo;b.RawVideoFrame;b.RepetitionPenaltyLogitsProcessor;b.ResNetForImageClassification;b.ResNetModel;b.ResNetPreTrainedModel;b.RoFormerForMaskedLM;b.RoFormerForQuestionAnswering;b.RoFormerForSequenceClassification;b.RoFormerForTokenClassification;b.RoFormerModel;b.RoFormerPreTrainedModel;b.RoFormerTokenizer;b.RobertaForMaskedLM;b.RobertaForQuestionAnswering;b.RobertaForSequenceClassification;b.RobertaForTokenClassification;b.RobertaModel;b.RobertaPreTrainedModel;b.RobertaTokenizer;b.SamImageProcessor;b.SamImageSegmentationOutput;b.SamModel;b.SamPreTrainedModel;b.SamProcessor;b.SapiensForDepthEstimation;b.SapiensForNormalEstimation;b.SapiensForSemanticSegmentation;b.SapiensPreTrainedModel;b.SeamlessM4TFeatureExtractor;b.SegformerFeatureExtractor;b.SegformerForImageClassification;b.SegformerForSemanticSegmentation;b.SegformerImageProcessor;b.SegformerModel;b.SegformerPreTrainedModel;b.Seq2SeqLMOutput;b.SequenceClassifierOutput;b.SiglipImageProcessor;b.SiglipModel;b.SiglipPreTrainedModel;b.SiglipTextModel;b.SiglipTokenizer;b.SiglipVisionModel;b.SmolLM3ForCausalLM;b.SmolLM3Model;b.SmolLM3PreTrainedModel;b.SmolVLMForConditionalGeneration;b.SmolVLMImageProcessor;b.SmolVLMProcessor;b.SnacDecoderModel;b.SnacEncoderModel;b.SnacFeatureExtractor;b.SnacModel;b.SnacPreTrainedModel;b.SpeechT5FeatureExtractor;b.SpeechT5ForSpeechToText;b.SpeechT5ForTextToSpeech;b.SpeechT5HifiGan;b.SpeechT5Model;b.SpeechT5PreTrainedModel;b.SpeechT5Processor;b.SpeechT5Tokenizer;b.SqueezeBertForMaskedLM;b.SqueezeBertForQuestionAnswering;b.SqueezeBertForSequenceClassification;b.SqueezeBertModel;b.SqueezeBertPreTrainedModel;b.SqueezeBertTokenizer;b.StableLmForCausalLM;b.StableLmModel;b.StableLmPreTrainedModel;b.Starcoder2ForCausalLM;b.Starcoder2Model;b.Starcoder2PreTrainedModel;b.StoppingCriteria;b.StoppingCriteriaList;b.StyleTextToSpeech2Model;b.StyleTextToSpeech2PreTrainedModel;b.SummarizationPipeline;b.SuppressTokensAtBeginLogitsProcessor;b.Swin2SRForImageSuperResolution;b.Swin2SRImageProcessor;b.Swin2SRModel;b.Swin2SRPreTrainedModel;b.SwinForImageClassification;b.SwinForSemanticSegmentation;b.SwinModel;b.SwinPreTrainedModel;b.T5ForConditionalGeneration;b.T5Model;b.T5PreTrainedModel;b.T5Tokenizer;b.TableTransformerForObjectDetection;b.TableTransformerModel;b.TableTransformerObjectDetectionOutput;b.TableTransformerPreTrainedModel;b.TemperatureLogitsWarper;b.Tensor;b.Text2TextGenerationPipeline;b.TextClassificationPipeline;b.TextGenerationPipeline;var uT=b.TextStreamer;b.TextToAudioPipeline;b.TokenClassificationPipeline;b.TokenClassifierOutput;b.TokenizerModel;b.TopKLogitsWarper;b.TopPLogitsWarper;b.TrOCRForCausalLM;b.TrOCRPreTrainedModel;b.TranslationPipeline;b.UltravoxModel;b.UltravoxPreTrainedModel;b.UltravoxProcessor;b.UniSpeechForCTC;b.UniSpeechForSequenceClassification;b.UniSpeechModel;b.UniSpeechPreTrainedModel;b.UniSpeechSatForAudioFrameClassification;b.UniSpeechSatForCTC;b.UniSpeechSatForSequenceClassification;b.UniSpeechSatModel;b.UniSpeechSatPreTrainedModel;b.VLChatProcessor;b.VLMImageProcessor;b.ViTFeatureExtractor;b.ViTForImageClassification;b.ViTImageProcessor;b.ViTMAEModel;b.ViTMAEPreTrainedModel;b.ViTMSNForImageClassification;b.ViTMSNModel;b.ViTMSNPreTrainedModel;b.ViTModel;b.ViTPreTrainedModel;b.VisionEncoderDecoderModel;b.VitMatteForImageMatting;b.VitMatteImageProcessor;b.VitMattePreTrainedModel;b.VitPoseForPoseEstimation;b.VitPoseImageProcessor;b.VitPosePreTrainedModel;b.VitsModel;b.VitsModelOutput;b.VitsPreTrainedModel;b.VitsTokenizer;b.VoxtralForConditionalGeneration;b.VoxtralProcessor;b.Wav2Vec2BertForCTC;b.Wav2Vec2BertForSequenceClassification;b.Wav2Vec2BertModel;b.Wav2Vec2BertPreTrainedModel;b.Wav2Vec2CTCTokenizer;b.Wav2Vec2FeatureExtractor;b.Wav2Vec2ForAudioFrameClassification;b.Wav2Vec2ForCTC;b.Wav2Vec2ForSequenceClassification;b.Wav2Vec2Model;b.Wav2Vec2PreTrainedModel;b.Wav2Vec2Processor;b.Wav2Vec2ProcessorWithLM;b.WavLMForAudioFrameClassification;b.WavLMForCTC;b.WavLMForSequenceClassification;b.WavLMForXVector;b.WavLMModel;b.WavLMPreTrainedModel;b.WeSpeakerFeatureExtractor;b.WeSpeakerResNetModel;b.WeSpeakerResNetPreTrainedModel;b.WhisperFeatureExtractor;b.WhisperForConditionalGeneration;b.WhisperModel;b.WhisperPreTrainedModel;b.WhisperProcessor;b.WhisperTextStreamer;b.WhisperTimeStampLogitsProcessor;b.WhisperTokenizer;b.XLMForQuestionAnswering;b.XLMForSequenceClassification;b.XLMForTokenClassification;b.XLMModel;b.XLMPreTrainedModel;b.XLMRobertaForMaskedLM;b.XLMRobertaForQuestionAnswering;b.XLMRobertaForSequenceClassification;b.XLMRobertaForTokenClassification;b.XLMRobertaModel;b.XLMRobertaPreTrainedModel;b.XLMRobertaTokenizer;b.XLMTokenizer;b.XLMWithLMHeadModel;b.XVectorOutput;b.YolosFeatureExtractor;b.YolosForObjectDetection;b.YolosImageProcessor;b.YolosModel;b.YolosObjectDetectionOutput;b.YolosPreTrainedModel;b.ZeroShotAudioClassificationPipeline;b.ZeroShotClassificationPipeline;b.ZeroShotImageClassificationPipeline;b.ZeroShotObjectDetectionPipeline;b.bankers_round;b.cat;b.cos_sim;b.dot;b.dynamic_time_warping;b.env;b.full;b.full_like;b.getCacheShapes;b.hamming;b.hanning;b.interpolate;b.interpolate_4d;b.interpolate_data;b.is_chinese_char;b.layer_norm;b.load_image;b.load_video;b.log_softmax;b.magnitude;b.matmul;b.max;b.mean;b.mean_pooling;b.medianFilter;b.mel_filter_bank;b.min;b.ones;b.ones_like;b.permute;b.permute_data;b.pipeline;b.quantize_embeddings;b.rand;b.read_audio;b.rfft;b.round;b.slice;b.softmax;b.spectrogram;b.stack;b.std_mean;b.topk;b.window_function;b.zeros;b.zeros_like;const Nw=xt.createContext(null),Xy="onnx-community/FastVLM-0.5B-ONNX",cT=512,dT=({children:t})=>{const[r,n]=xt.useState(!1),[a,o]=xt.useState(!1),[u,d]=xt.useState(null),c=xt.useRef(null),f=xt.useRef(null),p=xt.useRef(null),g=xt.useRef(!1),_=xt.useRef(null),h=xt.useCallback(async M=>{if(r){M?.("Model already loaded!");return}return p.current||(o(!0),d(null),p.current=(async()=>{try{M?.("Loading processor..."),c.current=await oT.from_pretrained(Xy),M?.("Processor loaded. Loading model..."),f.current=await iT.from_pretrained(Xy,{dtype:{embed_tokens:"fp16",vision_encoder:"q4",decoder_model_merged:"q4"},device:"webgpu"}),M?.("Model loaded successfully!"),n(!0)}catch(x){const F=x instanceof Error?x.message:String(x);throw d(F),console.error("Error loading model:",x),x}finally{o(!1),p.current=null}})()),p.current},[r]),w=xt.useCallback(async(M,x,F)=>{if(g.current)return console.log("Inference already running, skipping frame"),"";if(g.current=!0,!c.current||!f.current)throw new Error("Model/processor not loaded");_.current||(_.current=document.createElement("canvas"));const E=_.current;E.width=M.videoWidth,E.height=M.videoHeight;const T=E.getContext("2d",{willReadFrequently:!0});if(!T)throw new Error("Could not get canvas context");T.drawImage(M,0,0);const L=T.getImageData(0,0,E.width,E.height),O=new lT(L.data,L.width,L.height,4),S=[{role:"system",content:"You are a helpful visual AI assistant. Respond concisely and accurately to the user's query in one sentence."},{role:"user",content:`<image>${x}`}],$=c.current.apply_chat_template(S,{add_generation_prompt:!0}),C=await c.current(O,$,{add_special_tokens:!1});let k="";const U=new uT(c.current.tokenizer,{skip_prompt:!0,skip_special_tokens:!0,callback_function:ne=>{k+=ne,F?.(k.trim())}}),V=await f.current.generate({...C,max_new_tokens:cT,do_sample:!1,streamer:U,repetition_penalty:1.2}),re=c.current.batch_decode(V.slice(null,[C.input_ids.dims.at(-1),null]),{skip_special_tokens:!0});return g.current=!1,re[0].trim()},[]);return $e.jsx(Nw.Provider,{value:{isLoaded:r,isLoading:a,error:u,loadModel:h,runInference:w},children:t})};function jw(){const t=xt.useContext(Nw);if(!t)throw new Error("useVLMContext must be inside VLMProvider");return t}const Ir={BASE_FREQUENCY:.008,NUM_OCTAVES:2,SCALE:77,COLORS:{DEFAULT_BG:"rgba(0, 0, 0, 0.25)",SUCCESS_BG:"rgba(0, 50, 0, 0.25)",ERROR_BG:"rgba(50, 0, 0, 0.25)",BUTTON_BG:"rgba(59, 130, 246, 0.25)"}},om={MARGINS:{DEFAULT:20,BOTTOM:20}},fT={FRAME_CAPTURE_DELAY:50},W_="Describe what you see in one sentence.",kd={default:W_,placeholder:W_,suggestions:[W_,"What is the color of my shirt?","Identify any text or written content visible.","What emotions or actions are being portrayed?","Name the object I am holding in my hand."],fallbackCaption:"Waiting for first caption...",processingMessage:"Starting analysis..."};function pT(){return $e.jsx("svg",{style:{display:"none"},"aria-hidden":"true",children:$e.jsxs("filter",{id:"glass-distortion",children:[$e.jsx("feTurbulence",{type:"turbulence",baseFrequency:Ir.BASE_FREQUENCY,numOctaves:Ir.NUM_OCTAVES,result:"noise"}),$e.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:Ir.SCALE})]})})}function si({children:t,className:r="",bgColor:n="rgba(0, 0, 0, 0.25)",highlight:a="rgba(255, 255, 255, 0.15)",onClick:o,onMouseDown:u,role:d,style:c,...f}){const p=xt.useRef(null),g=xt.useCallback(h=>{if(!p.current)return;const w=h.currentTarget.getBoundingClientRect(),M=h.clientX-w.left,x=h.clientY-w.top;p.current.style.background=`radial-gradient(
      circle at ${M}px ${x}px,
      rgba(255,255,255,0.15) 0%,
      rgba(255,255,255,0.05) 30%,
      rgba(255,255,255,0) 60%
    )`},[]),_=xt.useCallback(()=>{p.current&&(p.current.style.background="none")},[]);return $e.jsxs("div",{className:`glass-container relative overflow-hidden ${r}`,onMouseMove:g,onMouseLeave:_,onClick:o,onMouseDown:u,role:d,style:{"--bg-color":n,"--highlight":a,"--text":"#ffffff",...c},...f,children:[$e.jsx(pT,{}),$e.jsx("div",{className:"glass-filter absolute inset-0 backdrop-blur-md z-10",style:{filter:"url(#glass-distortion) saturate(120%) brightness(1.15)",borderRadius:"inherit"}}),$e.jsx("div",{className:"glass-overlay absolute inset-0 z-20",style:{background:"var(--bg-color)",borderRadius:"inherit"}}),$e.jsx("div",{ref:p,className:"glass-specular absolute inset-0 z-30",style:{boxShadow:"inset 1px 1px 1px var(--highlight)",borderRadius:"inherit"}}),$e.jsx("div",{className:"glass-content relative z-40",children:t})]})}function hT({onComplete:t}){const[r,n]=xt.useState(0),[a,o]=xt.useState("Initializing..."),[u,d]=xt.useState(!1),[c,f]=xt.useState(!1),{loadModel:p,isLoaded:g,isLoading:_}=jw();return xt.useEffect(()=>{if(c||_||g)return;(async()=>{f(!0);try{if(o("Checking WebGPU support..."),n(5),!navigator.gpu){o("WebGPU not available in this browser"),d(!0);return}await p(w=>{o(w),w.includes("Loading processor")?n(10):w.includes("Processor loaded")?n(20):w.includes("Model loaded")&&n(80)}),o("Ready to start!"),n(100),await new Promise(w=>setTimeout(w,300)),t()}catch(w){console.error("Error loading model:",w),o(`Error loading model: ${w instanceof Error?w.message:String(w)}`),d(!0)}})()},[c,_,g,p,t]),xt.useEffect(()=>{g&&!c&&(n(100),o("Model already loaded!"),setTimeout(t,300))},[g,c,t]),$e.jsx("div",{className:"absolute inset-0 text-white flex items-center justify-center p-8",style:{opacity:1},children:$e.jsx(si,{className:"max-w-md w-full rounded-3xl shadow-2xl",bgColor:u?Ir.COLORS.ERROR_BG:Ir.COLORS.DEFAULT_BG,children:$e.jsxs("div",{className:"p-8 text-center space-y-8",children:[$e.jsxs("div",{className:"space-y-4",children:[$e.jsx("div",{className:"w-16 h-16 mx-auto",children:u?$e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center",children:$e.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:$e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}):$e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent"})}),$e.jsx("h2",{className:"text-2xl font-bold text-gray-100",children:u?"Loading Failed":"Loading AI Model"}),$e.jsx("p",{className:`${u?"text-red-400":"text-gray-400"}`,children:a})]}),!u&&$e.jsxs("div",{className:"space-y-2",children:[$e.jsx("div",{className:"w-full bg-gray-800/50 rounded-full h-3 overflow-hidden backdrop-blur-sm border border-gray-700/30",children:$e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full transition-all duration-300 ease-out",style:{width:`${r}%`}})}),$e.jsxs("p",{className:"text-sm text-gray-500",children:[Math.round(r),"% complete"]})]}),u&&$e.jsx("div",{className:"mt-4",children:$e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition-colors",children:"Reload Page"})})]})})})}function j1({children:t,onClick:r,className:n="",disabled:a=!1,bgColor:o=Ir.COLORS.BUTTON_BG,...u}){return $e.jsx(si,{bgColor:o,className:"rounded-xl",children:$e.jsx("button",{className:`px-4 py-2 border-none cursor-pointer bg-transparent transition-transform duration-200 outline-none ${a?"opacity-50 cursor-not-allowed":"hover:scale-105 active:scale-95"} ${n}`,onClick:a?void 0:r,disabled:a,...u,children:$e.jsx("div",{className:"font-medium text-white",children:t})})})}function mT({isRunning:t,onToggleRunning:r,error:n}){const a=!!n,[o,u,d]=a?["Error","bg-red-500",Ir.COLORS.ERROR_BG]:t?["Live","bg-green-500 animate-pulse",Ir.COLORS.DEFAULT_BG]:["Paused","bg-red-500",Ir.COLORS.DEFAULT_BG];return $e.jsxs($e.Fragment,{children:[$e.jsx("div",{className:"absolute top-4 right-4 flex space-x-2 z-20",children:$e.jsx(j1,{onClick:r,"aria-label":t?"Pause captioning":"Resume captioning",children:t?"Pause":"Resume"})}),$e.jsx("div",{className:"absolute top-4 left-4 z-20",children:$e.jsx(si,{bgColor:d,className:"px-3 py-2 rounded-lg",role:"status","aria-label":`Caption status: ${o}`,children:$e.jsxs("div",{className:"flex items-center space-x-2",children:[$e.jsx("div",{className:`w-2 h-2 rounded-full ${u}`}),$e.jsx("span",{className:"text-white text-sm font-medium",children:o})]})})})]})}const _T=(t,r,n)=>({x:Math.max(0,Math.min(t.x,r)),y:Math.max(0,Math.min(t.y,n))}),Yy=(t,r)=>{const{width:n,height:a}=r;switch(t){case"bottom-left":return{x:om.MARGINS.DEFAULT,y:window.innerHeight-a-om.MARGINS.BOTTOM};case"bottom-right":return{x:window.innerWidth-n-om.MARGINS.DEFAULT,y:window.innerHeight-a-om.MARGINS.BOTTOM}}};function Zy({children:t,initialPosition:r,className:n="",onDimensionsReady:a}){const[o,u]=xt.useState({x:0,y:0}),[d,c]=xt.useState(!1),[f,p]=xt.useState(!1),[g,_]=xt.useState({x:0,y:0}),[h,w]=xt.useState({x:0,y:0}),[M,x]=xt.useState({width:0,height:0}),[F,E]=xt.useState(!1),T=xt.useRef(null),L=xt.useCallback(()=>{if(!T.current||M.width===0)return{x:0,y:0};if(typeof r=="object")return r;const C=Yy(r,M);return f?{x:C.x+h.x,y:C.y+h.y}:C},[M,r,f,h]),O=xt.useCallback(C=>{x(C),a&&!f&&a(C)},[a,f]),S=xt.useCallback(C=>{if(!T.current)return C;const k=window.innerWidth-T.current.offsetWidth,U=window.innerHeight-T.current.offsetHeight;return _T(C,k,U)},[]);xt.useEffect(()=>{if(!F&&M.width>0&&!f){const C=L();u(S(C)),E(!0)}},[F,M.width,f,L,S]),xt.useEffect(()=>{if(!T.current)return;const C=new ResizeObserver(()=>{if(!T.current)return;const k=T.current.getBoundingClientRect(),U={width:k.width,height:k.height};O(U),u(V=>S(V))});return C.observe(T.current),()=>C.disconnect()},[O,S]),xt.useEffect(()=>{const C=()=>{const k=L();u(S(k))};return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[L,S]),xt.useEffect(()=>{if(!d)return;const C=U=>{const V={x:U.clientX-g.x,y:U.clientY-g.y};u(S(V))},k=()=>{if(c(!1),p(!0),T.current&&typeof r!="object"){const U=Yy(r,M);w({x:o.x-U.x,y:o.y-U.y})}};return document.addEventListener("mousemove",C),document.addEventListener("mouseup",k),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",k)}},[d,g,o,r,M,S]);const $=C=>{if(!T.current)return;const k=T.current.getBoundingClientRect();_({x:C.clientX-k.left,y:C.clientY-k.top}),c(!0)};return $e.jsx("div",{ref:T,className:`fixed z-50 ${n} ${d?"cursor-grabbing":"cursor-grab"}`,style:{left:o.x,top:o.y,transform:d?"scale(1.02)":"scale(1)",transition:d?"none":"transform 0.2s ease",opacity:F?1:0},onMouseDown:$,children:t})}function gT({onPromptChange:t,defaultPrompt:r=kd.default}){const[n,a]=xt.useState(r),[o,u]=xt.useState(!1),d=xt.useRef(null),c=xt.useRef(null),f=()=>{if(d.current){d.current.style.height="auto";const x=Math.min(d.current.scrollHeight,200);d.current.style.height=`${x}px`}};xt.useEffect(()=>{t(n),f()},[n,t]);const p=()=>{u(!0)},g=()=>{u(!0)},_=x=>{(!x.relatedTarget||!c.current?.contains(x.relatedTarget))&&u(!1)},h=x=>{a(x),u(!1),d.current?.focus()},w=()=>{a(""),d.current?.focus()},M=x=>{a(x.target.value)};return $e.jsxs("div",{ref:c,className:"w-[420px] relative",style:{"--input-bg":"rgba(0, 0, 0, 0.2)","--input-border":"rgba(255, 255, 255, 0.1)"},children:[$e.jsx("div",{className:`absolute bottom-full left-0 right-0 mb-2 ${o?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:$e.jsx(si,{className:"rounded-2xl shadow-2xl",children:$e.jsx("div",{className:`p-5 text-white transition-opacity duration-100 ${o?"opacity-100":"opacity-0"}`,children:$e.jsxs("div",{className:"suggestion-group",children:[$e.jsx("h4",{className:"text-sm mb-3 opacity-70 font-medium",children:"Suggested Prompts"}),$e.jsx("ul",{className:"space-y-1",children:kd.suggestions.map((x,F)=>$e.jsxs("li",{tabIndex:0,onMouseDown:E=>{E.preventDefault()},onClick:()=>h(x),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),h(x))},className:"py-2 px-3 rounded-lg cursor-pointer flex items-center gap-3 transition-all duration-200 hover:bg-white/20 hover:translate-x-1 hover:shadow-sm focus:bg-white/20 focus:translate-x-1 focus:outline-none",children:[$e.jsx("span",{className:"opacity-70 text-sm transition-all duration-200 hover:opacity-100",children:"→"}),$e.jsx("span",{className:"text-sm transition-all duration-200 hover:text-white/90",children:x})]},F))})]})})})}),$e.jsx(si,{className:"rounded-2xl shadow-2xl",children:$e.jsx("div",{className:"text-white",children:$e.jsx("div",{className:"search-container relative p-5 flex items-center transition-all duration-400",children:$e.jsxs("div",{className:"relative w-full",children:[$e.jsx("textarea",{ref:d,value:n,onChange:M,onFocus:p,onBlur:_,onClick:g,className:"search-input w-full py-3 pl-4 pr-8 rounded-xl text-white text-base transition-all duration-400 border resize-none focus:outline-none focus:-translate-y-0.5 focus:shadow-lg",style:{background:"var(--input-bg)",borderColor:"var(--input-border)",color:"#ffffff",minHeight:"48px",maxHeight:"200px",height:"auto",overflowY:"hidden"},placeholder:kd.placeholder,rows:1}),n&&$e.jsx("button",{type:"button",onClick:w,className:"search-clear absolute right-3 top-2 text-white opacity-70 hover:opacity-100 hover:bg-white/10 rounded-full p-1 transition-all duration-300",children:"×"})]})})})})]})}function yT({caption:t,isRunning:r,error:n}){const a=n||t,{color:o,label:u}=n?{color:"bg-red-500",label:"ERROR"}:r?{color:"bg-green-500 animate-pulse",label:"RUNNING"}:{color:"bg-yellow-500 animate-pulse",label:"STOPPED"};return $e.jsx(si,{bgColor:n?Ir.COLORS.ERROR_BG:Ir.COLORS.DEFAULT_BG,className:`w-150 h-45 rounded-2xl shadow-2xl hover:scale-105 transition-transform duration-200 ${n?"border border-red-500/30":""}`,children:$e.jsxs("div",{className:"p-5 text-white flex flex-col flex-start h-full",children:[$e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[$e.jsx("h3",{className:"text-base font-semibold opacity-90",children:"Live Caption"}),$e.jsxs("div",{className:"flex items-center space-x-2",children:[$e.jsx("div",{className:`w-2 h-2 rounded-full ${o}`}),$e.jsx("span",{className:"text-sm opacity-70",children:u})]})]}),$e.jsx("div",{className:"min-h-[4rem] flex flex-col",children:a?$e.jsx("div",{className:`text-sm opacity-85 leading-relaxed flex-1 ${n?"text-red-300":""}`,children:$e.jsx("span",{children:a||kd.fallbackCaption})}):$e.jsxs("div",{className:"flex items-center justify-center w-full space-x-2",children:[$e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-blue-400 border-t-transparent"}),$e.jsx("p",{className:"text-sm opacity-80 italic",children:kd.processingMessage})]})})]})})}function bT(t,r,n,a,o){const{isLoaded:u,runInference:d}=jw(),c=xt.useRef(null),f=xt.useRef(a),p=xt.useRef(o);xt.useEffect(()=>{f.current=a},[a]),xt.useEffect(()=>{p.current=o},[o]),xt.useEffect(()=>{if(c.current?.abort(),!r||!u)return;c.current=new AbortController;const g=c.current.signal,_=t.current;return setTimeout(async()=>{for(;!g.aborted;){if(_&&_.readyState>=2&&!_.paused&&_.videoWidth>0)try{const w=n.current||"",M=await d(_,w,f.current);M&&!g.aborted&&f.current(M)}catch(w){if(!g.aborted){const M=w instanceof Error?w.message:String(w);p.current(M),console.error("Error processing frame:",w)}}if(g.aborted)break;await new Promise(w=>setTimeout(w,fT.FRAME_CAPTURE_DELAY))}},0),()=>{c.current?.abort()}},[r,u,d,n,t])}function MT({videoRef:t}){const[r,n]=xt.useState(""),[a,o]=xt.useState(!0),[u,d]=xt.useState(kd.default),[c,f]=xt.useState(null),p=xt.useRef(u);xt.useEffect(()=>{p.current=u},[u]);const g=xt.useCallback(M=>{n(M),f(null)},[]),_=xt.useCallback(M=>{f(M),n(`Error: ${M}`)},[]);bT(t,a,p,g,_);const h=xt.useCallback(M=>{d(M),f(null)},[]),w=xt.useCallback(()=>{o(M=>!M),c&&f(null)},[c]);return $e.jsx("div",{className:"absolute inset-0 text-white",children:$e.jsxs("div",{className:"relative w-full h-full",children:[$e.jsx(mT,{isRunning:a,onToggleRunning:w,error:c}),$e.jsx(Zy,{initialPosition:"bottom-left",children:$e.jsx(gT,{onPromptChange:h})}),$e.jsx(Zy,{initialPosition:"bottom-right",children:$e.jsx(yT,{caption:r,isRunning:a,error:c})})]})})}const vT=({className:t})=>$e.jsxs("svg",{className:t,viewBox:"0 8 256 256",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[$e.jsx("path",{d:"M230.721 172.7C230.183 170.673 229.313 168.75 228.146 167.008C228.396 166.091 228.587 165.159 228.714 164.217C229.543 158.241 227.471 152.77 223.567 148.537C221.452 146.225 219.185 144.698 216.784 143.761C218.36 137.018 219.157 130.117 219.161 123.193C219.161 120.03 218.982 116.932 218.682 113.88C218.526 112.356 218.337 110.836 218.115 109.32C217.428 104.847 216.408 100.431 215.064 96.11C214.183 93.2707 213.164 90.476 212.01 87.736C210.281 83.6782 208.262 79.75 205.969 75.982C204.465 73.475 202.827 71.0508 201.062 68.72C200.197 67.543 199.296 66.3938 198.358 65.274C195.58 61.898 192.561 58.7277 189.325 55.788C188.25 54.7997 187.145 53.8453 186.01 52.926C184.893 51.9943 183.751 51.0927 182.586 50.222C180.241 48.4766 177.818 46.8392 175.324 45.315C161.543 36.945 145.382 32.145 128.109 32.145C77.817 32.145 37.057 72.907 37.057 123.196C37.055 130.208 37.867 137.196 39.477 144.02C37.317 144.958 35.247 146.42 33.327 148.535C29.424 152.766 27.351 158.217 28.18 164.193C28.306 165.142 28.495 166.082 28.747 167.006C27.5811 168.749 26.7117 170.673 26.174 172.7C24.974 177.261 25.369 181.374 26.894 184.978C25.236 189.688 25.65 194.704 27.809 199.065C29.379 202.25 31.626 204.714 34.396 206.916C37.689 209.534 41.811 211.758 46.783 213.892C52.715 216.422 59.956 218.799 63.249 219.671C71.755 221.873 79.911 223.269 88.177 223.337C99.954 223.446 110.096 220.677 117.357 213.59C120.924 214.027 124.515 214.246 128.109 214.244C131.906 214.236 135.699 213.997 139.467 213.529C146.711 220.661 156.892 223.455 168.712 223.343C176.977 223.277 185.133 221.881 193.617 219.676C196.932 218.804 204.17 216.427 210.105 213.897C215.077 211.76 219.199 209.536 222.514 206.922C225.263 204.719 227.508 202.256 229.079 199.071C231.26 194.709 231.652 189.693 230.017 184.983C231.527 181.379 231.92 177.257 230.721 172.7ZM222.281 184.673C223.952 187.844 224.059 191.427 222.585 194.764C220.349 199.821 214.795 203.805 204.008 208.082C197.3 210.742 191.158 212.443 191.104 212.458C182.232 214.759 174.208 215.928 167.262 215.928C155.76 215.928 147.201 212.754 141.773 206.486C132.594 208.05 123.222 208.103 114.026 206.644C108.591 212.808 100.081 215.928 88.676 215.928C81.729 215.928 73.706 214.759 64.833 212.458C64.779 212.443 58.639 210.742 51.929 208.082C41.143 203.805 35.587 199.824 33.352 194.764C31.878 191.427 31.985 187.844 33.656 184.673C33.81 184.378 33.976 184.091 34.153 183.813C33.1516 182.309 32.4799 180.61 32.182 178.827C31.8842 177.045 31.967 175.22 32.425 173.472C33.089 170.949 34.46 168.851 36.322 167.344C35.425 165.87 34.8365 164.23 34.592 162.522C34.056 158.808 35.289 155.1 38.062 152.076C40.222 149.723 43.275 148.428 46.655 148.428H46.745C44.1965 140.259 42.9044 131.75 42.913 123.193C42.913 76.522 80.749 38.683 127.427 38.683C174.104 38.683 211.94 76.518 211.94 123.193C211.947 131.773 210.646 140.304 208.081 148.492C208.489 148.452 208.889 148.432 209.282 148.431C212.662 148.431 215.716 149.726 217.874 152.079C220.647 155.1 221.881 158.811 221.344 162.525C221.1 164.233 220.511 165.873 219.615 167.347C221.477 168.854 222.849 170.952 223.512 173.475C223.97 175.223 224.053 177.048 223.755 178.831C223.458 180.613 222.786 182.312 221.784 183.816C221.961 184.091 222.129 184.378 222.281 184.673Z",fill:"white"}),$e.jsx("path",{d:"M221.784 183.816C222.786 182.312 223.458 180.613 223.756 178.831C224.053 177.048 223.97 175.223 223.512 173.475C222.848 170.952 221.476 168.854 219.615 167.347C220.512 165.873 221.1 164.233 221.344 162.525C221.881 158.811 220.648 155.103 217.874 152.079C215.716 149.726 212.662 148.431 209.282 148.431C208.889 148.431 208.489 148.452 208.081 148.492C210.643 140.304 211.942 131.774 211.933 123.195C211.933 76.5231 174.097 38.6851 127.424 38.6851C80.75 38.6851 42.9099 76.5191 42.9099 123.195C42.9015 131.752 44.1936 140.261 46.742 148.43H46.6519C43.2719 148.43 40.219 149.724 38.06 152.077C35.287 155.098 34.0529 158.81 34.5899 162.523C34.8346 164.231 35.4231 165.872 36.3199 167.346C34.4579 168.852 33.086 170.95 32.422 173.473C31.9642 175.222 31.8817 177.047 32.1799 178.83C32.4781 180.612 33.1501 182.312 34.1519 183.816C33.9739 184.094 33.8099 184.381 33.6549 184.676C31.9849 187.847 31.877 191.43 33.352 194.767C35.588 199.824 41.1419 203.808 51.9289 208.085C58.6359 210.745 64.779 212.446 64.833 212.461C73.705 214.762 81.729 215.931 88.675 215.931C100.081 215.931 108.591 212.811 114.026 206.647C123.222 208.106 132.594 208.052 141.773 206.489C147.201 212.757 155.76 215.931 167.262 215.931C174.208 215.931 182.232 214.762 191.103 212.461C191.158 212.446 197.298 210.745 204.008 208.085C214.795 203.808 220.35 199.824 222.585 194.767C224.059 191.43 223.952 187.847 222.281 184.676C222.129 184.379 221.961 184.091 221.784 183.816ZM110.137 196.997C109.669 197.815 109.168 198.614 108.635 199.391C107.23 201.448 105.382 203.02 103.237 204.188C99.1369 206.424 93.947 207.205 88.675 207.205C80.346 207.205 71.808 205.256 67.023 204.015C66.787 203.954 37.689 195.735 41.373 188.739C41.993 187.562 43.0129 187.092 44.2979 187.092C49.4849 187.092 58.9299 194.816 62.9889 194.816C63.8959 194.816 64.5359 194.43 64.7969 193.488C66.5269 187.284 38.5039 184.676 40.8639 175.692C41.2799 174.102 42.41 173.456 43.998 173.456C50.856 173.455 66.248 185.516 69.467 185.516C69.714 185.516 69.8909 185.443 69.9869 185.291C70.0009 185.268 70.015 185.246 70.028 185.222C71.539 182.727 70.6719 180.913 60.3209 174.573L59.3269 173.968C47.9359 167.074 39.9409 162.925 44.4879 157.975C45.0109 157.404 45.7529 157.151 46.6539 157.151C47.7219 157.151 49.0149 157.508 50.4389 158.108C56.4549 160.645 64.793 167.564 68.276 170.581C68.8239 171.057 69.3683 171.538 69.9089 172.022C69.9089 172.022 74.319 176.608 76.985 176.608C77.599 176.608 78.1199 176.366 78.4729 175.768C80.364 172.58 60.9099 157.838 59.8129 151.755C59.0689 147.634 60.3349 145.546 62.6749 145.546C63.7879 145.546 65.1459 146.02 66.6449 146.971C71.2949 149.922 80.2729 165.35 83.5599 171.352C84.6619 173.363 86.5429 174.213 88.2379 174.213C91.6009 174.213 94.2299 170.87 88.5459 166.622C80.0029 160.23 83.001 149.782 87.078 149.139C87.252 149.111 87.4279 149.097 87.6029 149.097C91.3109 149.097 92.9459 155.486 92.9459 155.486C92.9459 155.486 97.7399 167.524 105.975 175.753C113.447 183.222 114.491 189.351 110.137 196.997ZM136.766 198.407L136.339 198.458L135.611 198.541C135.228 198.581 134.844 198.619 134.459 198.654L134.084 198.688L133.741 198.717L133.255 198.756L132.718 198.795L132.182 198.83L132.063 198.838C131.923 198.846 131.783 198.855 131.641 198.862L131.462 198.872C131.296 198.881 131.13 198.889 130.962 198.896L130.381 198.921L129.854 198.939L129.502 198.949H129.323C129.213 198.949 129.104 198.955 128.994 198.956H128.82C128.71 198.956 128.601 198.956 128.491 198.961L128.043 198.967H127.418C126.927 198.967 126.437 198.962 125.949 198.952L125.553 198.943C125.44 198.943 125.327 198.938 125.216 198.934L124.796 198.922L124.275 198.902L123.805 198.881L123.684 198.876L123.237 198.853C123.112 198.846 122.989 198.84 122.865 198.831L122.576 198.814C122.213 198.791 121.85 198.766 121.487 198.738L121.107 198.707C120.947 198.695 120.787 198.68 120.628 198.666C120.441 198.65 120.254 198.632 120.067 198.614C119.754 198.585 119.441 198.553 119.128 198.519H119.113C123.683 188.324 121.372 178.802 112.137 169.575C106.08 163.526 102.051 154.594 101.215 152.633C99.5229 146.828 95.045 140.375 87.608 140.375C86.979 140.375 86.351 140.425 85.73 140.523C82.472 141.036 79.624 142.911 77.592 145.733C75.396 143.002 73.262 140.831 71.332 139.605C68.422 137.76 65.5179 136.824 62.6889 136.824C59.1579 136.824 56.0019 138.274 53.8019 140.904L53.7459 140.971C53.7039 140.798 53.6639 140.625 53.6229 140.451L53.6179 140.428C53.1992 138.638 52.8477 136.833 52.5639 135.016C52.5639 135.004 52.5639 134.992 52.5579 134.98C52.5359 134.843 52.5159 134.705 52.4949 134.568C52.4334 134.162 52.3757 133.755 52.3219 133.348C52.2979 133.163 52.2719 132.978 52.2489 132.793L52.1809 132.238C52.1589 132.053 52.1409 131.885 52.1209 131.709L52.115 131.665C52.0351 130.945 51.9651 130.225 51.9049 129.503L51.8829 129.226L51.8479 128.754C51.8379 128.625 51.8279 128.495 51.8209 128.365C51.8209 128.334 51.8159 128.304 51.8149 128.275C51.7895 127.913 51.7678 127.55 51.7499 127.187C51.7399 126.998 51.7299 126.81 51.7219 126.62L51.7019 126.124L51.6969 125.974L51.6809 125.517L51.6709 125.128C51.6709 124.973 51.6629 124.818 51.6609 124.663C51.6579 124.508 51.6539 124.338 51.6529 124.174C51.6509 124.01 51.6529 123.848 51.6479 123.685C51.6439 123.521 51.6479 123.358 51.6479 123.195C51.6479 81.3421 85.5789 47.4111 127.436 47.4111C169.292 47.4111 203.222 81.3411 203.222 123.195V124.174C203.222 124.337 203.217 124.501 203.214 124.663C203.214 124.798 203.208 124.931 203.204 125.068C203.204 125.188 203.199 125.309 203.195 125.425C203.195 125.578 203.186 125.731 203.181 125.884V125.896L203.16 126.427C203.153 126.582 203.147 126.738 203.139 126.893L203.134 127.003L203.107 127.499C203.048 128.562 202.967 129.623 202.866 130.683V130.696C202.849 130.87 202.832 131.044 202.813 131.218L202.768 131.629L202.679 132.433L202.628 132.84L202.565 133.319C202.542 133.493 202.519 133.668 202.493 133.841C202.467 134.036 202.438 134.23 202.409 134.424L202.34 134.883L202.258 135.403C202.23 135.576 202.2 135.748 202.168 135.92C202.135 136.093 202.109 136.265 202.079 136.437C202.019 136.781 201.956 137.125 201.89 137.468C201.789 137.981 201.686 138.493 201.58 139.005L201.47 139.512C201.434 139.681 201.395 139.851 201.357 140.02C199.224 137.947 196.399 136.818 193.284 136.818C190.457 136.818 187.55 137.753 184.641 139.598C182.711 140.824 180.578 142.996 178.381 145.726C176.346 142.904 173.498 141.029 170.242 140.516C169.621 140.418 168.993 140.368 168.364 140.368C160.925 140.368 156.45 146.821 154.757 152.626C153.917 154.587 149.887 163.519 143.825 169.577C134.596 178.775 132.268 188.254 136.766 198.407ZM215.007 177.998L214.977 178.087C214.901 178.288 214.813 178.484 214.714 178.674C214.639 178.814 214.558 178.95 214.47 179.082C214.303 179.331 214.12 179.569 213.921 179.793C213.875 179.845 213.831 179.897 213.779 179.948C213.707 180.025 213.634 180.101 213.559 180.175C212.213 181.509 210.161 182.679 207.841 183.752C207.578 183.871 207.311 183.99 207.042 184.11L206.774 184.229C206.595 184.308 206.416 184.386 206.228 184.463C206.049 184.541 205.863 184.619 205.677 184.695L205.119 184.925C203.814 185.462 202.477 185.974 201.173 186.479L200.615 186.696L200.064 186.912C199.697 187.055 199.335 187.198 198.979 187.341L198.448 187.555L197.926 187.768L197.67 187.876C197.499 187.947 197.332 188.018 197.165 188.089C193.328 189.736 190.567 191.411 191.147 193.489C191.163 193.548 191.181 193.604 191.201 193.659C191.253 193.813 191.324 193.958 191.413 194.095C191.465 194.176 191.525 194.253 191.592 194.323C192.274 195.032 193.515 194.92 195.08 194.357C195.3 194.276 195.519 194.192 195.736 194.104L195.872 194.048C196.23 193.896 196.609 193.726 196.996 193.542C197.093 193.496 197.191 193.452 197.289 193.401C199.203 192.465 201.372 191.205 203.524 190.058C204.385 189.593 205.258 189.152 206.142 188.733C208.18 187.774 210.096 187.094 211.636 187.094C212.359 187.094 212.997 187.242 213.529 187.582L213.618 187.641C213.952 187.876 214.232 188.178 214.441 188.528C214.482 188.595 214.522 188.666 214.561 188.739C215.322 190.184 214.685 191.68 213.194 193.147C211.763 194.556 209.537 195.937 207.007 197.215C206.819 197.31 206.631 197.405 206.44 197.498C198.91 201.196 189.049 203.981 188.912 204.016C186.284 204.697 182.526 205.591 178.292 206.26L177.666 206.358L177.563 206.373C177.089 206.445 176.614 206.512 176.138 206.574C175.655 206.639 175.167 206.698 174.676 206.753L174.586 206.763C172.806 206.968 171.019 207.104 169.228 207.169H169.202C168.554 207.192 167.907 207.204 167.259 207.204H166.512C165.524 207.191 164.538 207.146 163.553 207.07C163.53 207.07 163.505 207.07 163.482 207.064C163.129 207.037 162.777 207.004 162.425 206.965C162.06 206.926 161.696 206.882 161.333 206.833C161.094 206.801 160.856 206.765 160.618 206.726C160.376 206.687 160.134 206.647 159.893 206.605L159.564 206.543L159.539 206.538C159.192 206.472 158.847 206.399 158.503 206.319C158.303 206.274 158.104 206.23 157.907 206.176L157.788 206.146C157.69 206.122 157.595 206.096 157.498 206.07L157.445 206.056L157.137 205.966C157.025 205.935 156.913 205.901 156.801 205.868L156.762 205.857L156.471 205.768C156.361 205.734 156.251 205.698 156.142 205.662L155.874 205.573L155.677 205.504C155.487 205.437 155.298 205.368 155.111 205.296L154.933 205.226L154.786 205.168C154.502 205.054 154.22 204.935 153.941 204.81L153.756 204.72L153.725 204.706C153.659 204.675 153.594 204.644 153.528 204.617C153.399 204.555 153.271 204.491 153.144 204.426L153.105 204.407L152.921 204.31C152.594 204.139 152.274 203.957 151.96 203.764L151.788 203.658C151.702 203.605 151.616 203.55 151.532 203.494L151.308 203.346L151.067 203.18L150.923 203.077C150.771 202.969 150.622 202.857 150.476 202.742L150.243 202.563C150.15 202.488 150.058 202.412 149.967 202.335C149.89 202.272 149.815 202.206 149.74 202.14L149.734 202.135C149.653 202.064 149.574 201.993 149.495 201.92C149.417 201.849 149.339 201.777 149.263 201.704L149.254 201.695C149.174 201.619 149.096 201.542 149.019 201.463C148.942 201.385 148.863 201.307 148.788 201.227C148.713 201.148 148.636 201.067 148.562 200.984C148.488 200.902 148.42 200.827 148.35 200.746L148.327 200.719C148.259 200.641 148.192 200.562 148.126 200.481C147.983 200.31 147.844 200.135 147.71 199.956C147.575 199.776 147.443 199.592 147.314 199.405L147.191 199.221C147.027 198.981 146.867 198.739 146.712 198.493C146.596 198.316 146.483 198.138 146.373 197.957C146.302 197.844 146.234 197.73 146.166 197.618L146.138 197.572C146.073 197.462 146.009 197.354 145.947 197.245C145.911 197.186 145.877 197.127 145.845 197.066C145.812 197.004 145.774 196.941 145.739 196.878L145.682 196.779L145.647 196.715C145.58 196.595 145.514 196.474 145.45 196.352C145.42 196.298 145.391 196.244 145.36 196.192L145.271 196.019L145.181 195.848C144.956 195.398 144.743 194.942 144.543 194.48L144.472 194.311C144.426 194.198 144.383 194.086 144.337 193.975C144.315 193.921 144.293 193.868 144.274 193.814C144.167 193.537 144.067 193.257 143.975 192.975C143.942 192.874 143.91 192.775 143.88 192.675C143.808 192.448 143.743 192.219 143.685 191.988C143.614 191.719 143.551 191.448 143.498 191.175C143.487 191.12 143.476 191.065 143.467 191.012C143.415 190.745 143.373 190.476 143.34 190.206C143.332 190.153 143.326 190.1 143.32 190.047L143.303 189.885C143.281 189.673 143.264 189.46 143.254 189.247C143.254 189.193 143.249 189.139 143.247 189.087C143.242 188.981 143.24 188.875 143.239 188.769C143.183 184.496 145.345 180.388 149.968 175.767C158.203 167.54 162.997 155.501 162.997 155.501C162.997 155.501 163.126 154.996 163.394 154.269C163.431 154.168 163.47 154.064 163.514 153.955C163.67 153.548 163.846 153.148 164.041 152.758L164.08 152.683C164.246 152.351 164.428 152.027 164.624 151.712C164.67 151.639 164.714 151.567 164.765 151.494C164.912 151.277 165.067 151.065 165.23 150.86C165.319 150.749 165.416 150.639 165.513 150.532C165.552 150.49 165.59 150.448 165.631 150.408C166.108 149.915 166.653 149.513 167.27 149.299L167.348 149.273C167.4 149.256 167.452 149.24 167.505 149.225C167.566 149.209 167.627 149.195 167.69 149.182L167.719 149.176C167.849 149.15 167.981 149.133 168.114 149.124H168.125C168.194 149.124 168.264 149.117 168.335 149.117C168.424 149.117 168.507 149.117 168.594 149.126C168.684 149.134 168.773 149.144 168.863 149.158C169.605 149.276 170.311 149.718 170.919 150.4C171.15 150.66 171.358 150.94 171.54 151.236C171.66 151.428 171.773 151.631 171.88 151.845C171.923 151.934 171.964 152.016 172.004 152.104C172.108 152.33 172.202 152.56 172.284 152.795C172.479 153.345 172.626 153.911 172.723 154.487C172.807 154.992 172.857 155.502 172.873 156.013C172.881 156.286 172.881 156.563 172.873 156.842C172.819 158.14 172.553 159.421 172.086 160.634C172.044 160.745 171.997 160.857 171.952 160.969C171.86 161.195 171.759 161.417 171.65 161.634C171.569 161.799 171.484 161.965 171.392 162.13C171.332 162.24 171.269 162.35 171.206 162.46C171.045 162.734 170.871 163.006 170.684 163.277L170.571 163.439C170.129 164.055 169.637 164.633 169.099 165.167C168.569 165.698 168.001 166.189 167.4 166.637C166.798 167.083 166.233 167.577 165.711 168.114C164.208 169.691 163.858 171.083 164.196 172.138C164.25 172.304 164.321 172.465 164.407 172.617C164.508 172.791 164.628 172.951 164.764 173.097L164.817 173.152L164.871 173.206C164.925 173.258 164.982 173.309 165.043 173.359L165.103 173.407C165.248 173.519 165.402 173.619 165.563 173.707C165.61 173.732 165.652 173.757 165.705 173.781C165.879 173.866 166.058 173.939 166.242 173.998C166.293 174.015 166.344 174.03 166.396 174.046L166.461 174.063L166.551 174.087L166.628 174.106L166.712 174.124L166.795 174.141L166.874 174.154C166.932 174.164 166.992 174.174 167.052 174.181L167.109 174.19L167.213 174.2L167.277 174.207L167.382 174.214H167.444L167.554 174.22H167.9L167.999 174.214L168.113 174.207L168.252 174.194L168.382 174.179C168.412 174.179 168.442 174.171 168.472 174.165C168.872 174.107 169.264 174.001 169.639 173.849L169.798 173.782C169.887 173.743 169.977 173.702 170.059 173.658C170.235 173.57 170.406 173.47 170.57 173.361C170.799 173.211 171.015 173.043 171.217 172.858C171.265 172.815 171.312 172.769 171.358 172.725C171.381 172.703 171.403 172.682 171.425 172.658C171.469 172.613 171.514 172.569 171.558 172.52C171.878 172.168 172.155 171.78 172.383 171.363C174.34 167.804 176.391 164.298 178.534 160.849L178.828 160.378L179.125 159.907C179.273 159.668 179.423 159.433 179.572 159.199L179.722 158.965C180.22 158.185 180.726 157.41 181.241 156.641L181.546 156.185C182.158 155.278 182.768 154.396 183.373 153.558L183.674 153.143C184.332 152.236 185.017 151.348 185.728 150.482L186.01 150.144C186.057 150.088 186.1 150.032 186.151 149.978C186.244 149.868 186.337 149.761 186.428 149.657C186.474 149.604 186.517 149.552 186.566 149.5L186.834 149.198L186.968 149.051C187.103 148.906 187.235 148.767 187.365 148.634C187.455 148.544 187.538 148.455 187.624 148.371C188.131 147.853 188.69 147.388 189.293 146.985L189.433 146.895C189.567 146.805 189.706 146.721 189.848 146.645C192.212 145.303 194.169 145.204 195.296 146.331C195.978 147.013 196.356 148.144 196.335 149.718C196.335 149.787 196.335 149.857 196.33 149.929V150.006C196.33 150.078 196.324 150.15 196.318 150.223C196.318 150.313 196.308 150.402 196.299 150.492C196.29 150.581 196.285 150.649 196.276 150.729C196.276 150.751 196.272 150.774 196.268 150.798C196.262 150.867 196.253 150.938 196.243 151.009C196.243 151.03 196.243 151.052 196.235 151.074C196.224 151.169 196.21 151.263 196.194 151.357C196.183 151.447 196.168 151.531 196.152 151.619L196.126 151.768C196.1 151.91 196.067 152.05 196.026 152.188C195.948 152.447 195.854 152.7 195.743 152.946C195.588 153.284 195.417 153.613 195.229 153.933C195.125 154.111 195.018 154.286 194.907 154.459C194.793 154.638 194.673 154.819 194.549 155.002C194.233 155.454 193.905 155.897 193.564 156.33L193.408 156.527C192.852 157.22 192.278 157.899 191.686 158.562L191.499 158.772C191.247 159.053 190.991 159.336 190.729 159.62L190.532 159.834C190.401 159.977 190.264 160.12 190.132 160.264C190.001 160.407 189.864 160.552 189.726 160.697L189.315 161.13L188.898 161.566L188.478 162.002C188.196 162.294 187.913 162.586 187.628 162.878C183.573 167.037 179.301 171.182 177.855 173.766C177.758 173.934 177.671 174.108 177.593 174.285C177.387 174.755 177.301 175.157 177.36 175.482C177.379 175.589 177.416 175.691 177.471 175.785C177.552 175.926 177.651 176.056 177.766 176.172C177.819 176.224 177.875 176.272 177.934 176.316C178.232 176.528 178.591 176.637 178.957 176.627H179.071L179.188 176.618L179.305 176.605L179.402 176.591C179.415 176.589 179.429 176.587 179.442 176.583L179.531 176.566L179.554 176.561L179.653 176.54L179.688 176.531C179.723 176.522 179.757 176.513 179.792 176.503C179.827 176.493 179.875 176.48 179.917 176.466C180.093 176.413 180.265 176.35 180.434 176.278C180.523 176.242 180.61 176.203 180.696 176.161C180.741 176.141 180.786 176.12 180.828 176.098L180.962 176.032C181.282 175.866 181.594 175.685 181.898 175.491L182.031 175.401C182.076 175.373 182.121 175.344 182.164 175.312L182.297 175.223L182.368 175.174L182.56 175.039C182.739 174.916 182.906 174.789 183.075 174.66L183.09 174.648L183.359 174.44C183.726 174.15 184.074 173.858 184.39 173.583L184.6 173.399L184.619 173.381L184.729 173.284C184.987 173.052 185.217 172.836 185.408 172.658L185.487 172.581C185.556 172.516 185.619 172.455 185.676 172.403L185.788 172.292L185.828 172.253L185.839 172.242L185.956 172.125L186.03 172.048L186.039 172.041L186.074 172.009L186.118 171.969L186.132 171.956L186.169 171.922L186.373 171.743L186.487 171.641C186.548 171.588 186.607 171.534 186.666 171.479L186.802 171.358C186.827 171.338 186.851 171.316 186.876 171.294L187.019 171.169L187.229 170.984L187.341 170.887C187.776 170.509 188.305 170.052 188.913 169.537L189.162 169.326L189.573 168.981L189.994 168.63C190.544 168.173 191.136 167.688 191.762 167.185L192.173 166.855C192.523 166.576 192.882 166.292 193.246 166.006C193.393 165.891 193.542 165.776 193.694 165.662C194.066 165.373 194.44 165.086 194.817 164.803C195.675 164.155 196.56 163.506 197.456 162.874L197.84 162.606C198.109 162.421 198.377 162.235 198.645 162.054L198.888 161.89C199.367 161.565 199.853 161.248 200.343 160.939L200.586 160.786L200.827 160.636C201.069 160.486 201.309 160.339 201.548 160.196L201.787 160.053L202.265 159.775L202.734 159.506L202.829 159.454L203.2 159.25C203.355 159.166 203.509 159.085 203.663 159.006L203.892 158.888L204.115 158.776C204.193 158.739 204.27 158.7 204.346 158.663C204.848 158.415 205.36 158.187 205.88 157.979C206.021 157.919 206.161 157.865 206.3 157.818L206.71 157.674C206.833 157.633 206.953 157.594 207.068 157.559L207.108 157.547C207.17 157.527 207.232 157.509 207.293 157.493L207.311 157.488C207.439 157.451 207.566 157.419 207.691 157.389H207.7C208.054 157.304 208.414 157.243 208.777 157.206C208.944 157.189 209.111 157.18 209.279 157.181H209.363C209.475 157.181 209.583 157.188 209.69 157.199C209.739 157.199 209.788 157.209 209.836 157.215H209.856C209.904 157.221 209.952 157.228 210 157.239C210.047 157.248 210.095 157.256 210.141 157.267H210.156C210.203 157.277 210.245 157.289 210.294 157.303C210.548 157.374 210.79 157.484 211.012 157.628C211.121 157.699 211.223 157.779 211.317 157.868L211.344 157.894C211.362 157.91 211.379 157.927 211.395 157.944L211.444 157.997C211.846 158.418 212.178 158.901 212.428 159.427L212.466 159.517C212.551 159.717 212.618 159.924 212.666 160.135C212.808 160.781 212.753 161.455 212.508 162.07C212.415 162.318 212.302 162.557 212.169 162.785C211.858 163.309 211.489 163.796 211.07 164.237L210.981 164.332C210.848 164.472 210.71 164.612 210.565 164.752C210.501 164.815 210.434 164.877 210.367 164.94L210.162 165.129L210.055 165.224C209.797 165.454 209.532 165.677 209.263 165.893C209.1 166.025 208.936 166.154 208.77 166.281C208.184 166.729 207.587 167.161 206.979 167.578C206.612 167.83 206.242 168.077 205.869 168.321C204.95 168.924 204.021 169.512 203.083 170.084C201.115 171.294 198.934 172.588 196.609 173.995L196.007 174.36C195.348 174.762 194.726 175.146 194.14 175.512L193.845 175.697L193.287 176.055C192.917 176.292 192.548 176.531 192.179 176.77L191.882 176.966C191.737 177.06 191.593 177.156 191.449 177.252L191.308 177.342L190.876 177.633L190.647 177.79L190.379 177.976L190.13 178.149C189.713 178.444 189.325 178.725 188.968 178.992L188.834 179.094C188.624 179.253 188.416 179.415 188.211 179.58C187.902 179.829 187.62 180.067 187.367 180.296L187.243 180.409C187.172 180.474 187.102 180.539 187.035 180.603C186.989 180.648 186.946 180.693 186.898 180.736L186.834 180.8C186.691 180.944 186.551 181.091 186.416 181.242L186.35 181.318C186.203 181.488 186.075 181.651 185.963 181.81L185.913 181.881C185.825 182.009 185.744 182.141 185.671 182.277C185.652 182.311 185.635 182.345 185.618 182.379L185.569 182.481L185.536 182.555L185.515 182.605L185.498 182.65L185.475 182.711C185.413 182.88 185.37 183.056 185.345 183.234L185.337 183.296L185.331 183.354V183.669C185.331 183.695 185.331 183.721 185.338 183.749L185.343 183.797C185.343 183.823 185.349 183.848 185.353 183.876C185.357 183.902 185.364 183.949 185.372 183.986V183.991C185.379 184.026 185.386 184.06 185.395 184.095C185.404 184.13 185.413 184.17 185.424 184.206C185.443 184.277 185.467 184.347 185.492 184.417C185.508 184.459 185.523 184.5 185.54 184.541C185.54 184.549 185.546 184.558 185.55 184.566L185.586 184.647L185.636 184.758C185.69 184.873 185.749 184.985 185.813 185.094L185.879 185.208L185.947 185.322C185.959 185.341 185.973 185.359 185.988 185.376L186.01 185.399L186.035 185.422L186.061 185.442C186.099 185.469 186.14 185.49 186.183 185.505C186.206 185.513 186.23 185.519 186.254 185.525C186.831 185.655 188.017 185.178 189.593 184.346C189.682 184.298 189.78 184.248 189.875 184.196L190.355 183.934L190.589 183.804C190.756 183.715 190.926 183.614 191.1 183.515L191.417 183.336C193.5 182.137 195.988 180.597 198.56 179.093C198.801 178.952 199.043 178.811 199.285 178.672L199.771 178.361C200.335 178.038 200.902 177.719 201.471 177.404C202.188 177.01 202.91 176.626 203.639 176.254L204.115 176.013C204.431 175.857 204.744 175.705 205.053 175.557C205.651 175.273 206.256 175.003 206.868 174.748L207.203 174.612L207.243 174.596C209.018 173.893 210.627 173.459 211.929 173.459C212.21 173.456 212.492 173.48 212.769 173.528H212.778C212.867 173.544 212.948 173.562 213.031 173.582H213.046C213.259 173.636 213.466 173.713 213.662 173.812C213.937 173.954 214.184 174.143 214.393 174.371C214.489 174.477 214.574 174.592 214.649 174.714C214.789 174.929 214.899 175.162 214.978 175.406C215.01 175.501 215.038 175.594 215.067 175.693C215.278 176.45 215.257 177.253 215.007 177.998Z",fill:"#FF9D00"}),$e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M203.21 123.685V123.194C203.21 81.34 169.292 47.411 127.435 47.411C85.5791 47.411 51.648 81.342 51.648 123.194V123.358C51.646 123.467 51.645 123.576 51.648 123.685C51.6529 123.848 51.6546 124.011 51.653 124.174L51.6581 124.534L51.661 124.663C51.661 124.723 51.6631 124.782 51.6651 124.842C51.6681 124.937 51.67 125.033 51.67 125.128L51.681 125.517L51.697 125.974L51.702 126.124L51.722 126.597V126.62C51.73 126.805 51.7401 126.989 51.7491 127.173L51.75 127.187C51.76 127.375 51.7701 127.564 51.7821 127.753C51.7921 127.927 51.802 128.101 51.815 128.275L51.8171 128.306C51.8258 128.455 51.8358 128.605 51.847 128.754L51.85 128.794L51.883 129.226L51.8861 129.254C51.8921 129.338 51.898 129.422 51.906 129.503C51.9658 130.224 52.0355 130.945 52.1151 131.664L52.12 131.709L52.181 132.238L52.2491 132.793L52.299 133.17L52.322 133.347C52.3753 133.755 52.433 134.162 52.495 134.568L52.4991 134.595L52.558 134.979C52.8435 136.808 53.1971 138.626 53.618 140.429L53.6231 140.451L53.655 140.586L53.746 140.971L53.802 140.904C56.002 138.274 59.158 136.824 62.689 136.824C65.519 136.824 68.4221 137.76 71.3321 139.605C73.2621 140.831 75.3961 143.002 77.5921 145.733C79.6241 142.911 82.4721 141.035 85.7301 140.523C86.3513 140.425 86.9792 140.376 87.6081 140.375C95.0441 140.375 99.523 146.828 101.215 152.633C102.051 154.594 106.08 163.526 112.156 169.568C121.392 178.795 123.703 188.316 119.132 198.511H119.148C119.459 198.546 119.772 198.578 120.087 198.607C120.274 198.625 120.46 198.643 120.648 198.659L120.714 198.665L121.127 198.7L121.507 198.73C121.869 198.758 122.232 198.784 122.596 198.807L122.885 198.824L123.114 198.838L123.256 198.846L123.703 198.869L123.825 198.874L124.294 198.895L124.816 198.915L125.235 198.927L125.305 198.929C125.394 198.933 125.483 198.936 125.572 198.936L125.668 198.939C126.258 198.953 126.847 198.96 127.437 198.959H128.063L128.51 198.954C128.62 198.949 128.729 198.949 128.84 198.949H129.014L129.165 198.945C129.224 198.943 129.283 198.941 129.343 198.941H129.522L129.873 198.932L130.401 198.914L130.982 198.888C131.15 198.882 131.316 198.873 131.482 198.865L131.661 198.854L131.927 198.84L132.083 198.831L132.201 198.823L132.738 198.788L133.274 198.749L133.761 198.71L134.103 198.681L134.479 198.647C135.107 198.591 135.733 198.525 136.359 198.45L136.786 198.399C132.287 188.247 134.616 178.767 143.813 169.577C149.876 163.519 153.905 154.587 154.745 152.625C156.438 146.821 160.914 140.368 168.352 140.368C168.981 140.368 169.61 140.418 170.231 140.516C173.486 141.028 176.334 142.904 178.369 145.726C180.566 142.996 182.699 140.823 184.63 139.597C187.539 137.753 190.445 136.817 193.272 136.817C196.388 136.817 199.212 137.947 201.345 140.02C201.384 139.851 201.422 139.682 201.459 139.512L201.568 139.006C201.607 138.821 201.646 138.636 201.683 138.451C201.749 138.124 201.815 137.797 201.878 137.467C201.944 137.125 202.007 136.781 202.067 136.437L202.098 136.251C202.117 136.141 202.135 136.031 202.156 135.92C202.19 135.748 202.218 135.576 202.246 135.402L202.257 135.336L202.328 134.883L202.398 134.424V134.42C202.449 134.081 202.497 133.742 202.542 133.403L202.553 133.319L202.616 132.841L202.667 132.433L202.757 131.629L202.792 131.306L202.801 131.218C202.82 131.044 202.838 130.87 202.854 130.696V130.682C202.867 130.544 202.881 130.405 202.893 130.266C202.964 129.478 203.024 128.686 203.072 127.891C203.081 127.761 203.088 127.63 203.096 127.499V127.493L203.122 127.002L203.128 126.892C203.144 126.56 203.158 126.228 203.169 125.896V125.884L203.174 125.754C203.179 125.645 203.183 125.535 203.183 125.425L203.185 125.381C203.189 125.278 203.193 125.172 203.193 125.067L203.196 124.977C203.199 124.872 203.202 124.768 203.202 124.663L203.204 124.574C203.207 124.441 203.21 124.307 203.21 124.174V123.685ZM108.638 199.391C114.64 190.59 114.214 183.984 105.98 175.754C97.7441 167.523 92.951 155.487 92.951 155.487C92.951 155.487 91.1621 148.496 87.0821 149.138C83.0021 149.78 80.0091 160.227 88.5521 166.622C97.0941 173.017 86.8521 177.353 83.5641 171.352C80.2761 165.35 71.299 149.923 66.645 146.972C61.991 144.021 58.718 145.675 59.815 151.757C60.36 154.776 65.4281 159.929 70.1631 164.743C74.9671 169.627 79.428 174.163 78.474 175.768C76.581 178.955 69.9141 172.023 69.9141 172.023C69.9141 172.023 49.038 153.025 44.494 157.976C40.304 162.539 46.765 166.418 56.7211 172.397C57.5671 172.905 58.4391 173.429 59.3321 173.969C70.7231 180.865 71.609 182.684 69.992 185.293C69.395 186.257 65.582 183.968 60.892 181.153C52.897 176.352 42.3551 170.023 40.8661 175.688C39.5781 180.591 47.334 183.595 54.368 186.32C60.228 188.59 65.5881 190.666 64.7991 193.484C63.9821 196.406 59.5531 193.969 54.7121 191.305C49.2771 188.314 43.3221 185.038 41.3731 188.735C37.6901 195.725 66.7831 203.954 67.0231 204.015C76.4231 206.453 100.295 211.619 108.638 199.391ZM147.303 199.391C141.301 190.59 141.727 183.984 149.962 175.754C158.197 167.523 162.99 155.487 162.99 155.487C162.99 155.487 164.779 148.496 168.859 149.138C172.939 149.78 175.932 160.227 167.39 166.622C158.847 173.017 169.089 177.353 172.377 171.352C175.666 165.35 184.637 149.923 189.291 146.972C193.945 144.021 197.22 145.675 196.122 151.757C195.578 154.776 190.509 159.929 185.774 164.744C180.97 169.628 176.509 174.163 177.462 175.768C179.355 178.955 186.027 172.019 186.027 172.019C186.027 172.019 206.902 153.022 211.448 157.973C215.637 162.535 209.176 166.415 199.219 172.394C198.348 172.917 197.478 173.441 196.609 173.966C185.218 180.862 184.332 182.681 185.948 185.289C186.546 186.254 190.359 183.964 195.048 181.149C203.044 176.349 213.586 170.019 215.075 175.685C216.364 180.588 208.607 183.592 201.573 186.317C195.713 188.587 190.353 190.663 191.141 193.481C191.957 196.402 196.385 193.965 201.225 191.301C206.66 188.31 212.616 185.032 214.564 188.732C218.248 195.726 189.15 203.947 188.915 204.007C179.515 206.453 155.643 211.619 147.303 199.391Z",fill:"#FFD21E"}),$e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152.047 102.567C153.229 102.985 154.108 104.257 154.944 105.468C156.074 107.104 157.126 108.627 158.74 107.769C160.644 106.756 162.205 105.202 163.225 103.302C164.246 101.402 164.681 99.2427 164.475 97.096C164.321 95.4908 163.813 93.9398 162.987 92.5548C162.161 91.1697 161.038 89.985 159.7 89.0862C158.361 88.1874 156.839 87.5968 155.245 87.3569C153.65 87.117 152.022 87.2339 150.478 87.699C148.934 88.1639 147.513 88.9653 146.316 90.0455C145.119 91.1257 144.176 92.4578 143.556 93.946C142.936 95.4342 142.653 97.0415 142.728 98.652C142.804 100.263 143.235 101.836 143.992 103.26C144.74 104.667 146.4 104.003 148.152 103.302C149.525 102.753 150.956 102.181 152.047 102.567ZM100.672 102.567C99.49 102.985 98.611 104.258 97.775 105.468C96.645 107.105 95.592 108.627 93.979 107.769C91.5845 106.501 89.7482 104.386 88.8278 101.838C87.9075 99.2895 87.9692 96.4896 89.0008 93.9841C90.0324 91.4786 91.9601 89.4471 94.408 88.2855C96.856 87.1239 99.6488 86.9156 102.242 87.701C104.307 88.3228 106.141 89.5427 107.513 91.2065C108.885 92.8704 109.732 94.9035 109.949 97.049C110.165 99.1945 109.74 101.356 108.728 103.26C107.979 104.667 106.319 104.003 104.567 103.303C103.193 102.753 101.764 102.181 100.672 102.567ZM144.099 149.318C152.242 142.903 155.233 132.429 155.233 125.977C155.233 120.877 151.802 122.482 146.309 125.202L145.999 125.355C140.957 127.852 134.245 131.177 126.877 131.177C119.508 131.177 112.796 127.852 107.755 125.354C102.084 122.545 98.527 120.783 98.527 125.978C98.527 132.634 101.709 143.563 110.443 149.912C111.596 147.573 113.219 145.497 115.211 143.813C117.202 142.129 119.52 140.874 122.018 140.126C122.89 139.866 123.788 141.367 124.707 142.904C125.594 144.386 126.501 145.902 127.423 145.902C128.406 145.902 129.371 144.408 130.314 142.95C131.299 141.425 132.26 139.94 133.189 140.237C137.864 141.738 141.775 144.993 144.099 149.318Z",fill:"#32343D"}),$e.jsx("path",{d:"M144.097 149.317C139.856 152.659 134.219 154.9 126.878 154.9C119.981 154.9 114.587 152.922 110.443 149.911C111.596 147.572 113.219 145.495 115.211 143.812C117.202 142.128 119.52 140.873 122.018 140.125C123.73 139.614 125.545 145.901 127.423 145.901C129.433 145.901 131.37 139.655 133.189 140.236C137.863 141.738 141.773 144.993 144.097 149.317Z",fill:"#FF323D"}),$e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M81.2 111.64C80.2312 112.288 79.1173 112.687 77.9572 112.801C76.7971 112.916 75.6267 112.742 74.55 112.295C73.6893 111.94 72.9072 111.418 72.2488 110.759C71.5903 110.101 71.0684 109.319 70.713 108.458C70.267 107.381 70.0935 106.211 70.2082 105.051C70.3228 103.891 70.7219 102.777 71.37 101.808C72.1488 100.642 73.2558 99.7333 74.5512 99.1967C75.8466 98.6601 77.272 98.5197 78.6471 98.7935C80.0223 99.0672 81.2853 99.7427 82.2764 100.734C83.2675 101.726 83.9422 102.99 84.215 104.365C84.4883 105.74 84.3477 107.165 83.8113 108.46C83.2748 109.755 82.3654 110.861 81.2 111.64ZM182.613 111.64C181.644 112.288 180.53 112.687 179.37 112.801C178.209 112.916 177.039 112.742 175.962 112.295C175.101 111.939 174.319 111.418 173.661 110.759C173.003 110.101 172.481 109.319 172.125 108.458C171.68 107.381 171.507 106.211 171.621 105.051C171.736 103.891 172.135 102.777 172.782 101.808C173.364 100.936 174.133 100.205 175.032 99.6658C175.931 99.1269 176.938 98.7942 177.981 98.6917C179.025 98.5891 180.078 98.7193 181.064 99.0728C182.051 99.4264 182.947 99.9944 183.688 100.736C184.68 101.727 185.355 102.99 185.628 104.365C185.902 105.74 185.761 107.165 185.224 108.46C184.687 109.755 183.779 110.861 182.613 111.64Z",fill:"#FFAD03"})]});function wT({onStart:t}){return $e.jsx("div",{className:"absolute inset-0 text-white flex items-center justify-center p-8",children:$e.jsxs("div",{className:"max-w-2xl w-full space-y-8",children:[$e.jsx(si,{className:"rounded-3xl shadow-2xl hover:scale-105 transition-transform duration-200",role:"banner",children:$e.jsxs("div",{className:"p-8 text-center",children:[$e.jsx("h1",{className:"text-5xl font-bold text-gray-100 mb-4",children:"FastVLM WebGPU"}),$e.jsxs("p",{className:"text-xl text-gray-300 leading-relaxed",children:["Real-time video captioning powered by"," ",$e.jsx("a",{href:"https://huggingface.co/onnx-community/FastVLM-0.5B-ONNX",className:"text-blue-400 underline hover:text-blue-300 transition-colors",target:"_blank",rel:"noopener noreferrer","aria-label":"FastVLM-0.5B model on Hugging Face",children:"FastVLM-0.5B"})]})]})}),$e.jsx(si,{bgColor:Ir.COLORS.SUCCESS_BG,className:"rounded-2xl shadow-2xl hover:scale-105 transition-transform duration-200",role:"status","aria-label":"Camera status",children:$e.jsx("div",{className:"p-4",children:$e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[$e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 animate-pulse"}),$e.jsx("p",{className:"text-green-400 font-medium",children:"Camera ready"})]})})}),$e.jsx(si,{className:"rounded-2xl shadow-2xl hover:scale-105 transition-transform duration-200",role:"region","aria-labelledby":"how-it-works-title",children:$e.jsxs("div",{className:"p-6",children:[$e.jsx("h2",{id:"how-it-works-title",className:"text-lg font-semibold text-gray-200 mb-4 text-center",children:"How it works:"}),$e.jsxs("div",{className:"space-y-3",children:[$e.jsxs("div",{className:"flex items-start space-x-3",children:[$e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-sm font-bold mt-0.5 flex-shrink-0",children:"1"}),$e.jsxs("p",{className:"text-gray-300",children:["You are about to load"," ",$e.jsx("a",{href:"https://huggingface.co/onnx-community/FastVLM-0.5B-ONNX",className:"text-blue-400 underline",target:"_blank",rel:"noopener noreferrer",children:"FastVLM-0.5B"}),", a powerful multimodal model optimized for in-browser inference."]})]}),$e.jsxs("div",{className:"flex items-start space-x-3",children:[$e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-sm font-bold mt-0.5 flex-shrink-0",children:"2"}),$e.jsxs("p",{className:"text-gray-300",children:["Everything runs entirely in your browser with"," ",$e.jsxs("a",{href:"https://github.com/huggingface/transformers.js",className:"text-blue-400 underline",target:"_blank",rel:"noopener noreferrer",children:[$e.jsx(vT,{className:"inline-flex w-7 h-7 pointer-events-none"}),"Transformers.js"]})," ","and ONNX Runtime Web, meaning no data is sent to a server. It can even run offline!"]})]}),$e.jsxs("div",{className:"flex items-start space-x-3",children:[$e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-sm font-bold mt-0.5 flex-shrink-0",children:"3"}),$e.jsx("p",{className:"text-gray-300",children:"Get started by clicking the button below."})]})]})]})}),$e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[$e.jsx(j1,{onClick:t,className:"px-8 py-4 rounded-2xl","aria-label":"Start live captioning with AI model",children:$e.jsx("span",{className:"font-semibold text-lg",children:"Start Live Captioning"})}),$e.jsx("p",{className:"text-sm text-gray-400 opacity-80",children:"AI model will load when you click start"})]})]})})}const Sr={HTTPS:"https",NOT_SUPPORTED:"not-supported",PERMISSION:"permission",GENERAL:"general"},xT={video:{width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},facingMode:"user"}};function TT({onPermissionGranted:t}){const[r,n]=xt.useState(!1),[a,o]=xt.useState(null),u=x=>{if(!navigator.mediaDevices)return{type:Sr.HTTPS,message:"Camera access requires a secure connection (HTTPS)"};if(!navigator.mediaDevices.getUserMedia)return{type:Sr.NOT_SUPPORTED,message:"Camera access not supported in this browser"};if(x instanceof DOMException)switch(x.name){case"NotAllowedError":return{type:Sr.PERMISSION,message:"Camera access denied"};case"NotFoundError":return{type:Sr.GENERAL,message:"No camera found"};case"NotReadableError":return{type:Sr.GENERAL,message:"Camera is in use by another application"};case"OverconstrainedError":return{type:Sr.GENERAL,message:"Camera doesn't meet requirements"};case"SecurityError":return{type:Sr.HTTPS,message:"Security error accessing camera"};default:return{type:Sr.GENERAL,message:`Camera error: ${x.name}`}}return{type:Sr.GENERAL,message:"Failed to access camera"}},d=xt.useCallback(async()=>{n(!0),o(null);try{if(!navigator.mediaDevices?.getUserMedia)throw new Error("NOT_SUPPORTED");const x=await navigator.mediaDevices.getUserMedia(xT);t(x)}catch(x){const F=u(x);o(F),console.error("Error accessing webcam:",x,F)}finally{n(!1)}},[t]);xt.useEffect(()=>{d()},[d]);const c=xt.useMemo(()=>({[Sr.HTTPS]:{title:"🔒 HTTPS Required",items:["Access this app via https:// instead of http://","If developing locally, use localhost (exempt from HTTPS requirement)","Deploy to a hosting service that provides HTTPS (Vercel, Netlify, GitHub Pages)"]},[Sr.NOT_SUPPORTED]:{title:"🌐 Browser Compatibility",items:["Update your browser to the latest version","Use Chrome 120+, Edge 120+, Firefox Nightly, or Safari 26 beta+","Enable JavaScript if disabled"]},[Sr.PERMISSION]:{title:"🚫 Permission Issues",items:["Click the camera icon in your browser's address bar",'Select "Always allow" for camera access',"Check browser settings → Privacy & Security → Camera","Clear browser data and try again"]},[Sr.GENERAL]:{title:"General Troubleshooting",items:["Check if camera permissions are blocked in your browser","Try refreshing the page and allowing access","Ensure no other apps are using your camera","Try using a different browser or device"]}}),[]),f=x=>({container:`border rounded-lg p-4 ${x?"bg-orange-900/20 border-orange-500/30":"bg-red-900/20 border-red-500/30"}`,text:`text-sm ${x?"text-orange-400":"text-red-400"}`,troubleshooting:{bg:`border rounded-lg p-3 ${x?"bg-orange-900/20 border-orange-500/30":"bg-red-900/20 border-red-500/30"}`,title:`text-xs font-semibold mb-2 ${x?"text-orange-400":"text-red-400"}`,list:`text-xs space-y-1 ${x?"text-orange-300":"text-red-300"}`}}),p=()=>{if(r)return $e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent",role:"progressbar","aria-label":"Requesting camera access"});const x="w-8 h-8",F=`w-16 h-16 rounded-full flex items-center justify-center ${a?"bg-red-500/20":"bg-blue-500/20"}`;return $e.jsx("div",{className:F,"aria-hidden":"true",children:a?$e.jsx("svg",{className:`${x} text-red-400`,fill:"currentColor",viewBox:"0 0 20 20",children:$e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):$e.jsx("svg",{className:`${x} text-blue-400`,fill:"currentColor",viewBox:"0 0 20 20",children:$e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})})})},g=()=>{if(!a)return null;const x=c[a.type],F=a.type===Sr.HTTPS,E=f(F);return $e.jsxs("div",{className:E.troubleshooting.bg,children:[$e.jsx("h4",{className:E.troubleshooting.title,children:x.title}),$e.jsx("ul",{className:E.troubleshooting.list,children:x.items.map((T,L)=>$e.jsxs("li",{children:["• ",T]},L))})]})},_=()=>r?"Requesting Camera Access":a?"Camera Access Required":"Camera Permission Required",h=()=>r?"Please allow camera access in your browser to continue...":a?a.message:"This app requires camera access for live video captioning. Please grant permission to continue.",w=a?.type===Sr.HTTPS,M=a?f(w):null;return $e.jsx("div",{className:"absolute inset-0 text-white flex items-center justify-center p-8",role:"dialog","aria-labelledby":"webcam-dialog-title","aria-describedby":"webcam-dialog-description",children:$e.jsxs("div",{className:"max-w-md w-full space-y-6",children:[$e.jsx(si,{className:"rounded-3xl shadow-2xl",bgColor:a?Ir.COLORS.ERROR_BG:Ir.COLORS.DEFAULT_BG,children:$e.jsxs("div",{className:"p-8 text-center space-y-6",children:[$e.jsxs("div",{className:"space-y-4",children:[$e.jsx("div",{className:"w-16 h-16 mx-auto",children:p()}),$e.jsx("h2",{id:"webcam-dialog-title",className:"text-2xl font-bold text-gray-100",children:_()}),$e.jsx("p",{id:"webcam-dialog-description",className:"text-gray-400",children:h()})]}),a&&M&&$e.jsxs("div",{className:"space-y-4",children:[$e.jsx("div",{className:M.container,children:$e.jsx("p",{className:M.text,children:w?"This app requires HTTPS to access your camera. Live video captioning cannot work without camera input.":"Camera access is required for this app to function. Live video captioning cannot work without camera input."})}),$e.jsx(j1,{onClick:d,disabled:r,className:"px-6 py-3","aria-label":"Try again to request camera access",children:"Try Again"})]}),r&&$e.jsx("p",{className:"text-sm text-gray-500",children:"If you don't see a permission dialog, check your browser settings or try refreshing the page."})]})}),a&&$e.jsx(si,{className:"rounded-2xl shadow-2xl",children:$e.jsxs("div",{className:"p-4 text-left",children:[$e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Troubleshooting:"}),$e.jsx("div",{className:"space-y-3",children:g()}),$e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700/30",children:[$e.jsxs("p",{className:"text-xs text-gray-500",children:["Current URL:"," ",$e.jsxs("code",{className:"bg-gray-800/50 px-1 rounded text-gray-400",children:[window.location.protocol,"//",window.location.host]})]}),w&&!window.location.protocol.startsWith("https")&&$e.jsx("p",{className:"text-xs text-orange-400 mt-1",children:"⚠️ Non-secure connection detected"})]})]})})]})})}function ET(){const[t,r]=xt.useState("requesting-permission"),[n,a]=xt.useState(null),[o,u]=xt.useState(!1),d=xt.useRef(null),c=xt.useCallback(w=>{a(w),r("welcome")},[]),f=xt.useCallback(()=>{r("loading")},[]),p=xt.useCallback(()=>{r("captioning")},[]),g=xt.useCallback(async w=>{try{await w.play()}catch(M){console.error("Failed to play video:",M)}},[]),_=xt.useCallback((w,M)=>{w.srcObject=M;const x=()=>{u(!0),g(w)};return w.addEventListener("canplay",x,{once:!0}),()=>{w.removeEventListener("canplay",x)}},[g]);xt.useEffect(()=>{if(n&&d.current){const w=d.current;return w.srcObject=null,w.load(),_(w,n)}},[n,_]);const h=xt.useMemo(()=>{switch(t){case"requesting-permission":return"blur(20px) brightness(0.2) saturate(0.5)";case"welcome":return"blur(12px) brightness(0.3) saturate(0.7)";case"loading":return"blur(8px) brightness(0.4) saturate(0.8)";case"captioning":return"none";default:return"blur(20px) brightness(0.2) saturate(0.5)"}},[t]);return $e.jsxs("div",{className:"App relative h-screen overflow-hidden",children:[$e.jsx("div",{className:"absolute inset-0 bg-gray-900"}),n&&$e.jsx("video",{ref:d,autoPlay:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover transition-all duration-1000 ease-out",style:{filter:h,opacity:o?1:0}}),t!=="captioning"&&$e.jsx("div",{className:"absolute inset-0 bg-gray-900/80 backdrop-blur-sm"}),t==="requesting-permission"&&$e.jsx(TT,{onPermissionGranted:c}),t==="welcome"&&$e.jsx(wT,{onStart:f}),t==="loading"&&$e.jsx(hT,{onComplete:p}),t==="captioning"&&$e.jsx(MT,{videoRef:d})]})}bx.createRoot(document.getElementById("root")).render($e.jsx(dx.StrictMode,{children:$e.jsx(dT,{children:$e.jsx(ET,{})})}));
